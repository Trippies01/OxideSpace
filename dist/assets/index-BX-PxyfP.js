(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function Qx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yp={exports:{}},yc={},Qp={exports:{}},Je={};var Tb;function gE(){if(Tb)return Je;Tb=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.iterator;function v(L){return L===null||typeof L!="object"?null:(L=g&&L[g]||L["@@iterator"],typeof L=="function"?L:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,x={};function C(L,G,ke){this.props=L,this.context=G,this.refs=x,this.updater=ke||w}C.prototype.isReactComponent={},C.prototype.setState=function(L,G){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,G,"setState")},C.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function E(){}E.prototype=C.prototype;function I(L,G,ke){this.props=L,this.context=G,this.refs=x,this.updater=ke||w}var N=I.prototype=new E;N.constructor=I,k(N,C.prototype),N.isPureReactComponent=!0;var P=Array.isArray,R=Object.prototype.hasOwnProperty,j={current:null},U={key:!0,ref:!0,__self:!0,__source:!0};function F(L,G,ke){var Te,Ne={},Ce=null,qe=null;if(G!=null)for(Te in G.ref!==void 0&&(qe=G.ref),G.key!==void 0&&(Ce=""+G.key),G)R.call(G,Te)&&!U.hasOwnProperty(Te)&&(Ne[Te]=G[Te]);var se=arguments.length-2;if(se===1)Ne.children=ke;else if(1<se){for(var _e=Array(se),Pe=0;Pe<se;Pe++)_e[Pe]=arguments[Pe+2];Ne.children=_e}if(L&&L.defaultProps)for(Te in se=L.defaultProps,se)Ne[Te]===void 0&&(Ne[Te]=se[Te]);return{$$typeof:t,type:L,key:Ce,ref:qe,props:Ne,_owner:j.current}}function H(L,G){return{$$typeof:t,type:L.type,key:G,ref:L.ref,props:L.props,_owner:L._owner}}function q(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function Q(L){var G={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(ke){return G[ke]})}var ne=/\/+/g;function Se(L,G){return typeof L=="object"&&L!==null&&L.key!=null?Q(""+L.key):G.toString(36)}function De(L,G,ke,Te,Ne){var Ce=typeof L;(Ce==="undefined"||Ce==="boolean")&&(L=null);var qe=!1;if(L===null)qe=!0;else switch(Ce){case"string":case"number":qe=!0;break;case"object":switch(L.$$typeof){case t:case e:qe=!0}}if(qe)return qe=L,Ne=Ne(qe),L=Te===""?"."+Se(qe,0):Te,P(Ne)?(ke="",L!=null&&(ke=L.replace(ne,"$&/")+"/"),De(Ne,G,ke,"",function(Pe){return Pe})):Ne!=null&&(q(Ne)&&(Ne=H(Ne,ke+(!Ne.key||qe&&qe.key===Ne.key?"":(""+Ne.key).replace(ne,"$&/")+"/")+L)),G.push(Ne)),1;if(qe=0,Te=Te===""?".":Te+":",P(L))for(var se=0;se<L.length;se++){Ce=L[se];var _e=Te+Se(Ce,se);qe+=De(Ce,G,ke,_e,Ne)}else if(_e=v(L),typeof _e=="function")for(L=_e.call(L),se=0;!(Ce=L.next()).done;)Ce=Ce.value,_e=Te+Se(Ce,se++),qe+=De(Ce,G,ke,_e,Ne);else if(Ce==="object")throw G=String(L),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.");return qe}function Ke(L,G,ke){if(L==null)return L;var Te=[],Ne=0;return De(L,Te,"","",function(Ce){return G.call(ke,Ce,Ne++)}),Te}function de(L){if(L._status===-1){var G=L._result;G=G(),G.then(function(ke){(L._status===0||L._status===-1)&&(L._status=1,L._result=ke)},function(ke){(L._status===0||L._status===-1)&&(L._status=2,L._result=ke)}),L._status===-1&&(L._status=0,L._result=G)}if(L._status===1)return L._result.default;throw L._result}var V={current:null},Z={transition:null},he={ReactCurrentDispatcher:V,ReactCurrentBatchConfig:Z,ReactCurrentOwner:j};function oe(){throw Error("act(...) is not supported in production builds of React.")}return Je.Children={map:Ke,forEach:function(L,G,ke){Ke(L,function(){G.apply(this,arguments)},ke)},count:function(L){var G=0;return Ke(L,function(){G++}),G},toArray:function(L){return Ke(L,function(G){return G})||[]},only:function(L){if(!q(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Je.Component=C,Je.Fragment=n,Je.Profiler=r,Je.PureComponent=I,Je.StrictMode=i,Je.Suspense=u,Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=he,Je.act=oe,Je.cloneElement=function(L,G,ke){if(L==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+L+".");var Te=k({},L.props),Ne=L.key,Ce=L.ref,qe=L._owner;if(G!=null){if(G.ref!==void 0&&(Ce=G.ref,qe=j.current),G.key!==void 0&&(Ne=""+G.key),L.type&&L.type.defaultProps)var se=L.type.defaultProps;for(_e in G)R.call(G,_e)&&!U.hasOwnProperty(_e)&&(Te[_e]=G[_e]===void 0&&se!==void 0?se[_e]:G[_e])}var _e=arguments.length-2;if(_e===1)Te.children=ke;else if(1<_e){se=Array(_e);for(var Pe=0;Pe<_e;Pe++)se[Pe]=arguments[Pe+2];Te.children=se}return{$$typeof:t,type:L.type,key:Ne,ref:Ce,props:Te,_owner:qe}},Je.createContext=function(L){return L={$$typeof:a,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},L.Provider={$$typeof:o,_context:L},L.Consumer=L},Je.createElement=F,Je.createFactory=function(L){var G=F.bind(null,L);return G.type=L,G},Je.createRef=function(){return{current:null}},Je.forwardRef=function(L){return{$$typeof:c,render:L}},Je.isValidElement=q,Je.lazy=function(L){return{$$typeof:f,_payload:{_status:-1,_result:L},_init:de}},Je.memo=function(L,G){return{$$typeof:h,type:L,compare:G===void 0?null:G}},Je.startTransition=function(L){var G=Z.transition;Z.transition={};try{L()}finally{Z.transition=G}},Je.unstable_act=oe,Je.useCallback=function(L,G){return V.current.useCallback(L,G)},Je.useContext=function(L){return V.current.useContext(L)},Je.useDebugValue=function(){},Je.useDeferredValue=function(L){return V.current.useDeferredValue(L)},Je.useEffect=function(L,G){return V.current.useEffect(L,G)},Je.useId=function(){return V.current.useId()},Je.useImperativeHandle=function(L,G,ke){return V.current.useImperativeHandle(L,G,ke)},Je.useInsertionEffect=function(L,G){return V.current.useInsertionEffect(L,G)},Je.useLayoutEffect=function(L,G){return V.current.useLayoutEffect(L,G)},Je.useMemo=function(L,G){return V.current.useMemo(L,G)},Je.useReducer=function(L,G,ke){return V.current.useReducer(L,G,ke)},Je.useRef=function(L){return V.current.useRef(L)},Je.useState=function(L){return V.current.useState(L)},Je.useSyncExternalStore=function(L,G,ke){return V.current.useSyncExternalStore(L,G,ke)},Je.useTransition=function(){return V.current.useTransition()},Je.version="18.3.1",Je}var Cb;function sv(){return Cb||(Cb=1,Qp.exports=gE()),Qp.exports}var _b;function vE(){if(_b)return yc;_b=1;var t=sv(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(c,u,h){var f,g={},v=null,w=null;h!==void 0&&(v=""+h),u.key!==void 0&&(v=""+u.key),u.ref!==void 0&&(w=u.ref);for(f in u)i.call(u,f)&&!o.hasOwnProperty(f)&&(g[f]=u[f]);if(c&&c.defaultProps)for(f in u=c.defaultProps,u)g[f]===void 0&&(g[f]=u[f]);return{$$typeof:e,type:c,key:v,ref:w,props:g,_owner:r.current}}return yc.Fragment=n,yc.jsx=a,yc.jsxs=a,yc}var Eb;function yE(){return Eb||(Eb=1,Yp.exports=vE()),Yp.exports}var m=yE(),S=sv();const pt=Qx(S);var Id={},Xp={exports:{}},ai={},Zp={exports:{}},em={};var Pb;function bE(){return Pb||(Pb=1,(function(t){function e(Z,he){var oe=Z.length;Z.push(he);e:for(;0<oe;){var L=oe-1>>>1,G=Z[L];if(0<r(G,he))Z[L]=he,Z[oe]=G,oe=L;else break e}}function n(Z){return Z.length===0?null:Z[0]}function i(Z){if(Z.length===0)return null;var he=Z[0],oe=Z.pop();if(oe!==he){Z[0]=oe;e:for(var L=0,G=Z.length,ke=G>>>1;L<ke;){var Te=2*(L+1)-1,Ne=Z[Te],Ce=Te+1,qe=Z[Ce];if(0>r(Ne,oe))Ce<G&&0>r(qe,Ne)?(Z[L]=qe,Z[Ce]=oe,L=Ce):(Z[L]=Ne,Z[Te]=oe,L=Te);else if(Ce<G&&0>r(qe,oe))Z[L]=qe,Z[Ce]=oe,L=Ce;else break e}}return he}function r(Z,he){var oe=Z.sortIndex-he.sortIndex;return oe!==0?oe:Z.id-he.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var u=[],h=[],f=1,g=null,v=3,w=!1,k=!1,x=!1,C=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(Z){for(var he=n(h);he!==null;){if(he.callback===null)i(h);else if(he.startTime<=Z)i(h),he.sortIndex=he.expirationTime,e(u,he);else break;he=n(h)}}function P(Z){if(x=!1,N(Z),!k)if(n(u)!==null)k=!0,de(R);else{var he=n(h);he!==null&&V(P,he.startTime-Z)}}function R(Z,he){k=!1,x&&(x=!1,E(F),F=-1),w=!0;var oe=v;try{for(N(he),g=n(u);g!==null&&(!(g.expirationTime>he)||Z&&!Q());){var L=g.callback;if(typeof L=="function"){g.callback=null,v=g.priorityLevel;var G=L(g.expirationTime<=he);he=t.unstable_now(),typeof G=="function"?g.callback=G:g===n(u)&&i(u),N(he)}else i(u);g=n(u)}if(g!==null)var ke=!0;else{var Te=n(h);Te!==null&&V(P,Te.startTime-he),ke=!1}return ke}finally{g=null,v=oe,w=!1}}var j=!1,U=null,F=-1,H=5,q=-1;function Q(){return!(t.unstable_now()-q<H)}function ne(){if(U!==null){var Z=t.unstable_now();q=Z;var he=!0;try{he=U(!0,Z)}finally{he?Se():(j=!1,U=null)}}else j=!1}var Se;if(typeof I=="function")Se=function(){I(ne)};else if(typeof MessageChannel<"u"){var De=new MessageChannel,Ke=De.port2;De.port1.onmessage=ne,Se=function(){Ke.postMessage(null)}}else Se=function(){C(ne,0)};function de(Z){U=Z,j||(j=!0,Se())}function V(Z,he){F=C(function(){Z(t.unstable_now())},he)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Z){Z.callback=null},t.unstable_continueExecution=function(){k||w||(k=!0,de(R))},t.unstable_forceFrameRate=function(Z){0>Z||125<Z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<Z?Math.floor(1e3/Z):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(Z){switch(v){case 1:case 2:case 3:var he=3;break;default:he=v}var oe=v;v=he;try{return Z()}finally{v=oe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Z,he){switch(Z){case 1:case 2:case 3:case 4:case 5:break;default:Z=3}var oe=v;v=Z;try{return he()}finally{v=oe}},t.unstable_scheduleCallback=function(Z,he,oe){var L=t.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?L+oe:L):oe=L,Z){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=oe+G,Z={id:f++,callback:he,priorityLevel:Z,startTime:oe,expirationTime:G,sortIndex:-1},oe>L?(Z.sortIndex=oe,e(h,Z),n(u)===null&&Z===n(h)&&(x?(E(F),F=-1):x=!0,V(P,oe-L))):(Z.sortIndex=G,e(u,Z),k||w||(k=!0,de(R))),Z},t.unstable_shouldYield=Q,t.unstable_wrapCallback=function(Z){var he=v;return function(){var oe=v;v=he;try{return Z.apply(this,arguments)}finally{v=oe}}}})(em)),em}var Rb;function wE(){return Rb||(Rb=1,Zp.exports=bE()),Zp.exports}var Nb;function kE(){if(Nb)return ai;Nb=1;var t=sv(),e=wE();function n(s){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+s,d=1;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+s+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function o(s,l){a(s,l),a(s+"Capture",l)}function a(s,l){for(r[s]=l,s=0;s<l.length;s++)i.add(l[s])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},g={};function v(s){return u.call(g,s)?!0:u.call(f,s)?!1:h.test(s)?g[s]=!0:(f[s]=!0,!1)}function w(s,l,d,p){if(d!==null&&d.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return p?!1:d!==null?!d.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function k(s,l,d,p){if(l===null||typeof l>"u"||w(s,l,d,p))return!0;if(p)return!1;if(d!==null)switch(d.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function x(s,l,d,p,y,b,T){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=p,this.attributeNamespace=y,this.mustUseProperty=d,this.propertyName=s,this.type=l,this.sanitizeURL=b,this.removeEmptyString=T}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){C[s]=new x(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var l=s[0];C[l]=new x(l,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){C[s]=new x(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){C[s]=new x(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){C[s]=new x(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){C[s]=new x(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){C[s]=new x(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){C[s]=new x(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){C[s]=new x(s,5,!1,s.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function I(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var l=s.replace(E,I);C[l]=new x(l,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var l=s.replace(E,I);C[l]=new x(l,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var l=s.replace(E,I);C[l]=new x(l,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){C[s]=new x(s,1,!1,s.toLowerCase(),null,!1,!1)}),C.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){C[s]=new x(s,1,!1,s.toLowerCase(),null,!0,!0)});function N(s,l,d,p){var y=C.hasOwnProperty(l)?C[l]:null;(y!==null?y.type!==0:p||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(k(l,d,y,p)&&(d=null),p||y===null?v(l)&&(d===null?s.removeAttribute(l):s.setAttribute(l,""+d)):y.mustUseProperty?s[y.propertyName]=d===null?y.type===3?!1:"":d:(l=y.attributeName,p=y.attributeNamespace,d===null?s.removeAttribute(l):(y=y.type,d=y===3||y===4&&d===!0?"":""+d,p?s.setAttributeNS(p,l,d):s.setAttribute(l,d))))}var P=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),j=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),H=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),Q=Symbol.for("react.context"),ne=Symbol.for("react.forward_ref"),Se=Symbol.for("react.suspense"),De=Symbol.for("react.suspense_list"),Ke=Symbol.for("react.memo"),de=Symbol.for("react.lazy"),V=Symbol.for("react.offscreen"),Z=Symbol.iterator;function he(s){return s===null||typeof s!="object"?null:(s=Z&&s[Z]||s["@@iterator"],typeof s=="function"?s:null)}var oe=Object.assign,L;function G(s){if(L===void 0)try{throw Error()}catch(d){var l=d.stack.trim().match(/\n( *(at )?)/);L=l&&l[1]||""}return`
`+L+s}var ke=!1;function Te(s,l){if(!s||ke)return"";ke=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(K){var p=K}Reflect.construct(s,[],l)}else{try{l.call()}catch(K){p=K}s.call(l.prototype)}else{try{throw Error()}catch(K){p=K}s()}}catch(K){if(K&&p&&typeof K.stack=="string"){for(var y=K.stack.split(`
`),b=p.stack.split(`
`),T=y.length-1,O=b.length-1;1<=T&&0<=O&&y[T]!==b[O];)O--;for(;1<=T&&0<=O;T--,O--)if(y[T]!==b[O]){if(T!==1||O!==1)do if(T--,O--,0>O||y[T]!==b[O]){var D=`
`+y[T].replace(" at new "," at ");return s.displayName&&D.includes("<anonymous>")&&(D=D.replace("<anonymous>",s.displayName)),D}while(1<=T&&0<=O);break}}}finally{ke=!1,Error.prepareStackTrace=d}return(s=s?s.displayName||s.name:"")?G(s):""}function Ne(s){switch(s.tag){case 5:return G(s.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return s=Te(s.type,!1),s;case 11:return s=Te(s.type.render,!1),s;case 1:return s=Te(s.type,!0),s;default:return""}}function Ce(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case U:return"Fragment";case j:return"Portal";case H:return"Profiler";case F:return"StrictMode";case Se:return"Suspense";case De:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Q:return(s.displayName||"Context")+".Consumer";case q:return(s._context.displayName||"Context")+".Provider";case ne:var l=s.render;return s=s.displayName,s||(s=l.displayName||l.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Ke:return l=s.displayName||null,l!==null?l:Ce(s.type)||"Memo";case de:l=s._payload,s=s._init;try{return Ce(s(l))}catch{}}return null}function qe(s){var l=s.type;switch(s.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=l.render,s=s.displayName||s.name||"",l.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ce(l);case 8:return l===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function se(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function _e(s){var l=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Pe(s){var l=_e(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,l),p=""+s[l];if(!s.hasOwnProperty(l)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,b=d.set;return Object.defineProperty(s,l,{configurable:!0,get:function(){return y.call(this)},set:function(T){p=""+T,b.call(this,T)}}),Object.defineProperty(s,l,{enumerable:d.enumerable}),{getValue:function(){return p},setValue:function(T){p=""+T},stopTracking:function(){s._valueTracker=null,delete s[l]}}}}function zt(s){s._valueTracker||(s._valueTracker=Pe(s))}function mt(s){if(!s)return!1;var l=s._valueTracker;if(!l)return!0;var d=l.getValue(),p="";return s&&(p=_e(s)?s.checked?"true":"false":s.value),s=p,s!==d?(l.setValue(s),!0):!1}function Et(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function wt(s,l){var d=l.checked;return oe({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??s._wrapperState.initialChecked})}function kn(s,l){var d=l.defaultValue==null?"":l.defaultValue,p=l.checked!=null?l.checked:l.defaultChecked;d=se(l.value!=null?l.value:d),s._wrapperState={initialChecked:p,initialValue:d,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function hi(s,l){l=l.checked,l!=null&&N(s,"checked",l,!1)}function $t(s,l){hi(s,l);var d=se(l.value),p=l.type;if(d!=null)p==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+d):s.value!==""+d&&(s.value=""+d);else if(p==="submit"||p==="reset"){s.removeAttribute("value");return}l.hasOwnProperty("value")?Hn(s,l.type,d):l.hasOwnProperty("defaultValue")&&Hn(s,l.type,se(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(s.defaultChecked=!!l.defaultChecked)}function et(s,l,d){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var p=l.type;if(!(p!=="submit"&&p!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+s._wrapperState.initialValue,d||l===s.value||(s.value=l),s.defaultValue=l}d=s.name,d!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,d!==""&&(s.name=d)}function Hn(s,l,d){(l!=="number"||Et(s.ownerDocument)!==s)&&(d==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+d&&(s.defaultValue=""+d))}var Zt=Array.isArray;function en(s,l,d,p){if(s=s.options,l){l={};for(var y=0;y<d.length;y++)l["$"+d[y]]=!0;for(d=0;d<s.length;d++)y=l.hasOwnProperty("$"+s[d].value),s[d].selected!==y&&(s[d].selected=y),y&&p&&(s[d].defaultSelected=!0)}else{for(d=""+se(d),l=null,y=0;y<s.length;y++){if(s[y].value===d){s[y].selected=!0,p&&(s[y].defaultSelected=!0);return}l!==null||s[y].disabled||(l=s[y])}l!==null&&(l.selected=!0)}}function be(s,l){if(l.dangerouslySetInnerHTML!=null)throw Error(n(91));return oe({},l,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function jt(s,l){var d=l.value;if(d==null){if(d=l.children,l=l.defaultValue,d!=null){if(l!=null)throw Error(n(92));if(Zt(d)){if(1<d.length)throw Error(n(93));d=d[0]}l=d}l==null&&(l=""),d=l}s._wrapperState={initialValue:se(d)}}function Gn(s,l){var d=se(l.value),p=se(l.defaultValue);d!=null&&(d=""+d,d!==s.value&&(s.value=d),l.defaultValue==null&&s.defaultValue!==d&&(s.defaultValue=d)),p!=null&&(s.defaultValue=""+p)}function xn(s){var l=s.textContent;l===s._wrapperState.initialValue&&l!==""&&l!==null&&(s.value=l)}function Sn(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dn(s,l){return s==null||s==="http://www.w3.org/1999/xhtml"?Sn(l):s==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Jn,fi=(function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,d,p,y){MSApp.execUnsafeLocalFunction(function(){return s(l,d,p,y)})}:s})(function(s,l){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=l;else{for(Jn=Jn||document.createElement("div"),Jn.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Jn.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;l.firstChild;)s.appendChild(l.firstChild)}});function Fi(s,l){if(l){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=l;return}}s.textContent=l}var kt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},so=["Webkit","ms","Moz","O"];Object.keys(kt).forEach(function(s){so.forEach(function(l){l=l+s.charAt(0).toUpperCase()+s.substring(1),kt[l]=kt[s]})});function Cr(s,l,d){return l==null||typeof l=="boolean"||l===""?"":d||typeof l!="number"||l===0||kt.hasOwnProperty(s)&&kt[s]?(""+l).trim():l+"px"}function rs(s,l){s=s.style;for(var d in l)if(l.hasOwnProperty(d)){var p=d.indexOf("--")===0,y=Cr(d,l[d],p);d==="float"&&(d="cssFloat"),p?s.setProperty(d,y):s[d]=y}}var or=oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _r(s,l){if(l){if(or[s]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(n(137,s));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(n(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(n(61))}if(l.style!=null&&typeof l.style!="object")throw Error(n(62))}}function ss(s,l){if(s.indexOf("-")===-1)return typeof l.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Er=null;function Ci(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Pr=null,Ge=null,lt=null;function tn(s){if(s=ic(s)){if(typeof Pr!="function")throw Error(n(280));var l=s.stateNode;l&&(l=Wu(l),Pr(s.stateNode,s.type,l))}}function Ht(s){Ge?lt?lt.push(s):lt=[s]:Ge=s}function xt(){if(Ge){var s=Ge,l=lt;if(lt=Ge=null,tn(s),l)for(s=0;s<l.length;s++)tn(l[s])}}function nn(s,l){return s(l)}function rn(){}var St=!1;function _i(s,l,d){if(St)return s(l,d);St=!0;try{return nn(s,l,d)}finally{St=!1,(Ge!==null||lt!==null)&&(rn(),xt())}}function dt(s,l){var d=s.stateNode;if(d===null)return null;var p=Wu(d);if(p===null)return null;d=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(s=s.type,p=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!p;break e;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(n(231,l,typeof d));return d}var Yn=!1;if(c)try{var Gt={};Object.defineProperty(Gt,"passive",{get:function(){Yn=!0}}),window.addEventListener("test",Gt,Gt),window.removeEventListener("test",Gt,Gt)}catch{Yn=!1}function pi(s,l,d,p,y,b,T,O,D){var K=Array.prototype.slice.call(arguments,3);try{l.apply(d,K)}catch(te){this.onError(te)}}var Qn=!1,hn=null,In=!1,Fn=null,Rr={onError:function(s){Qn=!0,hn=s}};function El(s,l,d,p,y,b,T,O,D){Qn=!1,hn=null,pi.apply(Rr,arguments)}function Cu(s,l,d,p,y,b,T,O,D){if(El.apply(this,arguments),Qn){if(Qn){var K=hn;Qn=!1,hn=null}else throw Error(n(198));In||(In=!0,Fn=K)}}function Xn(s){var l=s,d=s;if(s.alternate)for(;l.return;)l=l.return;else{s=l;do l=s,(l.flags&4098)!==0&&(d=l.return),s=l.return;while(s)}return l.tag===3?d:null}function os(s){if(s.tag===13){var l=s.memoizedState;if(l===null&&(s=s.alternate,s!==null&&(l=s.memoizedState)),l!==null)return l.dehydrated}return null}function Pl(s){if(Xn(s)!==s)throw Error(n(188))}function hf(s){var l=s.alternate;if(!l){if(l=Xn(s),l===null)throw Error(n(188));return l!==s?null:s}for(var d=s,p=l;;){var y=d.return;if(y===null)break;var b=y.alternate;if(b===null){if(p=y.return,p!==null){d=p;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===d)return Pl(y),s;if(b===p)return Pl(y),l;b=b.sibling}throw Error(n(188))}if(d.return!==p.return)d=y,p=b;else{for(var T=!1,O=y.child;O;){if(O===d){T=!0,d=y,p=b;break}if(O===p){T=!0,p=y,d=b;break}O=O.sibling}if(!T){for(O=b.child;O;){if(O===d){T=!0,d=b,p=y;break}if(O===p){T=!0,p=b,d=y;break}O=O.sibling}if(!T)throw Error(n(189))}}if(d.alternate!==p)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?s:l}function Rl(s){return s=hf(s),s!==null?Nl(s):null}function Nl(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var l=Nl(s);if(l!==null)return l;s=s.sibling}return null}var ta=e.unstable_scheduleCallback,Il=e.unstable_cancelCallback,na=e.unstable_shouldYield,ia=e.unstable_requestPaint,Pt=e.unstable_now,ra=e.unstable_getCurrentPriorityLevel,Ol=e.unstable_ImmediatePriority,as=e.unstable_UserBlockingPriority,sa=e.unstable_NormalPriority,ls=e.unstable_LowPriority,Nr=e.unstable_IdlePriority,oo=null,Bn=null;function _u(s){if(Bn&&typeof Bn.onCommitFiberRoot=="function")try{Bn.onCommitFiberRoot(oo,s,void 0,(s.current.flags&128)===128)}catch{}}var Be=Math.clz32?Math.clz32:Eu,ff=Math.log,Qe=Math.LN2;function Eu(s){return s>>>=0,s===0?32:31-(ff(s)/Qe|0)|0}var cs=64,oa=4194304;function us(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function aa(s,l){var d=s.pendingLanes;if(d===0)return 0;var p=0,y=s.suspendedLanes,b=s.pingedLanes,T=d&268435455;if(T!==0){var O=T&~y;O!==0?p=us(O):(b&=T,b!==0&&(p=us(b)))}else T=d&~y,T!==0?p=us(T):b!==0&&(p=us(b));if(p===0)return 0;if(l!==0&&l!==p&&(l&y)===0&&(y=p&-p,b=l&-l,y>=b||y===16&&(b&4194240)!==0))return l;if((p&4)!==0&&(p|=d&16),l=s.entangledLanes,l!==0)for(s=s.entanglements,l&=p;0<l;)d=31-Be(l),y=1<<d,p|=s[d],l&=~y;return p}function pf(s,l){switch(s){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mf(s,l){for(var d=s.suspendedLanes,p=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes;0<b;){var T=31-Be(b),O=1<<T,D=y[T];D===-1?((O&d)===0||(O&p)!==0)&&(y[T]=pf(O,l)):D<=l&&(s.expiredLanes|=O),b&=~O}}function Al(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function jl(){var s=cs;return cs<<=1,(cs&4194240)===0&&(cs=64),s}function Dl(s){for(var l=[],d=0;31>d;d++)l.push(s);return l}function ds(s,l,d){s.pendingLanes|=l,l!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,l=31-Be(l),s[l]=d}function Ml(s,l){var d=s.pendingLanes&~l;s.pendingLanes=l,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=l,s.mutableReadLanes&=l,s.entangledLanes&=l,l=s.entanglements;var p=s.eventTimes;for(s=s.expirationTimes;0<d;){var y=31-Be(d),b=1<<y;l[y]=0,p[y]=-1,s[y]=-1,d&=~b}}function Ll(s,l){var d=s.entangledLanes|=l;for(s=s.entanglements;d;){var p=31-Be(d),y=1<<p;y&l|s[p]&l&&(s[p]|=l),d&=~y}}var nt=0;function hs(s){return s&=-s,1<s?4<s?(s&268435455)!==0?16:536870912:4:1}var Ul,la,ao,Ir,ca,ar=!1,ua=[],mi=null,lr=null,Zn=null,lo=new Map,fs=new Map,cr=[],gf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pu(s,l){switch(s){case"focusin":case"focusout":mi=null;break;case"dragenter":case"dragleave":lr=null;break;case"mouseover":case"mouseout":Zn=null;break;case"pointerover":case"pointerout":lo.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":fs.delete(l.pointerId)}}function Or(s,l,d,p,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:l,domEventName:d,eventSystemFlags:p,nativeEvent:b,targetContainers:[y]},l!==null&&(l=ic(l),l!==null&&la(l)),s):(s.eventSystemFlags|=p,l=s.targetContainers,y!==null&&l.indexOf(y)===-1&&l.push(y),s)}function vf(s,l,d,p,y){switch(l){case"focusin":return mi=Or(mi,s,l,d,p,y),!0;case"dragenter":return lr=Or(lr,s,l,d,p,y),!0;case"mouseover":return Zn=Or(Zn,s,l,d,p,y),!0;case"pointerover":var b=y.pointerId;return lo.set(b,Or(lo.get(b)||null,s,l,d,p,y)),!0;case"gotpointercapture":return b=y.pointerId,fs.set(b,Or(fs.get(b)||null,s,l,d,p,y)),!0}return!1}function Fl(s){var l=xo(s.target);if(l!==null){var d=Xn(l);if(d!==null){if(l=d.tag,l===13){if(l=os(d),l!==null){s.blockedOn=l,ca(s.priority,function(){ao(d)});return}}else if(l===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function da(s){if(s.blockedOn!==null)return!1;for(var l=s.targetContainers;0<l.length;){var d=uo(s.domEventName,s.eventSystemFlags,l[0],s.nativeEvent);if(d===null){d=s.nativeEvent;var p=new d.constructor(d.type,d);Er=p,d.target.dispatchEvent(p),Er=null}else return l=ic(d),l!==null&&la(l),s.blockedOn=d,!1;l.shift()}return!0}function Bl(s,l,d){da(s)&&d.delete(l)}function yf(){ar=!1,mi!==null&&da(mi)&&(mi=null),lr!==null&&da(lr)&&(lr=null),Zn!==null&&da(Zn)&&(Zn=null),lo.forEach(Bl),fs.forEach(Bl)}function ps(s,l){s.blockedOn===l&&(s.blockedOn=null,ar||(ar=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,yf)))}function co(s){function l(y){return ps(y,s)}if(0<ua.length){ps(ua[0],s);for(var d=1;d<ua.length;d++){var p=ua[d];p.blockedOn===s&&(p.blockedOn=null)}}for(mi!==null&&ps(mi,s),lr!==null&&ps(lr,s),Zn!==null&&ps(Zn,s),lo.forEach(l),fs.forEach(l),d=0;d<cr.length;d++)p=cr[d],p.blockedOn===s&&(p.blockedOn=null);for(;0<cr.length&&(d=cr[0],d.blockedOn===null);)Fl(d),d.blockedOn===null&&cr.shift()}var Ar=P.ReactCurrentBatchConfig,ha=!0;function Ru(s,l,d,p){var y=nt,b=Ar.transition;Ar.transition=null;try{nt=1,Vl(s,l,d,p)}finally{nt=y,Ar.transition=b}}function bf(s,l,d,p){var y=nt,b=Ar.transition;Ar.transition=null;try{nt=4,Vl(s,l,d,p)}finally{nt=y,Ar.transition=b}}function Vl(s,l,d,p){if(ha){var y=uo(s,l,d,p);if(y===null)Bf(s,l,p,fa,d),Pu(s,p);else if(vf(y,s,l,d,p))p.stopPropagation();else if(Pu(s,p),l&4&&-1<gf.indexOf(s)){for(;y!==null;){var b=ic(y);if(b!==null&&Ul(b),b=uo(s,l,d,p),b===null&&Bf(s,l,p,fa,d),b===y)break;y=b}y!==null&&p.stopPropagation()}else Bf(s,l,p,null,d)}}var fa=null;function uo(s,l,d,p){if(fa=null,s=Ci(p),s=xo(s),s!==null)if(l=Xn(s),l===null)s=null;else if(d=l.tag,d===13){if(s=os(l),s!==null)return s;s=null}else if(d===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;s=null}else l!==s&&(s=null);return fa=s,null}function zl(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ra()){case Ol:return 1;case as:return 4;case sa:case ls:return 16;case Nr:return 536870912;default:return 16}default:return 16}}var ei=null,pa=null,jr=null;function Nu(){if(jr)return jr;var s,l=pa,d=l.length,p,y="value"in ei?ei.value:ei.textContent,b=y.length;for(s=0;s<d&&l[s]===y[s];s++);var T=d-s;for(p=1;p<=T&&l[d-p]===y[b-p];p++);return jr=y.slice(s,1<p?1-p:void 0)}function ma(s){var l=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&l===13&&(s=13)):s=l,s===10&&(s=13),32<=s||s===13?s:0}function ms(){return!0}function ga(){return!1}function On(s){function l(d,p,y,b,T){this._reactName=d,this._targetInst=y,this.type=p,this.nativeEvent=b,this.target=T,this.currentTarget=null;for(var O in s)s.hasOwnProperty(O)&&(d=s[O],this[O]=d?d(b):b[O]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?ms:ga,this.isPropagationStopped=ga,this}return oe(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=ms)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=ms)},persist:function(){},isPersistent:ms}),l}var gs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ho=On(gs),vs=oe({},gs,{view:0,detail:0}),$l=On(vs),Bi,ur,Dr,fo=oe({},vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wa,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Dr&&(Dr&&s.type==="mousemove"?(Bi=s.screenX-Dr.screenX,ur=s.screenY-Dr.screenY):ur=Bi=0,Dr=s),Bi)},movementY:function(s){return"movementY"in s?s.movementY:ur}}),va=On(fo),Iu=oe({},fo,{dataTransfer:0}),ql=On(Iu),Ou=oe({},vs,{relatedTarget:0}),ya=On(Ou),Au=oe({},gs,{animationName:0,elapsedTime:0,pseudoElement:0}),po=On(Au),wf=oe({},gs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),mo=On(wf),go=oe({},gs,{data:0}),Kl=On(go),vo={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ba={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ju={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kf(s){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(s):(s=ju[s])?!!l[s]:!1}function wa(){return kf}var xf=oe({},vs,{key:function(s){if(s.key){var l=vo[s.key]||s.key;if(l!=="Unidentified")return l}return s.type==="keypress"?(s=ma(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ba[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wa,charCode:function(s){return s.type==="keypress"?ma(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?ma(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Wl=On(xf),yo=oe({},fo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Du=On(yo),Sf=oe({},vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wa}),Tf=On(Sf),Cf=oe({},gs,{propertyName:0,elapsedTime:0,pseudoElement:0}),_f=On(Cf),Ef=oe({},fo,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Pf=On(Ef),Rf=[9,13,27,32],Hl=c&&"CompositionEvent"in window,bo=null;c&&"documentMode"in document&&(bo=document.documentMode);var Nf=c&&"TextEvent"in window&&!bo,Gl=c&&(!Hl||bo&&8<bo&&11>=bo),Jl=" ",Yl=!1;function Mu(s,l){switch(s){case"keyup":return Rf.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ql(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var ys=!1;function If(s,l){switch(s){case"compositionend":return Ql(l);case"keypress":return l.which!==32?null:(Yl=!0,Jl);case"textInput":return s=l.data,s===Jl&&Yl?null:s;default:return null}}function Lu(s,l){if(ys)return s==="compositionend"||!Hl&&Mu(s,l)?(s=Nu(),jr=pa=ei=null,ys=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return Gl&&l.locale!=="ko"?null:l.data;default:return null}}var Of={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uu(s){var l=s&&s.nodeName&&s.nodeName.toLowerCase();return l==="input"?!!Of[s.type]:l==="textarea"}function Fu(s,l,d,p){Ht(p),l=$u(l,"onChange"),0<l.length&&(d=new ho("onChange","change",null,d,p),s.push({event:d,listeners:l}))}var wo=null,ko=null;function Mr(s){B0(s,0)}function _(s){var l=Ca(s);if(mt(l))return s}function J(s,l){if(s==="change")return l}var Y=!1;if(c){var ce;if(c){var me="oninput"in document;if(!me){var Oe=document.createElement("div");Oe.setAttribute("oninput","return;"),me=typeof Oe.oninput=="function"}ce=me}else ce=!1;Y=ce&&(!document.documentMode||9<document.documentMode)}function Ve(){wo&&(wo.detachEvent("onpropertychange",pe),ko=wo=null)}function pe(s){if(s.propertyName==="value"&&_(ko)){var l=[];Fu(l,ko,s,Ci(s)),_i(Mr,l)}}function Ie(s,l,d){s==="focusin"?(Ve(),wo=l,ko=d,wo.attachEvent("onpropertychange",pe)):s==="focusout"&&Ve()}function Rt(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return _(ko)}function ti(s,l){if(s==="click")return _(l)}function bs(s,l){if(s==="input"||s==="change")return _(l)}function Fe(s,l){return s===l&&(s!==0||1/s===1/l)||s!==s&&l!==l}var We=typeof Object.is=="function"?Object.is:Fe;function ct(s,l){if(We(s,l))return!0;if(typeof s!="object"||s===null||typeof l!="object"||l===null)return!1;var d=Object.keys(s),p=Object.keys(l);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var y=d[p];if(!u.call(l,y)||!We(s[y],l[y]))return!1}return!0}function fn(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Dt(s,l){var d=fn(s);s=0;for(var p;d;){if(d.nodeType===3){if(p=s+d.textContent.length,s<=l&&p>=l)return{node:d,offset:l-s};s=p}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=fn(d)}}function Jt(s,l){return s&&l?s===l?!0:s&&s.nodeType===3?!1:l&&l.nodeType===3?Jt(s,l.parentNode):"contains"in s?s.contains(l):s.compareDocumentPosition?!!(s.compareDocumentPosition(l)&16):!1:!1}function ws(){for(var s=window,l=Et();l instanceof s.HTMLIFrameElement;){try{var d=typeof l.contentWindow.location.href=="string"}catch{d=!1}if(d)s=l.contentWindow;else break;l=Et(s.document)}return l}function Af(s){var l=s&&s.nodeName&&s.nodeName.toLowerCase();return l&&(l==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||l==="textarea"||s.contentEditable==="true")}function S_(s){var l=ws(),d=s.focusedElem,p=s.selectionRange;if(l!==d&&d&&d.ownerDocument&&Jt(d.ownerDocument.documentElement,d)){if(p!==null&&Af(d)){if(l=p.start,s=p.end,s===void 0&&(s=l),"selectionStart"in d)d.selectionStart=l,d.selectionEnd=Math.min(s,d.value.length);else if(s=(l=d.ownerDocument||document)&&l.defaultView||window,s.getSelection){s=s.getSelection();var y=d.textContent.length,b=Math.min(p.start,y);p=p.end===void 0?b:Math.min(p.end,y),!s.extend&&b>p&&(y=p,p=b,b=y),y=Dt(d,b);var T=Dt(d,p);y&&T&&(s.rangeCount!==1||s.anchorNode!==y.node||s.anchorOffset!==y.offset||s.focusNode!==T.node||s.focusOffset!==T.offset)&&(l=l.createRange(),l.setStart(y.node,y.offset),s.removeAllRanges(),b>p?(s.addRange(l),s.extend(T.node,T.offset)):(l.setEnd(T.node,T.offset),s.addRange(l)))}}for(l=[],s=d;s=s.parentNode;)s.nodeType===1&&l.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<l.length;d++)s=l[d],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var T_=c&&"documentMode"in document&&11>=document.documentMode,ka=null,jf=null,Xl=null,Df=!1;function I0(s,l,d){var p=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Df||ka==null||ka!==Et(p)||(p=ka,"selectionStart"in p&&Af(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Xl&&ct(Xl,p)||(Xl=p,p=$u(jf,"onSelect"),0<p.length&&(l=new ho("onSelect","select",null,l,d),s.push({event:l,listeners:p}),l.target=ka)))}function Bu(s,l){var d={};return d[s.toLowerCase()]=l.toLowerCase(),d["Webkit"+s]="webkit"+l,d["Moz"+s]="moz"+l,d}var xa={animationend:Bu("Animation","AnimationEnd"),animationiteration:Bu("Animation","AnimationIteration"),animationstart:Bu("Animation","AnimationStart"),transitionend:Bu("Transition","TransitionEnd")},Mf={},O0={};c&&(O0=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);function Vu(s){if(Mf[s])return Mf[s];if(!xa[s])return s;var l=xa[s],d;for(d in l)if(l.hasOwnProperty(d)&&d in O0)return Mf[s]=l[d];return s}var A0=Vu("animationend"),j0=Vu("animationiteration"),D0=Vu("animationstart"),M0=Vu("transitionend"),L0=new Map,U0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ks(s,l){L0.set(s,l),o(l,[s])}for(var Lf=0;Lf<U0.length;Lf++){var Uf=U0[Lf],C_=Uf.toLowerCase(),__=Uf[0].toUpperCase()+Uf.slice(1);ks(C_,"on"+__)}ks(A0,"onAnimationEnd"),ks(j0,"onAnimationIteration"),ks(D0,"onAnimationStart"),ks("dblclick","onDoubleClick"),ks("focusin","onFocus"),ks("focusout","onBlur"),ks(M0,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),E_=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zl));function F0(s,l,d){var p=s.type||"unknown-event";s.currentTarget=d,Cu(p,l,void 0,s),s.currentTarget=null}function B0(s,l){l=(l&4)!==0;for(var d=0;d<s.length;d++){var p=s[d],y=p.event;p=p.listeners;e:{var b=void 0;if(l)for(var T=p.length-1;0<=T;T--){var O=p[T],D=O.instance,K=O.currentTarget;if(O=O.listener,D!==b&&y.isPropagationStopped())break e;F0(y,O,K),b=D}else for(T=0;T<p.length;T++){if(O=p[T],D=O.instance,K=O.currentTarget,O=O.listener,D!==b&&y.isPropagationStopped())break e;F0(y,O,K),b=D}}}if(In)throw s=Fn,In=!1,Fn=null,s}function gt(s,l){var d=l[Wf];d===void 0&&(d=l[Wf]=new Set);var p=s+"__bubble";d.has(p)||(V0(l,s,2,!1),d.add(p))}function Ff(s,l,d){var p=0;l&&(p|=4),V0(d,s,p,l)}var zu="_reactListening"+Math.random().toString(36).slice(2);function ec(s){if(!s[zu]){s[zu]=!0,i.forEach(function(d){d!=="selectionchange"&&(E_.has(d)||Ff(d,!1,s),Ff(d,!0,s))});var l=s.nodeType===9?s:s.ownerDocument;l===null||l[zu]||(l[zu]=!0,Ff("selectionchange",!1,l))}}function V0(s,l,d,p){switch(zl(l)){case 1:var y=Ru;break;case 4:y=bf;break;default:y=Vl}d=y.bind(null,l,d,s),y=void 0,!Yn||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(y=!0),p?y!==void 0?s.addEventListener(l,d,{capture:!0,passive:y}):s.addEventListener(l,d,!0):y!==void 0?s.addEventListener(l,d,{passive:y}):s.addEventListener(l,d,!1)}function Bf(s,l,d,p,y){var b=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var T=p.tag;if(T===3||T===4){var O=p.stateNode.containerInfo;if(O===y||O.nodeType===8&&O.parentNode===y)break;if(T===4)for(T=p.return;T!==null;){var D=T.tag;if((D===3||D===4)&&(D=T.stateNode.containerInfo,D===y||D.nodeType===8&&D.parentNode===y))return;T=T.return}for(;O!==null;){if(T=xo(O),T===null)return;if(D=T.tag,D===5||D===6){p=b=T;continue e}O=O.parentNode}}p=p.return}_i(function(){var K=b,te=Ci(d),re=[];e:{var ee=L0.get(s);if(ee!==void 0){var ge=ho,we=s;switch(s){case"keypress":if(ma(d)===0)break e;case"keydown":case"keyup":ge=Wl;break;case"focusin":we="focus",ge=ya;break;case"focusout":we="blur",ge=ya;break;case"beforeblur":case"afterblur":ge=ya;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=va;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=ql;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Tf;break;case A0:case j0:case D0:ge=po;break;case M0:ge=_f;break;case"scroll":ge=$l;break;case"wheel":ge=Pf;break;case"copy":case"cut":case"paste":ge=mo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=Du}var xe=(l&4)!==0,qt=!xe&&s==="scroll",B=xe?ee!==null?ee+"Capture":null:ee;xe=[];for(var M=K,$;M!==null;){$=M;var ae=$.stateNode;if($.tag===5&&ae!==null&&($=ae,B!==null&&(ae=dt(M,B),ae!=null&&xe.push(tc(M,ae,$)))),qt)break;M=M.return}0<xe.length&&(ee=new ge(ee,we,null,d,te),re.push({event:ee,listeners:xe}))}}if((l&7)===0){e:{if(ee=s==="mouseover"||s==="pointerover",ge=s==="mouseout"||s==="pointerout",ee&&d!==Er&&(we=d.relatedTarget||d.fromElement)&&(xo(we)||we[Lr]))break e;if((ge||ee)&&(ee=te.window===te?te:(ee=te.ownerDocument)?ee.defaultView||ee.parentWindow:window,ge?(we=d.relatedTarget||d.toElement,ge=K,we=we?xo(we):null,we!==null&&(qt=Xn(we),we!==qt||we.tag!==5&&we.tag!==6)&&(we=null)):(ge=null,we=K),ge!==we)){if(xe=va,ae="onMouseLeave",B="onMouseEnter",M="mouse",(s==="pointerout"||s==="pointerover")&&(xe=Du,ae="onPointerLeave",B="onPointerEnter",M="pointer"),qt=ge==null?ee:Ca(ge),$=we==null?ee:Ca(we),ee=new xe(ae,M+"leave",ge,d,te),ee.target=qt,ee.relatedTarget=$,ae=null,xo(te)===K&&(xe=new xe(B,M+"enter",we,d,te),xe.target=$,xe.relatedTarget=qt,ae=xe),qt=ae,ge&&we)t:{for(xe=ge,B=we,M=0,$=xe;$;$=Sa($))M++;for($=0,ae=B;ae;ae=Sa(ae))$++;for(;0<M-$;)xe=Sa(xe),M--;for(;0<$-M;)B=Sa(B),$--;for(;M--;){if(xe===B||B!==null&&xe===B.alternate)break t;xe=Sa(xe),B=Sa(B)}xe=null}else xe=null;ge!==null&&z0(re,ee,ge,xe,!1),we!==null&&qt!==null&&z0(re,qt,we,xe,!0)}}e:{if(ee=K?Ca(K):window,ge=ee.nodeName&&ee.nodeName.toLowerCase(),ge==="select"||ge==="input"&&ee.type==="file")var Ee=J;else if(Uu(ee))if(Y)Ee=bs;else{Ee=Rt;var Ae=Ie}else(ge=ee.nodeName)&&ge.toLowerCase()==="input"&&(ee.type==="checkbox"||ee.type==="radio")&&(Ee=ti);if(Ee&&(Ee=Ee(s,K))){Fu(re,Ee,d,te);break e}Ae&&Ae(s,ee,K),s==="focusout"&&(Ae=ee._wrapperState)&&Ae.controlled&&ee.type==="number"&&Hn(ee,"number",ee.value)}switch(Ae=K?Ca(K):window,s){case"focusin":(Uu(Ae)||Ae.contentEditable==="true")&&(ka=Ae,jf=K,Xl=null);break;case"focusout":Xl=jf=ka=null;break;case"mousedown":Df=!0;break;case"contextmenu":case"mouseup":case"dragend":Df=!1,I0(re,d,te);break;case"selectionchange":if(T_)break;case"keydown":case"keyup":I0(re,d,te)}var je;if(Hl)e:{switch(s){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else ys?Mu(s,d)&&(ze="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(ze="onCompositionStart");ze&&(Gl&&d.locale!=="ko"&&(ys||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&ys&&(je=Nu()):(ei=te,pa="value"in ei?ei.value:ei.textContent,ys=!0)),Ae=$u(K,ze),0<Ae.length&&(ze=new Kl(ze,s,null,d,te),re.push({event:ze,listeners:Ae}),je?ze.data=je:(je=Ql(d),je!==null&&(ze.data=je)))),(je=Nf?If(s,d):Lu(s,d))&&(K=$u(K,"onBeforeInput"),0<K.length&&(te=new Kl("onBeforeInput","beforeinput",null,d,te),re.push({event:te,listeners:K}),te.data=je))}B0(re,l)})}function tc(s,l,d){return{instance:s,listener:l,currentTarget:d}}function $u(s,l){for(var d=l+"Capture",p=[];s!==null;){var y=s,b=y.stateNode;y.tag===5&&b!==null&&(y=b,b=dt(s,d),b!=null&&p.unshift(tc(s,b,y)),b=dt(s,l),b!=null&&p.push(tc(s,b,y))),s=s.return}return p}function Sa(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function z0(s,l,d,p,y){for(var b=l._reactName,T=[];d!==null&&d!==p;){var O=d,D=O.alternate,K=O.stateNode;if(D!==null&&D===p)break;O.tag===5&&K!==null&&(O=K,y?(D=dt(d,b),D!=null&&T.unshift(tc(d,D,O))):y||(D=dt(d,b),D!=null&&T.push(tc(d,D,O)))),d=d.return}T.length!==0&&s.push({event:l,listeners:T})}var P_=/\r\n?/g,R_=/\u0000|\uFFFD/g;function $0(s){return(typeof s=="string"?s:""+s).replace(P_,`
`).replace(R_,"")}function qu(s,l,d){if(l=$0(l),$0(s)!==l&&d)throw Error(n(425))}function Ku(){}var Vf=null,zf=null;function $f(s,l){return s==="textarea"||s==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var qf=typeof setTimeout=="function"?setTimeout:void 0,N_=typeof clearTimeout=="function"?clearTimeout:void 0,q0=typeof Promise=="function"?Promise:void 0,I_=typeof queueMicrotask=="function"?queueMicrotask:typeof q0<"u"?function(s){return q0.resolve(null).then(s).catch(O_)}:qf;function O_(s){setTimeout(function(){throw s})}function Kf(s,l){var d=l,p=0;do{var y=d.nextSibling;if(s.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"){if(p===0){s.removeChild(y),co(l);return}p--}else d!=="$"&&d!=="$?"&&d!=="$!"||p++;d=y}while(d);co(l)}function xs(s){for(;s!=null;s=s.nextSibling){var l=s.nodeType;if(l===1||l===3)break;if(l===8){if(l=s.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return s}function K0(s){s=s.previousSibling;for(var l=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(l===0)return s;l--}else d==="/$"&&l++}s=s.previousSibling}return null}var Ta=Math.random().toString(36).slice(2),dr="__reactFiber$"+Ta,nc="__reactProps$"+Ta,Lr="__reactContainer$"+Ta,Wf="__reactEvents$"+Ta,A_="__reactListeners$"+Ta,j_="__reactHandles$"+Ta;function xo(s){var l=s[dr];if(l)return l;for(var d=s.parentNode;d;){if(l=d[Lr]||d[dr]){if(d=l.alternate,l.child!==null||d!==null&&d.child!==null)for(s=K0(s);s!==null;){if(d=s[dr])return d;s=K0(s)}return l}s=d,d=s.parentNode}return null}function ic(s){return s=s[dr]||s[Lr],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Ca(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(n(33))}function Wu(s){return s[nc]||null}var Hf=[],_a=-1;function Ss(s){return{current:s}}function vt(s){0>_a||(s.current=Hf[_a],Hf[_a]=null,_a--)}function ht(s,l){_a++,Hf[_a]=s.current,s.current=l}var Ts={},An=Ss(Ts),ni=Ss(!1),So=Ts;function Ea(s,l){var d=s.type.contextTypes;if(!d)return Ts;var p=s.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===l)return p.__reactInternalMemoizedMaskedChildContext;var y={},b;for(b in d)y[b]=l[b];return p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=l,s.__reactInternalMemoizedMaskedChildContext=y),y}function ii(s){return s=s.childContextTypes,s!=null}function Hu(){vt(ni),vt(An)}function W0(s,l,d){if(An.current!==Ts)throw Error(n(168));ht(An,l),ht(ni,d)}function H0(s,l,d){var p=s.stateNode;if(l=l.childContextTypes,typeof p.getChildContext!="function")return d;p=p.getChildContext();for(var y in p)if(!(y in l))throw Error(n(108,qe(s)||"Unknown",y));return oe({},d,p)}function Gu(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Ts,So=An.current,ht(An,s),ht(ni,ni.current),!0}function G0(s,l,d){var p=s.stateNode;if(!p)throw Error(n(169));d?(s=H0(s,l,So),p.__reactInternalMemoizedMergedChildContext=s,vt(ni),vt(An),ht(An,s)):vt(ni),ht(ni,d)}var Ur=null,Ju=!1,Gf=!1;function J0(s){Ur===null?Ur=[s]:Ur.push(s)}function D_(s){Ju=!0,J0(s)}function Cs(){if(!Gf&&Ur!==null){Gf=!0;var s=0,l=nt;try{var d=Ur;for(nt=1;s<d.length;s++){var p=d[s];do p=p(!0);while(p!==null)}Ur=null,Ju=!1}catch(y){throw Ur!==null&&(Ur=Ur.slice(s+1)),ta(Ol,Cs),y}finally{nt=l,Gf=!1}}return null}var Pa=[],Ra=0,Yu=null,Qu=0,Ei=[],Pi=0,To=null,Fr=1,Br="";function Co(s,l){Pa[Ra++]=Qu,Pa[Ra++]=Yu,Yu=s,Qu=l}function Y0(s,l,d){Ei[Pi++]=Fr,Ei[Pi++]=Br,Ei[Pi++]=To,To=s;var p=Fr;s=Br;var y=32-Be(p)-1;p&=~(1<<y),d+=1;var b=32-Be(l)+y;if(30<b){var T=y-y%5;b=(p&(1<<T)-1).toString(32),p>>=T,y-=T,Fr=1<<32-Be(l)+y|d<<y|p,Br=b+s}else Fr=1<<b|d<<y|p,Br=s}function Jf(s){s.return!==null&&(Co(s,1),Y0(s,1,0))}function Yf(s){for(;s===Yu;)Yu=Pa[--Ra],Pa[Ra]=null,Qu=Pa[--Ra],Pa[Ra]=null;for(;s===To;)To=Ei[--Pi],Ei[Pi]=null,Br=Ei[--Pi],Ei[Pi]=null,Fr=Ei[--Pi],Ei[Pi]=null}var gi=null,vi=null,Tt=!1,Vi=null;function Q0(s,l){var d=Oi(5,null,null,0);d.elementType="DELETED",d.stateNode=l,d.return=s,l=s.deletions,l===null?(s.deletions=[d],s.flags|=16):l.push(d)}function X0(s,l){switch(s.tag){case 5:var d=s.type;return l=l.nodeType!==1||d.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(s.stateNode=l,gi=s,vi=xs(l.firstChild),!0):!1;case 6:return l=s.pendingProps===""||l.nodeType!==3?null:l,l!==null?(s.stateNode=l,gi=s,vi=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(d=To!==null?{id:Fr,overflow:Br}:null,s.memoizedState={dehydrated:l,treeContext:d,retryLane:1073741824},d=Oi(18,null,null,0),d.stateNode=l,d.return=s,s.child=d,gi=s,vi=null,!0):!1;default:return!1}}function Qf(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Xf(s){if(Tt){var l=vi;if(l){var d=l;if(!X0(s,l)){if(Qf(s))throw Error(n(418));l=xs(d.nextSibling);var p=gi;l&&X0(s,l)?Q0(p,d):(s.flags=s.flags&-4097|2,Tt=!1,gi=s)}}else{if(Qf(s))throw Error(n(418));s.flags=s.flags&-4097|2,Tt=!1,gi=s}}}function Z0(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;gi=s}function Xu(s){if(s!==gi)return!1;if(!Tt)return Z0(s),Tt=!0,!1;var l;if((l=s.tag!==3)&&!(l=s.tag!==5)&&(l=s.type,l=l!=="head"&&l!=="body"&&!$f(s.type,s.memoizedProps)),l&&(l=vi)){if(Qf(s))throw ey(),Error(n(418));for(;l;)Q0(s,l),l=xs(l.nextSibling)}if(Z0(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));e:{for(s=s.nextSibling,l=0;s;){if(s.nodeType===8){var d=s.data;if(d==="/$"){if(l===0){vi=xs(s.nextSibling);break e}l--}else d!=="$"&&d!=="$!"&&d!=="$?"||l++}s=s.nextSibling}vi=null}}else vi=gi?xs(s.stateNode.nextSibling):null;return!0}function ey(){for(var s=vi;s;)s=xs(s.nextSibling)}function Na(){vi=gi=null,Tt=!1}function Zf(s){Vi===null?Vi=[s]:Vi.push(s)}var M_=P.ReactCurrentBatchConfig;function rc(s,l,d){if(s=d.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var p=d.stateNode}if(!p)throw Error(n(147,s));var y=p,b=""+s;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===b?l.ref:(l=function(T){var O=y.refs;T===null?delete O[b]:O[b]=T},l._stringRef=b,l)}if(typeof s!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,s))}return s}function Zu(s,l){throw s=Object.prototype.toString.call(l),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":s))}function ty(s){var l=s._init;return l(s._payload)}function ny(s){function l(B,M){if(s){var $=B.deletions;$===null?(B.deletions=[M],B.flags|=16):$.push(M)}}function d(B,M){if(!s)return null;for(;M!==null;)l(B,M),M=M.sibling;return null}function p(B,M){for(B=new Map;M!==null;)M.key!==null?B.set(M.key,M):B.set(M.index,M),M=M.sibling;return B}function y(B,M){return B=As(B,M),B.index=0,B.sibling=null,B}function b(B,M,$){return B.index=$,s?($=B.alternate,$!==null?($=$.index,$<M?(B.flags|=2,M):$):(B.flags|=2,M)):(B.flags|=1048576,M)}function T(B){return s&&B.alternate===null&&(B.flags|=2),B}function O(B,M,$,ae){return M===null||M.tag!==6?(M=qp($,B.mode,ae),M.return=B,M):(M=y(M,$),M.return=B,M)}function D(B,M,$,ae){var Ee=$.type;return Ee===U?te(B,M,$.props.children,ae,$.key):M!==null&&(M.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===de&&ty(Ee)===M.type)?(ae=y(M,$.props),ae.ref=rc(B,M,$),ae.return=B,ae):(ae=Sd($.type,$.key,$.props,null,B.mode,ae),ae.ref=rc(B,M,$),ae.return=B,ae)}function K(B,M,$,ae){return M===null||M.tag!==4||M.stateNode.containerInfo!==$.containerInfo||M.stateNode.implementation!==$.implementation?(M=Kp($,B.mode,ae),M.return=B,M):(M=y(M,$.children||[]),M.return=B,M)}function te(B,M,$,ae,Ee){return M===null||M.tag!==7?(M=Ao($,B.mode,ae,Ee),M.return=B,M):(M=y(M,$),M.return=B,M)}function re(B,M,$){if(typeof M=="string"&&M!==""||typeof M=="number")return M=qp(""+M,B.mode,$),M.return=B,M;if(typeof M=="object"&&M!==null){switch(M.$$typeof){case R:return $=Sd(M.type,M.key,M.props,null,B.mode,$),$.ref=rc(B,null,M),$.return=B,$;case j:return M=Kp(M,B.mode,$),M.return=B,M;case de:var ae=M._init;return re(B,ae(M._payload),$)}if(Zt(M)||he(M))return M=Ao(M,B.mode,$,null),M.return=B,M;Zu(B,M)}return null}function ee(B,M,$,ae){var Ee=M!==null?M.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return Ee!==null?null:O(B,M,""+$,ae);if(typeof $=="object"&&$!==null){switch($.$$typeof){case R:return $.key===Ee?D(B,M,$,ae):null;case j:return $.key===Ee?K(B,M,$,ae):null;case de:return Ee=$._init,ee(B,M,Ee($._payload),ae)}if(Zt($)||he($))return Ee!==null?null:te(B,M,$,ae,null);Zu(B,$)}return null}function ge(B,M,$,ae,Ee){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return B=B.get($)||null,O(M,B,""+ae,Ee);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case R:return B=B.get(ae.key===null?$:ae.key)||null,D(M,B,ae,Ee);case j:return B=B.get(ae.key===null?$:ae.key)||null,K(M,B,ae,Ee);case de:var Ae=ae._init;return ge(B,M,$,Ae(ae._payload),Ee)}if(Zt(ae)||he(ae))return B=B.get($)||null,te(M,B,ae,Ee,null);Zu(M,ae)}return null}function we(B,M,$,ae){for(var Ee=null,Ae=null,je=M,ze=M=0,gn=null;je!==null&&ze<$.length;ze++){je.index>ze?(gn=je,je=null):gn=je.sibling;var st=ee(B,je,$[ze],ae);if(st===null){je===null&&(je=gn);break}s&&je&&st.alternate===null&&l(B,je),M=b(st,M,ze),Ae===null?Ee=st:Ae.sibling=st,Ae=st,je=gn}if(ze===$.length)return d(B,je),Tt&&Co(B,ze),Ee;if(je===null){for(;ze<$.length;ze++)je=re(B,$[ze],ae),je!==null&&(M=b(je,M,ze),Ae===null?Ee=je:Ae.sibling=je,Ae=je);return Tt&&Co(B,ze),Ee}for(je=p(B,je);ze<$.length;ze++)gn=ge(je,B,ze,$[ze],ae),gn!==null&&(s&&gn.alternate!==null&&je.delete(gn.key===null?ze:gn.key),M=b(gn,M,ze),Ae===null?Ee=gn:Ae.sibling=gn,Ae=gn);return s&&je.forEach(function(js){return l(B,js)}),Tt&&Co(B,ze),Ee}function xe(B,M,$,ae){var Ee=he($);if(typeof Ee!="function")throw Error(n(150));if($=Ee.call($),$==null)throw Error(n(151));for(var Ae=Ee=null,je=M,ze=M=0,gn=null,st=$.next();je!==null&&!st.done;ze++,st=$.next()){je.index>ze?(gn=je,je=null):gn=je.sibling;var js=ee(B,je,st.value,ae);if(js===null){je===null&&(je=gn);break}s&&je&&js.alternate===null&&l(B,je),M=b(js,M,ze),Ae===null?Ee=js:Ae.sibling=js,Ae=js,je=gn}if(st.done)return d(B,je),Tt&&Co(B,ze),Ee;if(je===null){for(;!st.done;ze++,st=$.next())st=re(B,st.value,ae),st!==null&&(M=b(st,M,ze),Ae===null?Ee=st:Ae.sibling=st,Ae=st);return Tt&&Co(B,ze),Ee}for(je=p(B,je);!st.done;ze++,st=$.next())st=ge(je,B,ze,st.value,ae),st!==null&&(s&&st.alternate!==null&&je.delete(st.key===null?ze:st.key),M=b(st,M,ze),Ae===null?Ee=st:Ae.sibling=st,Ae=st);return s&&je.forEach(function(mE){return l(B,mE)}),Tt&&Co(B,ze),Ee}function qt(B,M,$,ae){if(typeof $=="object"&&$!==null&&$.type===U&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case R:e:{for(var Ee=$.key,Ae=M;Ae!==null;){if(Ae.key===Ee){if(Ee=$.type,Ee===U){if(Ae.tag===7){d(B,Ae.sibling),M=y(Ae,$.props.children),M.return=B,B=M;break e}}else if(Ae.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===de&&ty(Ee)===Ae.type){d(B,Ae.sibling),M=y(Ae,$.props),M.ref=rc(B,Ae,$),M.return=B,B=M;break e}d(B,Ae);break}else l(B,Ae);Ae=Ae.sibling}$.type===U?(M=Ao($.props.children,B.mode,ae,$.key),M.return=B,B=M):(ae=Sd($.type,$.key,$.props,null,B.mode,ae),ae.ref=rc(B,M,$),ae.return=B,B=ae)}return T(B);case j:e:{for(Ae=$.key;M!==null;){if(M.key===Ae)if(M.tag===4&&M.stateNode.containerInfo===$.containerInfo&&M.stateNode.implementation===$.implementation){d(B,M.sibling),M=y(M,$.children||[]),M.return=B,B=M;break e}else{d(B,M);break}else l(B,M);M=M.sibling}M=Kp($,B.mode,ae),M.return=B,B=M}return T(B);case de:return Ae=$._init,qt(B,M,Ae($._payload),ae)}if(Zt($))return we(B,M,$,ae);if(he($))return xe(B,M,$,ae);Zu(B,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,M!==null&&M.tag===6?(d(B,M.sibling),M=y(M,$),M.return=B,B=M):(d(B,M),M=qp($,B.mode,ae),M.return=B,B=M),T(B)):d(B,M)}return qt}var Ia=ny(!0),iy=ny(!1),ed=Ss(null),td=null,Oa=null,ep=null;function tp(){ep=Oa=td=null}function np(s){var l=ed.current;vt(ed),s._currentValue=l}function ip(s,l,d){for(;s!==null;){var p=s.alternate;if((s.childLanes&l)!==l?(s.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),s===d)break;s=s.return}}function Aa(s,l){td=s,ep=Oa=null,s=s.dependencies,s!==null&&s.firstContext!==null&&((s.lanes&l)!==0&&(ri=!0),s.firstContext=null)}function Ri(s){var l=s._currentValue;if(ep!==s)if(s={context:s,memoizedValue:l,next:null},Oa===null){if(td===null)throw Error(n(308));Oa=s,td.dependencies={lanes:0,firstContext:s}}else Oa=Oa.next=s;return l}var _o=null;function rp(s){_o===null?_o=[s]:_o.push(s)}function ry(s,l,d,p){var y=l.interleaved;return y===null?(d.next=d,rp(l)):(d.next=y.next,y.next=d),l.interleaved=d,Vr(s,p)}function Vr(s,l){s.lanes|=l;var d=s.alternate;for(d!==null&&(d.lanes|=l),d=s,s=s.return;s!==null;)s.childLanes|=l,d=s.alternate,d!==null&&(d.childLanes|=l),d=s,s=s.return;return d.tag===3?d.stateNode:null}var _s=!1;function sp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sy(s,l){s=s.updateQueue,l.updateQueue===s&&(l.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function zr(s,l){return{eventTime:s,lane:l,tag:0,payload:null,callback:null,next:null}}function Es(s,l,d){var p=s.updateQueue;if(p===null)return null;if(p=p.shared,(it&2)!==0){var y=p.pending;return y===null?l.next=l:(l.next=y.next,y.next=l),p.pending=l,Vr(s,d)}return y=p.interleaved,y===null?(l.next=l,rp(p)):(l.next=y.next,y.next=l),p.interleaved=l,Vr(s,d)}function nd(s,l,d){if(l=l.updateQueue,l!==null&&(l=l.shared,(d&4194240)!==0)){var p=l.lanes;p&=s.pendingLanes,d|=p,l.lanes=d,Ll(s,d)}}function oy(s,l){var d=s.updateQueue,p=s.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var y=null,b=null;if(d=d.firstBaseUpdate,d!==null){do{var T={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};b===null?y=b=T:b=b.next=T,d=d.next}while(d!==null);b===null?y=b=l:b=b.next=l}else y=b=l;d={baseState:p.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:p.shared,effects:p.effects},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=l}function id(s,l,d,p){var y=s.updateQueue;_s=!1;var b=y.firstBaseUpdate,T=y.lastBaseUpdate,O=y.shared.pending;if(O!==null){y.shared.pending=null;var D=O,K=D.next;D.next=null,T===null?b=K:T.next=K,T=D;var te=s.alternate;te!==null&&(te=te.updateQueue,O=te.lastBaseUpdate,O!==T&&(O===null?te.firstBaseUpdate=K:O.next=K,te.lastBaseUpdate=D))}if(b!==null){var re=y.baseState;T=0,te=K=D=null,O=b;do{var ee=O.lane,ge=O.eventTime;if((p&ee)===ee){te!==null&&(te=te.next={eventTime:ge,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});e:{var we=s,xe=O;switch(ee=l,ge=d,xe.tag){case 1:if(we=xe.payload,typeof we=="function"){re=we.call(ge,re,ee);break e}re=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=xe.payload,ee=typeof we=="function"?we.call(ge,re,ee):we,ee==null)break e;re=oe({},re,ee);break e;case 2:_s=!0}}O.callback!==null&&O.lane!==0&&(s.flags|=64,ee=y.effects,ee===null?y.effects=[O]:ee.push(O))}else ge={eventTime:ge,lane:ee,tag:O.tag,payload:O.payload,callback:O.callback,next:null},te===null?(K=te=ge,D=re):te=te.next=ge,T|=ee;if(O=O.next,O===null){if(O=y.shared.pending,O===null)break;ee=O,O=ee.next,ee.next=null,y.lastBaseUpdate=ee,y.shared.pending=null}}while(!0);if(te===null&&(D=re),y.baseState=D,y.firstBaseUpdate=K,y.lastBaseUpdate=te,l=y.shared.interleaved,l!==null){y=l;do T|=y.lane,y=y.next;while(y!==l)}else b===null&&(y.shared.lanes=0);Ro|=T,s.lanes=T,s.memoizedState=re}}function ay(s,l,d){if(s=l.effects,l.effects=null,s!==null)for(l=0;l<s.length;l++){var p=s[l],y=p.callback;if(y!==null){if(p.callback=null,p=d,typeof y!="function")throw Error(n(191,y));y.call(p)}}}var sc={},hr=Ss(sc),oc=Ss(sc),ac=Ss(sc);function Eo(s){if(s===sc)throw Error(n(174));return s}function op(s,l){switch(ht(ac,l),ht(oc,s),ht(hr,sc),s=l.nodeType,s){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:dn(null,"");break;default:s=s===8?l.parentNode:l,l=s.namespaceURI||null,s=s.tagName,l=dn(l,s)}vt(hr),ht(hr,l)}function ja(){vt(hr),vt(oc),vt(ac)}function ly(s){Eo(ac.current);var l=Eo(hr.current),d=dn(l,s.type);l!==d&&(ht(oc,s),ht(hr,d))}function ap(s){oc.current===s&&(vt(hr),vt(oc))}var Nt=Ss(0);function rd(s){for(var l=s;l!==null;){if(l.tag===13){var d=l.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var lp=[];function cp(){for(var s=0;s<lp.length;s++)lp[s]._workInProgressVersionPrimary=null;lp.length=0}var sd=P.ReactCurrentDispatcher,up=P.ReactCurrentBatchConfig,Po=0,It=null,sn=null,pn=null,od=!1,lc=!1,cc=0,L_=0;function jn(){throw Error(n(321))}function dp(s,l){if(l===null)return!1;for(var d=0;d<l.length&&d<s.length;d++)if(!We(s[d],l[d]))return!1;return!0}function hp(s,l,d,p,y,b){if(Po=b,It=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,sd.current=s===null||s.memoizedState===null?V_:z_,s=d(p,y),lc){b=0;do{if(lc=!1,cc=0,25<=b)throw Error(n(301));b+=1,pn=sn=null,l.updateQueue=null,sd.current=$_,s=d(p,y)}while(lc)}if(sd.current=cd,l=sn!==null&&sn.next!==null,Po=0,pn=sn=It=null,od=!1,l)throw Error(n(300));return s}function fp(){var s=cc!==0;return cc=0,s}function fr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pn===null?It.memoizedState=pn=s:pn=pn.next=s,pn}function Ni(){if(sn===null){var s=It.alternate;s=s!==null?s.memoizedState:null}else s=sn.next;var l=pn===null?It.memoizedState:pn.next;if(l!==null)pn=l,sn=s;else{if(s===null)throw Error(n(310));sn=s,s={memoizedState:sn.memoizedState,baseState:sn.baseState,baseQueue:sn.baseQueue,queue:sn.queue,next:null},pn===null?It.memoizedState=pn=s:pn=pn.next=s}return pn}function uc(s,l){return typeof l=="function"?l(s):l}function pp(s){var l=Ni(),d=l.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=s;var p=sn,y=p.baseQueue,b=d.pending;if(b!==null){if(y!==null){var T=y.next;y.next=b.next,b.next=T}p.baseQueue=y=b,d.pending=null}if(y!==null){b=y.next,p=p.baseState;var O=T=null,D=null,K=b;do{var te=K.lane;if((Po&te)===te)D!==null&&(D=D.next={lane:0,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),p=K.hasEagerState?K.eagerState:s(p,K.action);else{var re={lane:te,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null};D===null?(O=D=re,T=p):D=D.next=re,It.lanes|=te,Ro|=te}K=K.next}while(K!==null&&K!==b);D===null?T=p:D.next=O,We(p,l.memoizedState)||(ri=!0),l.memoizedState=p,l.baseState=T,l.baseQueue=D,d.lastRenderedState=p}if(s=d.interleaved,s!==null){y=s;do b=y.lane,It.lanes|=b,Ro|=b,y=y.next;while(y!==s)}else y===null&&(d.lanes=0);return[l.memoizedState,d.dispatch]}function mp(s){var l=Ni(),d=l.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=s;var p=d.dispatch,y=d.pending,b=l.memoizedState;if(y!==null){d.pending=null;var T=y=y.next;do b=s(b,T.action),T=T.next;while(T!==y);We(b,l.memoizedState)||(ri=!0),l.memoizedState=b,l.baseQueue===null&&(l.baseState=b),d.lastRenderedState=b}return[b,p]}function cy(){}function uy(s,l){var d=It,p=Ni(),y=l(),b=!We(p.memoizedState,y);if(b&&(p.memoizedState=y,ri=!0),p=p.queue,gp(fy.bind(null,d,p,s),[s]),p.getSnapshot!==l||b||pn!==null&&pn.memoizedState.tag&1){if(d.flags|=2048,dc(9,hy.bind(null,d,p,y,l),void 0,null),mn===null)throw Error(n(349));(Po&30)!==0||dy(d,l,y)}return y}function dy(s,l,d){s.flags|=16384,s={getSnapshot:l,value:d},l=It.updateQueue,l===null?(l={lastEffect:null,stores:null},It.updateQueue=l,l.stores=[s]):(d=l.stores,d===null?l.stores=[s]:d.push(s))}function hy(s,l,d,p){l.value=d,l.getSnapshot=p,py(l)&&my(s)}function fy(s,l,d){return d(function(){py(l)&&my(s)})}function py(s){var l=s.getSnapshot;s=s.value;try{var d=l();return!We(s,d)}catch{return!0}}function my(s){var l=Vr(s,1);l!==null&&Ki(l,s,1,-1)}function gy(s){var l=fr();return typeof s=="function"&&(s=s()),l.memoizedState=l.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uc,lastRenderedState:s},l.queue=s,s=s.dispatch=B_.bind(null,It,s),[l.memoizedState,s]}function dc(s,l,d,p){return s={tag:s,create:l,destroy:d,deps:p,next:null},l=It.updateQueue,l===null?(l={lastEffect:null,stores:null},It.updateQueue=l,l.lastEffect=s.next=s):(d=l.lastEffect,d===null?l.lastEffect=s.next=s:(p=d.next,d.next=s,s.next=p,l.lastEffect=s)),s}function vy(){return Ni().memoizedState}function ad(s,l,d,p){var y=fr();It.flags|=s,y.memoizedState=dc(1|l,d,void 0,p===void 0?null:p)}function ld(s,l,d,p){var y=Ni();p=p===void 0?null:p;var b=void 0;if(sn!==null){var T=sn.memoizedState;if(b=T.destroy,p!==null&&dp(p,T.deps)){y.memoizedState=dc(l,d,b,p);return}}It.flags|=s,y.memoizedState=dc(1|l,d,b,p)}function yy(s,l){return ad(8390656,8,s,l)}function gp(s,l){return ld(2048,8,s,l)}function by(s,l){return ld(4,2,s,l)}function wy(s,l){return ld(4,4,s,l)}function ky(s,l){if(typeof l=="function")return s=s(),l(s),function(){l(null)};if(l!=null)return s=s(),l.current=s,function(){l.current=null}}function xy(s,l,d){return d=d!=null?d.concat([s]):null,ld(4,4,ky.bind(null,l,s),d)}function vp(){}function Sy(s,l){var d=Ni();l=l===void 0?null:l;var p=d.memoizedState;return p!==null&&l!==null&&dp(l,p[1])?p[0]:(d.memoizedState=[s,l],s)}function Ty(s,l){var d=Ni();l=l===void 0?null:l;var p=d.memoizedState;return p!==null&&l!==null&&dp(l,p[1])?p[0]:(s=s(),d.memoizedState=[s,l],s)}function Cy(s,l,d){return(Po&21)===0?(s.baseState&&(s.baseState=!1,ri=!0),s.memoizedState=d):(We(d,l)||(d=jl(),It.lanes|=d,Ro|=d,s.baseState=!0),l)}function U_(s,l){var d=nt;nt=d!==0&&4>d?d:4,s(!0);var p=up.transition;up.transition={};try{s(!1),l()}finally{nt=d,up.transition=p}}function _y(){return Ni().memoizedState}function F_(s,l,d){var p=Is(s);if(d={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null},Ey(s))Py(l,d);else if(d=ry(s,l,d,p),d!==null){var y=zn();Ki(d,s,p,y),Ry(d,l,p)}}function B_(s,l,d){var p=Is(s),y={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ey(s))Py(l,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=l.lastRenderedReducer,b!==null))try{var T=l.lastRenderedState,O=b(T,d);if(y.hasEagerState=!0,y.eagerState=O,We(O,T)){var D=l.interleaved;D===null?(y.next=y,rp(l)):(y.next=D.next,D.next=y),l.interleaved=y;return}}catch{}d=ry(s,l,y,p),d!==null&&(y=zn(),Ki(d,s,p,y),Ry(d,l,p))}}function Ey(s){var l=s.alternate;return s===It||l!==null&&l===It}function Py(s,l){lc=od=!0;var d=s.pending;d===null?l.next=l:(l.next=d.next,d.next=l),s.pending=l}function Ry(s,l,d){if((d&4194240)!==0){var p=l.lanes;p&=s.pendingLanes,d|=p,l.lanes=d,Ll(s,d)}}var cd={readContext:Ri,useCallback:jn,useContext:jn,useEffect:jn,useImperativeHandle:jn,useInsertionEffect:jn,useLayoutEffect:jn,useMemo:jn,useReducer:jn,useRef:jn,useState:jn,useDebugValue:jn,useDeferredValue:jn,useTransition:jn,useMutableSource:jn,useSyncExternalStore:jn,useId:jn,unstable_isNewReconciler:!1},V_={readContext:Ri,useCallback:function(s,l){return fr().memoizedState=[s,l===void 0?null:l],s},useContext:Ri,useEffect:yy,useImperativeHandle:function(s,l,d){return d=d!=null?d.concat([s]):null,ad(4194308,4,ky.bind(null,l,s),d)},useLayoutEffect:function(s,l){return ad(4194308,4,s,l)},useInsertionEffect:function(s,l){return ad(4,2,s,l)},useMemo:function(s,l){var d=fr();return l=l===void 0?null:l,s=s(),d.memoizedState=[s,l],s},useReducer:function(s,l,d){var p=fr();return l=d!==void 0?d(l):l,p.memoizedState=p.baseState=l,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:l},p.queue=s,s=s.dispatch=F_.bind(null,It,s),[p.memoizedState,s]},useRef:function(s){var l=fr();return s={current:s},l.memoizedState=s},useState:gy,useDebugValue:vp,useDeferredValue:function(s){return fr().memoizedState=s},useTransition:function(){var s=gy(!1),l=s[0];return s=U_.bind(null,s[1]),fr().memoizedState=s,[l,s]},useMutableSource:function(){},useSyncExternalStore:function(s,l,d){var p=It,y=fr();if(Tt){if(d===void 0)throw Error(n(407));d=d()}else{if(d=l(),mn===null)throw Error(n(349));(Po&30)!==0||dy(p,l,d)}y.memoizedState=d;var b={value:d,getSnapshot:l};return y.queue=b,yy(fy.bind(null,p,b,s),[s]),p.flags|=2048,dc(9,hy.bind(null,p,b,d,l),void 0,null),d},useId:function(){var s=fr(),l=mn.identifierPrefix;if(Tt){var d=Br,p=Fr;d=(p&~(1<<32-Be(p)-1)).toString(32)+d,l=":"+l+"R"+d,d=cc++,0<d&&(l+="H"+d.toString(32)),l+=":"}else d=L_++,l=":"+l+"r"+d.toString(32)+":";return s.memoizedState=l},unstable_isNewReconciler:!1},z_={readContext:Ri,useCallback:Sy,useContext:Ri,useEffect:gp,useImperativeHandle:xy,useInsertionEffect:by,useLayoutEffect:wy,useMemo:Ty,useReducer:pp,useRef:vy,useState:function(){return pp(uc)},useDebugValue:vp,useDeferredValue:function(s){var l=Ni();return Cy(l,sn.memoizedState,s)},useTransition:function(){var s=pp(uc)[0],l=Ni().memoizedState;return[s,l]},useMutableSource:cy,useSyncExternalStore:uy,useId:_y,unstable_isNewReconciler:!1},$_={readContext:Ri,useCallback:Sy,useContext:Ri,useEffect:gp,useImperativeHandle:xy,useInsertionEffect:by,useLayoutEffect:wy,useMemo:Ty,useReducer:mp,useRef:vy,useState:function(){return mp(uc)},useDebugValue:vp,useDeferredValue:function(s){var l=Ni();return sn===null?l.memoizedState=s:Cy(l,sn.memoizedState,s)},useTransition:function(){var s=mp(uc)[0],l=Ni().memoizedState;return[s,l]},useMutableSource:cy,useSyncExternalStore:uy,useId:_y,unstable_isNewReconciler:!1};function zi(s,l){if(s&&s.defaultProps){l=oe({},l),s=s.defaultProps;for(var d in s)l[d]===void 0&&(l[d]=s[d]);return l}return l}function yp(s,l,d,p){l=s.memoizedState,d=d(p,l),d=d==null?l:oe({},l,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var ud={isMounted:function(s){return(s=s._reactInternals)?Xn(s)===s:!1},enqueueSetState:function(s,l,d){s=s._reactInternals;var p=zn(),y=Is(s),b=zr(p,y);b.payload=l,d!=null&&(b.callback=d),l=Es(s,b,y),l!==null&&(Ki(l,s,y,p),nd(l,s,y))},enqueueReplaceState:function(s,l,d){s=s._reactInternals;var p=zn(),y=Is(s),b=zr(p,y);b.tag=1,b.payload=l,d!=null&&(b.callback=d),l=Es(s,b,y),l!==null&&(Ki(l,s,y,p),nd(l,s,y))},enqueueForceUpdate:function(s,l){s=s._reactInternals;var d=zn(),p=Is(s),y=zr(d,p);y.tag=2,l!=null&&(y.callback=l),l=Es(s,y,p),l!==null&&(Ki(l,s,p,d),nd(l,s,p))}};function Ny(s,l,d,p,y,b,T){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(p,b,T):l.prototype&&l.prototype.isPureReactComponent?!ct(d,p)||!ct(y,b):!0}function Iy(s,l,d){var p=!1,y=Ts,b=l.contextType;return typeof b=="object"&&b!==null?b=Ri(b):(y=ii(l)?So:An.current,p=l.contextTypes,b=(p=p!=null)?Ea(s,y):Ts),l=new l(d,b),s.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=ud,s.stateNode=l,l._reactInternals=s,p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=y,s.__reactInternalMemoizedMaskedChildContext=b),l}function Oy(s,l,d,p){s=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(d,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(d,p),l.state!==s&&ud.enqueueReplaceState(l,l.state,null)}function bp(s,l,d,p){var y=s.stateNode;y.props=d,y.state=s.memoizedState,y.refs={},sp(s);var b=l.contextType;typeof b=="object"&&b!==null?y.context=Ri(b):(b=ii(l)?So:An.current,y.context=Ea(s,b)),y.state=s.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(yp(s,l,b,d),y.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(l=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),l!==y.state&&ud.enqueueReplaceState(y,y.state,null),id(s,d,y,p),y.state=s.memoizedState),typeof y.componentDidMount=="function"&&(s.flags|=4194308)}function Da(s,l){try{var d="",p=l;do d+=Ne(p),p=p.return;while(p);var y=d}catch(b){y=`
Error generating stack: `+b.message+`
`+b.stack}return{value:s,source:l,stack:y,digest:null}}function wp(s,l,d){return{value:s,source:null,stack:d??null,digest:l??null}}function kp(s,l){try{console.error(l.value)}catch(d){setTimeout(function(){throw d})}}var q_=typeof WeakMap=="function"?WeakMap:Map;function Ay(s,l,d){d=zr(-1,d),d.tag=3,d.payload={element:null};var p=l.value;return d.callback=function(){vd||(vd=!0,Mp=p),kp(s,l)},d}function jy(s,l,d){d=zr(-1,d),d.tag=3;var p=s.type.getDerivedStateFromError;if(typeof p=="function"){var y=l.value;d.payload=function(){return p(y)},d.callback=function(){kp(s,l)}}var b=s.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(d.callback=function(){kp(s,l),typeof p!="function"&&(Rs===null?Rs=new Set([this]):Rs.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})}),d}function Dy(s,l,d){var p=s.pingCache;if(p===null){p=s.pingCache=new q_;var y=new Set;p.set(l,y)}else y=p.get(l),y===void 0&&(y=new Set,p.set(l,y));y.has(d)||(y.add(d),s=rE.bind(null,s,l,d),l.then(s,s))}function My(s){do{var l;if((l=s.tag===13)&&(l=s.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return s;s=s.return}while(s!==null);return null}function Ly(s,l,d,p,y){return(s.mode&1)===0?(s===l?s.flags|=65536:(s.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(l=zr(-1,1),l.tag=2,Es(d,l,1))),d.lanes|=1),s):(s.flags|=65536,s.lanes=y,s)}var K_=P.ReactCurrentOwner,ri=!1;function Vn(s,l,d,p){l.child=s===null?iy(l,null,d,p):Ia(l,s.child,d,p)}function Uy(s,l,d,p,y){d=d.render;var b=l.ref;return Aa(l,y),p=hp(s,l,d,p,b,y),d=fp(),s!==null&&!ri?(l.updateQueue=s.updateQueue,l.flags&=-2053,s.lanes&=~y,$r(s,l,y)):(Tt&&d&&Jf(l),l.flags|=1,Vn(s,l,p,y),l.child)}function Fy(s,l,d,p,y){if(s===null){var b=d.type;return typeof b=="function"&&!$p(b)&&b.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(l.tag=15,l.type=b,By(s,l,b,p,y)):(s=Sd(d.type,null,p,l,l.mode,y),s.ref=l.ref,s.return=l,l.child=s)}if(b=s.child,(s.lanes&y)===0){var T=b.memoizedProps;if(d=d.compare,d=d!==null?d:ct,d(T,p)&&s.ref===l.ref)return $r(s,l,y)}return l.flags|=1,s=As(b,p),s.ref=l.ref,s.return=l,l.child=s}function By(s,l,d,p,y){if(s!==null){var b=s.memoizedProps;if(ct(b,p)&&s.ref===l.ref)if(ri=!1,l.pendingProps=p=b,(s.lanes&y)!==0)(s.flags&131072)!==0&&(ri=!0);else return l.lanes=s.lanes,$r(s,l,y)}return xp(s,l,d,p,y)}function Vy(s,l,d){var p=l.pendingProps,y=p.children,b=s!==null?s.memoizedState:null;if(p.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(La,yi),yi|=d;else{if((d&1073741824)===0)return s=b!==null?b.baseLanes|d:d,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:s,cachePool:null,transitions:null},l.updateQueue=null,ht(La,yi),yi|=s,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=b!==null?b.baseLanes:d,ht(La,yi),yi|=p}else b!==null?(p=b.baseLanes|d,l.memoizedState=null):p=d,ht(La,yi),yi|=p;return Vn(s,l,y,d),l.child}function zy(s,l){var d=l.ref;(s===null&&d!==null||s!==null&&s.ref!==d)&&(l.flags|=512,l.flags|=2097152)}function xp(s,l,d,p,y){var b=ii(d)?So:An.current;return b=Ea(l,b),Aa(l,y),d=hp(s,l,d,p,b,y),p=fp(),s!==null&&!ri?(l.updateQueue=s.updateQueue,l.flags&=-2053,s.lanes&=~y,$r(s,l,y)):(Tt&&p&&Jf(l),l.flags|=1,Vn(s,l,d,y),l.child)}function $y(s,l,d,p,y){if(ii(d)){var b=!0;Gu(l)}else b=!1;if(Aa(l,y),l.stateNode===null)hd(s,l),Iy(l,d,p),bp(l,d,p,y),p=!0;else if(s===null){var T=l.stateNode,O=l.memoizedProps;T.props=O;var D=T.context,K=d.contextType;typeof K=="object"&&K!==null?K=Ri(K):(K=ii(d)?So:An.current,K=Ea(l,K));var te=d.getDerivedStateFromProps,re=typeof te=="function"||typeof T.getSnapshotBeforeUpdate=="function";re||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(O!==p||D!==K)&&Oy(l,T,p,K),_s=!1;var ee=l.memoizedState;T.state=ee,id(l,p,T,y),D=l.memoizedState,O!==p||ee!==D||ni.current||_s?(typeof te=="function"&&(yp(l,d,te,p),D=l.memoizedState),(O=_s||Ny(l,d,O,p,ee,D,K))?(re||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(l.flags|=4194308)):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=D),T.props=p,T.state=D,T.context=K,p=O):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{T=l.stateNode,sy(s,l),O=l.memoizedProps,K=l.type===l.elementType?O:zi(l.type,O),T.props=K,re=l.pendingProps,ee=T.context,D=d.contextType,typeof D=="object"&&D!==null?D=Ri(D):(D=ii(d)?So:An.current,D=Ea(l,D));var ge=d.getDerivedStateFromProps;(te=typeof ge=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(O!==re||ee!==D)&&Oy(l,T,p,D),_s=!1,ee=l.memoizedState,T.state=ee,id(l,p,T,y);var we=l.memoizedState;O!==re||ee!==we||ni.current||_s?(typeof ge=="function"&&(yp(l,d,ge,p),we=l.memoizedState),(K=_s||Ny(l,d,K,p,ee,we,D)||!1)?(te||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(p,we,D),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(p,we,D)),typeof T.componentDidUpdate=="function"&&(l.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof T.componentDidUpdate!="function"||O===s.memoizedProps&&ee===s.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||O===s.memoizedProps&&ee===s.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=we),T.props=p,T.state=we,T.context=D,p=K):(typeof T.componentDidUpdate!="function"||O===s.memoizedProps&&ee===s.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||O===s.memoizedProps&&ee===s.memoizedState||(l.flags|=1024),p=!1)}return Sp(s,l,d,p,b,y)}function Sp(s,l,d,p,y,b){zy(s,l);var T=(l.flags&128)!==0;if(!p&&!T)return y&&G0(l,d,!1),$r(s,l,b);p=l.stateNode,K_.current=l;var O=T&&typeof d.getDerivedStateFromError!="function"?null:p.render();return l.flags|=1,s!==null&&T?(l.child=Ia(l,s.child,null,b),l.child=Ia(l,null,O,b)):Vn(s,l,O,b),l.memoizedState=p.state,y&&G0(l,d,!0),l.child}function qy(s){var l=s.stateNode;l.pendingContext?W0(s,l.pendingContext,l.pendingContext!==l.context):l.context&&W0(s,l.context,!1),op(s,l.containerInfo)}function Ky(s,l,d,p,y){return Na(),Zf(y),l.flags|=256,Vn(s,l,d,p),l.child}var Tp={dehydrated:null,treeContext:null,retryLane:0};function Cp(s){return{baseLanes:s,cachePool:null,transitions:null}}function Wy(s,l,d){var p=l.pendingProps,y=Nt.current,b=!1,T=(l.flags&128)!==0,O;if((O=T)||(O=s!==null&&s.memoizedState===null?!1:(y&2)!==0),O?(b=!0,l.flags&=-129):(s===null||s.memoizedState!==null)&&(y|=1),ht(Nt,y&1),s===null)return Xf(l),s=l.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?((l.mode&1)===0?l.lanes=1:s.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(T=p.children,s=p.fallback,b?(p=l.mode,b=l.child,T={mode:"hidden",children:T},(p&1)===0&&b!==null?(b.childLanes=0,b.pendingProps=T):b=Td(T,p,0,null),s=Ao(s,p,d,null),b.return=l,s.return=l,b.sibling=s,l.child=b,l.child.memoizedState=Cp(d),l.memoizedState=Tp,s):_p(l,T));if(y=s.memoizedState,y!==null&&(O=y.dehydrated,O!==null))return W_(s,l,T,p,O,y,d);if(b){b=p.fallback,T=l.mode,y=s.child,O=y.sibling;var D={mode:"hidden",children:p.children};return(T&1)===0&&l.child!==y?(p=l.child,p.childLanes=0,p.pendingProps=D,l.deletions=null):(p=As(y,D),p.subtreeFlags=y.subtreeFlags&14680064),O!==null?b=As(O,b):(b=Ao(b,T,d,null),b.flags|=2),b.return=l,p.return=l,p.sibling=b,l.child=p,p=b,b=l.child,T=s.child.memoizedState,T=T===null?Cp(d):{baseLanes:T.baseLanes|d,cachePool:null,transitions:T.transitions},b.memoizedState=T,b.childLanes=s.childLanes&~d,l.memoizedState=Tp,p}return b=s.child,s=b.sibling,p=As(b,{mode:"visible",children:p.children}),(l.mode&1)===0&&(p.lanes=d),p.return=l,p.sibling=null,s!==null&&(d=l.deletions,d===null?(l.deletions=[s],l.flags|=16):d.push(s)),l.child=p,l.memoizedState=null,p}function _p(s,l){return l=Td({mode:"visible",children:l},s.mode,0,null),l.return=s,s.child=l}function dd(s,l,d,p){return p!==null&&Zf(p),Ia(l,s.child,null,d),s=_p(l,l.pendingProps.children),s.flags|=2,l.memoizedState=null,s}function W_(s,l,d,p,y,b,T){if(d)return l.flags&256?(l.flags&=-257,p=wp(Error(n(422))),dd(s,l,T,p)):l.memoizedState!==null?(l.child=s.child,l.flags|=128,null):(b=p.fallback,y=l.mode,p=Td({mode:"visible",children:p.children},y,0,null),b=Ao(b,y,T,null),b.flags|=2,p.return=l,b.return=l,p.sibling=b,l.child=p,(l.mode&1)!==0&&Ia(l,s.child,null,T),l.child.memoizedState=Cp(T),l.memoizedState=Tp,b);if((l.mode&1)===0)return dd(s,l,T,null);if(y.data==="$!"){if(p=y.nextSibling&&y.nextSibling.dataset,p)var O=p.dgst;return p=O,b=Error(n(419)),p=wp(b,p,void 0),dd(s,l,T,p)}if(O=(T&s.childLanes)!==0,ri||O){if(p=mn,p!==null){switch(T&-T){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=(y&(p.suspendedLanes|T))!==0?0:y,y!==0&&y!==b.retryLane&&(b.retryLane=y,Vr(s,y),Ki(p,s,y,-1))}return zp(),p=wp(Error(n(421))),dd(s,l,T,p)}return y.data==="$?"?(l.flags|=128,l.child=s.child,l=sE.bind(null,s),y._reactRetry=l,null):(s=b.treeContext,vi=xs(y.nextSibling),gi=l,Tt=!0,Vi=null,s!==null&&(Ei[Pi++]=Fr,Ei[Pi++]=Br,Ei[Pi++]=To,Fr=s.id,Br=s.overflow,To=l),l=_p(l,p.children),l.flags|=4096,l)}function Hy(s,l,d){s.lanes|=l;var p=s.alternate;p!==null&&(p.lanes|=l),ip(s.return,l,d)}function Ep(s,l,d,p,y){var b=s.memoizedState;b===null?s.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:y}:(b.isBackwards=l,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=d,b.tailMode=y)}function Gy(s,l,d){var p=l.pendingProps,y=p.revealOrder,b=p.tail;if(Vn(s,l,p.children,d),p=Nt.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=l.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Hy(s,d,l);else if(s.tag===19)Hy(s,d,l);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===l)break e;for(;s.sibling===null;){if(s.return===null||s.return===l)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}p&=1}if(ht(Nt,p),(l.mode&1)===0)l.memoizedState=null;else switch(y){case"forwards":for(d=l.child,y=null;d!==null;)s=d.alternate,s!==null&&rd(s)===null&&(y=d),d=d.sibling;d=y,d===null?(y=l.child,l.child=null):(y=d.sibling,d.sibling=null),Ep(l,!1,y,d,b);break;case"backwards":for(d=null,y=l.child,l.child=null;y!==null;){if(s=y.alternate,s!==null&&rd(s)===null){l.child=y;break}s=y.sibling,y.sibling=d,d=y,y=s}Ep(l,!0,d,null,b);break;case"together":Ep(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function hd(s,l){(l.mode&1)===0&&s!==null&&(s.alternate=null,l.alternate=null,l.flags|=2)}function $r(s,l,d){if(s!==null&&(l.dependencies=s.dependencies),Ro|=l.lanes,(d&l.childLanes)===0)return null;if(s!==null&&l.child!==s.child)throw Error(n(153));if(l.child!==null){for(s=l.child,d=As(s,s.pendingProps),l.child=d,d.return=l;s.sibling!==null;)s=s.sibling,d=d.sibling=As(s,s.pendingProps),d.return=l;d.sibling=null}return l.child}function H_(s,l,d){switch(l.tag){case 3:qy(l),Na();break;case 5:ly(l);break;case 1:ii(l.type)&&Gu(l);break;case 4:op(l,l.stateNode.containerInfo);break;case 10:var p=l.type._context,y=l.memoizedProps.value;ht(ed,p._currentValue),p._currentValue=y;break;case 13:if(p=l.memoizedState,p!==null)return p.dehydrated!==null?(ht(Nt,Nt.current&1),l.flags|=128,null):(d&l.child.childLanes)!==0?Wy(s,l,d):(ht(Nt,Nt.current&1),s=$r(s,l,d),s!==null?s.sibling:null);ht(Nt,Nt.current&1);break;case 19:if(p=(d&l.childLanes)!==0,(s.flags&128)!==0){if(p)return Gy(s,l,d);l.flags|=128}if(y=l.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ht(Nt,Nt.current),p)break;return null;case 22:case 23:return l.lanes=0,Vy(s,l,d)}return $r(s,l,d)}var Jy,Pp,Yy,Qy;Jy=function(s,l){for(var d=l.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Pp=function(){},Yy=function(s,l,d,p){var y=s.memoizedProps;if(y!==p){s=l.stateNode,Eo(hr.current);var b=null;switch(d){case"input":y=wt(s,y),p=wt(s,p),b=[];break;case"select":y=oe({},y,{value:void 0}),p=oe({},p,{value:void 0}),b=[];break;case"textarea":y=be(s,y),p=be(s,p),b=[];break;default:typeof y.onClick!="function"&&typeof p.onClick=="function"&&(s.onclick=Ku)}_r(d,p);var T;d=null;for(K in y)if(!p.hasOwnProperty(K)&&y.hasOwnProperty(K)&&y[K]!=null)if(K==="style"){var O=y[K];for(T in O)O.hasOwnProperty(T)&&(d||(d={}),d[T]="")}else K!=="dangerouslySetInnerHTML"&&K!=="children"&&K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(r.hasOwnProperty(K)?b||(b=[]):(b=b||[]).push(K,null));for(K in p){var D=p[K];if(O=y?.[K],p.hasOwnProperty(K)&&D!==O&&(D!=null||O!=null))if(K==="style")if(O){for(T in O)!O.hasOwnProperty(T)||D&&D.hasOwnProperty(T)||(d||(d={}),d[T]="");for(T in D)D.hasOwnProperty(T)&&O[T]!==D[T]&&(d||(d={}),d[T]=D[T])}else d||(b||(b=[]),b.push(K,d)),d=D;else K==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,O=O?O.__html:void 0,D!=null&&O!==D&&(b=b||[]).push(K,D)):K==="children"?typeof D!="string"&&typeof D!="number"||(b=b||[]).push(K,""+D):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&(r.hasOwnProperty(K)?(D!=null&&K==="onScroll"&&gt("scroll",s),b||O===D||(b=[])):(b=b||[]).push(K,D))}d&&(b=b||[]).push("style",d);var K=b;(l.updateQueue=K)&&(l.flags|=4)}},Qy=function(s,l,d,p){d!==p&&(l.flags|=4)};function hc(s,l){if(!Tt)switch(s.tailMode){case"hidden":l=s.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?l||s.tail===null?s.tail=null:s.tail.sibling=null:p.sibling=null}}function Dn(s){var l=s.alternate!==null&&s.alternate.child===s.child,d=0,p=0;if(l)for(var y=s.child;y!==null;)d|=y.lanes|y.childLanes,p|=y.subtreeFlags&14680064,p|=y.flags&14680064,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)d|=y.lanes|y.childLanes,p|=y.subtreeFlags,p|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=p,s.childLanes=d,l}function G_(s,l,d){var p=l.pendingProps;switch(Yf(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dn(l),null;case 1:return ii(l.type)&&Hu(),Dn(l),null;case 3:return p=l.stateNode,ja(),vt(ni),vt(An),cp(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(s===null||s.child===null)&&(Xu(l)?l.flags|=4:s===null||s.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,Vi!==null&&(Fp(Vi),Vi=null))),Pp(s,l),Dn(l),null;case 5:ap(l);var y=Eo(ac.current);if(d=l.type,s!==null&&l.stateNode!=null)Yy(s,l,d,p,y),s.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!p){if(l.stateNode===null)throw Error(n(166));return Dn(l),null}if(s=Eo(hr.current),Xu(l)){p=l.stateNode,d=l.type;var b=l.memoizedProps;switch(p[dr]=l,p[nc]=b,s=(l.mode&1)!==0,d){case"dialog":gt("cancel",p),gt("close",p);break;case"iframe":case"object":case"embed":gt("load",p);break;case"video":case"audio":for(y=0;y<Zl.length;y++)gt(Zl[y],p);break;case"source":gt("error",p);break;case"img":case"image":case"link":gt("error",p),gt("load",p);break;case"details":gt("toggle",p);break;case"input":kn(p,b),gt("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!b.multiple},gt("invalid",p);break;case"textarea":jt(p,b),gt("invalid",p)}_r(d,b),y=null;for(var T in b)if(b.hasOwnProperty(T)){var O=b[T];T==="children"?typeof O=="string"?p.textContent!==O&&(b.suppressHydrationWarning!==!0&&qu(p.textContent,O,s),y=["children",O]):typeof O=="number"&&p.textContent!==""+O&&(b.suppressHydrationWarning!==!0&&qu(p.textContent,O,s),y=["children",""+O]):r.hasOwnProperty(T)&&O!=null&&T==="onScroll"&&gt("scroll",p)}switch(d){case"input":zt(p),et(p,b,!0);break;case"textarea":zt(p),xn(p);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(p.onclick=Ku)}p=y,l.updateQueue=p,p!==null&&(l.flags|=4)}else{T=y.nodeType===9?y:y.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=Sn(d)),s==="http://www.w3.org/1999/xhtml"?d==="script"?(s=T.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof p.is=="string"?s=T.createElement(d,{is:p.is}):(s=T.createElement(d),d==="select"&&(T=s,p.multiple?T.multiple=!0:p.size&&(T.size=p.size))):s=T.createElementNS(s,d),s[dr]=l,s[nc]=p,Jy(s,l,!1,!1),l.stateNode=s;e:{switch(T=ss(d,p),d){case"dialog":gt("cancel",s),gt("close",s),y=p;break;case"iframe":case"object":case"embed":gt("load",s),y=p;break;case"video":case"audio":for(y=0;y<Zl.length;y++)gt(Zl[y],s);y=p;break;case"source":gt("error",s),y=p;break;case"img":case"image":case"link":gt("error",s),gt("load",s),y=p;break;case"details":gt("toggle",s),y=p;break;case"input":kn(s,p),y=wt(s,p),gt("invalid",s);break;case"option":y=p;break;case"select":s._wrapperState={wasMultiple:!!p.multiple},y=oe({},p,{value:void 0}),gt("invalid",s);break;case"textarea":jt(s,p),y=be(s,p),gt("invalid",s);break;default:y=p}_r(d,y),O=y;for(b in O)if(O.hasOwnProperty(b)){var D=O[b];b==="style"?rs(s,D):b==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,D!=null&&fi(s,D)):b==="children"?typeof D=="string"?(d!=="textarea"||D!=="")&&Fi(s,D):typeof D=="number"&&Fi(s,""+D):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(r.hasOwnProperty(b)?D!=null&&b==="onScroll"&&gt("scroll",s):D!=null&&N(s,b,D,T))}switch(d){case"input":zt(s),et(s,p,!1);break;case"textarea":zt(s),xn(s);break;case"option":p.value!=null&&s.setAttribute("value",""+se(p.value));break;case"select":s.multiple=!!p.multiple,b=p.value,b!=null?en(s,!!p.multiple,b,!1):p.defaultValue!=null&&en(s,!!p.multiple,p.defaultValue,!0);break;default:typeof y.onClick=="function"&&(s.onclick=Ku)}switch(d){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return Dn(l),null;case 6:if(s&&l.stateNode!=null)Qy(s,l,s.memoizedProps,p);else{if(typeof p!="string"&&l.stateNode===null)throw Error(n(166));if(d=Eo(ac.current),Eo(hr.current),Xu(l)){if(p=l.stateNode,d=l.memoizedProps,p[dr]=l,(b=p.nodeValue!==d)&&(s=gi,s!==null))switch(s.tag){case 3:qu(p.nodeValue,d,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&qu(p.nodeValue,d,(s.mode&1)!==0)}b&&(l.flags|=4)}else p=(d.nodeType===9?d:d.ownerDocument).createTextNode(p),p[dr]=l,l.stateNode=p}return Dn(l),null;case 13:if(vt(Nt),p=l.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Tt&&vi!==null&&(l.mode&1)!==0&&(l.flags&128)===0)ey(),Na(),l.flags|=98560,b=!1;else if(b=Xu(l),p!==null&&p.dehydrated!==null){if(s===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[dr]=l}else Na(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Dn(l),b=!1}else Vi!==null&&(Fp(Vi),Vi=null),b=!0;if(!b)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=d,l):(p=p!==null,p!==(s!==null&&s.memoizedState!==null)&&p&&(l.child.flags|=8192,(l.mode&1)!==0&&(s===null||(Nt.current&1)!==0?on===0&&(on=3):zp())),l.updateQueue!==null&&(l.flags|=4),Dn(l),null);case 4:return ja(),Pp(s,l),s===null&&ec(l.stateNode.containerInfo),Dn(l),null;case 10:return np(l.type._context),Dn(l),null;case 17:return ii(l.type)&&Hu(),Dn(l),null;case 19:if(vt(Nt),b=l.memoizedState,b===null)return Dn(l),null;if(p=(l.flags&128)!==0,T=b.rendering,T===null)if(p)hc(b,!1);else{if(on!==0||s!==null&&(s.flags&128)!==0)for(s=l.child;s!==null;){if(T=rd(s),T!==null){for(l.flags|=128,hc(b,!1),p=T.updateQueue,p!==null&&(l.updateQueue=p,l.flags|=4),l.subtreeFlags=0,p=d,d=l.child;d!==null;)b=d,s=p,b.flags&=14680066,T=b.alternate,T===null?(b.childLanes=0,b.lanes=s,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=T.childLanes,b.lanes=T.lanes,b.child=T.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=T.memoizedProps,b.memoizedState=T.memoizedState,b.updateQueue=T.updateQueue,b.type=T.type,s=T.dependencies,b.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),d=d.sibling;return ht(Nt,Nt.current&1|2),l.child}s=s.sibling}b.tail!==null&&Pt()>Ua&&(l.flags|=128,p=!0,hc(b,!1),l.lanes=4194304)}else{if(!p)if(s=rd(T),s!==null){if(l.flags|=128,p=!0,d=s.updateQueue,d!==null&&(l.updateQueue=d,l.flags|=4),hc(b,!0),b.tail===null&&b.tailMode==="hidden"&&!T.alternate&&!Tt)return Dn(l),null}else 2*Pt()-b.renderingStartTime>Ua&&d!==1073741824&&(l.flags|=128,p=!0,hc(b,!1),l.lanes=4194304);b.isBackwards?(T.sibling=l.child,l.child=T):(d=b.last,d!==null?d.sibling=T:l.child=T,b.last=T)}return b.tail!==null?(l=b.tail,b.rendering=l,b.tail=l.sibling,b.renderingStartTime=Pt(),l.sibling=null,d=Nt.current,ht(Nt,p?d&1|2:d&1),l):(Dn(l),null);case 22:case 23:return Vp(),p=l.memoizedState!==null,s!==null&&s.memoizedState!==null!==p&&(l.flags|=8192),p&&(l.mode&1)!==0?(yi&1073741824)!==0&&(Dn(l),l.subtreeFlags&6&&(l.flags|=8192)):Dn(l),null;case 24:return null;case 25:return null}throw Error(n(156,l.tag))}function J_(s,l){switch(Yf(l),l.tag){case 1:return ii(l.type)&&Hu(),s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 3:return ja(),vt(ni),vt(An),cp(),s=l.flags,(s&65536)!==0&&(s&128)===0?(l.flags=s&-65537|128,l):null;case 5:return ap(l),null;case 13:if(vt(Nt),s=l.memoizedState,s!==null&&s.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Na()}return s=l.flags,s&65536?(l.flags=s&-65537|128,l):null;case 19:return vt(Nt),null;case 4:return ja(),null;case 10:return np(l.type._context),null;case 22:case 23:return Vp(),null;case 24:return null;default:return null}}var fd=!1,Mn=!1,Y_=typeof WeakSet=="function"?WeakSet:Set,ve=null;function Ma(s,l){var d=s.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(p){Mt(s,l,p)}else d.current=null}function Rp(s,l,d){try{d()}catch(p){Mt(s,l,p)}}var Xy=!1;function Q_(s,l){if(Vf=ha,s=ws(),Af(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else e:{d=(d=s.ownerDocument)&&d.defaultView||window;var p=d.getSelection&&d.getSelection();if(p&&p.rangeCount!==0){d=p.anchorNode;var y=p.anchorOffset,b=p.focusNode;p=p.focusOffset;try{d.nodeType,b.nodeType}catch{d=null;break e}var T=0,O=-1,D=-1,K=0,te=0,re=s,ee=null;t:for(;;){for(var ge;re!==d||y!==0&&re.nodeType!==3||(O=T+y),re!==b||p!==0&&re.nodeType!==3||(D=T+p),re.nodeType===3&&(T+=re.nodeValue.length),(ge=re.firstChild)!==null;)ee=re,re=ge;for(;;){if(re===s)break t;if(ee===d&&++K===y&&(O=T),ee===b&&++te===p&&(D=T),(ge=re.nextSibling)!==null)break;re=ee,ee=re.parentNode}re=ge}d=O===-1||D===-1?null:{start:O,end:D}}else d=null}d=d||{start:0,end:0}}else d=null;for(zf={focusedElem:s,selectionRange:d},ha=!1,ve=l;ve!==null;)if(l=ve,s=l.child,(l.subtreeFlags&1028)!==0&&s!==null)s.return=l,ve=s;else for(;ve!==null;){l=ve;try{var we=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(we!==null){var xe=we.memoizedProps,qt=we.memoizedState,B=l.stateNode,M=B.getSnapshotBeforeUpdate(l.elementType===l.type?xe:zi(l.type,xe),qt);B.__reactInternalSnapshotBeforeUpdate=M}break;case 3:var $=l.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(ae){Mt(l,l.return,ae)}if(s=l.sibling,s!==null){s.return=l.return,ve=s;break}ve=l.return}return we=Xy,Xy=!1,we}function fc(s,l,d){var p=l.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var y=p=p.next;do{if((y.tag&s)===s){var b=y.destroy;y.destroy=void 0,b!==void 0&&Rp(l,d,b)}y=y.next}while(y!==p)}}function pd(s,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var d=l=l.next;do{if((d.tag&s)===s){var p=d.create;d.destroy=p()}d=d.next}while(d!==l)}}function Np(s){var l=s.ref;if(l!==null){var d=s.stateNode;s.tag,s=d,typeof l=="function"?l(s):l.current=s}}function Zy(s){var l=s.alternate;l!==null&&(s.alternate=null,Zy(l)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(l=s.stateNode,l!==null&&(delete l[dr],delete l[nc],delete l[Wf],delete l[A_],delete l[j_])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function eb(s){return s.tag===5||s.tag===3||s.tag===4}function tb(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||eb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Ip(s,l,d){var p=s.tag;if(p===5||p===6)s=s.stateNode,l?d.nodeType===8?d.parentNode.insertBefore(s,l):d.insertBefore(s,l):(d.nodeType===8?(l=d.parentNode,l.insertBefore(s,d)):(l=d,l.appendChild(s)),d=d._reactRootContainer,d!=null||l.onclick!==null||(l.onclick=Ku));else if(p!==4&&(s=s.child,s!==null))for(Ip(s,l,d),s=s.sibling;s!==null;)Ip(s,l,d),s=s.sibling}function Op(s,l,d){var p=s.tag;if(p===5||p===6)s=s.stateNode,l?d.insertBefore(s,l):d.appendChild(s);else if(p!==4&&(s=s.child,s!==null))for(Op(s,l,d),s=s.sibling;s!==null;)Op(s,l,d),s=s.sibling}var Tn=null,$i=!1;function Ps(s,l,d){for(d=d.child;d!==null;)nb(s,l,d),d=d.sibling}function nb(s,l,d){if(Bn&&typeof Bn.onCommitFiberUnmount=="function")try{Bn.onCommitFiberUnmount(oo,d)}catch{}switch(d.tag){case 5:Mn||Ma(d,l);case 6:var p=Tn,y=$i;Tn=null,Ps(s,l,d),Tn=p,$i=y,Tn!==null&&($i?(s=Tn,d=d.stateNode,s.nodeType===8?s.parentNode.removeChild(d):s.removeChild(d)):Tn.removeChild(d.stateNode));break;case 18:Tn!==null&&($i?(s=Tn,d=d.stateNode,s.nodeType===8?Kf(s.parentNode,d):s.nodeType===1&&Kf(s,d),co(s)):Kf(Tn,d.stateNode));break;case 4:p=Tn,y=$i,Tn=d.stateNode.containerInfo,$i=!0,Ps(s,l,d),Tn=p,$i=y;break;case 0:case 11:case 14:case 15:if(!Mn&&(p=d.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){y=p=p.next;do{var b=y,T=b.destroy;b=b.tag,T!==void 0&&((b&2)!==0||(b&4)!==0)&&Rp(d,l,T),y=y.next}while(y!==p)}Ps(s,l,d);break;case 1:if(!Mn&&(Ma(d,l),p=d.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=d.memoizedProps,p.state=d.memoizedState,p.componentWillUnmount()}catch(O){Mt(d,l,O)}Ps(s,l,d);break;case 21:Ps(s,l,d);break;case 22:d.mode&1?(Mn=(p=Mn)||d.memoizedState!==null,Ps(s,l,d),Mn=p):Ps(s,l,d);break;default:Ps(s,l,d)}}function ib(s){var l=s.updateQueue;if(l!==null){s.updateQueue=null;var d=s.stateNode;d===null&&(d=s.stateNode=new Y_),l.forEach(function(p){var y=oE.bind(null,s,p);d.has(p)||(d.add(p),p.then(y,y))})}}function qi(s,l){var d=l.deletions;if(d!==null)for(var p=0;p<d.length;p++){var y=d[p];try{var b=s,T=l,O=T;e:for(;O!==null;){switch(O.tag){case 5:Tn=O.stateNode,$i=!1;break e;case 3:Tn=O.stateNode.containerInfo,$i=!0;break e;case 4:Tn=O.stateNode.containerInfo,$i=!0;break e}O=O.return}if(Tn===null)throw Error(n(160));nb(b,T,y),Tn=null,$i=!1;var D=y.alternate;D!==null&&(D.return=null),y.return=null}catch(K){Mt(y,l,K)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)rb(l,s),l=l.sibling}function rb(s,l){var d=s.alternate,p=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(qi(l,s),pr(s),p&4){try{fc(3,s,s.return),pd(3,s)}catch(xe){Mt(s,s.return,xe)}try{fc(5,s,s.return)}catch(xe){Mt(s,s.return,xe)}}break;case 1:qi(l,s),pr(s),p&512&&d!==null&&Ma(d,d.return);break;case 5:if(qi(l,s),pr(s),p&512&&d!==null&&Ma(d,d.return),s.flags&32){var y=s.stateNode;try{Fi(y,"")}catch(xe){Mt(s,s.return,xe)}}if(p&4&&(y=s.stateNode,y!=null)){var b=s.memoizedProps,T=d!==null?d.memoizedProps:b,O=s.type,D=s.updateQueue;if(s.updateQueue=null,D!==null)try{O==="input"&&b.type==="radio"&&b.name!=null&&hi(y,b),ss(O,T);var K=ss(O,b);for(T=0;T<D.length;T+=2){var te=D[T],re=D[T+1];te==="style"?rs(y,re):te==="dangerouslySetInnerHTML"?fi(y,re):te==="children"?Fi(y,re):N(y,te,re,K)}switch(O){case"input":$t(y,b);break;case"textarea":Gn(y,b);break;case"select":var ee=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!b.multiple;var ge=b.value;ge!=null?en(y,!!b.multiple,ge,!1):ee!==!!b.multiple&&(b.defaultValue!=null?en(y,!!b.multiple,b.defaultValue,!0):en(y,!!b.multiple,b.multiple?[]:"",!1))}y[nc]=b}catch(xe){Mt(s,s.return,xe)}}break;case 6:if(qi(l,s),pr(s),p&4){if(s.stateNode===null)throw Error(n(162));y=s.stateNode,b=s.memoizedProps;try{y.nodeValue=b}catch(xe){Mt(s,s.return,xe)}}break;case 3:if(qi(l,s),pr(s),p&4&&d!==null&&d.memoizedState.isDehydrated)try{co(l.containerInfo)}catch(xe){Mt(s,s.return,xe)}break;case 4:qi(l,s),pr(s);break;case 13:qi(l,s),pr(s),y=s.child,y.flags&8192&&(b=y.memoizedState!==null,y.stateNode.isHidden=b,!b||y.alternate!==null&&y.alternate.memoizedState!==null||(Dp=Pt())),p&4&&ib(s);break;case 22:if(te=d!==null&&d.memoizedState!==null,s.mode&1?(Mn=(K=Mn)||te,qi(l,s),Mn=K):qi(l,s),pr(s),p&8192){if(K=s.memoizedState!==null,(s.stateNode.isHidden=K)&&!te&&(s.mode&1)!==0)for(ve=s,te=s.child;te!==null;){for(re=ve=te;ve!==null;){switch(ee=ve,ge=ee.child,ee.tag){case 0:case 11:case 14:case 15:fc(4,ee,ee.return);break;case 1:Ma(ee,ee.return);var we=ee.stateNode;if(typeof we.componentWillUnmount=="function"){p=ee,d=ee.return;try{l=p,we.props=l.memoizedProps,we.state=l.memoizedState,we.componentWillUnmount()}catch(xe){Mt(p,d,xe)}}break;case 5:Ma(ee,ee.return);break;case 22:if(ee.memoizedState!==null){ab(re);continue}}ge!==null?(ge.return=ee,ve=ge):ab(re)}te=te.sibling}e:for(te=null,re=s;;){if(re.tag===5){if(te===null){te=re;try{y=re.stateNode,K?(b=y.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(O=re.stateNode,D=re.memoizedProps.style,T=D!=null&&D.hasOwnProperty("display")?D.display:null,O.style.display=Cr("display",T))}catch(xe){Mt(s,s.return,xe)}}}else if(re.tag===6){if(te===null)try{re.stateNode.nodeValue=K?"":re.memoizedProps}catch(xe){Mt(s,s.return,xe)}}else if((re.tag!==22&&re.tag!==23||re.memoizedState===null||re===s)&&re.child!==null){re.child.return=re,re=re.child;continue}if(re===s)break e;for(;re.sibling===null;){if(re.return===null||re.return===s)break e;te===re&&(te=null),re=re.return}te===re&&(te=null),re.sibling.return=re.return,re=re.sibling}}break;case 19:qi(l,s),pr(s),p&4&&ib(s);break;case 21:break;default:qi(l,s),pr(s)}}function pr(s){var l=s.flags;if(l&2){try{e:{for(var d=s.return;d!==null;){if(eb(d)){var p=d;break e}d=d.return}throw Error(n(160))}switch(p.tag){case 5:var y=p.stateNode;p.flags&32&&(Fi(y,""),p.flags&=-33);var b=tb(s);Op(s,b,y);break;case 3:case 4:var T=p.stateNode.containerInfo,O=tb(s);Ip(s,O,T);break;default:throw Error(n(161))}}catch(D){Mt(s,s.return,D)}s.flags&=-3}l&4096&&(s.flags&=-4097)}function X_(s,l,d){ve=s,sb(s)}function sb(s,l,d){for(var p=(s.mode&1)!==0;ve!==null;){var y=ve,b=y.child;if(y.tag===22&&p){var T=y.memoizedState!==null||fd;if(!T){var O=y.alternate,D=O!==null&&O.memoizedState!==null||Mn;O=fd;var K=Mn;if(fd=T,(Mn=D)&&!K)for(ve=y;ve!==null;)T=ve,D=T.child,T.tag===22&&T.memoizedState!==null?lb(y):D!==null?(D.return=T,ve=D):lb(y);for(;b!==null;)ve=b,sb(b),b=b.sibling;ve=y,fd=O,Mn=K}ob(s)}else(y.subtreeFlags&8772)!==0&&b!==null?(b.return=y,ve=b):ob(s)}}function ob(s){for(;ve!==null;){var l=ve;if((l.flags&8772)!==0){var d=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:Mn||pd(5,l);break;case 1:var p=l.stateNode;if(l.flags&4&&!Mn)if(d===null)p.componentDidMount();else{var y=l.elementType===l.type?d.memoizedProps:zi(l.type,d.memoizedProps);p.componentDidUpdate(y,d.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var b=l.updateQueue;b!==null&&ay(l,b,p);break;case 3:var T=l.updateQueue;if(T!==null){if(d=null,l.child!==null)switch(l.child.tag){case 5:d=l.child.stateNode;break;case 1:d=l.child.stateNode}ay(l,T,d)}break;case 5:var O=l.stateNode;if(d===null&&l.flags&4){d=O;var D=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":D.autoFocus&&d.focus();break;case"img":D.src&&(d.src=D.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var K=l.alternate;if(K!==null){var te=K.memoizedState;if(te!==null){var re=te.dehydrated;re!==null&&co(re)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Mn||l.flags&512&&Np(l)}catch(ee){Mt(l,l.return,ee)}}if(l===s){ve=null;break}if(d=l.sibling,d!==null){d.return=l.return,ve=d;break}ve=l.return}}function ab(s){for(;ve!==null;){var l=ve;if(l===s){ve=null;break}var d=l.sibling;if(d!==null){d.return=l.return,ve=d;break}ve=l.return}}function lb(s){for(;ve!==null;){var l=ve;try{switch(l.tag){case 0:case 11:case 15:var d=l.return;try{pd(4,l)}catch(D){Mt(l,d,D)}break;case 1:var p=l.stateNode;if(typeof p.componentDidMount=="function"){var y=l.return;try{p.componentDidMount()}catch(D){Mt(l,y,D)}}var b=l.return;try{Np(l)}catch(D){Mt(l,b,D)}break;case 5:var T=l.return;try{Np(l)}catch(D){Mt(l,T,D)}}}catch(D){Mt(l,l.return,D)}if(l===s){ve=null;break}var O=l.sibling;if(O!==null){O.return=l.return,ve=O;break}ve=l.return}}var Z_=Math.ceil,md=P.ReactCurrentDispatcher,Ap=P.ReactCurrentOwner,Ii=P.ReactCurrentBatchConfig,it=0,mn=null,Yt=null,Cn=0,yi=0,La=Ss(0),on=0,pc=null,Ro=0,gd=0,jp=0,mc=null,si=null,Dp=0,Ua=1/0,qr=null,vd=!1,Mp=null,Rs=null,yd=!1,Ns=null,bd=0,gc=0,Lp=null,wd=-1,kd=0;function zn(){return(it&6)!==0?Pt():wd!==-1?wd:wd=Pt()}function Is(s){return(s.mode&1)===0?1:(it&2)!==0&&Cn!==0?Cn&-Cn:M_.transition!==null?(kd===0&&(kd=jl()),kd):(s=nt,s!==0||(s=window.event,s=s===void 0?16:zl(s.type)),s)}function Ki(s,l,d,p){if(50<gc)throw gc=0,Lp=null,Error(n(185));ds(s,d,p),((it&2)===0||s!==mn)&&(s===mn&&((it&2)===0&&(gd|=d),on===4&&Os(s,Cn)),oi(s,p),d===1&&it===0&&(l.mode&1)===0&&(Ua=Pt()+500,Ju&&Cs()))}function oi(s,l){var d=s.callbackNode;mf(s,l);var p=aa(s,s===mn?Cn:0);if(p===0)d!==null&&Il(d),s.callbackNode=null,s.callbackPriority=0;else if(l=p&-p,s.callbackPriority!==l){if(d!=null&&Il(d),l===1)s.tag===0?D_(ub.bind(null,s)):J0(ub.bind(null,s)),I_(function(){(it&6)===0&&Cs()}),d=null;else{switch(hs(p)){case 1:d=Ol;break;case 4:d=as;break;case 16:d=sa;break;case 536870912:d=Nr;break;default:d=sa}d=yb(d,cb.bind(null,s))}s.callbackPriority=l,s.callbackNode=d}}function cb(s,l){if(wd=-1,kd=0,(it&6)!==0)throw Error(n(327));var d=s.callbackNode;if(Fa()&&s.callbackNode!==d)return null;var p=aa(s,s===mn?Cn:0);if(p===0)return null;if((p&30)!==0||(p&s.expiredLanes)!==0||l)l=xd(s,p);else{l=p;var y=it;it|=2;var b=hb();(mn!==s||Cn!==l)&&(qr=null,Ua=Pt()+500,Io(s,l));do try{nE();break}catch(O){db(s,O)}while(!0);tp(),md.current=b,it=y,Yt!==null?l=0:(mn=null,Cn=0,l=on)}if(l!==0){if(l===2&&(y=Al(s),y!==0&&(p=y,l=Up(s,y))),l===1)throw d=pc,Io(s,0),Os(s,p),oi(s,Pt()),d;if(l===6)Os(s,p);else{if(y=s.current.alternate,(p&30)===0&&!eE(y)&&(l=xd(s,p),l===2&&(b=Al(s),b!==0&&(p=b,l=Up(s,b))),l===1))throw d=pc,Io(s,0),Os(s,p),oi(s,Pt()),d;switch(s.finishedWork=y,s.finishedLanes=p,l){case 0:case 1:throw Error(n(345));case 2:Oo(s,si,qr);break;case 3:if(Os(s,p),(p&130023424)===p&&(l=Dp+500-Pt(),10<l)){if(aa(s,0)!==0)break;if(y=s.suspendedLanes,(y&p)!==p){zn(),s.pingedLanes|=s.suspendedLanes&y;break}s.timeoutHandle=qf(Oo.bind(null,s,si,qr),l);break}Oo(s,si,qr);break;case 4:if(Os(s,p),(p&4194240)===p)break;for(l=s.eventTimes,y=-1;0<p;){var T=31-Be(p);b=1<<T,T=l[T],T>y&&(y=T),p&=~b}if(p=y,p=Pt()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*Z_(p/1960))-p,10<p){s.timeoutHandle=qf(Oo.bind(null,s,si,qr),p);break}Oo(s,si,qr);break;case 5:Oo(s,si,qr);break;default:throw Error(n(329))}}}return oi(s,Pt()),s.callbackNode===d?cb.bind(null,s):null}function Up(s,l){var d=mc;return s.current.memoizedState.isDehydrated&&(Io(s,l).flags|=256),s=xd(s,l),s!==2&&(l=si,si=d,l!==null&&Fp(l)),s}function Fp(s){si===null?si=s:si.push.apply(si,s)}function eE(s){for(var l=s;;){if(l.flags&16384){var d=l.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var p=0;p<d.length;p++){var y=d[p],b=y.getSnapshot;y=y.value;try{if(!We(b(),y))return!1}catch{return!1}}}if(d=l.child,l.subtreeFlags&16384&&d!==null)d.return=l,l=d;else{if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Os(s,l){for(l&=~jp,l&=~gd,s.suspendedLanes|=l,s.pingedLanes&=~l,s=s.expirationTimes;0<l;){var d=31-Be(l),p=1<<d;s[d]=-1,l&=~p}}function ub(s){if((it&6)!==0)throw Error(n(327));Fa();var l=aa(s,0);if((l&1)===0)return oi(s,Pt()),null;var d=xd(s,l);if(s.tag!==0&&d===2){var p=Al(s);p!==0&&(l=p,d=Up(s,p))}if(d===1)throw d=pc,Io(s,0),Os(s,l),oi(s,Pt()),d;if(d===6)throw Error(n(345));return s.finishedWork=s.current.alternate,s.finishedLanes=l,Oo(s,si,qr),oi(s,Pt()),null}function Bp(s,l){var d=it;it|=1;try{return s(l)}finally{it=d,it===0&&(Ua=Pt()+500,Ju&&Cs())}}function No(s){Ns!==null&&Ns.tag===0&&(it&6)===0&&Fa();var l=it;it|=1;var d=Ii.transition,p=nt;try{if(Ii.transition=null,nt=1,s)return s()}finally{nt=p,Ii.transition=d,it=l,(it&6)===0&&Cs()}}function Vp(){yi=La.current,vt(La)}function Io(s,l){s.finishedWork=null,s.finishedLanes=0;var d=s.timeoutHandle;if(d!==-1&&(s.timeoutHandle=-1,N_(d)),Yt!==null)for(d=Yt.return;d!==null;){var p=d;switch(Yf(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&Hu();break;case 3:ja(),vt(ni),vt(An),cp();break;case 5:ap(p);break;case 4:ja();break;case 13:vt(Nt);break;case 19:vt(Nt);break;case 10:np(p.type._context);break;case 22:case 23:Vp()}d=d.return}if(mn=s,Yt=s=As(s.current,null),Cn=yi=l,on=0,pc=null,jp=gd=Ro=0,si=mc=null,_o!==null){for(l=0;l<_o.length;l++)if(d=_o[l],p=d.interleaved,p!==null){d.interleaved=null;var y=p.next,b=d.pending;if(b!==null){var T=b.next;b.next=y,p.next=T}d.pending=p}_o=null}return s}function db(s,l){do{var d=Yt;try{if(tp(),sd.current=cd,od){for(var p=It.memoizedState;p!==null;){var y=p.queue;y!==null&&(y.pending=null),p=p.next}od=!1}if(Po=0,pn=sn=It=null,lc=!1,cc=0,Ap.current=null,d===null||d.return===null){on=1,pc=l,Yt=null;break}e:{var b=s,T=d.return,O=d,D=l;if(l=Cn,O.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){var K=D,te=O,re=te.tag;if((te.mode&1)===0&&(re===0||re===11||re===15)){var ee=te.alternate;ee?(te.updateQueue=ee.updateQueue,te.memoizedState=ee.memoizedState,te.lanes=ee.lanes):(te.updateQueue=null,te.memoizedState=null)}var ge=My(T);if(ge!==null){ge.flags&=-257,Ly(ge,T,O,b,l),ge.mode&1&&Dy(b,K,l),l=ge,D=K;var we=l.updateQueue;if(we===null){var xe=new Set;xe.add(D),l.updateQueue=xe}else we.add(D);break e}else{if((l&1)===0){Dy(b,K,l),zp();break e}D=Error(n(426))}}else if(Tt&&O.mode&1){var qt=My(T);if(qt!==null){(qt.flags&65536)===0&&(qt.flags|=256),Ly(qt,T,O,b,l),Zf(Da(D,O));break e}}b=D=Da(D,O),on!==4&&(on=2),mc===null?mc=[b]:mc.push(b),b=T;do{switch(b.tag){case 3:b.flags|=65536,l&=-l,b.lanes|=l;var B=Ay(b,D,l);oy(b,B);break e;case 1:O=D;var M=b.type,$=b.stateNode;if((b.flags&128)===0&&(typeof M.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Rs===null||!Rs.has($)))){b.flags|=65536,l&=-l,b.lanes|=l;var ae=jy(b,O,l);oy(b,ae);break e}}b=b.return}while(b!==null)}pb(d)}catch(Ee){l=Ee,Yt===d&&d!==null&&(Yt=d=d.return);continue}break}while(!0)}function hb(){var s=md.current;return md.current=cd,s===null?cd:s}function zp(){(on===0||on===3||on===2)&&(on=4),mn===null||(Ro&268435455)===0&&(gd&268435455)===0||Os(mn,Cn)}function xd(s,l){var d=it;it|=2;var p=hb();(mn!==s||Cn!==l)&&(qr=null,Io(s,l));do try{tE();break}catch(y){db(s,y)}while(!0);if(tp(),it=d,md.current=p,Yt!==null)throw Error(n(261));return mn=null,Cn=0,on}function tE(){for(;Yt!==null;)fb(Yt)}function nE(){for(;Yt!==null&&!na();)fb(Yt)}function fb(s){var l=vb(s.alternate,s,yi);s.memoizedProps=s.pendingProps,l===null?pb(s):Yt=l,Ap.current=null}function pb(s){var l=s;do{var d=l.alternate;if(s=l.return,(l.flags&32768)===0){if(d=G_(d,l,yi),d!==null){Yt=d;return}}else{if(d=J_(d,l),d!==null){d.flags&=32767,Yt=d;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{on=6,Yt=null;return}}if(l=l.sibling,l!==null){Yt=l;return}Yt=l=s}while(l!==null);on===0&&(on=5)}function Oo(s,l,d){var p=nt,y=Ii.transition;try{Ii.transition=null,nt=1,iE(s,l,d,p)}finally{Ii.transition=y,nt=p}return null}function iE(s,l,d,p){do Fa();while(Ns!==null);if((it&6)!==0)throw Error(n(327));d=s.finishedWork;var y=s.finishedLanes;if(d===null)return null;if(s.finishedWork=null,s.finishedLanes=0,d===s.current)throw Error(n(177));s.callbackNode=null,s.callbackPriority=0;var b=d.lanes|d.childLanes;if(Ml(s,b),s===mn&&(Yt=mn=null,Cn=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||yd||(yd=!0,yb(sa,function(){return Fa(),null})),b=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||b){b=Ii.transition,Ii.transition=null;var T=nt;nt=1;var O=it;it|=4,Ap.current=null,Q_(s,d),rb(d,s),S_(zf),ha=!!Vf,zf=Vf=null,s.current=d,X_(d),ia(),it=O,nt=T,Ii.transition=b}else s.current=d;if(yd&&(yd=!1,Ns=s,bd=y),b=s.pendingLanes,b===0&&(Rs=null),_u(d.stateNode),oi(s,Pt()),l!==null)for(p=s.onRecoverableError,d=0;d<l.length;d++)y=l[d],p(y.value,{componentStack:y.stack,digest:y.digest});if(vd)throw vd=!1,s=Mp,Mp=null,s;return(bd&1)!==0&&s.tag!==0&&Fa(),b=s.pendingLanes,(b&1)!==0?s===Lp?gc++:(gc=0,Lp=s):gc=0,Cs(),null}function Fa(){if(Ns!==null){var s=hs(bd),l=Ii.transition,d=nt;try{if(Ii.transition=null,nt=16>s?16:s,Ns===null)var p=!1;else{if(s=Ns,Ns=null,bd=0,(it&6)!==0)throw Error(n(331));var y=it;for(it|=4,ve=s.current;ve!==null;){var b=ve,T=b.child;if((ve.flags&16)!==0){var O=b.deletions;if(O!==null){for(var D=0;D<O.length;D++){var K=O[D];for(ve=K;ve!==null;){var te=ve;switch(te.tag){case 0:case 11:case 15:fc(8,te,b)}var re=te.child;if(re!==null)re.return=te,ve=re;else for(;ve!==null;){te=ve;var ee=te.sibling,ge=te.return;if(Zy(te),te===K){ve=null;break}if(ee!==null){ee.return=ge,ve=ee;break}ve=ge}}}var we=b.alternate;if(we!==null){var xe=we.child;if(xe!==null){we.child=null;do{var qt=xe.sibling;xe.sibling=null,xe=qt}while(xe!==null)}}ve=b}}if((b.subtreeFlags&2064)!==0&&T!==null)T.return=b,ve=T;else e:for(;ve!==null;){if(b=ve,(b.flags&2048)!==0)switch(b.tag){case 0:case 11:case 15:fc(9,b,b.return)}var B=b.sibling;if(B!==null){B.return=b.return,ve=B;break e}ve=b.return}}var M=s.current;for(ve=M;ve!==null;){T=ve;var $=T.child;if((T.subtreeFlags&2064)!==0&&$!==null)$.return=T,ve=$;else e:for(T=M;ve!==null;){if(O=ve,(O.flags&2048)!==0)try{switch(O.tag){case 0:case 11:case 15:pd(9,O)}}catch(Ee){Mt(O,O.return,Ee)}if(O===T){ve=null;break e}var ae=O.sibling;if(ae!==null){ae.return=O.return,ve=ae;break e}ve=O.return}}if(it=y,Cs(),Bn&&typeof Bn.onPostCommitFiberRoot=="function")try{Bn.onPostCommitFiberRoot(oo,s)}catch{}p=!0}return p}finally{nt=d,Ii.transition=l}}return!1}function mb(s,l,d){l=Da(d,l),l=Ay(s,l,1),s=Es(s,l,1),l=zn(),s!==null&&(ds(s,1,l),oi(s,l))}function Mt(s,l,d){if(s.tag===3)mb(s,s,d);else for(;l!==null;){if(l.tag===3){mb(l,s,d);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Rs===null||!Rs.has(p))){s=Da(d,s),s=jy(l,s,1),l=Es(l,s,1),s=zn(),l!==null&&(ds(l,1,s),oi(l,s));break}}l=l.return}}function rE(s,l,d){var p=s.pingCache;p!==null&&p.delete(l),l=zn(),s.pingedLanes|=s.suspendedLanes&d,mn===s&&(Cn&d)===d&&(on===4||on===3&&(Cn&130023424)===Cn&&500>Pt()-Dp?Io(s,0):jp|=d),oi(s,l)}function gb(s,l){l===0&&((s.mode&1)===0?l=1:(l=oa,oa<<=1,(oa&130023424)===0&&(oa=4194304)));var d=zn();s=Vr(s,l),s!==null&&(ds(s,l,d),oi(s,d))}function sE(s){var l=s.memoizedState,d=0;l!==null&&(d=l.retryLane),gb(s,d)}function oE(s,l){var d=0;switch(s.tag){case 13:var p=s.stateNode,y=s.memoizedState;y!==null&&(d=y.retryLane);break;case 19:p=s.stateNode;break;default:throw Error(n(314))}p!==null&&p.delete(l),gb(s,d)}var vb;vb=function(s,l,d){if(s!==null)if(s.memoizedProps!==l.pendingProps||ni.current)ri=!0;else{if((s.lanes&d)===0&&(l.flags&128)===0)return ri=!1,H_(s,l,d);ri=(s.flags&131072)!==0}else ri=!1,Tt&&(l.flags&1048576)!==0&&Y0(l,Qu,l.index);switch(l.lanes=0,l.tag){case 2:var p=l.type;hd(s,l),s=l.pendingProps;var y=Ea(l,An.current);Aa(l,d),y=hp(null,l,p,s,y,d);var b=fp();return l.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,ii(p)?(b=!0,Gu(l)):b=!1,l.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,sp(l),y.updater=ud,l.stateNode=y,y._reactInternals=l,bp(l,p,s,d),l=Sp(null,l,p,!0,b,d)):(l.tag=0,Tt&&b&&Jf(l),Vn(null,l,y,d),l=l.child),l;case 16:p=l.elementType;e:{switch(hd(s,l),s=l.pendingProps,y=p._init,p=y(p._payload),l.type=p,y=l.tag=lE(p),s=zi(p,s),y){case 0:l=xp(null,l,p,s,d);break e;case 1:l=$y(null,l,p,s,d);break e;case 11:l=Uy(null,l,p,s,d);break e;case 14:l=Fy(null,l,p,zi(p.type,s),d);break e}throw Error(n(306,p,""))}return l;case 0:return p=l.type,y=l.pendingProps,y=l.elementType===p?y:zi(p,y),xp(s,l,p,y,d);case 1:return p=l.type,y=l.pendingProps,y=l.elementType===p?y:zi(p,y),$y(s,l,p,y,d);case 3:e:{if(qy(l),s===null)throw Error(n(387));p=l.pendingProps,b=l.memoizedState,y=b.element,sy(s,l),id(l,p,null,d);var T=l.memoizedState;if(p=T.element,b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},l.updateQueue.baseState=b,l.memoizedState=b,l.flags&256){y=Da(Error(n(423)),l),l=Ky(s,l,p,d,y);break e}else if(p!==y){y=Da(Error(n(424)),l),l=Ky(s,l,p,d,y);break e}else for(vi=xs(l.stateNode.containerInfo.firstChild),gi=l,Tt=!0,Vi=null,d=iy(l,null,p,d),l.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Na(),p===y){l=$r(s,l,d);break e}Vn(s,l,p,d)}l=l.child}return l;case 5:return ly(l),s===null&&Xf(l),p=l.type,y=l.pendingProps,b=s!==null?s.memoizedProps:null,T=y.children,$f(p,y)?T=null:b!==null&&$f(p,b)&&(l.flags|=32),zy(s,l),Vn(s,l,T,d),l.child;case 6:return s===null&&Xf(l),null;case 13:return Wy(s,l,d);case 4:return op(l,l.stateNode.containerInfo),p=l.pendingProps,s===null?l.child=Ia(l,null,p,d):Vn(s,l,p,d),l.child;case 11:return p=l.type,y=l.pendingProps,y=l.elementType===p?y:zi(p,y),Uy(s,l,p,y,d);case 7:return Vn(s,l,l.pendingProps,d),l.child;case 8:return Vn(s,l,l.pendingProps.children,d),l.child;case 12:return Vn(s,l,l.pendingProps.children,d),l.child;case 10:e:{if(p=l.type._context,y=l.pendingProps,b=l.memoizedProps,T=y.value,ht(ed,p._currentValue),p._currentValue=T,b!==null)if(We(b.value,T)){if(b.children===y.children&&!ni.current){l=$r(s,l,d);break e}}else for(b=l.child,b!==null&&(b.return=l);b!==null;){var O=b.dependencies;if(O!==null){T=b.child;for(var D=O.firstContext;D!==null;){if(D.context===p){if(b.tag===1){D=zr(-1,d&-d),D.tag=2;var K=b.updateQueue;if(K!==null){K=K.shared;var te=K.pending;te===null?D.next=D:(D.next=te.next,te.next=D),K.pending=D}}b.lanes|=d,D=b.alternate,D!==null&&(D.lanes|=d),ip(b.return,d,l),O.lanes|=d;break}D=D.next}}else if(b.tag===10)T=b.type===l.type?null:b.child;else if(b.tag===18){if(T=b.return,T===null)throw Error(n(341));T.lanes|=d,O=T.alternate,O!==null&&(O.lanes|=d),ip(T,d,l),T=b.sibling}else T=b.child;if(T!==null)T.return=b;else for(T=b;T!==null;){if(T===l){T=null;break}if(b=T.sibling,b!==null){b.return=T.return,T=b;break}T=T.return}b=T}Vn(s,l,y.children,d),l=l.child}return l;case 9:return y=l.type,p=l.pendingProps.children,Aa(l,d),y=Ri(y),p=p(y),l.flags|=1,Vn(s,l,p,d),l.child;case 14:return p=l.type,y=zi(p,l.pendingProps),y=zi(p.type,y),Fy(s,l,p,y,d);case 15:return By(s,l,l.type,l.pendingProps,d);case 17:return p=l.type,y=l.pendingProps,y=l.elementType===p?y:zi(p,y),hd(s,l),l.tag=1,ii(p)?(s=!0,Gu(l)):s=!1,Aa(l,d),Iy(l,p,y),bp(l,p,y,d),Sp(null,l,p,!0,s,d);case 19:return Gy(s,l,d);case 22:return Vy(s,l,d)}throw Error(n(156,l.tag))};function yb(s,l){return ta(s,l)}function aE(s,l,d,p){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oi(s,l,d,p){return new aE(s,l,d,p)}function $p(s){return s=s.prototype,!(!s||!s.isReactComponent)}function lE(s){if(typeof s=="function")return $p(s)?1:0;if(s!=null){if(s=s.$$typeof,s===ne)return 11;if(s===Ke)return 14}return 2}function As(s,l){var d=s.alternate;return d===null?(d=Oi(s.tag,l,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=l,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&14680064,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,l=s.dependencies,d.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d}function Sd(s,l,d,p,y,b){var T=2;if(p=s,typeof s=="function")$p(s)&&(T=1);else if(typeof s=="string")T=5;else e:switch(s){case U:return Ao(d.children,y,b,l);case F:T=8,y|=8;break;case H:return s=Oi(12,d,l,y|2),s.elementType=H,s.lanes=b,s;case Se:return s=Oi(13,d,l,y),s.elementType=Se,s.lanes=b,s;case De:return s=Oi(19,d,l,y),s.elementType=De,s.lanes=b,s;case V:return Td(d,y,b,l);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case q:T=10;break e;case Q:T=9;break e;case ne:T=11;break e;case Ke:T=14;break e;case de:T=16,p=null;break e}throw Error(n(130,s==null?s:typeof s,""))}return l=Oi(T,d,l,y),l.elementType=s,l.type=p,l.lanes=b,l}function Ao(s,l,d,p){return s=Oi(7,s,p,l),s.lanes=d,s}function Td(s,l,d,p){return s=Oi(22,s,p,l),s.elementType=V,s.lanes=d,s.stateNode={isHidden:!1},s}function qp(s,l,d){return s=Oi(6,s,null,l),s.lanes=d,s}function Kp(s,l,d){return l=Oi(4,s.children!==null?s.children:[],s.key,l),l.lanes=d,l.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},l}function cE(s,l,d,p,y){this.tag=l,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Dl(0),this.expirationTimes=Dl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dl(0),this.identifierPrefix=p,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function Wp(s,l,d,p,y,b,T,O,D){return s=new cE(s,l,d,O,D),l===1?(l=1,b===!0&&(l|=8)):l=0,b=Oi(3,null,null,l),s.current=b,b.stateNode=s,b.memoizedState={element:p,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},sp(b),s}function uE(s,l,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:j,key:p==null?null:""+p,children:s,containerInfo:l,implementation:d}}function bb(s){if(!s)return Ts;s=s._reactInternals;e:{if(Xn(s)!==s||s.tag!==1)throw Error(n(170));var l=s;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(ii(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(n(171))}if(s.tag===1){var d=s.type;if(ii(d))return H0(s,d,l)}return l}function wb(s,l,d,p,y,b,T,O,D){return s=Wp(d,p,!0,s,y,b,T,O,D),s.context=bb(null),d=s.current,p=zn(),y=Is(d),b=zr(p,y),b.callback=l??null,Es(d,b,y),s.current.lanes=y,ds(s,y,p),oi(s,p),s}function Cd(s,l,d,p){var y=l.current,b=zn(),T=Is(y);return d=bb(d),l.context===null?l.context=d:l.pendingContext=d,l=zr(b,T),l.payload={element:s},p=p===void 0?null:p,p!==null&&(l.callback=p),s=Es(y,l,T),s!==null&&(Ki(s,y,T,b),nd(s,y,T)),T}function _d(s){return s=s.current,s.child?(s.child.tag===5,s.child.stateNode):null}function kb(s,l){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<l?d:l}}function Hp(s,l){kb(s,l),(s=s.alternate)&&kb(s,l)}function dE(){return null}var xb=typeof reportError=="function"?reportError:function(s){console.error(s)};function Gp(s){this._internalRoot=s}Ed.prototype.render=Gp.prototype.render=function(s){var l=this._internalRoot;if(l===null)throw Error(n(409));Cd(s,l,null,null)},Ed.prototype.unmount=Gp.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var l=s.containerInfo;No(function(){Cd(null,s,null,null)}),l[Lr]=null}};function Ed(s){this._internalRoot=s}Ed.prototype.unstable_scheduleHydration=function(s){if(s){var l=Ir();s={blockedOn:null,target:s,priority:l};for(var d=0;d<cr.length&&l!==0&&l<cr[d].priority;d++);cr.splice(d,0,s),d===0&&Fl(s)}};function Jp(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Pd(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Sb(){}function hE(s,l,d,p,y){if(y){if(typeof p=="function"){var b=p;p=function(){var K=_d(T);b.call(K)}}var T=wb(l,p,s,0,null,!1,!1,"",Sb);return s._reactRootContainer=T,s[Lr]=T.current,ec(s.nodeType===8?s.parentNode:s),No(),T}for(;y=s.lastChild;)s.removeChild(y);if(typeof p=="function"){var O=p;p=function(){var K=_d(D);O.call(K)}}var D=Wp(s,0,!1,null,null,!1,!1,"",Sb);return s._reactRootContainer=D,s[Lr]=D.current,ec(s.nodeType===8?s.parentNode:s),No(function(){Cd(l,D,d,p)}),D}function Rd(s,l,d,p,y){var b=d._reactRootContainer;if(b){var T=b;if(typeof y=="function"){var O=y;y=function(){var D=_d(T);O.call(D)}}Cd(l,T,s,y)}else T=hE(d,l,s,y,p);return _d(T)}Ul=function(s){switch(s.tag){case 3:var l=s.stateNode;if(l.current.memoizedState.isDehydrated){var d=us(l.pendingLanes);d!==0&&(Ll(l,d|1),oi(l,Pt()),(it&6)===0&&(Ua=Pt()+500,Cs()))}break;case 13:No(function(){var p=Vr(s,1);if(p!==null){var y=zn();Ki(p,s,1,y)}}),Hp(s,1)}},la=function(s){if(s.tag===13){var l=Vr(s,134217728);if(l!==null){var d=zn();Ki(l,s,134217728,d)}Hp(s,134217728)}},ao=function(s){if(s.tag===13){var l=Is(s),d=Vr(s,l);if(d!==null){var p=zn();Ki(d,s,l,p)}Hp(s,l)}},Ir=function(){return nt},ca=function(s,l){var d=nt;try{return nt=s,l()}finally{nt=d}},Pr=function(s,l,d){switch(l){case"input":if($t(s,d),l=d.name,d.type==="radio"&&l!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<d.length;l++){var p=d[l];if(p!==s&&p.form===s.form){var y=Wu(p);if(!y)throw Error(n(90));mt(p),$t(p,y)}}}break;case"textarea":Gn(s,d);break;case"select":l=d.value,l!=null&&en(s,!!d.multiple,l,!1)}},nn=Bp,rn=No;var fE={usingClientEntryPoint:!1,Events:[ic,Ca,Wu,Ht,xt,Bp]},vc={findFiberByHostInstance:xo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pE={bundleType:vc.bundleType,version:vc.version,rendererPackageName:vc.rendererPackageName,rendererConfig:vc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Rl(s),s===null?null:s.stateNode},findFiberByHostInstance:vc.findFiberByHostInstance||dE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nd.isDisabled&&Nd.supportsFiber)try{oo=Nd.inject(pE),Bn=Nd}catch{}}return ai.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fE,ai.createPortal=function(s,l){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jp(l))throw Error(n(200));return uE(s,l,null,d)},ai.createRoot=function(s,l){if(!Jp(s))throw Error(n(299));var d=!1,p="",y=xb;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onRecoverableError!==void 0&&(y=l.onRecoverableError)),l=Wp(s,1,!1,null,null,d,!1,p,y),s[Lr]=l.current,ec(s.nodeType===8?s.parentNode:s),new Gp(l)},ai.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var l=s._reactInternals;if(l===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=Rl(l),s=s===null?null:s.stateNode,s},ai.flushSync=function(s){return No(s)},ai.hydrate=function(s,l,d){if(!Pd(l))throw Error(n(200));return Rd(null,s,l,!0,d)},ai.hydrateRoot=function(s,l,d){if(!Jp(s))throw Error(n(405));var p=d!=null&&d.hydratedSources||null,y=!1,b="",T=xb;if(d!=null&&(d.unstable_strictMode===!0&&(y=!0),d.identifierPrefix!==void 0&&(b=d.identifierPrefix),d.onRecoverableError!==void 0&&(T=d.onRecoverableError)),l=wb(l,null,s,1,d??null,y,!1,b,T),s[Lr]=l.current,ec(s),p)for(s=0;s<p.length;s++)d=p[s],y=d._getVersion,y=y(d._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[d,y]:l.mutableSourceEagerHydrationData.push(d,y);return new Ed(l)},ai.render=function(s,l,d){if(!Pd(l))throw Error(n(200));return Rd(null,s,l,!1,d)},ai.unmountComponentAtNode=function(s){if(!Pd(s))throw Error(n(40));return s._reactRootContainer?(No(function(){Rd(null,null,s,!1,function(){s._reactRootContainer=null,s[Lr]=null})}),!0):!1},ai.unstable_batchedUpdates=Bp,ai.unstable_renderSubtreeIntoContainer=function(s,l,d,p){if(!Pd(d))throw Error(n(200));if(s==null||s._reactInternals===void 0)throw Error(n(38));return Rd(s,l,d,!1,p)},ai.version="18.3.1-next-f1338f8080-20240426",ai}var Ib;function Xx(){if(Ib)return Xp.exports;Ib=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Xp.exports=kE(),Xp.exports}var Ob;function xE(){if(Ob)return Id;Ob=1;var t=Xx();return Id.createRoot=t.createRoot,Id.hydrateRoot=t.hydrateRoot,Id}var SE=xE();const TE=Qx(SE);var Hs=Xx();var CE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const _E=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ye=(t,e)=>{const n=S.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:c="",children:u,...h},f)=>S.createElement("svg",{ref:f,...CE,width:r,height:r,stroke:i,strokeWidth:a?Number(o)*24/Number(r):o,className:["lucide",`lucide-${_E(t)}`,c].join(" "),...h},[...e.map(([g,v])=>S.createElement(g,v)),...Array.isArray(u)?u:[u]]));return n.displayName=`${t}`,n};const Bh=ye("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const EE=ye("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);const PE=ye("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const RE=ye("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);const NE=ye("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Qm=ye("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const IE=ye("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const fh=ye("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const OE=ye("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Zx=ye("Code2",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);const AE=ye("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);const jE=ye("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const tm=ye("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);const DE=ye("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const Ab=ye("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const ME=ye("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);const ov=ye("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const LE=ye("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);const UE=ye("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const Xm=ye("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const qs=ye("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const FE=ye("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const BE=ye("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const VE=ye("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const zE=ye("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const eS=ye("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const $E=ye("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);const qE=ye("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const KE=ye("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);const jb=ye("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const Wc=ye("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const Vh=ye("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const WE=ye("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const Db=ye("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);const HE=ye("MonitorOff",[["path",{d:"M17 17H4a2 2 0 0 1-2-2V5c0-1.5 1-2 1-2",key:"k0q8oc"}],["path",{d:"M22 15V5a2 2 0 0 0-2-2H9",key:"cp1ac0"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const av=ye("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const GE=ye("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);const Mb=ye("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);const JE=ye("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);const Lb=ye("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);const YE=ye("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const QE=ye("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const Hc=ye("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const tS=ye("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);const XE=ye("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const Ub=ye("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const Zm=ye("ScreenShare",[["path",{d:"M13 3H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3",key:"i8wdob"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"m17 8 5-5",key:"fqif7o"}],["path",{d:"M17 3h5v5",key:"1o3tu8"}]]);const Jd=ye("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const nS=ye("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const iS=ye("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const ZE=ye("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);const eP=ye("SignalHigh",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}]]);const tP=ye("SignalLow",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}]]);const nP=ye("SignalMedium",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}]]);const iP=ye("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);const rP=ye("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["path",{d:"M12 14h.01",key:"1etili"}]]);const sP=ye("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);const rS=ye("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const oP=ye("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const aP=ye("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);const lP=ye("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);const ph=ye("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);const eg=ye("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const Go=ye("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const lv=ye("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);var Fb={};function cP(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var uP=Object.defineProperty,dP=(t,e,n)=>e in t?uP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Bb=(t,e,n)=>dP(t,typeof e!="symbol"?e+"":e,n);class Kn{constructor(){Bb(this,"_locking"),Bb(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function Bt(t,e){if(!t)throw new Error(e)}const hP=34028234663852886e22,fP=-34028234663852886e22,pP=4294967295,mP=2147483647,gP=-2147483648;function Yd(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>mP||t<gP)throw new Error("invalid int 32: "+t)}function tg(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>pP||t<0)throw new Error("invalid uint 32: "+t)}function sS(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>hP||t<fP))throw new Error("invalid float 32: "+t)}const oS=Symbol("@bufbuild/protobuf/enum-type");function vP(t){const e=t[oS];return Bt(e,"missing enum type on enum object"),e}function aS(t,e,n,i){t[oS]=lS(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function lS(t,e,n){const i=Object.create(null),r=Object.create(null),o=[];for(const a of e){const c=cS(a);o.push(c),i[a.name]=c,r[a.no]=c}return{typeName:t,values:o,findName(a){return i[a]},findNumber(a){return r[a]}}}function yP(t,e,n){const i={};for(const r of e){const o=cS(r);i[o.localName]=o.no,i[o.no]=o.localName}return aS(i,t,e),i}function cS(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class cv{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,o=r.makeReadOptions(n);return r.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,o=r.makeReadOptions(n);return r.readMessage(i,e,o,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),o=r.writerFactory();return i.writeMessage(this,o,r),o.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function bP(t,e,n,i){var r;const o=(r=i?.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),a={[o]:function(c){t.util.initFields(this),t.util.initPartial(c,this)}}[o];return Object.setPrototypeOf(a.prototype,new cv),Object.assign(a,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(c,u){return new a().fromBinary(c,u)},fromJson(c,u){return new a().fromJson(c,u)},fromJsonString(c,u){return new a().fromJsonString(c,u)},equals(c,u){return t.util.equals(a,c,u)}}),a}function wP(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,(r&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function nm(t,e,n){for(let o=0;o<28;o=o+7){const a=t>>>o,c=!(!(a>>>7)&&e==0),u=(c?a|128:a)&255;if(n.push(u),!c)return}const i=t>>>28&15|(e&7)<<4,r=e>>3!=0;if(n.push((r?i|128:i)&255),!!r){for(let o=3;o<31;o=o+7){const a=e>>>o,c=!!(a>>>7),u=(c?a|128:a)&255;if(n.push(u),!c)return}n.push(e>>>31&1)}}const Qd=4294967296;function Vb(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function o(a,c){const u=Number(t.slice(a,c));r*=n,i=i*n+u,i>=Qd&&(r=r+(i/Qd|0),i=i%Qd)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?dS(i,r):uv(i,r)}function kP(t,e){let n=uv(t,e);const i=n.hi&2147483648;i&&(n=dS(n.lo,n.hi));const r=uS(n.lo,n.hi);return i?"-"+r:r}function uS(t,e){if({lo:t,hi:e}=xP(t,e),e<=2097151)return String(Qd*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let o=n+i*6777216+r*6710656,a=i+r*8147497,c=r*2;const u=1e7;return o>=u&&(a+=Math.floor(o/u),o%=u),a>=u&&(c+=Math.floor(a/u),a%=u),c.toString()+zb(a)+zb(o)}function xP(t,e){return{lo:t>>>0,hi:e>>>0}}function uv(t,e){return{lo:t|0,hi:e|0}}function dS(t,e){return e=~e,t?t=~t+1:e+=1,uv(t,e)}const zb=t=>{const e=String(t);return"0000000".slice(e.length)+e};function $b(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function SP(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function TP(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Fb!="object"||Fb.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),c=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(u){const h=typeof u=="bigint"?u:BigInt(u);if(h>o||h<r)throw new Error("int64 invalid: ".concat(u));return h},uParse(u){const h=typeof u=="bigint"?u:BigInt(u);if(h>c||h<a)throw new Error("uint64 invalid: ".concat(u));return h},enc(u){return t.setBigInt64(0,this.parse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(u){return t.setBigInt64(0,this.uParse(u),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(u,h){return t.setInt32(0,u,!0),t.setInt32(4,h,!0),t.getBigInt64(0,!0)},uDec(u,h){return t.setInt32(0,u,!0),t.setInt32(4,h,!0),t.getBigUint64(0,!0)}}}const n=r=>Bt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Bt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),Vb(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),Vb(r)},dec(r,o){return kP(r,o)},uDec(r,o){return uS(r,o)}}}const _t=TP();var X;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(X||(X={}));var Xs;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Xs||(Xs={}));function Ds(t,e,n){if(e===n)return!0;if(t==X.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return e==n}return!1}function gl(t,e){switch(t){case X.BOOL:return!1;case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return e==0?_t.zero:"0";case X.DOUBLE:case X.FLOAT:return 0;case X.BYTES:return new Uint8Array(0);case X.STRING:return"";default:return 0}}function hS(t,e){switch(t){case X.BOOL:return e===!1;case X.STRING:return e==="";case X.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Wt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Wt||(Wt={}));class CP{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(tg(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Yd(e),$b(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){sS(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){tg(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Yd(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Yd(e),e=(e<<1^e>>31)>>>0,$b(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=_t.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=_t.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=_t.enc(e);return nm(n.lo,n.hi,this.buf),this}sint64(e){let n=_t.enc(e),i=n.hi>>31,r=n.lo<<1^i,o=(n.hi<<1|n.lo>>>31)^i;return nm(r,o,this.buf),this}uint64(e){let n=_t.uEnc(e);return nm(n.lo,n.hi,this.buf),this}}class _P{constructor(e,n){this.varint64=wP,this.uint32=SP,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Wt.Varint:for(;this.buf[this.pos++]&128;);break;case Wt.Bit64:this.pos+=4;case Wt.Bit32:this.pos+=4;break;case Wt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Wt.StartGroup:for(;;){const[o,a]=this.tag();if(a===Wt.EndGroup){if(n!==void 0&&o!==n)throw new Error("invalid end group tag");break}this.skip(a,o)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return _t.dec(...this.varint64())}uint64(){return _t.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,_t.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return _t.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return _t.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function EP(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const o=typeof i=="function"?i():i;o.name=e.split(".").pop(),o.jsonName="[".concat(e,"]"),r=t.util.newFieldList([o]).list()[0]}return r},runtime:t}}function fS(t){const e=t.field.localName,n=Object.create(null);return n[e]=PP(t),[n,()=>n[e]]}function PP(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return gl(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function RP(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Gr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),zh=[];for(let t=0;t<Gr.length;t++)zh[Gr[t].charCodeAt(0)]=t;zh[45]=Gr.indexOf("+");zh[95]=Gr.indexOf("/");const pS={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,o,a=0;for(let c=0;c<t.length;c++){if(o=zh[t.charCodeAt(c)],o===void 0)switch(t[c]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=o,r=1;break;case 1:n[i++]=a<<2|(o&48)>>4,a=o,r=2;break;case 2:n[i++]=(a&15)<<4|(o&60)>>2,a=o,r=3;break;case 3:n[i++]=(a&3)<<6|o,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let o=0;o<t.length;o++)switch(i=t[o],n){case 0:e+=Gr[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Gr[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Gr[r|i>>6],e+=Gr[i&63],n=0;break}return n&&(e+=Gr[r],e+="=",n==1&&(e+="=")),e}};function NP(t,e,n){gS(e,t);const i=e.runtime.bin.makeReadOptions(n),r=RP(t.getType().runtime.bin.listUnknownFields(t),e.field),[o,a]=fS(e);for(const c of r)e.runtime.bin.readField(o,i.readerFactory(c.data),e.field,c.wireType,i);return a()}function IP(t,e,n,i){gS(e,t);const r=e.runtime.bin.makeReadOptions(i),o=e.runtime.bin.makeWriteOptions(i);if(mS(t,e)){const h=t.getType().runtime.bin.listUnknownFields(t).filter(f=>f.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const f of h)t.getType().runtime.bin.onUnknownField(t,f.no,f.wireType,f.data)}const a=o.writerFactory();let c=e.field;!c.opt&&!c.repeated&&(c.kind=="enum"||c.kind=="scalar")&&(c=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(c,n,a,o);const u=r.readerFactory(a.finish());for(;u.pos<u.len;){const[h,f]=u.tag(),g=u.skip(f,h);t.getType().runtime.bin.onUnknownField(t,h,f,g)}}function mS(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function gS(t,e){Bt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function vS(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!hS(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function qb(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?gl(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Jr(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(cv.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function yS(t,e){return Jr(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}X.DOUBLE,X.FLOAT,X.INT64,X.UINT64,X.INT32,X.UINT32,X.BOOL,X.STRING,X.BYTES;const Kb={ignoreUnknownFields:!1},Wb={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function OP(t){return t?Object.assign(Object.assign({},Kb),t):Kb}function AP(t){return t?Object.assign(Object.assign({},Wb),t):Wb}const mh=Symbol(),Xd=Symbol();function jP(){return{makeReadOptions:OP,makeWriteOptions:AP,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(gr(e)));i=i??new t;const r=new Map,o=n.typeRegistry;for(const[a,c]of Object.entries(e)){const u=t.fields.findJsonName(a);if(u){if(u.oneof){if(c===null&&u.kind=="scalar")continue;const h=r.get(u.oneof);if(h!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(u.oneof.name,'" present: "').concat(h,'", "').concat(a,'"'));r.set(u.oneof,a)}Hb(i,c,u,n,t)}else{let h=!1;if(o?.findExtension&&a.startsWith("[")&&a.endsWith("]")){const f=o.findExtension(a.substring(1,a.length-1));if(f&&f.extendee.typeName==t.typeName){h=!0;const[g,v]=fS(f);Hb(g,c,f.field,n,f),IP(i,f,v(),n)}}if(!h&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(a,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!vS(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!MP(r))continue}const a=r.oneof?t[r.oneof.localName].value:t[r.localName],c=Gb(r,a,e);c!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=c)}const o=e.typeRegistry;if(o?.findExtensionFor)for(const a of n.runtime.bin.listUnknownFields(t)){const c=o.findExtensionFor(n.typeName,a.no);if(c&&mS(t,c)){const u=NP(t,c,e),h=Gb(c.field,u,e);h!==void 0&&(i[c.field.jsonName]=h)}}}catch(o){const a=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),c=o instanceof Error?o.message:String(o);throw new Error(a+(c.length>0?": ".concat(c):""))}return i},readScalar(t,e,n){return Oc(t,e,n??Xs.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||hS(t,e)))return Zd(t,e)},debug:gr}}function gr(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Hb(t,e,n,i,r){let o=n.localName;if(n.repeated){if(Bt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(e)));const a=t[o];for(const c of e){if(c===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(c)));switch(n.kind){case"message":a.push(n.T.fromJson(c,i));break;case"enum":const u=im(n.T,c,i.ignoreUnknownFields,!0);u!==Xd&&a.push(u);break;case"scalar":try{a.push(Oc(n.T,c,n.L,!0))}catch(h){let f="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(c));throw h instanceof Error&&h.message.length>0&&(f+=": ".concat(h.message)),new Error(f)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(e)));const a=t[o];for(const[c,u]of Object.entries(e)){if(u===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let h;try{h=DP(n.K,c)}catch(f){let g="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(e));throw f instanceof Error&&f.message.length>0&&(g+=": ".concat(f.message)),new Error(g)}switch(n.V.kind){case"message":a[h]=n.V.T.fromJson(u,i);break;case"enum":const f=im(n.V.T,u,i.ignoreUnknownFields,!0);f!==Xd&&(a[h]=f);break;case"scalar":try{a[h]=Oc(n.V.T,u,Xs.BIGINT,!0)}catch(g){let v="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(e));throw g instanceof Error&&g.message.length>0&&(v+=": ".concat(g.message)),new Error(v)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:o},o="value"),n.kind){case"message":const a=n.T;if(e===null&&a.typeName!="google.protobuf.Value")return;let c=t[o];Jr(c)?c.fromJson(e,i):(t[o]=c=a.fromJson(e,i),a.fieldWrapper&&!n.oneof&&(t[o]=a.fieldWrapper.unwrapField(c)));break;case"enum":const u=im(n.T,e,i.ignoreUnknownFields,!1);switch(u){case mh:qb(n,t);break;case Xd:break;default:t[o]=u;break}break;case"scalar":try{const h=Oc(n.T,e,n.L,!1);h===mh?qb(n,t):t[o]=h}catch(h){let f="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(gr(e));throw h instanceof Error&&h.message.length>0&&(f+=": ".concat(h.message)),new Error(f)}break}}function DP(t,e){if(t===X.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Oc(t,e,Xs.BIGINT,!0).toString()}function Oc(t,e,n,i){if(e===null)return i?gl(t,n):mh;switch(t){case X.DOUBLE:case X.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==X.FLOAT&&sS(r),r;case X.INT32:case X.FIXED32:case X.SFIXED32:case X.SINT32:case X.UINT32:let o;if(typeof e=="number"?o=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(o=Number(e)),o===void 0)break;return t==X.UINT32||t==X.FIXED32?tg(o):Yd(o),o;case X.INT64:case X.SFIXED64:case X.SINT64:if(typeof e!="number"&&typeof e!="string")break;const a=_t.parse(e);return n?a.toString():a;case X.FIXED64:case X.UINT64:if(typeof e!="number"&&typeof e!="string")break;const c=_t.uParse(e);return n?c.toString():c;case X.BOOL:if(typeof e!="boolean")break;return e;case X.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case X.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return pS.dec(e)}throw new Error}function im(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:mh;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Xd;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(gr(e)))}function MP(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Gb(t,e,n){if(t.kind=="map"){Bt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[a,c]of r)i[a.toString()]=Zd(t.V.T,c);break;case"message":for(const[a,c]of r)i[a.toString()]=c.toJson(n);break;case"enum":const o=t.V.T;for(const[a,c]of r)i[a.toString()]=rm(o,c,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Bt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Zd(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(rm(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Zd(t.T,e);case"enum":return rm(t.T,e,n.enumAsInteger);case"message":return yS(t.T,e).toJson(n)}}function rm(t,e,n){var i;if(Bt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r?.name)!==null&&i!==void 0?i:e}function Zd(t,e){switch(t){case X.INT32:case X.SFIXED32:case X.SINT32:case X.FIXED32:case X.UINT32:return Bt(typeof e=="number"),e;case X.FLOAT:case X.DOUBLE:return Bt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case X.STRING:return Bt(typeof e=="string"),e;case X.BOOL:return Bt(typeof e=="boolean"),e;case X.UINT64:case X.FIXED64:case X.INT64:case X.SFIXED64:case X.SINT64:return Bt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case X.BYTES:return Bt(e instanceof Uint8Array),pS.enc(e)}}const Ba=Symbol("@bufbuild/protobuf/unknown-fields"),Jb={readUnknownFields:!0,readerFactory:t=>new _P(t)},Yb={writeUnknownFields:!0,writerFactory:()=>new CP};function LP(t){return t?Object.assign(Object.assign({},Jb),t):Jb}function UP(t){return t?Object.assign(Object.assign({},Yb),t):Yb}function FP(){return{makeReadOptions:LP,makeWriteOptions:UP,listUnknownFields(t){var e;return(e=t[Ba])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Ba]},writeUnknownFields(t,e){const i=t[Ba];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Ba])||(r[Ba]=[]),r[Ba].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const o=t.getType(),a=r?e.len:e.pos+n;let c,u;for(;e.pos<a&&([c,u]=e.tag(),!(r===!0&&u==Wt.EndGroup));){const h=o.fields.find(c);if(!h){const f=e.skip(u,c);i.readUnknownFields&&this.onUnknownField(t,c,u,f);continue}Qb(t,e,h,u,i)}if(r&&(u!=Wt.EndGroup||c!==n))throw new Error("invalid end group tag")},readField:Qb,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!vS(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName];Xb(r,o,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Xb(t,e,n,i)}}}function Qb(t,e,n,i,r){let{repeated:o,localName:a}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=a&&delete t.value,t.case=a,a="value"),n.kind){case"scalar":case"enum":const c=n.kind=="enum"?X.INT32:n.T;let u=gh;if(n.kind=="scalar"&&n.L>0&&(u=VP),o){let v=t[a];if(i==Wt.LengthDelimited&&c!=X.STRING&&c!=X.BYTES){let k=e.uint32()+e.pos;for(;e.pos<k;)v.push(u(e,c))}else v.push(u(e,c))}else t[a]=u(e,c);break;case"message":const h=n.T;o?t[a].push(eh(e,new h,r,n)):Jr(t[a])?eh(e,t[a],r,n):(t[a]=eh(e,new h,r,n),h.fieldWrapper&&!n.oneof&&!n.repeated&&(t[a]=h.fieldWrapper.unwrapField(t[a])));break;case"map":let[f,g]=BP(n,e,r);t[a][f]=g;break}}function eh(t,e,n,i){const r=e.getType().runtime.bin,o=i?.delimited;return r.readMessage(e,t,o?i.no:t.uint32(),n,o),e}function BP(t,e,n){const i=e.uint32(),r=e.pos+i;let o,a;for(;e.pos<r;){const[c]=e.tag();switch(c){case 1:o=gh(e,t.K);break;case 2:switch(t.V.kind){case"scalar":a=gh(e,t.V.T);break;case"enum":a=e.int32();break;case"message":a=eh(e,new t.V.T,n,void 0);break}break}}if(o===void 0&&(o=gl(t.K,Xs.BIGINT)),typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(t.V.kind){case"scalar":a=gl(t.V.T,Xs.BIGINT);break;case"enum":a=t.V.T.values[0].no;break;case"message":a=new t.V.T;break}return[o,a]}function VP(t,e){const n=gh(t,e);return typeof n=="bigint"?n.toString():n}function gh(t,e){switch(e){case X.STRING:return t.string();case X.BOOL:return t.bool();case X.DOUBLE:return t.double();case X.FLOAT:return t.float();case X.INT32:return t.int32();case X.INT64:return t.int64();case X.UINT64:return t.uint64();case X.FIXED64:return t.fixed64();case X.BYTES:return t.bytes();case X.FIXED32:return t.fixed32();case X.SFIXED32:return t.sfixed32();case X.SFIXED64:return t.sfixed64();case X.SINT64:return t.sint64();case X.UINT32:return t.uint32();case X.SINT32:return t.sint32()}}function Xb(t,e,n,i){Bt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let o=t.kind=="enum"?X.INT32:t.T;if(r)if(Bt(Array.isArray(e)),t.packed)$P(n,o,t.no,e);else for(const a of e)Ac(n,o,t.no,a);else Ac(n,o,t.no,e);break;case"message":if(r){Bt(Array.isArray(e));for(const a of e)Zb(n,i,t,a)}else Zb(n,i,t,e);break;case"map":Bt(typeof e=="object"&&e!=null);for(const[a,c]of Object.entries(e))zP(n,i,t,a,c);break}}function zP(t,e,n,i,r){t.tag(n.no,Wt.LengthDelimited),t.fork();let o=i;switch(n.K){case X.INT32:case X.FIXED32:case X.UINT32:case X.SFIXED32:case X.SINT32:o=Number.parseInt(i);break;case X.BOOL:Bt(i=="true"||i=="false"),o=i=="true";break}switch(Ac(t,n.K,1,o),n.V.kind){case"scalar":Ac(t,n.V.T,2,r);break;case"enum":Ac(t,X.INT32,2,r);break;case"message":Bt(r!==void 0),t.tag(2,Wt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Zb(t,e,n,i){const r=yS(n.T,i);n.delimited?t.tag(n.no,Wt.StartGroup).raw(r.toBinary(e)).tag(n.no,Wt.EndGroup):t.tag(n.no,Wt.LengthDelimited).bytes(r.toBinary(e))}function Ac(t,e,n,i){Bt(i!==void 0);let[r,o]=bS(e);t.tag(n,r)[o](i)}function $P(t,e,n,i){if(!i.length)return;t.tag(n,Wt.LengthDelimited).fork();let[,r]=bS(e);for(let o=0;o<i.length;o++)t[r](i[o]);t.join()}function bS(t){let e=Wt.Varint;switch(t){case X.BYTES:case X.STRING:e=Wt.LengthDelimited;break;case X.DOUBLE:case X.FIXED64:case X.SFIXED64:e=Wt.Bit64;break;case X.FIXED32:case X.SFIXED32:case X.FLOAT:e=Wt.Bit32;break}const n=X[t].toLowerCase();return[e,n]}function qP(){return{setEnumType:aS,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,o=e,a=t;if(a[r]!=null)switch(i.kind){case"oneof":const c=a[r].case;if(c===void 0)continue;const u=i.findField(c);let h=a[r].value;u&&u.kind=="message"&&!Jr(h,u.T)?h=new u.T(h):u&&u.kind==="scalar"&&u.T===X.BYTES&&(h=bc(h)),o[r]={case:c,value:h};break;case"scalar":case"enum":let f=a[r];i.T===X.BYTES&&(f=i.repeated?f.map(bc):bc(f)),o[r]=f;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===X.BYTES)for(const[w,k]of Object.entries(a[r]))o[r][w]=bc(k);else Object.assign(o[r],a[r]);break;case"message":const v=i.V.T;for(const w of Object.keys(a[r])){let k=a[r][w];v.fieldWrapper||(k=new v(k)),o[r][w]=k}break}break;case"message":const g=i.T;if(i.repeated)o[r]=a[r].map(v=>Jr(v,g)?v:new g(v));else{const v=a[r];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?o[r]=bc(v):o[r]=v:o[r]=Jr(v,g)?v:new g(v)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],o=n[i.localName];if(i.repeated){if(r.length!==o.length)return!1;switch(i.kind){case"message":return r.every((a,c)=>i.T.equals(a,o[c]));case"scalar":return r.every((a,c)=>Ds(i.T,a,o[c]));case"enum":return r.every((a,c)=>Ds(X.INT32,a,o[c]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let a=r,c=o;return i.T.fieldWrapper&&(a!==void 0&&!Jr(a)&&(a=i.T.fieldWrapper.wrapField(a)),c!==void 0&&!Jr(c)&&(c=i.T.fieldWrapper.wrapField(c))),i.T.equals(a,c);case"enum":return Ds(X.INT32,r,o);case"scalar":return Ds(i.T,r,o);case"oneof":if(r.case!==o.case)return!1;const u=i.findField(r.case);if(u===void 0)return!0;switch(u.kind){case"message":return u.T.equals(r.value,o.value);case"enum":return Ds(X.INT32,r.value,o.value);case"scalar":return Ds(u.T,r.value,o.value)}throw new Error("oneof cannot contain ".concat(u.kind));case"map":const h=Object.keys(r).concat(Object.keys(o));switch(i.V.kind){case"message":const f=i.V.T;return h.every(v=>f.equals(r[v],o[v]));case"enum":return h.every(v=>Ds(X.INT32,r[v],o[v]));case"scalar":const g=i.V.T;return h.every(v=>Ds(g,r[v],o[v]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const o=t[r.localName];let a;if(r.repeated)a=o.map(Od);else if(r.kind=="map"){a=i[r.localName];for(const[c,u]of Object.entries(o))a[c]=Od(u)}else r.kind=="oneof"?a=r.findField(o.case)?{case:o.case,value:Od(o.value)}:{case:void 0}:a=Od(o);i[r.localName]=a}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function Od(t){if(t===void 0)return t;if(Jr(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function bc(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function KP(t,e,n){return{syntax:t,json:jP(),bin:FP(),util:Object.assign(Object.assign({},qP()),{newFieldList:e,initFields:n}),makeMessageType(i,r,o){return bP(this,i,r,o)},makeEnum:yP,makeEnumType:lS,getEnumType:vP,makeExtension(i,r,o){return EP(this,i,r,o)}}}class WP{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function wS(t,e){const n=kS(t);return e?n:XP(QP(n))}function HP(t){return wS(t,!1)}const GP=kS;function kS(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const JP=new Set(["constructor","toString","toJSON","valueOf"]),YP=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),xS=t=>"".concat(t,"$"),QP=t=>YP.has(t)?xS(t):t,XP=t=>JP.has(t)?xS(t):t;class ZP{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=HP(e)}addField(e){Bt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function eR(t,e){var n,i,r,o,a,c;const u=[];let h;for(const f of typeof t=="function"?t():t){const g=f;if(g.localName=wS(f.name,f.oneof!==void 0),g.jsonName=(n=f.jsonName)!==null&&n!==void 0?n:GP(f.name),g.repeated=(i=f.repeated)!==null&&i!==void 0?i:!1,f.kind=="scalar"&&(g.L=(r=f.L)!==null&&r!==void 0?r:Xs.BIGINT),g.delimited=(o=f.delimited)!==null&&o!==void 0?o:!1,g.req=(a=f.req)!==null&&a!==void 0?a:!1,g.opt=(c=f.opt)!==null&&c!==void 0?c:!1,f.packed===void 0&&(g.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=X.BYTES&&f.T!=X.STRING),f.oneof!==void 0){const v=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!h||h.name!=v)&&(h=new ZP(v)),g.oneof=h,h.addField(g)}u.push(g)}return u}const z=KP("proto3",t=>new WP(t,e=>eR(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=gl(e.T,e.L);break}}});class li extends cv{constructor(e){super(),this.seconds=_t.zero,this.nanos=0,z.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(z.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=_t.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return li.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new li({seconds:_t.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new li().fromBinary(e,n)}static fromJson(e,n){return new li().fromJson(e,n)}static fromJsonString(e,n){return new li().fromJsonString(e,n)}static equals(e,n){return z.util.equals(li,e,n)}}li.runtime=z;li.typeName="google.protobuf.Timestamp";li.fields=z.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const tR=z.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:li},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:nR,repeated:!0},{no:5,name:"events",kind:"message",T:rR,repeated:!0}]),nR=z.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:iR,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),iR=z.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:li},{no:3,name:"value",kind:"scalar",T:2}]),rR=z.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:li},{no:7,name:"normalized_end_timestamp",kind:"message",T:li,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),SS=z.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Zi=z.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Xt=z.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),dv=z.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),_c=z.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Gc=z.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),nr=z.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Uo=z.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),sR=z.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),bn=z.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),$h=z.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:vh,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:MS}]),vh=z.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),oR=z.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:z.getEnumType(Xt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Yo=z.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:z.getEnumType(al)},{no:4,name:"tracks",kind:"message",T:Qa,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:oR},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:z.getEnumType(Jc)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:z.getEnumType(nr)},{no:18,name:"kind_details",kind:"enum",T:z.getEnumType(aR),repeated:!0}]),al=z.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Jc=z.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),aR=z.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),un=z.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),lR=z.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Js,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:z.getEnumType(TS)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Qa=z.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:z.getEnumType(Zi)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:z.getEnumType(Xt)},{no:10,name:"layers",kind:"message",T:Js,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:lR,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:z.getEnumType(un)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:MS},{no:19,name:"audio_features",kind:"enum",T:z.getEnumType(bn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:z.getEnumType(SS)}]),Js=z.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:z.getEnumType(dv)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),TS=z.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),qn=z.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:z.getEnumType(Ye)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:hv,oneof:"value"},{no:3,name:"speaker",kind:"message",T:cR,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:PS,oneof:"value"},{no:7,name:"transcription",kind:"message",T:uR,oneof:"value"},{no:8,name:"metrics",kind:"message",T:tR,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:yh,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:fv,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:pv,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:mv,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:bh,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:wh,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:kh,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:CS,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),Ye=z.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),CS=z.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:z.getEnumType(un)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),_S=z.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:hv,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:yh,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:fv,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:pv,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:mv,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:bh,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:wh,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:kh,oneof:"value"}]),cR=z.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:ES,repeated:!0}]),ES=z.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),hv=z.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),PS=z.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),uR=z.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:dR,repeated:!0}]),dR=z.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),yh=z.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),fv=z.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),pv=z.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),mv=z.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:RS,oneof:"value"}]),RS=z.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),NS=z.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),IS=z.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:z.getEnumType(OS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),OS=z.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),AS=z.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:z.getEnumType(jS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),jS=z.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),DS=z.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:ew},{no:2,name:"screen",kind:"message",T:ew},{no:3,name:"resume_connection",kind:"enum",T:z.getEnumType(Gc)},{no:4,name:"disabled_codecs",kind:"message",T:hR},{no:5,name:"force_relay",kind:"enum",T:z.getEnumType(Gc)}]),ew=z.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:z.getEnumType(Gc)}]),hR=z.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:vh,repeated:!0},{no:2,name:"publish",kind:"message",T:vh,repeated:!0}]),MS=z.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),ng=z.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),LS=z.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:z.getEnumType(ng)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),US=z.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),bh=z.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:z.getEnumType(un)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:LS,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:US,oneof:"content_header"}],{localName:"DataStream_Header"}),wh=z.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),kh=z.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),fR=z.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),er=z.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ig=z.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),pR=z.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),mR=z.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Zs,oneof:"message"},{no:2,name:"answer",kind:"message",T:Zs,oneof:"message"},{no:3,name:"trickle",kind:"message",T:qh,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Yc,oneof:"message"},{no:5,name:"mute",kind:"message",T:Kh,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Wh,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:FS,oneof:"message"},{no:8,name:"leave",kind:"message",T:Hh,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:VS,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:qS,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:wv,oneof:"message"},{no:13,name:"simulate",kind:"message",T:mr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:yv,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:HS,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:vv,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:BS,oneof:"message"}]),tw=z.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:gR,oneof:"message"},{no:2,name:"answer",kind:"message",T:Zs,oneof:"message"},{no:3,name:"offer",kind:"message",T:Zs,oneof:"message"},{no:4,name:"trickle",kind:"message",T:qh,oneof:"message"},{no:5,name:"update",kind:"message",T:bR,oneof:"message"},{no:6,name:"track_published",kind:"message",T:gv,oneof:"message"},{no:8,name:"leave",kind:"message",T:Hh,oneof:"message"},{no:9,name:"mute",kind:"message",T:Kh,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:wR,oneof:"message"},{no:11,name:"room_update",kind:"message",T:kR,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:SR,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:CR,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ER,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:RR,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:yR,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:vR,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:IR,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:jR,oneof:"message"},{no:22,name:"request_response",kind:"message",T:DR,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:MR,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:NR,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:BR,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:PR,oneof:"message"}]),rg=z.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Js,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:z.getEnumType(TS)}]),Yc=z.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:z.getEnumType(Zi)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:z.getEnumType(Xt)},{no:9,name:"layers",kind:"message",T:Js,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:rg,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:z.getEnumType(un)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:z.getEnumType(SS)},{no:17,name:"audio_features",kind:"enum",T:z.getEnumType(bn),repeated:!0}]),qh=z.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:z.getEnumType(er)},{no:3,name:"final",kind:"scalar",T:8}]),Kh=z.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),gR=z.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:$h},{no:2,name:"participant",kind:"message",T:Yo},{no:3,name:"other_participants",kind:"message",T:Yo,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:zS,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:DS},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:IS},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:vh,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),vR=z.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:zS,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:DS},{no:3,name:"server_info",kind:"message",T:IS},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),gv=z.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Qa}]),yR=z.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Zs=z.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),bR=z.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Yo,repeated:!0}]),Wh=z.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:NS,repeated:!0}]),FS=z.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:z.getEnumType(dv)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),vv=z.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:z.getEnumType(bn),repeated:!0}]),BS=z.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Hh=z.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:z.getEnumType(nr)},{no:3,name:"action",kind:"enum",T:z.getEnumType(ll)},{no:4,name:"regions",kind:"message",T:OR}]),ll=z.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),VS=z.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Js,repeated:!0}]),yv=z.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),zS=z.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),wR=z.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:ES,repeated:!0}]),kR=z.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:$h}]),xR=z.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:z.getEnumType(_c)},{no:3,name:"score",kind:"scalar",T:2}]),SR=z.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:xR,repeated:!0}]),TR=z.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:z.getEnumType(ig)}]),CR=z.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:TR,repeated:!0}]),bv=z.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:z.getEnumType(dv)},{no:2,name:"enabled",kind:"scalar",T:8}]),_R=z.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:bv,repeated:!0}]),ER=z.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:bv,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:_R,repeated:!0}]),PR=z.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:fR,repeated:!0}]),$S=z.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),qS=z.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:$S,repeated:!0}]),RR=z.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),NR=z.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:$h},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Yo},{no:4,name:"other_participants",kind:"message",T:Yo,repeated:!0}]),wv=z.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Zs},{no:2,name:"subscription",kind:"message",T:Wh},{no:3,name:"publish_tracks",kind:"message",T:gv,repeated:!0},{no:4,name:"data_channels",kind:"message",T:WS,repeated:!0},{no:5,name:"offer",kind:"message",T:Zs},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:KS,repeated:!0}]),KS=z.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),WS=z.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:z.getEnumType(er)}]),mr=z.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:z.getEnumType(pR),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),HS=z.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),IR=z.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),OR=z.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:AR,repeated:!0}]),AR=z.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),jR=z.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:z.getEnumType(sR)}]),DR=z.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:z.getEnumType(kv)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:qh,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Yc,oneof:"request"},{no:6,name:"mute",kind:"message",T:Kh,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:yv,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:vv,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:BS,oneof:"request"}]),kv=z.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),MR=z.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),GS=z.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),LR=z.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:AS},{no:2,name:"connection_settings",kind:"message",T:GS},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Yc,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Zs},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:z.getEnumType(Uo)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:wv}]),UR=z.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:z.getEnumType(FR)},{no:2,name:"join_request",kind:"scalar",T:12}]),FR=z.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),BR=z.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function VR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var th={exports:{}},zR=th.exports,nw;function $R(){return nw||(nw=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(zR,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],o={},a=null;function c(x,C){var E=x[C];if(typeof E.bind=="function")return E.bind(x);try{return Function.prototype.bind.call(E,x)}catch{return function(){return Function.prototype.apply.apply(E,[x,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(x){return x==="debug"&&(x="log"),typeof console===n?!1:x==="trace"&&i?u:console[x]!==void 0?c(console,x):console.log!==void 0?c(console,"log"):e}function f(){for(var x=this.getLevel(),C=0;C<r.length;C++){var E=r[C];this[E]=C<x?e:this.methodFactory(E,x,this.name)}if(this.log=this.debug,typeof console===n&&x<this.levels.SILENT)return"No console available for logging"}function g(x){return function(){typeof console!==n&&(f.call(this),this[x].apply(this,arguments))}}function v(x,C,E){return h(x)||g.apply(this,arguments)}function w(x,C){var E=this,I,N,P,R="loglevel";typeof x=="string"?R+=":"+x:typeof x=="symbol"&&(R=void 0);function j(Q){var ne=(r[Q]||"silent").toUpperCase();if(!(typeof window===n||!R)){try{window.localStorage[R]=ne;return}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+ne+";"}catch{}}}function U(){var Q;if(!(typeof window===n||!R)){try{Q=window.localStorage[R]}catch{}if(typeof Q===n)try{var ne=window.document.cookie,Se=encodeURIComponent(R),De=ne.indexOf(Se+"=");De!==-1&&(Q=/^([^;]+)/.exec(ne.slice(De+Se.length+1))[1])}catch{}return E.levels[Q]===void 0&&(Q=void 0),Q}}function F(){if(!(typeof window===n||!R)){try{window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function H(Q){var ne=Q;if(typeof ne=="string"&&E.levels[ne.toUpperCase()]!==void 0&&(ne=E.levels[ne.toUpperCase()]),typeof ne=="number"&&ne>=0&&ne<=E.levels.SILENT)return ne;throw new TypeError("log.setLevel() called with invalid level: "+Q)}E.name=x,E.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},E.methodFactory=C||v,E.getLevel=function(){return P??N??I},E.setLevel=function(Q,ne){return P=H(Q),ne!==!1&&j(P),f.call(E)},E.setDefaultLevel=function(Q){N=H(Q),U()||E.setLevel(Q,!1)},E.resetLevel=function(){P=null,F(),f.call(E)},E.enableAll=function(Q){E.setLevel(E.levels.TRACE,Q)},E.disableAll=function(Q){E.setLevel(E.levels.SILENT,Q)},E.rebuild=function(){if(a!==E&&(I=H(a.getLevel())),f.call(E),a===E)for(var Q in o)o[Q].rebuild()},I=H(a?a.getLevel():"WARN");var q=U();q!=null&&(P=H(q)),f.call(E)}a=new w,a.getLogger=function(C){if(typeof C!="symbol"&&typeof C!="string"||C==="")throw new TypeError("You must supply a name when creating a logger.");var E=o[C];return E||(E=o[C]=new w(C,a.methodFactory)),E};var k=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=k),a},a.getLoggers=function(){return o},a.default=a,a})})(th)),th.exports}var Gh=$R(),sg;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(sg||(sg={}));var ir;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(ir||(ir={}));let He=Gh.getLogger("livekit");Object.values(ir).map(t=>Gh.getLogger(t));He.setDefaultLevel(sg.info);function ts(t){const e=Gh.getLogger(t);return e.setDefaultLevel(He.getLevel()),e}const qR=Gh.getLogger("lk-e2ee"),wc=7e3,KR=[0,300,4*300,9*300,16*300,wc,wc,wc,wc,wc];class WR{constructor(e){this._retryDelays=e!==void 0?[...e]:KR}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function HR(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function A(t,e,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(f){try{h(i.next(f))}catch(g){a(g)}}function u(f){try{h(i.throw(f))}catch(g){a(g)}}function h(f){f.done?o(f.value):r(f.value).then(c,u)}h((i=i.apply(t,e||[])).next())})}function iw(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yr(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof iw=="function"?iw(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(a){return new Promise(function(c,u){a=t[o](a),r(c,u,a.done,a.value)})}}function r(o,a,c,u){Promise.resolve(u).then(function(h){o({value:h,done:c})},a)}}var Ad={exports:{}},rw;function GR(){if(rw)return Ad.exports;rw=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(R,j,U){return Function.prototype.apply.call(R,j,U)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:n=function(R){return Object.getOwnPropertyNames(R)};function i(P){console&&console.warn&&console.warn(P)}var r=Number.isNaN||function(R){return R!==R};function o(){o.init.call(this)}Ad.exports=o,Ad.exports.once=E,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function c(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(P){if(typeof P!="number"||P<0||r(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");a=P}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||r(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this};function u(P){return P._maxListeners===void 0?o.defaultMaxListeners:P._maxListeners}o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(R){for(var j=[],U=1;U<arguments.length;U++)j.push(arguments[U]);var F=R==="error",H=this._events;if(H!==void 0)F=F&&H.error===void 0;else if(!F)return!1;if(F){var q;if(j.length>0&&(q=j[0]),q instanceof Error)throw q;var Q=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw Q.context=q,Q}var ne=H[R];if(ne===void 0)return!1;if(typeof ne=="function")e(ne,this,j);else for(var Se=ne.length,De=k(ne,Se),U=0;U<Se;++U)e(De[U],this,j);return!0};function h(P,R,j,U){var F,H,q;if(c(j),H=P._events,H===void 0?(H=P._events=Object.create(null),P._eventsCount=0):(H.newListener!==void 0&&(P.emit("newListener",R,j.listener?j.listener:j),H=P._events),q=H[R]),q===void 0)q=H[R]=j,++P._eventsCount;else if(typeof q=="function"?q=H[R]=U?[j,q]:[q,j]:U?q.unshift(j):q.push(j),F=u(P),F>0&&q.length>F&&!q.warned){q.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");Q.name="MaxListenersExceededWarning",Q.emitter=P,Q.type=R,Q.count=q.length,i(Q)}return P}o.prototype.addListener=function(R,j){return h(this,R,j,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(R,j){return h(this,R,j,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(P,R,j){var U={fired:!1,wrapFn:void 0,target:P,type:R,listener:j},F=f.bind(U);return F.listener=j,U.wrapFn=F,F}o.prototype.once=function(R,j){return c(j),this.on(R,g(this,R,j)),this},o.prototype.prependOnceListener=function(R,j){return c(j),this.prependListener(R,g(this,R,j)),this},o.prototype.removeListener=function(R,j){var U,F,H,q,Q;if(c(j),F=this._events,F===void 0)return this;if(U=F[R],U===void 0)return this;if(U===j||U.listener===j)--this._eventsCount===0?this._events=Object.create(null):(delete F[R],F.removeListener&&this.emit("removeListener",R,U.listener||j));else if(typeof U!="function"){for(H=-1,q=U.length-1;q>=0;q--)if(U[q]===j||U[q].listener===j){Q=U[q].listener,H=q;break}if(H<0)return this;H===0?U.shift():x(U,H),U.length===1&&(F[R]=U[0]),F.removeListener!==void 0&&this.emit("removeListener",R,Q||j)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(R){var j,U,F;if(U=this._events,U===void 0)return this;if(U.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):U[R]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete U[R]),this;if(arguments.length===0){var H=Object.keys(U),q;for(F=0;F<H.length;++F)q=H[F],q!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(j=U[R],typeof j=="function")this.removeListener(R,j);else if(j!==void 0)for(F=j.length-1;F>=0;F--)this.removeListener(R,j[F]);return this};function v(P,R,j){var U=P._events;if(U===void 0)return[];var F=U[R];return F===void 0?[]:typeof F=="function"?j?[F.listener||F]:[F]:j?C(F):k(F,F.length)}o.prototype.listeners=function(R){return v(this,R,!0)},o.prototype.rawListeners=function(R){return v(this,R,!1)},o.listenerCount=function(P,R){return typeof P.listenerCount=="function"?P.listenerCount(R):w.call(P,R)},o.prototype.listenerCount=w;function w(P){var R=this._events;if(R!==void 0){var j=R[P];if(typeof j=="function")return 1;if(j!==void 0)return j.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function k(P,R){for(var j=new Array(R),U=0;U<R;++U)j[U]=P[U];return j}function x(P,R){for(;R+1<P.length;R++)P[R]=P[R+1];P.pop()}function C(P){for(var R=new Array(P.length),j=0;j<R.length;++j)R[j]=P[j].listener||P[j];return R}function E(P,R){return new Promise(function(j,U){function F(q){P.removeListener(R,H),U(q)}function H(){typeof P.removeListener=="function"&&P.removeListener("error",F),j([].slice.call(arguments))}N(P,R,H,{once:!0}),R!=="error"&&I(P,F,{once:!0})})}function I(P,R,j){typeof P.on=="function"&&N(P,"error",R,j)}function N(P,R,j,U){if(typeof P.on=="function")U.once?P.once(R,j):P.on(R,j);else if(typeof P.addEventListener=="function")P.addEventListener(R,function F(H){U.once&&P.removeEventListener(R,F),j(H)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}return Ad.exports}var Sr=GR();let JS=!0,YS=!0;function Ec(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Zo(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(a,c){if(a!==e)return r.apply(this,arguments);const u=h=>{const f=n(h);f&&(c.handleEvent?c.handleEvent(f):c(f))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,u),r.apply(this,[a,u])};const o=i.removeEventListener;i.removeEventListener=function(a,c){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(c))return o.apply(this,arguments);const u=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,u])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function JR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(JS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function YR(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(YS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function QS(){if(typeof window=="object"){if(JS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function xv(t,e){YS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function QR(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ec(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ec(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ec(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ec(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function sw(t){return Object.prototype.toString.call(t)==="[object Object]"}function XS(t){return sw(t)?Object.keys(t).reduce(function(e,n){const i=sw(t[n]),r=i?XS(t[n]):t[n],o=i&&!Object.keys(r).length;return r===void 0||o?e:Object.assign(e,{[n]:r})},{}):t}function og(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?og(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{og(t,t.get(r),n)})}))}function ow(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(c=>{c.type===i&&c.trackId===a.id&&og(t,c,r)})}),r}const aw=QS;function ZS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const u={};return Object.keys(c).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const f=typeof c[h]=="object"?c[h]:{ideal:c[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const g=function(v,w){return v?v+w.charAt(0).toUpperCase()+w.slice(1):w==="deviceId"?"sourceId":w};if(f.ideal!==void 0){u.optional=u.optional||[];let v={};typeof f.ideal=="number"?(v[g("min",h)]=f.ideal,u.optional.push(v),v={},v[g("max",h)]=f.ideal,u.optional.push(v)):(v[g("",h)]=f.ideal,u.optional.push(v))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[g("",h)]=f.exact):["min","max"].forEach(v=>{f[v]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[g(v,h)]=f[v])})}),c.advanced&&(u.optional=(u.optional||[]).concat(c.advanced)),u},r=function(c,u){if(e.version>=61)return u(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const h=function(f,g,v){g in f&&!(v in f)&&(f[v]=f[g],delete f[g])};c=JSON.parse(JSON.stringify(c)),h(c.audio,"autoGainControl","googAutoGainControl"),h(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let h=c.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const f=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete c.video.facingMode;let g;if(h.exact==="environment"||h.ideal==="environment"?g=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(g=["front"]),g)return n.mediaDevices.enumerateDevices().then(v=>{v=v.filter(k=>k.kind==="videoinput");let w=v.find(k=>g.some(x=>k.label.toLowerCase().includes(x)));return!w&&v.length&&g.includes("back")&&(w=v[v.length-1]),w&&(c.video.deviceId=h.exact?{exact:w.deviceId}:{ideal:w.deviceId}),c.video=i(c.video),aw("chrome: "+JSON.stringify(c)),u(c)})}c.video=i(c.video)}return aw("chrome: "+JSON.stringify(c)),u(c)},o=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(c,u,h){r(c,f=>{n.webkitGetUserMedia(f,u,g=>{h&&h(o(g))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return r(u,h=>c(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(o(f))))}}}function eT(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function tT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):o={track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)}),i.stream.getTracks().forEach(r=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===r.id):o={track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[i.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zo(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function nT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=r.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,u){let h=r.apply(this,arguments);return h||(h=e(this,c),this._senders.push(h)),h};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const u=this._senders.indexOf(c);u!==-1&&this._senders.splice(u,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const c=this._senders.find(u=>u.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function iT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>ow(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Zo(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>ow(o,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,o,a;return this.getSenders().forEach(c=>{c.track===i&&(r?a=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===i&&(o?a=!0:o=c),c.track===i)),a||r&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function rT(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(u)===-1&&this._shimmedLocalStreams[c.id].push(u):this._shimmedLocalStreams[c.id]=[c,u],u};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(h=>c.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const u=this._shimmedLocalStreams[c].indexOf(a);u!==-1&&this._shimmedLocalStreams[c].splice(u,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function sT(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return rT(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(g=>this._reverseStreams[g.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(g=>{if(this.getSenders().find(w=>w.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const g=new t.MediaStream(f.getTracks());this._streams[f.id]=g,this._reverseStreams[g.id]=f,f=g}i.apply(this,[f])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},t.RTCPeerConnection.prototype.addTrack=function(f,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(x=>x===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(x=>x.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[g.id];if(k)k.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const x=new t.MediaStream([f]);this._streams[g.id]=x,this._reverseStreams[x.id]=g,this.addStream(x)}return this.getSenders().find(x=>x.track===f)};function o(h,f){let g=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(v=>{const w=h._reverseStreams[v],k=h._streams[w.id];g=g.replace(new RegExp(k.id,"g"),w.id)}),new RTCSessionDescription({type:f.type,sdp:g})}function a(h,f){let g=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(v=>{const w=h._reverseStreams[v],k=h._streams[w.id];g=g.replace(new RegExp(w.id,"g"),k.id)}),new RTCSessionDescription({type:f.type,sdp:g})}["createOffer","createAnswer"].forEach(function(h){const f=t.RTCPeerConnection.prototype[h],g={[h](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[k=>{const x=o(this,k);v[0].apply(null,[x])},k=>{v[1]&&v[1].apply(null,k)},arguments[2]]):f.apply(this,arguments).then(k=>o(this,k))}};t.RTCPeerConnection.prototype[h]=g[h]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=a(this,arguments[0]),c.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const h=u.get.apply(this);return h.type===""?h:o(this,h)}}),t.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let v;Object.keys(this._streams).forEach(w=>{this._streams[w].getTracks().find(x=>f.track===x)&&(v=this._streams[w])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ag(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function oT(t,e){Zo(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var lw=Object.freeze({__proto__:null,fixNegotiationNeeded:oT,shimAddTrackRemoveTrack:sT,shimAddTrackRemoveTrackWithNative:rT,shimGetSendersWithDtmf:nT,shimGetUserMedia:ZS,shimMediaStream:eT,shimOnTrack:tT,shimPeerConnection:ag,shimSenderReceiverGetStats:iT});function aT(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,o,a){xv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(a,c,u){c in a&&!(u in a)&&(a[u]=a[c],delete a[c])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a.audio,"autoGainControl","mozAutoGainControl"),r(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},i&&i.prototype.getSettings){const a=i.prototype.getSettings;i.prototype.getSettings=function(){const c=a.apply(this,arguments);return r(c,"mozAutoGainControl","autoGainControl"),r(c,"mozNoiseSuppression","noiseSuppression"),c}}if(i&&i.prototype.applyConstraints){const a=i.prototype.applyConstraints;i.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c,"autoGainControl","mozAutoGainControl"),r(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function XR(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function lT(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lg(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=t.RTCPeerConnection.prototype[r],a={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=a[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,c]=arguments;return i.apply(this,[o||null]).then(u=>{if(e.version<53&&!a)try{u.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((f,g)=>{u.set(g,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(a,c)}}function cT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function uT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Zo(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function dT(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){xv("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function hT(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function fT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(r){const{sender:a}=o,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=i,a.sendEncodings=i,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function pT(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function mT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function gT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var cw=Object.freeze({__proto__:null,shimAddTransceiver:fT,shimCreateAnswer:gT,shimCreateOffer:mT,shimGetDisplayMedia:XR,shimGetParameters:pT,shimGetUserMedia:aT,shimOnTrack:lT,shimPeerConnection:lg,shimRTCDataChannel:hT,shimReceiverGetStats:uT,shimRemoveStream:dT,shimSenderGetStats:cT});function vT(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function yT(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,i.dispatchEvent(a)})}),e.apply(i,arguments)}}}function bT(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(h,f){const g=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[g]);return f?(v.then(h,f),Promise.resolve()):v},e.createAnswer=function(h,f){const g=arguments.length>=2?arguments[2]:arguments[0],v=i.apply(this,[g]);return f?(v.then(h,f),Promise.resolve()):v};let c=function(u,h,f){const g=r.apply(this,[u]);return f?(g.then(h,f),Promise.resolve()):g};e.setLocalDescription=c,c=function(u,h,f){const g=o.apply(this,[u]);return f?(g.then(h,f),Promise.resolve()):g},e.setRemoteDescription=c,c=function(u,h,f){const g=a.apply(this,[u]);return f?(g.then(h,f),Promise.resolve()):g},e.addIceCandidate=c}function wT(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(kT(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,o){e.mediaDevices.getUserMedia(i).then(r,o)}).bind(e))}function kT(t){return t&&t.video!==void 0?Object.assign({},t,{video:XS(t.video)}):t}function xT(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const o=[];for(let a=0;a<i.iceServers.length;a++){let c=i.iceServers[a];c.urls===void 0&&c.url?(xv("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(i.iceServers[a])}i.iceServers=o}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function ST(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function TT(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function CT(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var uw=Object.freeze({__proto__:null,shimAudioContext:CT,shimCallbacksAPI:bT,shimConstraints:kT,shimCreateOfferLegacy:TT,shimGetUserMedia:wT,shimLocalStreamsAPI:vT,shimRTCIceServerUrls:xT,shimRemoteStreamsAPI:yT,shimTrackEventTransceiver:ST}),sm={exports:{}},dw;function ZR(){return dw||(dw=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:r[i[o]]===void 0&&(r[i[o]]=i[o+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)r=o[a].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),i+="a=fmtp:"+r+" "+o.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],o=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");i.profile=o[2];for(let c=3;c<o.length;c++){const u=o[c],h=e.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(h){const f=e.parseRtpMap(h),g=e.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=g.length?e.parseFmtp(g[0]):{},f.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),i.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(f.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{a.forEach(u=>{c.rtcpFeedback.find(f=>f.type===u.type&&f.parameter===u.parameter)||c.rtcpFeedback.push(u)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(a=>{r+=e.writeRtpMap(a),r+=e.writeFmtp(a),r+=e.writeRtcpFb(a)});let o=0;return i.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(r+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(a=>{r+=e.writeExtmap(a)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),o=r.fecMechanisms.indexOf("RED")!==-1,a=r.fecMechanisms.indexOf("ULPFEC")!==-1,c=e.matchPrefix(n,"a=ssrc:").map(v=>e.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),u=c.length>0&&c[0].ssrc;let h;const f=e.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substring(17).split(" ").map(k=>parseInt(k,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(h=f[0][1]),r.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let w={ssrc:u,codecPayloadType:parseInt(v.parameters.apt,10)};u&&h&&(w.rtx={ssrc:h}),i.push(w),o&&(w=JSON.parse(JSON.stringify(w)),w.fec={ssrc:u,mechanism:a?"red+ulpfec":"red"},i.push(w))}}),i.length===0&&u&&i.push({ssrc:u});let g=e.matchPrefix(n,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-2e3*8:g=void 0,i.forEach(v=>{v.maxBitrate=g})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return i.mux=a.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const c=e.matchPrefix(n,"a=sctpmap:");if(c.length>0){const u=c[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let o;const a=i!==void 0?i:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(sm)),sm.exports}var _T=ZR(),cl=VR(_T),eN=cP({__proto__:null,default:cl},[_T]);function nh(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),o=cl.parseCandidate(i.candidate);for(const a in o)a in r||Object.defineProperty(r,a,{value:o[a]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Zo(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function cg(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Zo(t,"icecandidate",e=>{if(e.candidate){const n=cl.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ih(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(c){if(!c||!c.sdp)return!1;const u=cl.splitSections(c.sdp);return u.shift(),u.some(h=>{const f=cl.parseMLine(h);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},i=function(c){const u=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const h=parseInt(u[1],10);return h!==h?-1:h},r=function(c){let u=65536;return e.browser==="firefox"&&(e.version<57?c===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},o=function(c,u){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const f=cl.matchPrefix(c.sdp,"a=max-message-size:");return f.length>0?h=parseInt(f[0].substring(19),10):e.browser==="firefox"&&u!==-1&&(h=2147483637),h},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=i(arguments[0]),h=r(u),f=o(arguments[0],u);let g;h===0&&f===0?g=Number.POSITIVE_INFINITY:h===0||f===0?g=Math.max(h,f):g=Math.min(h,f);const v={};Object.defineProperty(v,"maxMessageSize",{get(){return g}}),this._sctp=v}return a.apply(this,arguments)}}function rh(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const o=i.send;i.send=function(){const c=arguments[0],u=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&u>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Zo(t,"datachannel",i=>(e(i.channel,i.target),i))}function ug(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",r);o.dispatchEvent(a)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function dg(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function sh(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function oh(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var tN=Object.freeze({__proto__:null,removeExtmapAllowMixed:dg,shimAddIceCandidateNullOrEmpty:sh,shimConnectionState:ug,shimMaxMessageSize:ih,shimParameterlessSetLocalDescription:oh,shimRTCIceCandidate:nh,shimRTCIceCandidateRelayProtocol:cg,shimSendThrowTypeError:rh});function nN(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=QS,i=QR(t),r={browserDetails:i,commonShim:tN,extractVersion:Ec,disableLog:JR,disableWarnings:YR,sdp:eN};switch(i.browser){case"chrome":if(!lw||!ag||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=lw,sh(t,i),oh(t),ZS(t,i),eT(t),ag(t,i),tT(t),sT(t,i),nT(t),iT(t),oT(t,i),nh(t),cg(t),ug(t),ih(t,i),rh(t),dg(t,i);break;case"firefox":if(!cw||!lg||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=cw,sh(t,i),oh(t),aT(t,i),lg(t,i),lT(t),dT(t),cT(t),uT(t),hT(t),fT(t),pT(t),mT(t),gT(t),nh(t),ug(t),ih(t,i),rh(t);break;case"safari":if(!uw||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=uw,sh(t,i),oh(t),xT(t),TT(t),bT(t),vT(t),yT(t),ST(t),wT(t),CT(t),nh(t),cg(t),ih(t,i),rh(t),dg(t,i);break;default:n("Unsupported browser!");break}return r}nN({window:typeof window>"u"?void 0:window});const iN=/version\/(\d+(\.?_?\d+)+)/i;let om;function ui(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(om===void 0||e){const i=rN.find(r=>{let{test:o}=r;return o.test(n)});om=i?.describe(n)}return om}const rN=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:ah(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:am(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:ah(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:am(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:ah(iN,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:am(t)}}}];function ah(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function am(t){return t.includes("mac os")?ah(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var sN="2.16.1";const oN=sN,aN=16;class Tr extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var yt;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket"})(yt||(yt={}));class $e extends Tr{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=yt[n]}static notAllowed(e,n,i){return new $e(e,yt.NotAllowed,n,i)}static timeout(e){return new $e(e,yt.Timeout)}static leaveRequest(e,n){return new $e(e,yt.LeaveRequest,void 0,n)}static internal(e,n){return new $e(e,yt.InternalError,void 0,n)}static cancelled(e){return new $e(e,yt.Cancelled)}static serverUnreachable(e,n){return new $e(e,yt.ServerUnreachable,n)}static websocket(e,n,i){return new $e(e,yt.WebSocket,n,i)}}class Sv extends Tr{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Qr extends Tr{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class lN extends Tr{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class ln extends Tr{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class hg extends Tr{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class hw extends Tr{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class fw extends Tr{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:kv[n]}}var $n;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})($n||($n={}));class Mi extends Tr{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=$n[n]}}class Va extends Tr{constructor(e){super(18,e),this.name="SignalReconnectError"}}var xh;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(xh||(xh={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(xh||(xh={}));class Rn{}Rn.setTimeout=function(){return setTimeout(...arguments)};Rn.setInterval=function(){return setInterval(...arguments)};Rn.clearTimeout=function(){return clearTimeout(...arguments)};Rn.clearInterval=function(){return clearInterval(...arguments)};var ie;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(ie||(ie={}));var fe;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(fe||(fe={}));var ue;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(ue||(ue={}));var le;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(le||(le={}));function cN(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class at{constructor(e,n,i,r,o){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:o};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const uN=["vp8","h264"],dN=["vp8","h264","vp9","av1","h265"];function hN(t){return!!uN.find(e=>e===t)}const fN=hN;var pw;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(pw||(pw={}));var fg;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(fg||(fg={}));const Qc={h90:new at(160,90,9e4,20),h180:new at(320,180,16e4,20),h216:new at(384,216,18e4,20),h360:new at(640,360,45e4,20),h540:new at(960,540,8e5,25),h720:new at(1280,720,17e5,30),h1080:new at(1920,1080,3e6,30),h1440:new at(2560,1440,5e6,30),h2160:new at(3840,2160,8e6,30)},pg={h120:new at(160,120,7e4,20),h180:new at(240,180,125e3,20),h240:new at(320,240,14e4,20),h360:new at(480,360,33e4,20),h480:new at(640,480,5e5,20),h540:new at(720,540,6e5,25),h720:new at(960,720,13e5,30),h1080:new at(1440,1080,23e5,30),h1440:new at(1920,1440,38e5,30)},Tv={h360fps3:new at(640,360,2e5,3,"medium"),h360fps15:new at(640,360,4e5,15,"medium"),h720fps5:new at(1280,720,8e5,5,"medium"),h720fps15:new at(1280,720,15e5,15,"medium"),h720fps30:new at(1280,720,2e6,30,"medium"),h1080fps15:new at(1920,1080,25e5,15,"medium"),h1080fps30:new at(1920,1080,5e6,30,"medium"),original:new at(0,0,7e6,30,"medium")};function ET(t,e,n){var i,r,o,a;const{optionsWithoutProcessor:c,audioProcessor:u,videoProcessor:h}=NT(t??{}),f=e?.processor,g=n?.processor,v=c??{};return v.audio===!0&&(v.audio={}),v.video===!0&&(v.video={}),v.audio&&(mg(v.audio,e),(i=(o=v.audio).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(u||f)&&(v.audio.processor=u??f)),v.video&&(mg(v.video,n),(r=(a=v.video).deviceId)!==null&&r!==void 0||(a.deviceId={ideal:"default"}),(h||g)&&(v.video.processor=h??g)),v}function mg(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Cv(t){var e,n,i,r;const o={};if(t.video)if(typeof t.video=="object"){const a={},c=a,u=t.video;Object.keys(u).forEach(h=>{h==="resolution"?mg(c,u.resolution):c[h]=u[h]}),o.video=a,(e=(i=o.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else o.video=t.video?{deviceId:{ideal:"default"}}:!1;else o.video=!1;return t.audio?typeof t.audio=="object"?(o.audio=t.audio,(n=(r=o.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):o.audio={deviceId:{ideal:"default"}}:o.audio=!1,o}function PT(t){return A(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=RT();if(i){const r=i.createAnalyser();r.fftSize=2048;const o=r.frequencyBinCount,a=new Uint8Array(o);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Nn(n),r.getByteTimeDomainData(a);const u=a.some(h=>h!==128&&h!==0);return i.close(),!u}return!1})()})}function RT(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>A(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(o){console.warn("Error trying to auto-resume audio context",o)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function pN(t){return t==="audioinput"?W.Source.Microphone:t==="videoinput"?W.Source.Camera:W.Source.Unknown}function gg(t){return t===W.Source.Microphone?"audioinput":t===W.Source.Camera?"videoinput":void 0}function mN(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Xo()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function jc(t){return t.split("/")[1].toLowerCase()}function gN(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new gv({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Xe(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Xe(t.track):{})}}function vN(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function yN(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const o of i)t[o]!==e[o]&&(r[o]=(n=e[o])!==null&&n!==void 0?n:"");return r}function NT(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:cN(e)}}function bN(t){switch(t){case Xt.CAMERA:return W.Source.Camera;case Xt.MICROPHONE:return W.Source.Microphone;case Xt.SCREEN_SHARE:return W.Source.ScreenShare;case Xt.SCREEN_SHARE_AUDIO:return W.Source.ScreenShareAudio;default:return W.Source.Unknown}}function mw(t,e){return t.width*t.height<e.width*e.height}function wN(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const kN=5e3,kc=[];var xi;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(xi||(xi={}));class W extends Sr.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=W.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=He,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),kN):this.handleAppVisibilityChanged()},this.log=ts((r=i.loggerName)!==null&&r!==void 0?r:ir.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=W.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Xe(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===W.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===W.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(kc.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&kc.splice(kc.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Xa(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(r?le.AudioPlaybackStarted:le.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(r?le.AudioPlaybackFailed:le.VideoPlaybackFailed,o):o.name==="AbortError"?He.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):He.warn("could not playback ".concat(r?"audio":"video"),o),r&&e&&i.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(le.ElementAttached,e),e}detach(e){try{if(e){ul(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(le.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{ul(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(le.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ts(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),kc.forEach(i=>{i.parentElement||(n=!1)}),n&&kc.push(e)}}handleAppVisibilityChanged(){return A(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===W.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ci()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ci()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Xa(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Xo()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Xo()||Qo())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function ul(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(h){h.Audio="audio",h.Video="video",h.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(h){h.Camera="camera",h.Microphone="microphone",h.ScreenShare="screen_share",h.ScreenShareAudio="screen_share_audio",h.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(h){h.Active="active",h.Paused="paused",h.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(h){switch(h){case e.Audio:return Zi.AUDIO;case e.Video:return Zi.VIDEO;default:return Zi.DATA}}t.kindToProto=r;function o(h){switch(h){case Zi.AUDIO:return e.Audio;case Zi.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=o;function a(h){switch(h){case n.Camera:return Xt.CAMERA;case n.Microphone:return Xt.MICROPHONE;case n.ScreenShare:return Xt.SCREEN_SHARE;case n.ScreenShareAudio:return Xt.SCREEN_SHARE_AUDIO;default:return Xt.UNKNOWN}}t.sourceToProto=a;function c(h){switch(h){case Xt.CAMERA:return n.Camera;case Xt.MICROPHONE:return n.Microphone;case Xt.SCREEN_SHARE:return n.ScreenShare;case Xt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=c;function u(h){switch(h){case ig.ACTIVE:return i.Active;case ig.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=u})(W||(W={}));const xN="|",gw="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function SN(t){const e=t.split(xN);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Nn(t){return A(this,void 0,void 0,function*(){return new Promise(e=>Rn.setTimeout(e,t))})}function vg(){return"addTransceiver"in RTCPeerConnection.prototype}function yg(){return"addTrack"in RTCPeerConnection.prototype}function TN(){if(!("getCapabilities"in RTCRtpSender)||Xo()||Qo())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function CN(){if(!("getCapabilities"in RTCRtpSender)||Qo())return!1;if(Xo()){const n=ui();if(n?.version&&kr(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&kr(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function tr(t){return t==="av1"||t==="vp9"}function bg(t){return!document||Xc()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function _N(){return typeof RTCPeerConnection>"u"?!1:vg()||yg()}function Qo(){var t;return((t=ui())===null||t===void 0?void 0:t.name)==="Firefox"}function vw(){const t=ui();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Xo(){var t;return((t=ui())===null||t===void 0?void 0:t.name)==="Safari"}function Xc(){const t=ui();return t?.name==="Safari"||t?.os==="iOS"}function EN(){const t=ui();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&kr(t.osVersion,"17")>=0}function PN(t){return t||(t=ui()),t?.name==="Safari"&&kr(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&kr(t.osVersion,"18.3")>0}function IT(){var t,e;return ci()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function RN(){const t=ui(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&kr(t.osVersion,e)>=0?!0:t.name==="Safari"&&kr(t.version,e)>=0}function ci(){return typeof document<"u"}function wr(){return navigator.product=="ReactNative"}function vl(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function lm(t){return vl(t)?t.hostname.split(".")[0]:null}function OT(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function AT(){if(!wr())return;let t=OT();if(t)return t.platform}function yw(){if(ci())return window.devicePixelRatio;if(wr()){let t=OT();if(t)return t.devicePixelRatio}return 1}function kr(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let o=0;o<r;++o){const a=parseInt(n[o],10),c=parseInt(i[o],10);if(a>c)return 1;if(a<c)return-1;if(o===r-1&&a===c)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function NN(t){for(const e of t)e.target.handleResize(e)}function IN(t){for(const e of t)e.target.handleVisibilityChanged(e)}let cm=null;const bw=()=>(cm||(cm=new ResizeObserver(NN)),cm);let um=null;const ww=()=>(um||(um=new IntersectionObserver(IN,{root:null,rootMargin:"0px"})),um);function ON(){var t;const e=new AS({sdk:jS.JS,protocol:aN,version:oN});return wr()&&(e.os=(t=AT())!==null&&t!==void 0?t:""),e}function kw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const o=r.getContext("2d");o?.fillRect(0,0,r.width,r.height),i&&o&&(o.beginPath(),o.arc(t/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=r.captureStream(),[c]=a.getTracks();if(!c)throw Error("Could not get empty media stream video track");return c.enabled=n,c}let xc;function dm(){if(!xc){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[xc]=i.stream.getAudioTracks(),!xc)throw Error("Could not get empty media stream audio track");xc.enabled=!1}return xc.clone()}class Ui{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>A(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function AN(t){return dN.includes(t)}function Ys(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function jN(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Zc(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function DN(t,e){return t.segments.map(n=>{let{id:i,text:r,language:o,startTime:a,endTime:c,final:u}=n;var h;const f=(h=e.get(i))!==null&&h!==void 0?h:Date.now(),g=Date.now();return u?e.delete(i):e.set(i,f),{id:i,text:r,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(c.toString()),final:u,language:o,firstReceivedTime:f,lastReceivedTime:g}})}function MN(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function xw(t){switch(t.reason){case yt.LeaveRequest:return t.context;case yt.Cancelled:return nr.CLIENT_INITIATED;case yt.NotAllowed:return nr.USER_REJECTED;case yt.ServerUnreachable:return nr.JOIN_FAILURE;default:return nr.UNKNOWN_REASON}}function lh(t){return t!==void 0?Number(t):void 0}function Fo(t){return t!==void 0?BigInt(t):void 0}function dl(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function vr(t){return!!t&&t.kind==W.Kind.Audio}function no(t){return!!t&&t.kind==W.Kind.Video}function Ms(t){return dl(t)&&no(t)}function Kr(t){return dl(t)&&vr(t)}function wg(t){return!!t&&!t.isLocal}function LN(t){return!!t&&!t.isLocal}function hm(t){return wg(t)&&no(t)}function UN(t){return t.isLocal}function FN(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const o=i[r];if(o!==void 0&&(o&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function BN(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function VN(t,e){const n=new URL(jN(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),DT(n,"rtc")}function zN(t){const e=new URL(Zc(t));return DT(e,"validate")}function jT(t){return t.endsWith("/")?t:"".concat(t,"/")}function DT(t,e){return t.pathname="".concat(jT(t.pathname)).concat(e),t.toString()}function Sw(t){if(typeof t=="string")return tw.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return tw.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function $N(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const qN=10,Sc="lk_e2ee",KN="LKFrameEncryptionKey",WN={sharedKey:!1,ratchetSalt:KN,ratchetWindowSize:8,failureTolerance:qN,keyringSize:16};var Qs;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Qs||(Qs={}));var Tw;(function(t){t.KeyRatcheted="keyRatcheted"})(Tw||(Tw={}));var Gs;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Gs||(Gs={}));var Cw;(function(t){t.Error="cryptorError"})(Cw||(Cw={}));function HN(){return GN()||kg()}function kg(){return typeof window.RTCRtpScriptTransform<"u"}function GN(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function JN(t){var e,n,i,r,o;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((o=t.value)===null||o===void 0?void 0:o.case)!=="encryptedPacket")return new _S({value:t.value})}class d5 extends Sr.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{He.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},WN),e),this.on(Qs.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Qs.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Qs.RatchetRequest,e,n)}}var _w;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(_w||(_w={}));class YN extends Sr.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,o;const{kind:a,data:c}=i.data;switch(a){case"error":if(He.error(c.error.message),c.uuid){const f=this.decryptDataRequests.get(c.uuid);if(f?.reject){f.reject(c.error);break}const g=this.encryptDataRequests.get(c.uuid);if(g?.reject){g.reject(c.error);break}}this.emit(Gs.EncryptionError,c.error,c.participantIdentity);break;case"initAck":c.enabled&&this.keyProvider.getKeys().forEach(f=>{this.postKey(f)});break;case"enable":if(c.enabled&&this.keyProvider.getKeys().forEach(f=>{this.postKey(f)}),this.encryptionEnabled!==c.enabled&&c.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Gs.ParticipantEncryptionStatusChanged,c.enabled,this.room.localParticipant),this.encryptionEnabled=c.enabled;else if(c.participantIdentity){const f=(o=this.room)===null||o===void 0?void 0:o.getParticipantByIdentity(c.participantIdentity);if(!f)throw TypeError("couldn't set encryption status, participant not found".concat(c.participantIdentity));this.emit(Gs.ParticipantEncryptionStatusChanged,c.enabled,f)}break;case"ratchetKey":this.keyProvider.emit(Qs.KeyRatcheted,c.ratchetResult,c.participantIdentity,c.keyIndex);break;case"decryptDataResponse":const u=this.decryptDataRequests.get(c.uuid);u?.resolve&&u.resolve(c);break;case"encryptDataResponse":const h=this.encryptDataRequests.get(c.uuid);h?.resolve&&h.resolve(c);break}},this.onWorkerError=i=>{He.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Gs.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!HN())throw new Sv("tried to setup end-to-end encryption on an unsupported browser");if(He.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:qR.getLevel()}};this.worker&&(He.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){He.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?He.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(ue.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(ie.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==un.NONE,r.identity)),e.on(ie.ConnectionStateChanged,i=>{i===ot.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==un.NONE,r.identity)})})}).on(ie.TrackUnsubscribed,(i,r,o)=>{var a;const c={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:i.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(c)}).on(ie.TrackSubscribed,(i,r,o)=>{this.setupE2EEReceiver(i,o.identity,r.trackInfo)}).on(ie.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(fe.LocalSenderCreated,(i,r)=>A(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(fe.LocalTrackPublished,i=>{if(!no(i.track)||!Xc())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:jc(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Qs.SetKey,i=>this.postKey(i)).on(Qs.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return A(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Ui;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const o=crypto.randomUUID(),a={kind:"decryptDataRequest",data:{uuid:o,payload:e,iv:n,participantIdentity:i,keyIndex:r}},c=new Ui;return c.onFinally=()=>{this.decryptDataRequests.delete(o)},this.decryptDataRequests.set(o,c),this.worker.postMessage(a),c.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(a)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?jc(i.mimeType):void 0)}}setupE2EESender(e,n){if(!dl(e)||!n){n||He.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return A(this,void 0,void 0,function*(){if(this.worker){if(kg()&&!vw()){const o={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Sc in e&&r){const u={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(u);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const u=e.createEncodedStreams();e.writableStream=u.writable,o=u.writable,e.readableStream=u.readable,a=u.readable}const c={kind:"decode",data:{readableStream:a,writableStream:o,trackId:n,codec:r,participantIdentity:i,isReuse:Sc in e}};this.worker.postMessage(c,[a,o])}e[Sc]=!0}})}handleSender(e,n,i){var r;if(!(Sc in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(kg()&&!vw()){He.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{He.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(a,[o.readable,o.writable])}e[Sc]=!0}}}const QN=500,XN=15e3;class hl{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new hl),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=lm(i);if(!r)return;let o=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,o+1),this.backOffPromises.set(r,Nn(Math.min(QN*Math.pow(2,o),XN)))}getBackOffPromise(e){const n=new URL(e),i=n&&lm(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&lm(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}hl._instance=null;const fm="default";class wn{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new wn),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;if(((o=wn.userMediaPromiseMap)===null||o===void 0?void 0:o.size)>0){He.debug("awaiting getUserMedia promise");try{n?yield wn.userMediaPromiseMap.get(n):yield Promise.all(wn.userMediaPromiseMap.values())}catch{He.warn("error waiting for media permissons")}}let a=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Xo()&&i.hasDeviceInUse(n))&&(a.filter(u=>u.kind===n).length===0||a.some(u=>{const h=u.label==="",f=n?u.kind===n:!0;return h&&f}))){const u={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},h=yield navigator.mediaDevices.getUserMedia(u);a=yield navigator.mediaDevices.enumerateDevices(),h.getTracks().forEach(f=>{f.stop()})}return i._previousDevices=a,n&&(a=a.filter(c=>c.kind===n)),a})()})}normalizeDeviceId(e,n,i){return A(this,void 0,void 0,function*(){if(n!==fm)return n;const r=yield this.getDevices(e),o=r.find(c=>c.deviceId===fm);if(!o){He.warn("could not reliably determine default device");return}const a=r.find(c=>c.deviceId!==fm&&c.groupId===(i??o.groupId));if(!a){He.warn("could not reliably determine default device");return}return a?.deviceId})}hasDeviceInUse(e){return e?wn.userMediaPromiseMap.has(e):wn.userMediaPromiseMap.size>0}}wn.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];wn.userMediaPromiseMap=new Map;var Dc;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(Dc||(Dc={}));class ZN{constructor(){this.pendingTasks=new Map,this.taskMutex=new Kn,this.nextTaskIndex=0}run(e){return A(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:Dc.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=Dc.RUNNING,yield e()}finally{n.status=Dc.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return A(this,void 0,void 0,function*(){return this.run(()=>A(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class eI{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const o=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);o.binaryType="arraybuffer",this.ws=o;const a=function(){let{closeCode:c,reason:u}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.close(c,u)};this.opened=new Promise((c,u)=>{o.onopen=()=>{c({readable:new ReadableStream({start(h){o.onmessage=f=>{let{data:g}=f;return h.enqueue(g)},o.onerror=f=>h.error(f)},cancel:a}),writable:new WritableStream({write(h){o.send(h)},abort(){o.close()},close:a}),protocol:o.protocol,extensions:o.extensions}),o.removeEventListener("error",u)},o.addEventListener("error",u)}),this.closed=new Promise((c,u)=>{const h=()=>A(this,void 0,void 0,function*(){const f=new Promise(v=>{o.readyState!==WebSocket.CLOSED&&o.addEventListener("close",w=>{v(w)},{once:!0})}),g=yield Promise.race([Nn(250),f]);g?c(g):u(new Error("Encountered unspecified websocket error without a timely close event"))});o.onclose=f=>{let{code:g,reason:v}=f;c({closeCode:g,reason:v}),o.removeEventListener("error",h)},o.addEventListener("error",h)}),n.signal&&(n.signal.onabort=()=>o.close()),this.close=a}}const tI=["syncState","trickle","offer","answer","simulate","leave"];function nI(t){const e=tI.indexOf(t.case)>=0;return He.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var ut;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(ut||(ut={}));const iI=250;class _v{get currentState(){return this.state}get isDisconnected(){return this.state===ut.DISCONNECTING||this.state===ut.DISCONNECTED}get isEstablishingConnection(){return this.state===ut.CONNECTING||this.state===ut.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=ut.DISCONNECTED,this.log=He,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ts((i=n.loggerName)!==null&&i!==void 0?i:ir.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new ZN,this.queuedRequests=[],this.closingLock=new Kn,this.connectionLock=new Kn,this.state=ut.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return A(this,void 0,void 0,function*(){return this.state=ut.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return A(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=ut.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){return A(this,void 0,void 0,function*(){const o=yield this.connectionLock.lock();this.connectOptions=i;const a=ON(),c=i.singlePeerConnection?sI(n,a,i):rI(n,a,i),u=VN(e,c),h=zN(u);return new Promise((f,g)=>A(this,void 0,void 0,function*(){var v,w;try{let k=!1;const x=P=>A(this,void 0,void 0,function*(){if(k)return;k=!0;const R=P instanceof Event?P.currentTarget:P,j=$N(R,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(j)).catch(U=>{this.log.error(U),this.close()}):this.close(),C(),g($e.cancelled(j))});r?.addEventListener("abort",x);const C=()=>{clearTimeout(E),r?.removeEventListener("abort",x)},E=setTimeout(()=>{x($e.timeout("room connection has timed out (signal)"))},i.websocketTimeout),I=(P,R)=>{this.handleSignalConnected(P,E,R)},N=new URL(u);N.searchParams.has("access_token")&&N.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(N),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new eI(u);try{this.ws.closed.then(q=>{var Q;this.isEstablishingConnection&&g($e.internal("Websocket got closed during a (re)connection attempt: ".concat(q.reason))),q.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:q.reason,code:q.closeCode,wasClean:q.closeCode===1e3,state:this.state})),this.state===ut.CONNECTED&&this.handleOnClose((Q=q.reason)!==null&&Q!==void 0?Q:"Unexpected WS error"))}).catch(q=>{this.isEstablishingConnection&&g($e.internal("Websocket error during a (re)connection attempt: ".concat(q)))});const P=yield this.ws.opened.catch(q=>A(this,void 0,void 0,function*(){if(this.state!==ut.CONNECTED){this.state=ut.DISCONNECTED,clearTimeout(E);const Q=yield this.handleConnectionError(q,h);g(Q);return}this.handleWSError(q),g(q)}));if(clearTimeout(E),!P)return;const R=P.readable.getReader();this.streamWriter=P.writable.getWriter();const j=yield R.read();if(R.releaseLock(),!j.value)throw $e.internal("no message received as first message");const U=Sw(j.value),F=this.validateFirstMessage(U,(v=i.reconnect)!==null&&v!==void 0?v:!1);if(!F.isValid){g(F.error);return}((w=U.message)===null||w===void 0?void 0:w.case)==="join"&&(this.pingTimeoutDuration=U.message.value.pingTimeout,this.pingIntervalDuration=U.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const H=F.shouldProcessFirstMessage?U:void 0;I(P,H),f(F.response)}catch(P){g(P)}finally{C()}}finally{o()}}))})}startReadingLoop(e,n){return A(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Nn(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const o=Sw(r);this.handleSignalResponse(o)}})}close(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([ut.DISCONNECTING||ut.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=ut.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const o=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([o,Nn(iI)])}}catch(o){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:o}))}finally{n&&(e.state=ut.DISCONNECTED),r()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Za(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Za(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new qh({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Kh({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return A(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const c=o.getNextRequestId();return yield o.sendRequest({case:"updateMetadata",value:new yv({requestId:c,metadata:i,name:r,attributes:a})}),c})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new VS({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new qS({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:_t.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new HS({timestamp:_t.parse(Date.now()),rtt:_t.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new vv({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Hh({reason:nr.CLIENT_INITIATED,action:ll.DISCONNECT})})}sendRequest(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!r&&!nI(n)&&i.state===ut.RECONNECTING){i.queuedRequests.push(()=>A(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Nn(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const a=new mR({message:n});try{i.useJSON?yield i.streamWriter.write(a.toJsonString()):yield i.streamWriter.write(a.toBinary())}catch(c){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:c}))}})()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(r.case==="answer"){const a=Ew(r.value);this.onAnswer&&this.onAnswer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const a=Ew(r.value);this.onOffer&&this.onOffer(a,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const a=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(a,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return A(this,void 0,void 0,function*(){if(this.state===ut.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Rn.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Rn.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Rn.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Rn.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=ut.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,o,a,c;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===ut.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((o=e.message)===null||o===void 0?void 0:o.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((a=e.message)===null||a===void 0?void 0:a.case)==="leave"?{isValid:!1,error:$e.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:$e.internal("Unexpected first message")}:{isValid:!1,error:$e.internal("did not receive join response, got ".concat((c=e.message)===null||c===void 0?void 0:c.case," instead"))}}handleConnectionError(e,n){return A(this,void 0,void 0,function*(){try{const i=yield fetch(n);if(i.status.toFixed(0).startsWith("4")){const r=yield i.text();return $e.notAllowed(r,i.status)}else return e instanceof $e?e:$e.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof $e?i:$e.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Ew(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Za(t,e){return new Zs({sdp:t.sdp,type:t.type,id:e})}function rI(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",wr()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function sI(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new LR({clientInfo:e,connectionSettings:new GS({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const o=new UR({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(o.toBinary()))),i}class Pw{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class oI{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,o]of i.entries())n.push(e(o,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Wi={},pm={},mm={exports:{}},Rw;function Ev(){if(Rw)return mm.exports;Rw=1;var t=mm.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),mm.exports}var Nw;function aI(){return Nw||(Nw=1,(function(t){var e=function(c){return String(Number(c))===c?Number(c):c},n=function(c,u,h,f){if(f&&!h)u[f]=e(c[1]);else for(var g=0;g<h.length;g+=1)c[g+1]!=null&&(u[h[g]]=e(c[g+1]))},i=function(c,u,h){var f=c.name&&c.names;c.push&&!u[c.push]?u[c.push]=[]:f&&!u[c.name]&&(u[c.name]={});var g=c.push?{}:f?u[c.name]:u;n(h.match(c.reg),g,c.names,c.name),c.push&&u[c.push].push(g)},r=Ev(),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(c){var u={},h=[],f=u;return c.split(/(\r\n|\r|\n)/).filter(o).forEach(function(g){var v=g[0],w=g.slice(2);v==="m"&&(h.push({rtp:[],fmtp:[]}),f=h[h.length-1]);for(var k=0;k<(r[v]||[]).length;k+=1){var x=r[v][k];if(x.reg.test(w))return i(x,f,w)}}),u.media=h,u};var a=function(c,u){var h=u.split(/=(.+)/,2);return h.length===2?c[h[0]]=e(h[1]):h.length===1&&u.length>1&&(c[h[0]]=void 0),c};t.parseParams=function(c){return c.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(c){return c.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(c){for(var u=[],h=c.split(" ").map(e),f=0;f<h.length;f+=3)u.push({component:h[f],ip:h[f+1],port:h[f+2]});return u},t.parseImageAttributes=function(c){return c.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(c){return c.split(";").map(function(u){return u.split(",").map(function(h){var f,g=!1;return h[0]!=="~"?f=e(h):(f=e(h.substring(1,h.length)),g=!0),{scid:f,paused:g}})})}})(pm)),pm}var gm,Iw;function lI(){if(Iw)return gm;Iw=1;var t=Ev(),e=/%[sdv%]/g,n=function(a){var c=1,u=arguments,h=u.length;return a.replace(e,function(f){if(c>=h)return f;var g=u[c];switch(c+=1,f){case"%%":return"%";case"%s":return String(g);case"%d":return Number(g);case"%v":return""}})},i=function(a,c,u){var h=c.format instanceof Function?c.format(c.push?u:u[c.name]):c.format,f=[a+"="+h];if(c.names)for(var g=0;g<c.names.length;g+=1){var v=c.names[g];c.name?f.push(u[c.name][v]):f.push(u[c.names[g]])}else f.push(u[c.name]);return n.apply(null,f)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];return gm=function(a,c){c=c||{},a.version==null&&(a.version=0),a.name==null&&(a.name=" "),a.media.forEach(function(g){g.payloads==null&&(g.payloads="")});var u=c.outerOrder||r,h=c.innerOrder||o,f=[];return u.forEach(function(g){t[g].forEach(function(v){v.name in a&&a[v.name]!=null?f.push(i(g,v,a)):v.push in a&&a[v.push]!=null&&a[v.push].forEach(function(w){f.push(i(g,v,w))})})}),a.media.forEach(function(g){f.push(i("m",t.m[0],g)),h.forEach(function(v){t[v].forEach(function(w){w.name in g&&g[w.name]!=null?f.push(i(v,w,g)):w.push in g&&g[w.push]!=null&&g[w.push].forEach(function(k){f.push(i(v,w,k))})})})}),f.join(`\r
`)+`\r
`},gm}var Ow;function cI(){if(Ow)return Wi;Ow=1;var t=aI(),e=lI(),n=Ev();return Wi.grammar=n,Wi.write=e,Wi.parse=t.parse,Wi.parseParams=t.parseParams,Wi.parseFmtpConfig=t.parseFmtpConfig,Wi.parsePayloads=t.parsePayloads,Wi.parseRemoteCandidates=t.parseRemoteCandidates,Wi.parseImageAttributes=t.parseImageAttributes,Wi.parseSimulcastStreamList=t.parseSimulcastStreamList,Wi}var Bs=cI();function Pv(t,e,n){var i,r,o;e===void 0&&(e=50),n===void 0&&(n={});var a=(i=n.isImmediate)!=null&&i,c=(r=n.callback)!=null&&r,u=n.maxWait,h=Date.now(),f=[];function g(){if(u!==void 0){var w=Date.now()-h;if(w+e>=u)return u-w}return e}var v=function(){var w=[].slice.call(arguments),k=this;return new Promise(function(x,C){var E=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,h=Date.now(),!a){var N=t.apply(k,w);c&&c(N),f.forEach(function(P){return(0,P.resolve)(N)}),f=[]}},g()),E){var I=t.apply(k,w);return c&&c(I),x(I)}f.push({resolve:x,reject:C})})};return v.cancel=function(w){o!==void 0&&clearTimeout(o),f.forEach(function(k){return(0,k.reject)(w)}),f=[]},v}const uI=.7,dI=20,fl={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Aw extends Sr.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=He,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Pv(r=>A(this,void 0,void 0,function*(){this.emit(fl.NegotiationStarted);try{yield this.createAndSendOffer()}catch(o){if(r)r(o);else throw o}}),dI),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ts((i=n.loggerName)!==null&&i!==void 0?i:ir.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Kn}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return A(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return A(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:o,nackMids:a}=hI(e);this.remoteStereoMids=o,this.remoteNackMids=a}else if(e.type==="answer"){const o=Bs.parse((i=e.sdp)!==null&&i!==void 0?i:"");o.media.forEach(a=>{const c=Rv(a.mid);a.type==="audio"&&this.trackBitrates.some(u=>{if(!u.transceiver||c!=u.transceiver.mid)return!1;let h=0;if(a.rtp.some(g=>g.codec.toUpperCase()===u.codec.toUpperCase()?(h=g.payload,!0):!1),h===0)return!0;let f=!1;for(const g of a.fmtp)if(g.payload===h){g.config=g.config.split(";").filter(v=>!v.includes("maxaveragebitrate")).join(";"),u.maxbr>0&&(g.config+=";maxaveragebitrate=".concat(u.maxbr*1e3)),f=!0;break}return f||u.maxbr>0&&a.fmtp.push({payload:h,config:"maxaveragebitrate=".concat(u.maxbr*1e3)}),!0})}),r=Bs.write(o)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(o=>{this.pc.addIceCandidate(o)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(fl.NegotiationComplete),e.sdp&&Bs.parse(e.sdp).media.forEach(a=>{a.type==="video"&&this.emit(fl.RTPVideoPayloadTypes,a.rtp)})),!0})}createAndSendOffer(e){return A(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const c=this._pc.remoteDescription;if(e?.iceRestart&&c)yield this._pc.setRemoteDescription(c);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const o=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:o.sdp},this.logContext));const a=Bs.parse((n=o.sdp)!==null&&n!==void 0?n:"");if(a.media.forEach(c=>{Dw(c),c.type==="audio"?jw(c,["all"],[]):c.type==="video"&&this.trackBitrates.some(u=>{if(!c.msid||!u.cid||!c.msid.includes(u.cid))return!1;let h=0;if(c.rtp.some(g=>g.codec.toUpperCase()===u.codec.toUpperCase()?(h=g.payload,!0):!1),h===0||(tr(u.codec)&&!Xo()&&this.ensureVideoDDExtensionForSVC(c,a),!tr(u.codec)))return!0;const f=Math.round(u.maxbr*uI);for(const g of c.fmtp)if(g.payload===h){g.config.includes("x-google-start-bitrate")||(g.config+=";x-google-start-bitrate=".concat(f));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(o,Bs.write(a)),this.onOffer(o,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return A(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Bs.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Dw(r),r.type==="audio"&&jw(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Bs.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new ln("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new ln("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return A(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(c=>{switch(c.type){case"transport":n=c.selectedCandidatePairId;break;case"candidate-pair":n===""&&c.selected&&(n=c.id),i.set(c.id,c);break;case"remote-candidate":r.set(c.id,"".concat(c.address,":").concat(c.port));break}}),n==="")return;const a=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return r.get(a)})}setMungedSDP(e,n,i){return A(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let o="unknown error";r instanceof Error?o=r.message:typeof r=="string"&&(o=r);const a={error:o,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new hg(o)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(a=>a.uri===gw))){if(this.ddExtID===0){let a=0;n.media.forEach(c=>{var u;c.type==="video"&&((u=c.ext)===null||u===void 0||u.forEach(h=>{h.value>a&&(a=h.value)}))}),this.ddExtID=a+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:gw})}}}function jw(t,e,n){const i=Rv(t.mid);let r=0;t.rtp.some(o=>o.codec==="opus"?(r=o.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(o=>o.payload===r&&o.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(o=>o.payload===r?(o.config.includes("stereo=1")||(o.config+=";stereo=1"),!0):!1))}function hI(t){var e;const n=[],i=[],r=Bs.parse((e=t.sdp)!==null&&e!==void 0?e:"");let o=0;return r.media.forEach(a=>{var c;const u=Rv(a.mid);a.type==="audio"&&(a.rtp.some(h=>h.codec==="opus"?(o=h.payload,!0):!1),!((c=a.rtcpFb)===null||c===void 0)&&c.some(h=>h.payload===o&&h.type==="nack")&&i.push(u),a.fmtp.some(h=>h.payload===o?(h.config.includes("sprop-stereo=1")&&n.push(u),!0):!1))}),{stereoMids:n,nackMids:i}}function Dw(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Rv(t){return typeof t=="number"?t.toFixed(0):t}const xg="vp8",fI={audioPreset:fg.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Tv.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:xg,backupCodec:!0,preConnectBuffer:!1},MT={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},LT={deviceId:{ideal:"default"},resolution:Qc.h720.resolution},pI={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new WR,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},Nv={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Ut;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Ut||(Ut={}));class mI{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Nv.peerConnectionTimeout,this.log=He,this.updateState=()=>{var o,a;const c=this.state,u=this.requiredTransports.map(h=>h.getConnectionState());u.every(h=>h==="connected")?this.state=Ut.CONNECTED:u.some(h=>h==="failed")?this.state=Ut.FAILED:u.some(h=>h==="connecting")?this.state=Ut.CONNECTING:u.every(h=>h==="closed")?this.state=Ut.CLOSED:u.some(h=>h==="closed")?this.state=Ut.CLOSING:u.every(h=>h==="new")&&(this.state=Ut.NEW),c!==this.state&&(this.log.debug("pc state change: from ".concat(Ut[c]," to ").concat(Ut[this.state]),this.logContext),(o=this.onStateChange)===null||o===void 0||o.call(this,this.state,this.publisher.getConnectionState(),(a=this.subscriber)===null||a===void 0?void 0:a.getConnectionState()))},this.log=ts((r=i.loggerName)!==null&&r!==void 0?r:ir.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Aw(e,i),n!=="publisher-only"&&(this.subscriber=new Aw(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,er.SUBSCRIBER)},this.subscriber.onDataChannel=o=>{var a;(a=this.onDataChannel)===null||a===void 0||a.call(this,o)},this.subscriber.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=o=>{var a;(a=this.onIceCandidate)===null||a===void 0||a.call(this,o,er.PUBLISHER)},this.publisher.onTrack=o=>{var a;(a=this.onTrack)===null||a===void 0||a.call(this,o)},this.publisher.onOffer=(o,a)=>{var c;(c=this.onPublisherOffer)===null||c===void 0||c.call(this,o,a)},this.state=Ut.NEW,this.connectionLock=new Kn,this.remoteOfferLock=new Kn}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return A(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return A(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return A(this,void 0,void 0,function*(){var i;n===er.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return A(this,void 0,void 0,function*(){var i,r,o;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const a=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(o=this.subscriber)===null||o===void 0?void 0:o.createAndSetAnswer():void 0}finally{a()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return A(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(o=>this.ensureTransportConnected(o,e,n)))}finally{r()}})}negotiate(e){return A(this,void 0,void 0,function*(){return new Promise((n,i)=>A(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(fl.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(fl.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(a=>{clearTimeout(r),i(a)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===er.PUBLISHER?this.publisher.getConnectedAddress():e===er.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return A(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((u,h)=>A(o,void 0,void 0,function*(){const f=()=>{this.log.warn("abort transport connection",this.logContext),Rn.clearTimeout(g),h($e.cancelled("room connection has been cancelled"))};r?.signal.aborted&&f(),r?.signal.addEventListener("abort",f);const g=Rn.setTimeout(()=>{r?.signal.removeEventListener("abort",f),h($e.internal("could not establish pc connection"))},a);for(;this.state!==Ut.CONNECTED;)if(yield Nn(50),r?.signal.aborted){h($e.cancelled("room connection has been cancelled"));return}Rn.clearTimeout(g),r?.signal.removeEventListener("abort",f),u()}))})()})}}const UT=5e3,gI=3e4;class rt{static fetchRegionSettings(e,n,i){return A(this,void 0,void 0,function*(){const r=yield rt.fetchLock.lock();try{const o=yield fetch("".concat(vI(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(o.ok){const a=BN(o.headers),c=a?a*1e3:UT;return{regionSettings:yield o.json(),updatedAtInMs:Date.now(),maxAgeInMs:c}}else throw o.status===401?$e.notAllowed("Could not fetch region settings: ".concat(o.statusText),o.status):$e.internal("Could not fetch region settings: ".concat(o.statusText))}catch(o){throw o instanceof $e?o:i?.aborted?$e.cancelled("Region fetching was aborted"):$e.serverUnreachable("Could not fetch region settings, ".concat(o instanceof Error?"".concat(o.name,": ").concat(o.message):o))}finally{r()}})}static scheduleRefetch(e,n,i){return A(this,void 0,void 0,function*(){const r=rt.settingsTimeouts.get(e.hostname);clearTimeout(r),rt.settingsTimeouts.set(e.hostname,setTimeout(()=>A(this,void 0,void 0,function*(){try{const o=yield rt.fetchRegionSettings(e,n);rt.updateCachedRegionSettings(e,n,o)}catch(o){if(o instanceof $e&&o.reason===yt.NotAllowed){He.debug("token is not valid, cancelling auto region refresh");return}He.debug("auto refetching of region settings failed",{error:o}),rt.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){rt.cache.set(e.hostname,i),rt.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=rt.settingsTimeouts.get(e);n&&(clearTimeout(n),rt.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=rt.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=rt.connectionTrackers.get(e);i&&i.connectionCount===0&&(He.debug("stopping region refetch after disconnect delay",{hostname:e}),rt.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},gI))}static cancelCleanup(e){const n=rt.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=rt.connectionTrackers.get(e);n||(n={connectionCount:0},rt.connectionTrackers.set(e,n)),n.connectionCount++,rt.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=rt.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&rt.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return vl(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return A(this,void 0,void 0,function*(){return rt.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return A(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=rt.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),rt.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(o=>o.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),He.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){rt.updateCachedRegionSettings(this.serverUrl,this.token,e)}}rt.cache=new Map;rt.settingsTimeouts=new Map;rt.connectionTrackers=new Map;rt.fetchLock=new Kn;function vI(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Vt extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Mw(n,Vt.MAX_MESSAGE_BYTES),this.data=i?Mw(i,Vt.MAX_DATA_BYTES):void 0}static fromProto(e){return new Vt(e.code,e.message,e.data)}toProto(){return new RS({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Vt(Vt.ErrorCode[e],Vt.ErrorMessage[e],n)}}Vt.MAX_MESSAGE_BYTES=256;Vt.MAX_DATA_BYTES=15360;Vt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Vt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const FT=15360;function Iv(t){return new TextEncoder().encode(t).length}function Mw(t,e){if(Iv(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const o=Math.floor((n+i+1)/2);r.encode(t.slice(0,o)).length<=e?n=o:i=o-1}return t.slice(0,n)}const Ov=2e3;function Jh(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Av=typeof MediaRecorder<"u";class yI{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const bI=Av?MediaRecorder:yI;class wI extends bI{constructor(e,n){if(!Av)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const o=()=>r===void 0,a=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",c),r?.close(),r=void 0},c=u=>{r?.error(u),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",a),this.removeEventListener("error",c),r=void 0};this.byteStream=new ReadableStream({start:u=>{r=u,i=h=>A(this,void 0,void 0,function*(){let f;if(h.data.arrayBuffer){const g=yield h.data.arrayBuffer();f=new Uint8Array(g)}else if(h.data.byteArray)f=h.data.byteArray;else throw new Error("no data available!");o()||u.enqueue(f)}),this.addEventListener("dataavailable",i)},cancel:()=>{a()}}),this.addEventListener("stop",a),this.addEventListener("error",c)}}function kI(){return Av}const xI=1e3,SI=1e4;class BT extends W{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,n,o),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Pv(()=>A(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>A(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(le.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Kn,this.pauseUpstreamLock=new Kn,this.trackChangeLock=new Kn,this.trackChangeLock.lock().then(a=>A(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{a()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==W.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return A(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(o=>{ul(this._mediaStreamTrack,o)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Xa(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(o=>{Xa(r??e,o)}))})}waitForDimensions(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:xI;return(function*(){var i;if(e.kind===W.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ui())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Nn(10));const r=Date.now();for(;Date.now()-r<n;){const o=e.dimensions;if(o)return o;yield Nn(50)}throw new Qr("unable to get track dimensions after timeout")})()})}setDeviceId(e){return A(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ys(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Ys(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===W.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),o=e.kind===W.Kind.Audio?"audioinput":"videoinput";return n?wn.getInstance().normalizeDeviceId(o,i,r):i})()})}mute(){return A(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return A(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return A(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Qr("unable to replace an unpublished track");let r,o;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,o=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),o&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return A(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,o=HR(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const a={audio:!1,video:!1};this.kind===W.Kind.Video?a.video=i||r?{deviceId:i,facingMode:r}:!0:a.audio=i?Object.assign({deviceId:i},o):!0,this.attachedElements.forEach(h=>{ul(this.mediaStreamTrack,h)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const u=(yield navigator.mediaDevices.getUserMedia(a)).getTracks()[0];return this.kind===W.Kind.Video&&(yield u.applyConstraints(o)),u.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(u),this._constraints=e,this.emit(le.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?le.Muted:le.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),IT()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return A(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(le.UpstreamPaused,this);const i=ui();if(i?.name==="Safari"&&kr(i.version,"12.0")<0)throw new Sv("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return A(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(le.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return A(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o;const a=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const c=document.createElement(i.kind),u={kind:i.kind,track:i._mediaStreamTrack,element:c,audioContext:i.audioContext};if(yield n.init(u),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Xa(i._mediaStreamTrack,c),c.muted=!0,c.play().catch(h=>{h instanceof DOMException&&h.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:h})),setTimeout(()=>{c.play().catch(f=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:f}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:h}))}),i.processor=n,i.processorElement=c,i.processor.processedTrack){for(const h of i.attachedElements)h!==i.processorElement&&r&&(ul(i._mediaStreamTrack,h),Xa(i.processor.processedTrack,h));yield(o=i.sender)===null||o===void 0?void 0:o.replaceTrack(i.processor.processedTrack)}i.emit(le.TrackProcessorUpdate,i.processor)}finally{a()}})()})}getProcessor(){return this.processor}stopProcessor(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(le.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!kI()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new wI(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},SI)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Sh extends BT{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,W.Kind.Audio,n,i,o),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>A(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(c){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}a&&this.prevStats&&(this._currentBitrate=Jh(a,this.prevStats)),this.prevStats=a}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(le.AudioTrackFeatureUpdate,this,bn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(le.AudioTrackFeatureUpdate,this,bn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return A(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===W.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return A(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ys(this._constraints.deviceId);return this.source===W.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return A(this,void 0,void 0,function*(){let n;if(e){const i=Cv({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return A(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ci()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ov)))}setProcessor(e){return A(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!wr()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(le.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return A(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return A(this,void 0,void 0,function*(){const e=yield PT(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(le.AudioSilenceDetected)),e})}}function TI(t,e,n){switch(t.kind){case"audio":return new Sh(t,e,!1,void 0,n);case"video":return new Th(t,e,!1,n);default:throw new Qr("unsupported track type: ".concat(t.kind))}}const CI=Object.values(Qc),_I=Object.values(pg),EI=Object.values(Tv),PI=[Qc.h180,Qc.h360],RI=[pg.h180,pg.h360],NI=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new at(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),Sg=["q","h","f"];function Tg(t,e,n,i){var r,o;let a=i?.videoEncoding;t&&(a=i?.screenShareEncoding);const c=i?.simulcast,u=i?.scalabilityMode,h=i?.videoCodec;if(!a&&!c&&!u||!e||!n)return[{}];a||(a=OI(t,e,n,h),He.debug("using video encoding",a));const f=a.maxFramerate,g=new at(e,n,a.maxBitrate,a.maxFramerate,a.priority);if(u&&tr(h)){const k=new VT(u),x=[];if(k.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(u));const C=ui();if(Xc()||wr()||C?.name==="Chrome"&&kr(C?.version,"113")<0){const E=k.suffix=="h"?2:3,I=PN(C);for(let N=0;N<k.spatial;N+=1)x.push({rid:Sg[2-N],maxBitrate:a.maxBitrate/Math.pow(E,N),maxFramerate:g.encoding.maxFramerate,scaleResolutionDownBy:I?Math.pow(2,N):void 0});x[0].scalabilityMode=u}else x.push({maxBitrate:a.maxBitrate,maxFramerate:g.encoding.maxFramerate,scalabilityMode:u});return g.encoding.priority&&(x[0].priority=g.encoding.priority,x[0].networkPriority=g.encoding.priority),He.debug("using svc encoding",{encodings:x}),x}if(!c)return[a];let v=[];t?v=(r=Uw(i?.screenShareSimulcastLayers))!==null&&r!==void 0?r:Lw(t,g):v=(o=Uw(i?.videoSimulcastLayers))!==null&&o!==void 0?o:Lw(t,g);let w;if(v.length>0){const k=v[0];v.length>1&&([,w]=v);const x=Math.max(e,n);if(x>=960&&w)return vm(e,n,[k,w,g],f);if(x>=480)return vm(e,n,[k,g],f)}return vm(e,n,[g])}function II(t,e,n){var i,r,o,a;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&He.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const c=t.mediaStreamTrack.getSettings(),u=(i=c.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,h=(o=c.height)!==null&&o!==void 0?o:(a=t.dimensions)===null||a===void 0?void 0:a.height;return t.source===W.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Tg(t.source===W.Source.ScreenShare,u,h,n)}function OI(t,e,n,i){const r=AI(t,e,n);let{encoding:o}=r[0];const a=Math.max(e,n);for(let c=0;c<r.length;c+=1){const u=r[c];if(o=u.encoding,u.width>=a)break}if(i)switch(i){case"av1":case"h265":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function AI(t,e,n){if(t)return EI;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?CI:_I}function Lw(t,e){if(t)return NI(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?PI:RI}function vm(t,e,n,i){const r=[];if(n.forEach((o,a)=>{if(a>=Sg.length)return;const c=Math.min(t,e),h={rid:Sg[a],scaleResolutionDownBy:Math.max(1,c/Math.min(o.width,o.height)),maxBitrate:o.encoding.maxBitrate},f=i&&o.encoding.maxFramerate?Math.min(i,o.encoding.maxFramerate):o.encoding.maxFramerate;f&&(h.maxFramerate=f);const g=Qo()||a===0;o.encoding.priority&&g&&(h.priority=o.encoding.priority,h.networkPriority=o.encoding.priority),r.push(h)}),wr()&&AT()==="ios"){let o;r.forEach(c=>{o?c.maxFramerate&&c.maxFramerate>o&&(o=c.maxFramerate):o=c.maxFramerate});let a=!0;r.forEach(c=>{var u;c.maxFramerate!=o&&(a&&(a=!1,He.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),He.info('Setting framerate of encoding "'.concat((u=c.rid)!==null&&u!==void 0?u:"",'" to ').concat(o)),c.maxFramerate=o)})}return r}function Uw(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class VT{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function jI(t){return t.source===W.Source.ScreenShare||t.constraints.height&&Ys(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const DI=5e3;class Th extends BT{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,W.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>A(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(u){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:u}));return}const a=new Map(o.map(u=>[u.rid,u])),c=o.some(u=>u.qualityLimitationReason==="cpu");if(c!==this.isCpuConstrained&&(this.isCpuConstrained=c,this.isCpuConstrained&&this.emit(le.CpuConstrained)),this.prevStats){let u=0;a.forEach((h,f)=>{var g;const v=(g=this.prevStats)===null||g===void 0?void 0:g.get(f);u+=Jh(h,v)}),this._currentBitrate=u}this.prevStats=a}),this.senderLock=new Kn}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ci())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Ov))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return A(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.pauseUpstream.call(this);try{for(var c=!0,u=Yr(this.simulcastCodecs.values()),h;h=yield u.next(),n=h.done,!n;c=!0)o=h.value,c=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(f){i={error:f}}finally{try{!c&&!n&&(r=u.return)&&(yield r.call(u))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return A(this,void 0,void 0,function*(){var n,i,r,o,a;yield e.resumeUpstream.call(this);try{for(var c=!0,u=Yr(this.simulcastCodecs.values()),h;h=yield u.next(),n=h.done,!n;c=!0){o=h.value,c=!1;const f=o;yield(a=f.sender)===null||a===void 0?void 0:a.replaceTrack(f.mediaStreamTrack)}}catch(f){i={error:f}}finally{try{!c&&!n&&(r=u.return)&&(yield r.call(u))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return A(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return A(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return A(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var o;if(r.type==="outbound-rtp"){const a={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(o=r.rid)!==null&&o!==void 0?o:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},c=i.get(r.remoteId);c&&(a.jitter=c.jitter,a.packetsLost=c.packetsLost,a.roundTripTime=c.roundTripTime),n.push(a)}}),n.sort((r,o)=>{var a,c;return((a=o.frameWidth)!==null&&a!==void 0?a:0)-((c=r.frameWidth)!==null&&c!==void 0?c:0)}),n})}setPublishingQuality(e){const n=[];for(let i=xi.LOW;i<=xi.HIGH;i+=1)n.push(new bv({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(tr(this.codec),n)}restartTrack(e){return A(this,void 0,void 0,function*(){var n,i,r,o,a;let c;if(e){const g=Cv({video:e});typeof g.video!="boolean"&&(c=g.video)}yield this.restart(c),this.isCpuConstrained=!1;try{for(var u=!0,h=Yr(this.simulcastCodecs.values()),f;f=yield h.next(),n=f.done,!n;u=!0){o=f.value,u=!1;const g=o;g.sender&&((a=g.sender.transport)===null||a===void 0?void 0:a.state)!=="closed"&&(g.mediaStreamTrack=this.mediaStreamTrack.clone(),yield g.sender.replaceTrack(g.mediaStreamTrack))}}catch(g){i={error:g}}finally{try{!u&&!n&&(r=h.return)&&(yield r.call(h))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return A(this,arguments,void 0,function(i){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var a,c,u,h,f,g;if(yield n.setProcessor.call(r,i,o),!((f=r.processor)===null||f===void 0)&&f.processedTrack)try{for(var v=!0,w=Yr(r.simulcastCodecs.values()),k;k=yield w.next(),a=k.done,!a;v=!0)h=k.value,v=!1,yield(g=h.sender)===null||g===void 0?void 0:g.replaceTrack(r.processor.processedTrack)}catch(x){c={error:x}}finally{try{!v&&!a&&(u=w.return)&&(yield u.call(w))}finally{if(c)throw c.error}}})()})}setDegradationPreference(e){return A(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},DI))}setPublishingCodecs(e){return A(this,void 0,void 0,function*(){var n,i,r,o,a,c,u;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(tr(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const h=[];try{for(n=!0,i=Yr(e);r=yield i.next(),o=r.done,!o;n=!0){u=r.value,n=!1;const f=u;if(!this.codec||this.codec===f.codec)yield this.setPublishingLayers(tr(f.codec),f.qualities);else{const g=this.simulcastCodecs.get(f.codec);if(this.log.debug("try setPublishingCodec for ".concat(f.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:g})),!g||!g.sender){for(const v of f.qualities)if(v.enabled){h.push(f.codec);break}}else g.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(f.codec),this.logContext),yield Fw(g.sender,g.encodings,f.qualities,this.senderLock,tr(f.codec),this.log,this.logContext))}}}catch(f){a={error:f}}finally{try{!n&&!o&&(c=i.return)&&(yield c.call(i))}finally{if(a)throw a.error}}return h})}setPublishingLayers(e,n){return A(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Fw(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return A(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var o;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((o=this.mediaStreamTrack.getSettings().height)!==null&&o!==void 0?o:360)/360)),scalabilityMode:r===0&&tr(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),IT()&&this.isInBackground&&this.source===W.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Fw(t,e,n,i,r,o,a){return A(this,void 0,void 0,function*(){const c=yield i.lock();o.debug("setPublishingLayersForSender",Object.assign(Object.assign({},a),{sender:t,qualities:n,senderEncodings:e}));try{const u=t.getParameters(),{encodings:h}=u;if(!h)return;if(h.length!==e.length){o.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},a),{encodings:h,senderEncodings:e}));return}let f=!1;!1&&h[0].scalabilityMode||(r&&n.some(w=>w.enabled)&&n.forEach(w=>w.enabled=!0),h.forEach((v,w)=>{var k;let x=(k=v.rid)!==null&&k!==void 0?k:"";x===""&&(x="q");const C=zT(x),E=n.find(I=>I.quality===C);E&&v.active!==E.enabled&&(f=!0,v.active=E.enabled,o.debug("setting layer ".concat(E.quality," to ").concat(v.active?"enabled":"disabled"),a),Qo()&&(E.enabled?(v.scaleResolutionDownBy=e[w].scaleResolutionDownBy,v.maxBitrate=e[w].maxBitrate,v.maxFrameRate=e[w].maxFrameRate):(v.scaleResolutionDownBy=4,v.maxBitrate=10,v.maxFrameRate=2)))})),f&&(u.encodings=h,o.debug("setting encodings",Object.assign(Object.assign({},a),{encodings:u.encodings})),yield t.setParameters(u))}finally{c()}})}function zT(t){switch(t){case"f":return xi.HIGH;case"h":return xi.MEDIUM;case"q":return xi.LOW;default:return xi.HIGH}}function Bw(t,e,n,i){if(!n)return[new Js({quality:xi.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,o=new VT(r),a=[],c=o.suffix=="h"?1.5:2,u=o.suffix=="h"?2:3;for(let h=0;h<o.spatial;h+=1)a.push(new Js({quality:Math.min(xi.HIGH,o.spatial-1)-h,width:Math.ceil(t/Math.pow(c,h)),height:Math.ceil(e/Math.pow(c,h)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(u,h)):0,ssrc:0}));return a}return n.map(r=>{var o,a,c;const u=(o=r.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let h=zT((a=r.rid)!==null&&a!==void 0?a:"");return new Js({quality:h,width:Math.ceil(t/u),height:Math.ceil(e/u),bitrate:(c=r.maxBitrate)!==null&&c!==void 0?c:0,ssrc:0})})}const Vw="_lossy",zw="_reliable",MI=2*1e3,ym="leave-reconnect",LI=3e4,UI=8*1024,FI=256*1024;var ji;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(ji||(ji={}));class BI extends Sr.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Nv.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=ji.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=He,this.reliableDataSequence=1,this.reliableMessageBuffer=new Pw,this.reliableReceivedState=new oI(LI),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>A(this,[i],void 0,function(r){var o=this;let{channel:a}=r;return(function*(){if(a){if(a.label===zw)o.reliableDCSub=a;else if(a.label===Vw)o.lossyDCSub=a;else return;o.log.debug("on data channel ".concat(a.id,", ").concat(a.label),o.logContext),a.onmessage=o.handleDataMessage}})()}),this.handleDataMessage=i=>A(this,void 0,void 0,function*(){var r,o,a,c,u;const h=yield this.dataProcessLock.lock();try{let f;if(i.data instanceof ArrayBuffer)f=i.data;else if(i.data instanceof Blob)f=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const g=qn.fromBinary(new Uint8Array(f));if(g.sequence>0&&g.participantSid!==""){const v=this.reliableReceivedState.get(g.participantSid);if(v&&g.sequence<=v)return;this.reliableReceivedState.set(g.participantSid,g.sequence)}if(((r=g.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(ue.ActiveSpeakersUpdate,g.value.value.speakers);else if(((o=g.value)===null||o===void 0?void 0:o.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const v=yield(a=this.e2eeManager)===null||a===void 0?void 0:a.handleEncryptedData(g.value.value.encryptedValue,g.value.value.iv,g.participantIdentity,g.value.value.keyIndex),w=_S.fromBinary(v.payload),k=new qn({value:w.value,participantIdentity:g.participantIdentity,participantSid:g.participantSid});((c=k.value)===null||c===void 0?void 0:c.case)==="user"&&$w(k,k.value.value),this.emit(ue.DataPacketReceived,k,g.value.value.encryptionType)}else((u=g.value)===null||u===void 0?void 0:u.case)==="user"&&$w(g,g.value.value),this.emit(ue.DataPacketReceived,g,un.NONE)}finally{h()}}),this.handleDataError=i=>{const o=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:a}=i.error;this.log.error("DataChannel error on ".concat(o,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const o=i.currentTarget.maxRetransmits===0?Ye.LOSSY:Ye.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=u=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(u,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let c=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(c===null){o(a);return}i===ym&&(c=0),this.log.debug("reconnecting in ".concat(c,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Rn.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),c)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===ji.Connected&&i();const o=()=>{this.off(ue.Disconnected,a),i()},a=()=>{this.off(ue.Restarted,o),r()};this.once(ue.Restarted,o),this.once(ue.Disconnected,a)}),this.updateAndEmitDCBufferStatus=i=>{if(i===Ye.RELIABLE){const o=this.dataChannelForKind(i);o&&this.reliableMessageBuffer.alignBufferedAmount(o.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(ue.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>A(this,void 0,void 0,function*(){!this.url||!(yield fetch(Zc(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===ut.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===ut.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Uo.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>A(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Zc(this.url),{method:"HEAD"}),Nn(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ts((n=e.loggerName)!==null&&n!==void 0?n:ir.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new _v(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Kn,this.dataProcessLock=new Kn,this.dcBufferStatus=new Map([[Ye.LOSSY,!0],[Ye.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(ue.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(ue.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(ue.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(ue.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(ue.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(ue.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(ue.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(ue.SignalRequestResponse,i)}get logContext(){var e,n,i,r,o,a;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity,pID:this.participantSid}}join(e,n,i,r){return A(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),(!this.subscriberPrimary||o.fastPublish)&&this.negotiate().catch(a=>{He.error(a,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=o.clientConfiguration,this.emit(ue.SignalConnected,o),o}catch(o){if(o instanceof $e&&o.reason===yt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw o}})}close(){return A(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ue.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return A(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Pw,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return A(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Qr("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i($e.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(r),n(o)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return A(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return A(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Ut.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new mI(r,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ue.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,c)=>A(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===Ut.CONNECTED){const f=this.pcState===ji.New;this.pcState=ji.Connected,f&&this.emit(ue.Connected,e)}else o===Ut.FAILED&&(this.pcState===ji.Connected||this.pcState===ji.Reconnecting)&&(this.pcState=ji.Disconnected,this.handleDisconnect("peerconnection failed",c==="failed"?Uo.RR_SUBSCRIBER_FAILED:Uo.RR_PUBLISHER_FAILED));const u=this.client.isDisconnected||this.client.currentState===ut.RECONNECTING,h=[Ut.FAILED,Ut.CLOSING,Ut.CLOSED].includes(o);u&&h&&!this._isClosed&&this.emit(ue.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(ue.MediaTrackAdded,o.track,o.streams[0],o.receiver)},VI((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>A(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>A(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(ue.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(ue.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(ue.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(ue.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(ue.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let o=0;o<e.numAudios;o++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let o=0;o<e.numVideos;o++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Uo.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:UT,regionSettings:e.regions})),e.action){case ll.DISCONNECT:this.emit(ue.Disconnected,e?.reason),this.close();break;case ll.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(ym);break;case ll.RESUME:this.handleDisconnect(ym)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),r.push(a)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Gc.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Vw,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(zw,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(Ye.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,UI),FI)}},1e3))}createSender(e,n,i){return A(this,void 0,void 0,function*(){if(vg())return yield this.createTransceiverRTCRtpSender(e,n,i);if(yg())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new ln("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return A(this,void 0,void 0,function*(){if(vg())return this.createSimulcastTransceiverSender(e,n,i,r);if(yg())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new ln("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),no(e)&&(e.codec=n.videoCodec);const o={direction:"sendonly",streams:r};return i&&(o.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o)).sender})}createSimulcastTransceiverSender(e,n,i,r){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");const o={direction:"sendonly"};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return A(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){He.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Gc.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Ut.NEW)===Ut.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof ln?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof Va||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",Uo.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ue.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return A(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new ln("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Va;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof $e&&a.reason===yt.NotAllowed?new ln("could not reconnect, token might be expired"):new Va}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ue.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==ut.CONNECTED)throw new Va("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(ue.Restarted)}catch(o){const a=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),o}})}resumeConnection(e){return A(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new ln("could not reconnect, url or token not saved");if(!this.pcManager)throw new ln("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ue.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let o="";throw r instanceof Error&&(o=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof $e&&r.reason===yt.NotAllowed?new ln("could not reconnect, token might be expired"):r instanceof $e&&r.reason===yt.LeaveRequest?r:new Va(o)}if(this.emit(ue.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==ut.CONNECTED)throw new Va("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(ue.Resumed)})}waitForPCInitialConnection(e,n){return A(this,void 0,void 0,function*(){if(!this.pcManager)throw new ln("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return A(this,void 0,void 0,function*(){this.pcState=ji.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Nn(MI),!this.pcManager)throw new ln("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=ji.Connected}catch(e){throw this.pcState=ji.Disconnected,$e.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return A(this,void 0,void 0,function*(){const o=new qn({destinationIdentities:[e],kind:Ye.RELIABLE,value:{case:"rpcResponse",value:new mv({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(o,Ye.RELIABLE)})}publishRpcAck(e,n){return A(this,void 0,void 0,function*(){const i=new qn({destinationIdentities:[e],kind:Ye.RELIABLE,value:{case:"rpcAck",value:new pv({requestId:n})}});yield this.sendDataPacket(i,Ye.RELIABLE)})}sendDataPacket(e,n){return A(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const o=JN(e);if(o){const a=yield this.e2eeManager.encryptData(o.toBinary());e.value={case:"encryptedPacket",value:new CS({encryptedValue:a.payload,iv:a.iv,keyIndex:a.keyIndex})}}}n===Ye.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===Ye.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return A(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(Ye.RELIABLE);const n=this.dataChannelForKind(Ye.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(Ye.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>A(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(ue.Closing,r);!this.dcBufferStatus.get(e);)yield Nn(10);this.off(ue.Closing,r),n()}}))}ensureDataTransportConnected(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var o;if(!i.pcManager)throw new ln("PC manager is closed");const a=r?i.pcManager.subscriber:i.pcManager.publisher,c=r?"Subscriber":"Publisher";if(!a)throw $e.internal("".concat(c," connection not set"));let u=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),u=!0),!u&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(u=!0),u&&i.negotiate().catch(g=>{He.error(g,i.logContext)});const h=i.dataChannelForKind(n,r);if(h?.readyState==="open")return;const f=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<f;){if(a.isICEConnected&&((o=i.dataChannelForKind(n,r))===null||o===void 0?void 0:o.readyState)==="open")return;yield Nn(50)}throw $e.internal("could not establish ".concat(c," connection, state: ").concat(a.getICEConnectionState()))})()})}ensurePublisherConnected(e){return A(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Ut.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return A(this,void 0,void 0,function*(){return new Promise((e,n)=>A(this,void 0,void 0,function*(){if(!this.pcManager){n(new hg("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(ue.Closing,r),this.pcManager.publisher.once(fl.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(c=>{const u=c.codec.toLowerCase();AN(u)&&a.set(c.payload,u)}),this.emit(ue.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(i),e()}catch(o){o instanceof hg&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Uo.RR_UNKNOWN),n(o)}finally{this.off(ue.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===Ye.LOSSY)return this.lossyDCSub;if(e===Ye.RELIABLE)return this.reliableDCSub}else{if(e===Ye.LOSSY)return this.lossyDC;if(e===Ye.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,o,a;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const c=this.pcManager.publisher.getLocalDescription(),u=this.pcManager.publisher.getRemoteDescription(),h=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),f=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),g=(a=(o=this.signalOpts)===null||o===void 0?void 0:o.autoSubscribe)!==null&&a!==void 0?a:!0,v=new Array,w=new Array;e.forEach(k=>{k.isDesired!==g&&v.push(k.trackSid),k.isEnabled||w.push(k.trackSid)}),this.client.sendSyncState(new wv({answer:this.options.singlePeerConnection?u?Za({sdp:u.sdp,type:u.type}):void 0:f?Za({sdp:f.sdp,type:f.type}):void 0,offer:this.options.singlePeerConnection?c?Za({sdp:c.sdp,type:c.type}):void 0:h?Za({sdp:h.sdp,type:h.type}):void 0,subscription:new Wh({trackSids:v,subscribe:!g,participantTracks:[]}),publishTracks:gN(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:w,datachannelReceiveStates:this.reliableReceivedState.map((k,x)=>new KS({publisherSid:x,lastSeq:k}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{i?.id!==void 0&&i.id!==null&&e.push(new WS({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(Ye.LOSSY),er.PUBLISHER),n(this.dataChannelForKind(Ye.RELIABLE),er.PUBLISHER),n(this.dataChannelForKind(Ye.LOSSY,!0),er.SUBSCRIBER),n(this.dataChannelForKind(Ye.RELIABLE,!0),er.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Rn.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ci()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ci()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(o=>{let[a]=o;return a===i});if(r)return r[1]}}}function VI(t){return t!==void 0&&t>13}function $w(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class $T{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Mi("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),$n.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Mi("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),$n.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class zI extends $T{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Ui,i=null,r=null;if(this.signal){const a=this.signal;r=()=>{var c;(c=n.reject)===null||c===void 0||c.call(n,a.reason)},a.addEventListener("abort",r),i=a}const o=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>A(this,void 0,void 0,function*(){var a,c;try{const{done:u,value:h}=yield Promise.race([e.read(),n.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);return u?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(h),{done:!1,value:h.content})}catch(u){throw o(),u}}),return(){return A(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let c=new Set;const u=n.signal?e.withAbortSignal(n.signal):e;try{for(var h=!0,f=Yr(u),g;g=yield f.next(),i=g.done,!i;h=!0){a=g.value,h=!1;const v=a;c.add(v)}}catch(v){r={error:v}}finally{try{!h&&!i&&(o=f.return)&&(yield o.call(f))}finally{if(r)throw r.error}}return Array.from(c)})()})}}class $I extends $T{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=lh(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const o=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,o)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Ui,r=null,o=null;if(this.signal){const c=this.signal;o=()=>{var u;(u=i.reject)===null||u===void 0||u.call(i,c.reason)},c.addEventListener("abort",o),r=c}const a=()=>{e.releaseLock(),r&&o&&r.removeEventListener("abort",o),this.signal=void 0};return{next:()=>A(this,void 0,void 0,function*(){var c,u;try{const{done:h,value:f}=yield Promise.race([e.read(),i.promise,(u=(c=this.outOfBandFailureRejectingFuture)===null||c===void 0?void 0:c.promise)!==null&&u!==void 0?u:new Promise(()=>{})]);if(h)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(f);let g;try{g=n.decode(f.content)}catch(v){throw new Mi("Cannot decode datastream chunk ".concat(f.chunkIndex," as text: ").concat(v),$n.DecodeFailed)}return{done:!1,value:g}}}catch(h){throw a(),h}}),return(){return A(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return A(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,r,o,a;let c="";const u=n.signal?e.withAbortSignal(n.signal):e;try{for(var h=!0,f=Yr(u),g;g=yield f.next(),i=g.done,!i;h=!0)a=g.value,h=!1,c+=a}catch(v){r={error:v}}finally{try{!h&&!i&&(o=f.return)&&(yield o.call(f))}finally{if(r)throw r.error}}return c})()})}}class qI{constructor(){this.log=He,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Mi('A text stream handler for topic "'.concat(e,'" has already been set.'),$n.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Mi('A byte stream handler for topic "'.concat(e,'" has already been set.'),$n.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,o;const a=Array.from(this.textStreamControllers.entries()).filter(u=>u[1].sendingParticipantIdentity===e),c=Array.from(this.byteStreamControllers.entries()).filter(u=>u[1].sendingParticipantIdentity===e);if(a.length>0||c.length>0){const u=new Mi("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),$n.AbnormalEnd);for(const[h,f]of c)(i=(n=f.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,u),this.byteStreamControllers.delete(h);for(const[h,f]of a)(o=(r=f.outOfBandFailureRejectingFuture).reject)===null||o===void 0||o.call(r,u),this.textStreamControllers.delete(h)}}handleDataStreamPacket(e,n){return A(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return A(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const o=this.byteStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let a;const c=new Ui;c.promise.catch(f=>{this.log.error(f)});const u={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:lh(e.timestamp),attributes:e.attributes,encryptionType:i},h=new ReadableStream({start:f=>{if(a=f,this.textStreamControllers.has(e.streamId))throw new Mi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),$n.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:u,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:c})}});o(new zI(u,h,lh(e.totalLength),c),{identity:n})}else if(e.contentHeader.case==="textHeader"){const o=this.textStreamHandlers.get(e.topic);if(!o){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let a;const c=new Ui;c.promise.catch(f=>{this.log.error(f)});const u={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},h=new ReadableStream({start:f=>{if(a=f,this.textStreamControllers.has(e.streamId))throw new Mi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),$n.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:u,controller:a,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:c})}});o(new $I(u,h,lh(e.totalLength),c),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Mi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),$n.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Mi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),$n.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Mi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),$n.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Mi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),$n.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class qT{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return A(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class KI extends qT{}class WI extends qT{}const qw=15e3;class HI{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return A(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),a=new TextEncoder().encode(e).byteLength,c=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),u=new Array(c?c.length+1:1).fill(0),h=(g,v)=>{var w;u[v]=g;const k=u.reduce((x,C)=>x+C,0);(w=n?.onProgress)===null||w===void 0||w.call(n,k)},f=yield this.streamText({streamId:r,totalSize:a,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:c,attributes:n?.attributes});return yield f.write(e),h(1,0),yield f.close(),n?.attachments&&c&&(yield Promise.all(n.attachments.map((g,v)=>A(this,void 0,void 0,function*(){return this._sendFile(c[v],g,{topic:n.topic,mimeType:g.type,onProgress:w=>{h(w,v+1)}})})))),f.info})}streamText(e){return A(this,void 0,void 0,function*(){var n,i,r;const o=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),a={id:o,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e?.topic)!==null&&i!==void 0?i:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?un.GCM:un.NONE},c=new bh({streamId:o,mimeType:a.mimeType,topic:a.topic,timestamp:Fo(a.timestamp),totalLength:Fo(e?.totalSize),attributes:a.attributes,contentHeader:{case:"textHeader",value:new LS({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?ng.UPDATE:ng.CREATE})}}),u=e?.destinationIdentities,h=new qn({destinationIdentities:u,value:{case:"streamHeader",value:c}});yield this.engine.sendDataPacket(h,Ye.RELIABLE);let f=0;const g=this.engine,v=new WritableStream({write(x){return A(this,void 0,void 0,function*(){for(const C of FN(x,qw)){const E=new wh({content:C,streamId:o,chunkIndex:Fo(f)}),I=new qn({destinationIdentities:u,value:{case:"streamChunk",value:E}});yield g.sendDataPacket(I,Ye.RELIABLE),f+=1}})},close(){return A(this,void 0,void 0,function*(){const x=new kh({streamId:o}),C=new qn({destinationIdentities:u,value:{case:"streamTrailer",value:x}});yield g.sendDataPacket(C,Ye.RELIABLE)})},abort(x){console.log("Sink error:",x)}});let w=()=>A(this,void 0,void 0,function*(){yield k.close()});g.once(ue.Closing,w);const k=new KI(v,a,()=>this.engine.off(ue.Closing,w));return k})}sendFile(e,n){return A(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return A(this,void 0,void 0,function*(){var r;const o=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i?.mimeType)!==null&&r!==void 0?r:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),a=n.stream().getReader();for(;;){const{done:c,value:u}=yield a.read();if(c)break;yield o.write(u)}return yield o.close(),o.info})}streamBytes(e){return A(this,void 0,void 0,function*(){var n,i,r,o,a,c;const u=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),h=e?.destinationIdentities,f={id:u,mimeType:(i=e?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e?.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(o=e?.name)!==null&&o!==void 0?o:"unknown",encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?un.GCM:un.NONE},g=new bh({totalLength:Fo((c=f.size)!==null&&c!==void 0?c:0),mimeType:f.mimeType,streamId:u,topic:f.topic,timestamp:Fo(Date.now()),attributes:f.attributes,contentHeader:{case:"byteHeader",value:new US({name:f.name})}}),v=new qn({destinationIdentities:h,value:{case:"streamHeader",value:g}});yield this.engine.sendDataPacket(v,Ye.RELIABLE);let w=0;const k=new Kn,x=this.engine,C=this.log,E=new WritableStream({write(N){return A(this,void 0,void 0,function*(){const P=yield k.lock();let R=0;try{for(;R<N.byteLength;){const j=N.slice(R,R+qw),U=new qn({destinationIdentities:h,value:{case:"streamChunk",value:new wh({content:j,streamId:u,chunkIndex:Fo(w)})}});yield x.sendDataPacket(U,Ye.RELIABLE),w+=1,R+=j.byteLength}}finally{P()}})},close(){return A(this,void 0,void 0,function*(){const N=new kh({streamId:u}),P=new qn({destinationIdentities:h,value:{case:"streamTrailer",value:N}});yield x.sendDataPacket(P,Ye.RELIABLE)})},abort(N){C.error("Sink error:",N)}});return new WI(E,f)})}}class KT extends W{constructor(e,n,i,r,o){super(e,i,o),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?le.Muted:le.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(le.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return A(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Ov)),vN()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:o}=i;o&&this.rtpTimestamp!==o&&(this.emit(le.TimeSyncUpdate,{timestamp:r,rtpTimestamp:o}),this.rtpTimestamp=o)}};e()}}class GI extends KT{constructor(e,n,i,r,o,a){super(e,n,W.Kind.Audio,i,a),this.monitorReceiver=()=>A(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const c=yield this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=Jh(c,this.prevStats)),this.prevStats=c}),this.audioContext=r,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;wr()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(wr())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return A(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(bg(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&bg(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(le.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(le.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return A(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const bm=100;class JI extends KT{constructor(e,n,i,r,o){super(e,n,W.Kind.Video,i,o),this.elementInfos=[],this.monitorReceiver=()=>A(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Jh(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=Pv(()=>{this.updateDimensions()},bm),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===W.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?ul(this._mediaStreamTrack,n):Xa(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new YI(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return A(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(i=o.codecId,n={type:"video",streamId:o.id,framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&r.set(o.id,o)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return A(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((u,h)=>Math.max(u,h.visibilityChangedAt||0),0),o=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,a=this.elementInfos.some(u=>u.pictureInPicture),c=this.elementInfos.some(u=>u.visible)&&!o||a;if(!(this.lastVisible===c&&!e)){if(!c&&Date.now()-r<bm){Rn.setTimeout(()=>{this.updateVisibility()},bm);return}this.lastVisible=c,this.emit(le.VisibilityChanged,c,this)}}updateDimensions(){var e,n;let i=0,r=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const c=a.width()*o,u=a.height()*o;c+u>i+r&&(i=c,r=u)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(le.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?yw():n||(yw()>2?2:1)}}class YI{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:o,isIntersecting:a}=i;o===this.element&&(this.isIntersecting=a,this.isPiP=Tc(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,o;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Tc(this.element),(o=this.handleVisibilityChanged)===null||o===void 0||o.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Tc(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Cg(e),this.isPiP=ci()&&Tc(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Cg(this.element),this.isPiP=Tc(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,ww().observe(this.element),bw().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,o;(e=ww())===null||e===void 0||e.unobserve(this.element),(n=bw())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(o=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||o===void 0||o.removeEventListener("pagehide",this.onLeavePiP)}}function Tc(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Cg(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Cg(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const o=t.offsetWidth,a=t.offsetHeight,{hidden:c}=t,{display:u}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+a>n.pageYOffset&&r+o>n.pageXOffset&&!c&&u!=="none"}class Hr extends Sr.EventEmitter{constructor(e,n,i,r){var o;super(),this.metadataMuted=!1,this.encryption=un.NONE,this.log=He,this.handleMuted=()=>{this.emit(le.Muted)},this.handleUnmuted=()=>{this.emit(le.Unmuted)},this.log=ts((o=r?.loggerName)!==null&&o!==void 0?o:ir.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=W.Source.Unknown}setTrack(e){this.track&&(this.track.off(le.Muted,this.handleMuted),this.track.off(le.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(le.Muted,this.handleMuted),e.on(le.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Xe(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==un.NONE}get audioTrack(){if(vr(this.track))return this.track}get videoTrack(){if(no(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=W.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===W.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(Hr||(Hr={}));class _g extends Hr{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(le.Ended)},this.handleCpuConstrained=()=>{this.track&&no(this.track)&&this.emit(le.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(le.Ended,this.handleTrackEnded),this.track.off(le.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(le.Ended,this.handleTrackEnded),e.on(le.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return A(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return A(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return A(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return A(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(vr(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(bn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(bn.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(bn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(bn.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(bn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(bn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Yh(t,e){return A(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:o}=NT(t);let a=o.audio,c=o.video;if(i&&typeof o.audio=="object"&&(o.audio.processor=i),r&&typeof o.video=="object"&&(o.video.processor=r),t.audio&&typeof o.audio=="object"&&typeof o.audio.deviceId=="string"){const g=o.audio.deviceId;o.audio.deviceId={exact:g},n=!0,a=Object.assign(Object.assign({},o.audio),{deviceId:{ideal:g}})}if(o.video&&typeof o.video=="object"&&typeof o.video.deviceId=="string"){const g=o.video.deviceId;o.video.deviceId={exact:g},n=!0,c=Object.assign(Object.assign({},o.video),{deviceId:{ideal:g}})}o.audio===!0?o.audio={deviceId:"default"}:typeof o.audio=="object"&&o.audio!==null&&(o.audio=Object.assign(Object.assign({},o.audio),{deviceId:o.audio.deviceId||"default"})),o.video===!0?o.video={deviceId:"default"}:typeof o.video=="object"&&!o.video.deviceId&&(o.video.deviceId="default");const u=ET(o,MT,LT),h=Cv(u),f=navigator.mediaDevices.getUserMedia(h);o.audio&&(wn.userMediaPromiseMap.set("audioinput",f),f.catch(()=>wn.userMediaPromiseMap.delete("audioinput"))),o.video&&(wn.userMediaPromiseMap.set("videoinput",f),f.catch(()=>wn.userMediaPromiseMap.delete("videoinput")));try{const g=yield f;return yield Promise.all(g.getTracks().map(v=>A(this,void 0,void 0,function*(){const w=v.kind==="audio";let k=w?u.audio:u.video;(typeof k=="boolean"||!k)&&(k={});let x;const C=w?h.audio:h.video;typeof C!="boolean"&&(x=C);const E=v.getSettings().deviceId;x?.deviceId&&Ys(x.deviceId)!==E?x.deviceId=E:x||(x={deviceId:E});const I=TI(v,x,e);return I.kind===W.Kind.Video?I.source=W.Source.Camera:I.kind===W.Kind.Audio&&(I.source=W.Source.Microphone),I.mediaStream=g,vr(I)&&i?yield I.setProcessor(i):no(I)&&r&&(yield I.setProcessor(r)),I})))}catch(g){if(!n)throw g;return Yh(Object.assign(Object.assign({},t),{audio:a,video:c}),e)}})}function QI(t){return A(this,void 0,void 0,function*(){return(yield Yh({audio:!1,video:!0}))[0]})}function XI(t){return A(this,void 0,void 0,function*(){return(yield Yh({audio:!0,video:!1}))[0]})}var Ks;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Ks||(Ks={}));function ZI(t){switch(t){case _c.EXCELLENT:return Ks.Excellent;case _c.GOOD:return Ks.Good;case _c.POOR:return Ks.Poor;case _c.LOST:return Ks.Lost;default:return Ks.Unknown}}class WT extends Sr.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Jc.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===al.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,o,a){let c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Jc.STANDARD;var u;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ks.Unknown,this.log=He,this.log=ts((u=a?.loggerName)!==null&&u!==void 0?u:ir.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=c,this._attributes=o??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Ui,this.once(fe.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(W.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(W.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(W.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===al.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==al.ACTIVE&&this.emit(fe.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(fe.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(fe.ParticipantNameChanged,e)}_setAttributes(e){const n=yN(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(fe.AttributesChanged,n)}setPermissions(e){var n,i,r,o,a,c;const u=this.permissions,h=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((f,g)=>{var v;return f!==((v=this.permissions)===null||v===void 0?void 0:v.canPublishSources[g])})||e.canSubscribeMetrics!==((c=this.permissions)===null||c===void 0?void 0:c.canSubscribeMetrics);return this.permissions=e,h&&this.emit(fe.ParticipantPermissionsChanged,u),h}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(fe.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=ZI(e),n!==this._connectionQuality&&this.emit(fe.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>vr(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(le.Muted,()=>{this.emit(fe.TrackMuted,e)}),e.on(le.Unmuted,()=>{this.emit(fe.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case W.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case W.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function eO(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new $S({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class tO extends WT{constructor(e,n,i,r,o,a){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=un.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Ui)},this.handleReconnected=()=>{var c,u;(u=(c=this.reconnectFuture)===null||c===void 0?void 0:c.resolve)===null||u===void 0||u.call(c),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var c,u,h,f,g,v;this.reconnectFuture&&(this.reconnectFuture.promise.catch(w=>this.log.warn(w.message,this.logContext)),(u=(c=this.reconnectFuture)===null||c===void 0?void 0:c.reject)===null||u===void 0||u.call(c,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((f=(h=this.signalConnectedFuture).reject)===null||f===void 0||f.call(h,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(v=(g=this.activeAgentFuture)===null||g===void 0?void 0:g.reject)===null||v===void 0||v.call(g,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=c=>{var u,h;c.participant&&this.updateInfo(c.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Ui),(h=(u=this.signalConnectedFuture).resolve)===null||h===void 0||h.call(u)},this.handleSignalRequestResponse=c=>{const{requestId:u,reason:h,message:f}=c,g=this.pendingSignalRequests.get(u);g&&(h!==kv.OK&&g.reject(new fw(f,h)),this.pendingSignalRequests.delete(u))},this.handleDataPacket=c=>{switch(c.value.case){case"rpcResponse":let u=c.value.value,h=null,f=null;u.value.case==="payload"?h=u.value.value:u.value.case==="error"&&(f=Vt.fromProto(u.value.value)),this.handleIncomingRpcResponse(u.requestId,h,f);break;case"rpcAck":let g=c.value.value;this.handleIncomingRpcAck(g.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(c=>eO(c)))},this.onTrackUnmuted=c=>{this.onTrackMuted(c,c.isUpstreamPaused)},this.onTrackMuted=(c,u)=>{if(u===void 0&&(u=!0),!c.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Xe(c)));return}this.engine.updateMuteStatus(c.sid,u)},this.onTrackUpstreamPaused=c=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Xe(c))),this.onTrackMuted(c,!0)},this.onTrackUpstreamResumed=c=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Xe(c))),this.onTrackMuted(c,c.isMuted)},this.onTrackFeatureUpdate=c=>{const u=this.audioTrackPublications.get(c.sid);if(!u){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(c.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(u.trackSid,u.getTrackFeatures())},this.onTrackCpuConstrained=(c,u)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Xe(u))),this.emit(fe.LocalTrackCpuConstrained,c,u)},this.handleSubscribedQualityUpdate=c=>A(this,void 0,void 0,function*(){var u,h,f,g,v;if(!(!((v=this.roomOptions)===null||v===void 0)&&v.dynacast))return;const w=this.videoTrackPublications.get(c.trackSid);if(!w){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:c.trackSid}));return}if(!w.videoTrack)return;const k=yield w.videoTrack.setPublishingCodecs(c.subscribedCodecs);try{for(var x=!0,C=Yr(k),E;E=yield C.next(),u=E.done,!u;x=!0){g=E.value,x=!1;const I=g;fN(I)&&(this.log.debug("publish ".concat(I," for ").concat(w.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Xe(w))),yield this.publishAdditionalCodecForTrack(w.videoTrack,I,w.options))}}catch(I){h={error:I}}finally{try{!x&&!u&&(f=C.return)&&(yield f.call(C))}finally{if(h)throw h.error}}}),this.handleLocalTrackUnpublished=c=>{const u=this.trackPublications.get(c.trackSid);if(!u){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:c.trackSid}));return}this.unpublishTrack(u.track)},this.handleTrackEnded=c=>A(this,void 0,void 0,function*(){if(c.source===W.Source.ScreenShare||c.source===W.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Xe(c))),this.unpublishTrack(c);else if(c.isUserProvided)yield c.mute();else if(Kr(c)||Ms(c))try{if(ci())try{const u=yield navigator?.permissions.query({name:c.source===W.Source.Camera?"camera":"microphone"});if(u&&u.state==="denied")throw this.log.warn("user has revoked access to ".concat(c.source),Object.assign(Object.assign({},this.logContext),Xe(c))),u.onchange=()=>{u.state!=="denied"&&(c.isMuted||c.restartTrack(),u.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}c.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Xe(c))),Kr(c)?yield c.restartTrack({deviceId:"default"}):yield c.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Xe(c))),yield c.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=o,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==un.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(ue.RemoteMute,(i,r)=>{const o=this.trackPublications.get(i);!o||!o.track||(r?o.mute():o.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ue.Connected,this.handleReconnected).on(ue.SignalConnected,this.handleSignalConnected).on(ue.SignalRestarted,this.handleReconnected).on(ue.SignalResumed,this.handleReconnected).on(ue.Restarting,this.handleReconnecting).on(ue.Resuming,this.handleReconnecting).on(ue.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ue.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ue.Closing,this.handleClosing).on(ue.SignalRequestResponse,this.handleSignalRequestResponse).on(ue.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return A(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return A(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:o,attributes:a}=n;return(function*(){return new Promise((c,u)=>A(i,void 0,void 0,function*(){var h,f;try{let g=!1;const v=yield this.engine.client.sendUpdateLocalMetadata((h=r??this.metadata)!==null&&h!==void 0?h:"",(f=o??this.name)!==null&&f!==void 0?f:"",a),w=performance.now();for(this.pendingSignalRequests.set(v,{resolve:c,reject:k=>{u(k),g=!0},values:{name:o,metadata:r,attributes:a}});performance.now()-w<5e3&&!g;){if((!o||this.name===o)&&(!r||this.metadata===r)&&(!a||Object.entries(a).every(k=>{let[x,C]=k;return this.attributes[x]===C||C===""&&!this.attributes[x]}))){this.pendingSignalRequests.delete(v),c();return}yield Nn(50)}u(new fw("Request to update local metadata timed out","TimeoutError"))}catch(g){g instanceof Error&&u(g)}}))})()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(W.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(W.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(W.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return A(this,void 0,void 0,function*(){this.encryptionType=e?un.GCM:un.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return A(this,void 0,void 0,function*(){var o,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let c=this.getTrackPublication(e);if(n)if(c)yield c.unmute();else{let u;if(this.pendingPublishing.has(e)){const h=yield this.waitForPendingPublicationOfSource(e);return h||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield h?.unmute(),h}this.pendingPublishing.add(e);try{switch(e){case W.Source.Camera:u=yield this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case W.Source.Microphone:u=yield this.createTracks({audio:(a=i)!==null&&a!==void 0?a:!0});break;case W.Source.ScreenShare:u=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Qr(e)}}catch(h){throw u?.forEach(f=>{f.stop()}),h instanceof Error&&this.emit(fe.MediaDevicesError,h,gg(e)),this.pendingPublishing.delete(e),h}for(const h of u){const f=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===W.Source.Microphone&&vr(h)&&f.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),h.startPreConnectBuffer())}try{const h=[];for(const g of u)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Xe(g))),h.push(this.publishTrack(g,r));[c]=yield Promise.all(h)}catch(h){throw u?.forEach(f=>{f.stop()}),h}finally{this.pendingPublishing.delete(e)}}else if(!c?.track&&this.pendingPublishing.has(e)&&(c=yield this.waitForPendingPublicationOfSource(e),c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),c&&c.track)if(e===W.Source.ScreenShare){c=yield this.unpublishTrack(c.track);const u=this.getTrackPublication(W.Source.ScreenShareAudio);u&&u.track&&this.unpublishTrack(u.track)}else yield c.mute();return c})}enableCameraAndMicrophone(){return A(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(W.Source.Camera)||this.pendingPublishing.has(W.Source.Microphone))){this.pendingPublishing.add(W.Source.Camera),this.pendingPublishing.add(W.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(W.Source.Camera),this.pendingPublishing.delete(W.Source.Microphone)}}})}createTracks(e){return A(this,void 0,void 0,function*(){var n,i;e??(e={});const r=ET(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Yh(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(c=>(vr(c)&&(this.microphoneError=void 0,c.setAudioContext(this.audioContext),c.source=W.Source.Microphone,this.emit(fe.AudioStreamAcquired)),no(c)&&(this.cameraError=void 0,c.source=W.Source.Camera),c))}catch(o){throw o instanceof Error&&(e.audio&&(this.microphoneError=o),e.video&&(this.cameraError=o)),o}})}createScreenTracks(e){return A(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Sv("getDisplayMedia not supported");e.resolution===void 0&&!EN()&&(e.resolution=Tv.h1080fps30.resolution);const n=mN(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Qr("no video track found");const o=new Th(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=W.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(i.getAudioTracks().length>0){this.emit(fe.AudioStreamAcquired);const c=new Sh(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});c.source=W.Source.ScreenShareAudio,a.push(c)}return a})}publishTrack(e,n){return A(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return A(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var c,u,h,f;Kr(i)&&i.setAudioContext(o.audioContext),yield(c=o.reconnectFuture)===null||c===void 0?void 0:c.promise,o.republishPromise&&!a&&(yield o.republishPromise),dl(i)&&o.pendingPublishPromises.has(i)&&(yield o.pendingPublishPromises.get(i));let g;if(i instanceof MediaStreamTrack)g=i.getConstraints();else{g=i.constraints;let E;switch(i.source){case W.Source.Microphone:E="audioinput";break;case W.Source.Camera:E="videoinput"}E&&o.activeDeviceMap.has(E)&&(g=Object.assign(Object.assign({},g),{deviceId:o.activeDeviceMap.get(E)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Sh(i,g,!0,o.audioContext,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;case"video":i=new Th(i,g,!0,{loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});break;default:throw new Qr("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:o.roomOptions.loggerName,loggerContextCb:()=>o.logContext});let v;if(o.trackPublications.forEach(E=>{E.track&&E.track===i&&(v=E)}),v)return o.log.warn("track has already been published, skipping",Object.assign(Object.assign({},o.logContext),Xe(v))),v;const w=Object.assign(Object.assign({},o.roomOptions.publishDefaults),r),k="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,x=(u=w.forceStereo)!==null&&u!==void 0?u:k;x&&(w.dtx===void 0&&o.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},o.logContext),Xe(i))),w.red===void 0&&o.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(h=w.dtx)!==null&&h!==void 0||(w.dtx=!1),(f=w.red)!==null&&f!==void 0||(w.red=!1)),!RN()&&o.roomOptions.e2ee&&(o.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},o.logContext)),w.simulcast=!1),w.source&&(i.source=w.source);const C=new Promise((E,I)=>A(o,void 0,void 0,function*(){try{if(this.engine.client.currentState!==ut.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Xe(i)}));let N=!1;const P=setTimeout(()=>{N=!0,i.stop(),I(new hw("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(P),N)return;const R=yield this.publish(i,w,x);E(R)}else try{const N=yield this.publish(i,w,x);E(N)}catch(N){I(N)}}catch(N){I(N)}}));o.pendingPublishPromises.set(i,C);try{return yield C}catch(E){throw E}finally{o.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Ui),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Xe(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>bN(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Xe(e))),!1)}publish(e,n,i){return A(this,void 0,void 0,function*(){var r,o,a,c,u,h,f,g,v,w;if(!this.hasPermissionsToPublish(e))throw new hw("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(H=>dl(e)&&H.source===e.source)&&e.source!==W.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Xe(e))),n.stopMicTrackOnMute&&vr(e)&&(e.stopOnMute=!0),e.source===W.Source.ScreenShare&&Qo()&&(n.simulcast=!1),n.videoCodec==="av1"&&!TN()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!CN()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=xg),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(H=>n.videoCodec===jc(H.mime))||(n.videoCodec=jc(this.enabledPublishVideoCodecs[0].mime)));const x=n.videoCodec;e.on(le.Muted,this.onTrackMuted),e.on(le.Unmuted,this.onTrackUnmuted),e.on(le.Ended,this.handleTrackEnded),e.on(le.UpstreamPaused,this.onTrackUpstreamPaused),e.on(le.UpstreamResumed,this.onTrackUpstreamResumed),e.on(le.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const C=[],E=!(!((r=n.dtx)!==null&&r!==void 0)||r),I=e.getSourceTrackSettings();I.autoGainControl&&C.push(bn.TF_AUTO_GAIN_CONTROL),I.echoCancellation&&C.push(bn.TF_ECHO_CANCELLATION),I.noiseSuppression&&C.push(bn.TF_NOISE_SUPPRESSION),I.channelCount&&I.channelCount>1&&C.push(bn.TF_STEREO),E&&C.push(bn.TF_NO_DTX),Kr(e)&&e.hasPreConnectBuffer&&C.push(bn.TF_PRECONNECT_BUFFER);const N=new Yc({cid:e.mediaStreamTrack.id,name:n.name,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),disableDtx:E,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((o=n.red)!==null&&o!==void 0)||o),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:C});let P;if(e.kind===W.Kind.Video){let H={width:0,height:0};try{H=yield e.waitForDimensions()}catch{const Q=(c=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&c!==void 0?c:Qc.h720.resolution;H={width:Q.width,height:Q.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(e)),{dims:H}))}N.width=H.width,N.height=H.height,Ms(e)&&(tr(x)&&(e.source===W.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Xe(e))))),n.scalabilityMode=(u=n.scalabilityMode)!==null&&u!==void 0?u:"L3T3_KEY"),N.simulcastCodecs=[new rg({codec:x,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:xg}),n.backupCodec&&x!==n.backupCodec.codec&&N.encryption===un.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),N.simulcastCodecs.push(new rg({codec:n.backupCodec.codec,cid:""})))),P=Tg(e.source===W.Source.ScreenShare,N.width,N.height,n),N.layers=Bw(N.width,N.height,P,tr(n.videoCodec))}else e.kind===W.Kind.Audio&&(P=[{maxBitrate:(h=n.audioPreset)===null||h===void 0?void 0:h.maxBitrate,priority:(g=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&g!==void 0?g:"high",networkPriority:(w=(v=n.audioPreset)===null||v===void 0?void 0:v.priority)!==null&&w!==void 0?w:"high"}]);if(!this.engine||this.engine.isClosed)throw new ln("cannot publish track when not connected");const R=()=>A(this,void 0,void 0,function*(){var H,q,Q;if(!this.engine.pcManager)throw new ln("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,P),this.emit(fe.LocalSenderCreated,e.sender,e),Ms(e)&&((H=n.degradationPreference)!==null&&H!==void 0||(n.degradationPreference=jI(e)),e.setDegradationPreference(n.degradationPreference)),P)if(Qo()&&e.kind===W.Kind.Audio){let ne;for(const Se of this.engine.pcManager.publisher.getTransceivers())if(Se.sender===e.sender){ne=Se;break}ne&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:ne,codec:"opus",maxbr:!((q=P[0])===null||q===void 0)&&q.maxBitrate?P[0].maxBitrate/1e3:0})}else e.codec&&tr(e.codec)&&(!((Q=P[0])===null||Q===void 0)&&Q.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:N.cid,codec:e.codec,maxbr:P[0].maxBitrate/1e3});yield this.engine.negotiate()});let j;const U=new Promise((H,q)=>A(this,void 0,void 0,function*(){var Q;try{j=yield this.engine.addTrack(N),H(j)}catch(ne){e.sender&&(!((Q=this.engine.pcManager)===null||Q===void 0)&&Q.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Se=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(e)),{error:Se}))})),q(ne)}}));if(this.enabledPublishVideoCodecs.length>0)j=(yield Promise.all([U,R()]))[0];else{j=yield U;let H;if(j.codecs.forEach(q=>{H===void 0&&(H=q.mimeType)}),H&&e.kind===W.Kind.Video){const q=jc(H);q!==x&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(e)),{codec:q})),n.videoCodec=q,P=Tg(e.source===W.Source.ScreenShare,N.width,N.height,n))}yield R()}const F=new _g(e.kind,j,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(F.on(le.CpuConstrained,H=>this.onTrackCpuConstrained(H,F)),F.options=n,e.sid=j.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:P,trackInfo:j})),Ms(e)?e.startMonitor(this.engine.client):Kr(e)&&e.startMonitor(),this.addTrackPublication(F),this.emit(fe.LocalTrackPublished,F),Kr(e)&&j.audioFeatures.includes(bn.TF_PRECONNECT_BUFFER)){const H=e.getPreConnectBuffer(),q=e.getPreConnectBufferMimeType();this.on(fe.LocalTrackSubscribed,Q=>{if(Q.trackSid===j.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Xe(e))),e.stopPreConnectBuffer()}}),H&&new Promise((ne,Se)=>A(this,void 0,void 0,function*(){var De,Ke,de,V,Z,he;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Xe(e)));const ke=setTimeout(()=>{Se(new Error("agent not active within 10 seconds"))},1e4),Te=yield this.waitUntilActiveAgentPresent();clearTimeout(ke),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Xe(e)));const Ne=yield this.streamBytes({name:"preconnect-buffer",mimeType:q,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Te.identity],attributes:{trackId:F.trackSid,sampleRate:String((Z=I.sampleRate)!==null&&Z!==void 0?Z:"48000"),channels:String((he=I.channelCount)!==null&&he!==void 0?he:"1")}});try{for(var oe=!0,L=Yr(H),G;G=yield L.next(),De=G.done,!De;oe=!0){V=G.value,oe=!1;const Ce=V;yield Ne.write(Ce)}}catch(Ce){Ke={error:Ce}}finally{try{!oe&&!De&&(de=L.return)&&(yield de.call(L))}finally{if(Ke)throw Ke.error}}yield Ne.close(),ne()}catch(ke){Se(ke)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Xe(e)))}).catch(ne=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(e)),{error:ne}))})}return F})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return A(this,void 0,void 0,function*(){var r;if(this.encryptionType!==un.NONE)return;let o;if(this.trackPublications.forEach(w=>{w.track&&w.track===e&&(o=w)}),!o)throw new Qr("track is not published");if(!Ms(e))throw new Qr("track is not a video track");const a=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),c=II(e,n,a);if(!c){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Xe(e)));return}const u=e.addSimulcastTrack(n,c);if(!u)return;const h=new Yc({cid:u.mediaStreamTrack.id,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:u.mediaStreamTrack.id}]});if(h.layers=Bw(h.width,h.height,c),!this.engine||this.engine.isClosed)throw new ln("cannot publish track when not connected");const f=()=>A(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,u,a,c),yield this.engine.negotiate()}),v=(yield Promise.all([this.engine.addTrack(h),f()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:c,trackInfo:v}))})}unpublishTrack(e,n){return A(this,void 0,void 0,function*(){var i,r;if(dl(e)){const h=this.pendingPublishPromises.get(e);h&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Xe(e))),yield h)}const o=this.getPublicationForTrack(e),a=o?Xe(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(le.Muted,this.onTrackMuted),e.off(le.Unmuted,this.onTrackUnmuted),e.off(le.Ended,this.handleTrackEnded),e.off(le.UpstreamPaused,this.onTrackUpstreamPaused),e.off(le.UpstreamResumed,this.onTrackUpstreamResumed),e.off(le.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let c=!1;const u=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Ut.FAILED&&u)try{for(const h of this.engine.pcManager.publisher.getTransceivers())h.sender===u&&(h.direction="inactive",c=!0);if(this.engine.removeTrack(u)&&(c=!0),Ms(e)){for(const[,h]of e.simulcastCodecs)h.sender&&(this.engine.removeTrack(h.sender)&&(c=!0),h.sender=void 0);e.simulcastCodecs.clear()}}catch(h){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:h}))}switch(this.trackPublications.delete(o.trackSid),o.kind){case W.Kind.Audio:this.audioTrackPublications.delete(o.trackSid);break;case W.Kind.Video:this.videoTrackPublications.delete(o.trackSid);break}return this.emit(fe.LocalTrackUnpublished,o),o.setTrack(void 0),c&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return A(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((o,a)=>A(i,void 0,void 0,function*(){try{const c=[];this.trackPublications.forEach(u=>{u.track&&(n&&(u.options=Object.assign(Object.assign({},u.options),n)),c.push(u))}),yield Promise.all(c.map(u=>A(this,void 0,void 0,function*(){const h=u.track;yield this.unpublishTrack(h,!1),r&&!h.isMuted&&h.source!==W.Source.ScreenShare&&h.source!==W.Source.ScreenShareAudio&&(Kr(h)||Ms(h))&&!h.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:u.trackSid})),yield h.restartTrack()),yield this.publishOrRepublishTrack(h,u.options,!0)}))),o()}catch(c){a(c)}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(e){return A(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const o=r.reliable?Ye.RELIABLE:Ye.LOSSY,a=r.destinationIdentities,c=r.topic;let u=new hv({participantIdentity:i.identity,payload:n,destinationIdentities:a,topic:c});const h=new qn({kind:o,value:{case:"user",value:u}});yield i.engine.sendDataPacket(h,o)})()})}publishDtmf(e,n){return A(this,void 0,void 0,function*(){const i=new qn({kind:Ye.RELIABLE,value:{case:"sipDtmf",value:new PS({code:e,digit:n})}});yield this.engine.sendDataPacket(i,Ye.RELIABLE)})}sendChatMessage(e,n){return A(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},r=new qn({value:{case:"chatMessage",value:new yh(Object.assign(Object.assign({},i),{timestamp:_t.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,Ye.RELIABLE),this.emit(fe.ChatMessage,i),i})}editChatMessage(e,n){return A(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new qn({value:{case:"chatMessage",value:new yh(Object.assign(Object.assign({},i),{timestamp:_t.parse(i.timestamp),editTimestamp:_t.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,Ye.RELIABLE),this.emit(fe.ChatMessage,i),i})}sendText(e,n){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return A(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return A(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:o,payload:a,responseTimeout:c=15e3}=n;return(function*(){return new Promise((f,g)=>A(i,void 0,void 0,function*(){var v,w,k,x;if(Iv(a)>FT){g(Vt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((w=(v=this.engine.latestJoinResponse)===null||v===void 0?void 0:v.serverInfo)===null||w===void 0)&&w.version&&kr((x=(k=this.engine.latestJoinResponse)===null||k===void 0?void 0:k.serverInfo)===null||x===void 0?void 0:x.version,"1.8.0")<0){g(Vt.builtIn("UNSUPPORTED_SERVER"));return}const C=Math.max(c,8e3),E=crypto.randomUUID();yield this.publishRpcRequest(r,E,o,a,C);const I=setTimeout(()=>{this.pendingAcks.delete(E),g(Vt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(E),clearTimeout(N)},7e3);this.pendingAcks.set(E,{resolve:()=>{clearTimeout(I)},participantIdentity:r});const N=setTimeout(()=>{this.pendingResponses.delete(E),g(Vt.builtIn("RESPONSE_TIMEOUT"))},c);this.pendingResponses.set(E,{resolve:(P,R)=>{clearTimeout(N),this.pendingAcks.has(E)&&(this.log.warn("RPC response received before ack",E),this.pendingAcks.delete(E),clearTimeout(I)),R?g(R):f(P??"")},participantIdentity:r})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,o){return A(this,void 0,void 0,function*(){const a=new qn({destinationIdentities:[e],kind:Ye.RELIABLE,value:{case:"rpcRequest",value:new fv({id:n,method:i,payload:r,responseTimeoutMs:o,version:1})}});yield this.engine.sendDataPacket(a,Ye.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,Vt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const o=this.trackPublications.get(n.sid);if(o){const a=o.isMuted||((r=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);a!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(n.sid,a))}}),!0):!1}setActiveAgent(e){var n,i,r,o;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(o=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||o===void 0||o.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Ui),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Kr(r)||Ms(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return A(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(o=>{let[a]=o;return a.source===e});if(r)return r[1];yield Nn(20)}})}}class nO extends Hr{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=o=>{this.setTrack(void 0),this.emit(le.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.visible=o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensionsAdaptiveStream=o,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Wh({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new NS({participantSid:"",trackSids:[this.trackSid]})]});this.emit(le.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Hr.SubscriptionStatus.Unsubscribed:super.isSubscribed?Hr.SubscriptionStatus.Subscribed:Hr.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Hr.PermissionStatus.Allowed:Hr.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(hm(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&hm(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:xi.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(le.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(le.VisibilityChanged,this.handleVisibilityChange),r.off(le.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(le.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(le.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(le.VisibilityChanged,this.handleVisibilityChange),e.on(le.Ended,this.handleEnded),this.emit(le.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(le.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?le.Muted:le.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(le.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(le.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return hm(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new FS({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===W.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)mw(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=wN(this.trackInfo,this.requestedMaxQuality);i&&mw(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:xi.HIGH})),e.quality=xi.HIGH)}this.emit(le.UpdateSettings,e)}}class Ch extends WT{static fromParticipantInfo(e,n,i){return new Ch(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,o,a,c){let u=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Jc.STANDARD;super(n,i||"",r,o,a,c,u),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(le.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Xe(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(le.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(le.SubscriptionPermissionChanged,n=>{this.emit(fe.TrackSubscriptionPermissionChanged,e,n)}),e.on(le.SubscriptionStatusChanged,n=>{this.emit(fe.TrackSubscriptionStatusChanged,e,n)}),e.on(le.Subscribed,n=>{this.emit(fe.TrackSubscribed,n,e)}),e.on(le.Unsubscribed,n=>{this.emit(fe.TrackUnsubscribed,n,e)}),e.on(le.SubscriptionFailed,n=>{this.emit(fe.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,o,a){let c=this.getTrackPublicationBySid(n);if(c||n.startsWith("TR")||this.trackPublications.forEach(f=>{!c&&e.kind===f.kind.toString()&&(c=f)}),!c){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(fe.TrackSubscriptionFailed,n);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Xe(c))),this.emit(fe.TrackSubscriptionFailed,n);return}const u=e.kind==="video";let h;return u?h=new JI(e,n,r,o):h=new GI(e,n,r,this.audioContext,this.audioOutput),h.source=c.source,h.isMuted=c.isMuted,h.setMediaStream(i),h.start(),c.setTrack(h),this.volumeMap.has(c.source)&&wg(h)&&vr(h)&&h.setVolume(this.volumeMap.get(c.source)),c}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var o,a;let c=this.getTrackPublicationBySid(r.sid);if(c)c.updateInfo(r);else{const u=W.kindFromProto(r.type);if(!u)return;c=new nO(u,r,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),c.updateInfo(r),i.set(r.sid,c);const h=Array.from(this.trackPublications.values()).find(f=>f.source===c?.source);h&&c.source!==W.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(c.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Xe(h),newTrack:Xe(c)})),this.addTrackPublication(c)}n.set(r.sid,c)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Xe(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(fe.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case W.Kind.Audio:this.audioTrackPublications.delete(e);break;case W.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(fe.TrackUnpublished,i)}setAudioOutput(e){return A(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;vr(i.track)&&wg(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ot;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ot||(ot={}));const iO=4*1e3;class yl extends Sr.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,o;if(super(),n=this,this.state=ot.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=He,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,c,u)=>A(this,void 0,void 0,function*(){var h;if(!_N())throw wr()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const f=yield this.disconnectLock.lock();if(this.state===ot.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),f(),Promise.resolve();if(this.connectFuture)return f(),this.connectFuture.promise;this.setAndEmitConnectionState(ot.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==jT(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),vl(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new rt(a,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(w=>{var k;(k=this.regionUrlProvider)===null||k===void 0||k.setServerReportedRegions(w)}).catch(w=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:w}))}));const g=(w,k,x)=>A(this,void 0,void 0,function*(){var C,E;this.abortController&&this.abortController.abort();const I=new AbortController;this.abortController=I,f?.();try{if(yield hl.getInstance().getBackOffPromise(a),I.signal.aborted)throw $e.cancelled("Connection attempt aborted");yield this.attemptConnection(x??a,c,u,I),this.abortController=void 0,w()}catch(N){if(this.regionUrlProvider&&N instanceof $e&&N.reason!==yt.Cancelled&&N.reason!==yt.NotAllowed){let P=null;try{this.log.debug("Fetching next region"),P=yield this.regionUrlProvider.getNextBestRegionUrl((C=this.abortController)===null||C===void 0?void 0:C.signal)}catch(R){if(R instanceof $e&&(R.status===401||R.reason===yt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),k(R);return}}[yt.InternalError,yt.ServerUnreachable,yt.Timeout].includes(N.reason)&&(this.log.debug("Adding failed connection attempt to back off"),hl.getInstance().addFailedConnectionAttempt(a)),P&&!(!((E=this.abortController)===null||E===void 0)&&E.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(N.message,". Retrying with another region: ").concat(P),this.logContext),this.recreateEngine(),yield g(w,k,P)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,xw(N)),k(N))}else{let P=nr.UNKNOWN_REASON;N instanceof $e&&(P=xw(N)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,P),k(N)}}}),v=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Ui((w,k)=>{g(w,k,v)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,c,u,h,f,g)=>A(this,void 0,void 0,function*(){var v,w,k;const x=yield u.join(a,c,{autoSubscribe:h.autoSubscribe,adaptiveStream:typeof f.adaptiveStream=="object"?!0:f.adaptiveStream,maxRetries:h.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:h.websocketTimeout,singlePeerConnection:f.singlePeerConnection},g.signal);let C=x.serverInfo;if(C||(C={version:x.serverVersion,region:x.serverRegion}),this.serverInfo=C,this.log.debug("connected to Livekit Server ".concat(Object.entries(C).map(E=>{let[I,N]=E;return"".concat(I,": ").concat(N)}).join(", ")),{room:(v=x.room)===null||v===void 0?void 0:v.name,roomSid:(w=x.room)===null||w===void 0?void 0:w.sid,identity:(k=x.participant)===null||k===void 0?void 0:k.identity}),!C.version)throw new lN("unknown server version");return C.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),f.dynacast=!1),x}),this.applyJoinResponse=a=>{const c=a.participant;if(this.localParticipant.sid=c.sid,this.localParticipant.identity=c.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(u){this.log.error(u instanceof Error?u.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:u}))}this.handleParticipantUpdates([c,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,c,u,h)=>A(this,void 0,void 0,function*(){var f,g;this.state===ot.Reconnecting||this.isResuming||!((f=this.engine)===null||f===void 0)&&f.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((g=this.regionUrlProvider)===null||g===void 0)&&g.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Nv),u),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const v=yield this.connectSignal(a,c,this.engine,this.connOptions,this.options,h);this.applyJoinResponse(v),this.setupLocalParticipantEvents(),this.emit(ie.SignalConnected)}catch(v){yield this.engine.close(),this.recreateEngine();const w=h.signal.aborted?$e.cancelled("Signal connection aborted"):$e.serverUnreachable("could not establish signal connection");throw v instanceof Error&&(w.message="".concat(w.message,": ").concat(v.message)),v instanceof $e&&(w.reason=v.reason,w.status=v.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:v})),w}if(h.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),$e.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,h)}catch(v){throw yield this.engine.close(),this.recreateEngine(),v}ci()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ci()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ot.Connected),this.emit(ie.Connected),hl.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];return A(n,[...c],void 0,function(){var h=this;let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var g,v,w;const k=yield h.disconnectLock.lock();try{if(h.state===ot.Disconnected){h.log.debug("already disconnected",h.logContext);return}if(h.log.info("disconnect from room",Object.assign({},h.logContext)),h.state===ot.Connecting||h.state===ot.Reconnecting||h.isResuming){const x="Abort connection attempt due to user initiated disconnect";h.log.warn(x,h.logContext),(g=h.abortController)===null||g===void 0||g.abort(x),(w=(v=h.connectFuture)===null||v===void 0?void 0:v.reject)===null||w===void 0||w.call(v,$e.cancelled("Client initiated disconnect")),h.connectFuture=void 0}h.engine&&(h.engine.client.isDisconnected||(yield h.engine.client.sendLeave()),yield h.engine.close()),h.handleDisconnect(f,nr.CLIENT_INITIATED),h.engine=void 0}finally{k()}})()})},this.onPageLeave=()=>A(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>A(this,void 0,void 0,function*(){const a=[],c=ui();if(c&&c.os==="iOS"){const u="livekit-dummy-audio-el";let h=document.getElementById(u);if(!h){h=document.createElement("audio"),h.id=u,h.autoplay=!0,h.hidden=!0;const f=dm();f.enabled=!0;const g=new MediaStream([f]);h.srcObject=g,document.addEventListener("visibilitychange",()=>{h&&(h.srcObject=document.hidden?null:g,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(h),this.once(ie.Disconnected,()=>{h?.remove(),h=null})}a.push(h)}this.remoteParticipants.forEach(u=>{u.audioTrackPublications.forEach(h=>{h.track&&h.track.attachedElements.forEach(f=>{a.push(f)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(u=>(u.muted=!1,u.play()))]),this.handleAudioPlaybackStarted()}catch(u){throw this.handleAudioPlaybackFailed(u),u}}),this.startVideo=()=>A(this,void 0,void 0,function*(){const a=[];for(const c of this.remoteParticipants.values())c.videoTrackPublications.forEach(u=>{var h;(h=u.track)===null||h===void 0||h.attachedElements.forEach(f=>{a.includes(f)||a.push(f)})});yield Promise.all(a.map(c=>c.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(c=>{c.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(ot.Reconnecting)&&this.emit(ie.Reconnecting)},this.handleSignalRestarted=a=>A(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(c){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:c}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(ot.Connected),this.emit(ie.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(c=>{var u;if(c.identity===this.localParticipant.identity){this.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(u=this.sidToIdentity.get(c.sid))!==null&&u!==void 0?u:"");let h=this.remoteParticipants.get(c.identity);c.state===al.DISCONNECTED?this.handleParticipantDisconnected(c.identity,h):h=this.getOrCreateParticipant(c.identity,c)})},this.handleActiveSpeakersUpdate=a=>{const c=[],u={};a.forEach(h=>{if(u[h.sid]=!0,h.sid===this.localParticipant.sid)this.localParticipant.audioLevel=h.level,this.localParticipant.setIsSpeaking(!0),c.push(this.localParticipant);else{const f=this.getRemoteParticipantBySid(h.sid);f&&(f.audioLevel=h.level,f.setIsSpeaking(!0),c.push(f))}}),u[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(h=>{u[h.sid]||(h.audioLevel=0,h.setIsSpeaking(!1))}),this.activeSpeakers=c,this.emitWhenConnected(ie.ActiveSpeakersChanged,c)},this.handleSpeakersChanged=a=>{const c=new Map;this.activeSpeakers.forEach(h=>{const f=this.remoteParticipants.get(h.identity);f&&f.sid!==h.sid||c.set(h.sid,h)}),a.forEach(h=>{let f=this.getRemoteParticipantBySid(h.sid);h.sid===this.localParticipant.sid&&(f=this.localParticipant),f&&(f.audioLevel=h.level,f.setIsSpeaking(h.active),h.active?c.set(h.sid,f):c.delete(h.sid))});const u=Array.from(c.values());u.sort((h,f)=>f.audioLevel-h.audioLevel),this.activeSpeakers=u,this.emitWhenConnected(ie.ActiveSpeakersChanged,u)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(c=>{const u=this.getRemoteParticipantBySid(c.participantSid);if(!u)return;const h=u.getTrackPublicationBySid(c.trackSid);if(!h||!h.track)return;const f=W.streamStateFromProto(c.state);h.track.setStreamState(f),f!==h.track.streamState&&(u.emit(fe.TrackStreamStateChanged,h,h.track.streamState),this.emitWhenConnected(ie.TrackStreamStateChanged,h,h.track.streamState,u))})},this.handleSubscriptionPermissionUpdate=a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(a.trackSid);u&&u.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const c=Array.from(this.remoteParticipants.values()).find(h=>h.trackPublications.has(a.trackSid));if(!c)return;const u=c.getTrackPublicationBySid(a.trackSid);u&&u.setSubscriptionError(a.err)},this.handleDataPacket=(a,c)=>{const u=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(u,a.value.value,a.kind,c);else if(a.value.case==="transcription")this.handleTranscription(u,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(u,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(u,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,u);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,c);else if(a.value.case==="rpcRequest"){const h=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(a,c,u,h)=>{this.emit(ie.DataReceived,c.payload,a,u,c.topic,h),a?.emit(fe.DataReceived,c.payload,u,h)},this.handleSipDtmf=(a,c)=>{this.emit(ie.SipDTMFReceived,c,a),a?.emit(fe.SipDTMFReceived,c)},this.handleTranscription=(a,c)=>{const u=c.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(c.transcribedParticipantIdentity),h=u?.trackPublications.get(c.trackId),f=DN(c,this.transcriptionReceivedTimes);h?.emit(le.TranscriptionReceived,f),u?.emit(fe.TranscriptionReceived,f,h),this.emit(ie.TranscriptionReceived,f,u,h)},this.handleChatMessage=(a,c)=>{const u=MN(c);this.emit(ie.ChatMessage,u,a)},this.handleMetrics=(a,c)=>{this.emit(ie.MetricsReceived,a,c)},this.handleDataStream=(a,c)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,c)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ie.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ie.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ie.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ie.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>A(this,void 0,void 0,function*(){var a;((a=ui())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(ie.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const c=this.roomInfo;this.roomInfo=a,c&&c.metadata!==a.metadata&&this.emitWhenConnected(ie.RoomMetadataChanged,a.metadata),c?.activeRecording!==a.activeRecording&&this.emitWhenConnected(ie.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(c=>{if(c.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(c.quality);return}const u=this.getRemoteParticipantBySid(c.participantSid);u&&u.setConnectionQuality(c.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(ie.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(ie.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(ie.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(ie.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(ie.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var c;(c=a?.onPublish)===null||c===void 0||c.call(a,this)},this.onLocalTrackPublished=a=>A(this,void 0,void 0,function*(){var c,u,h,f,g,v;(c=a.track)===null||c===void 0||c.on(le.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=a.track)===null||u===void 0||u.on(le.Restarted,this.onLocalTrackRestarted),(g=(f=(h=a.track)===null||h===void 0?void 0:h.getProcessor())===null||f===void 0?void 0:f.onPublish)===null||g===void 0||g.call(f,this),this.emit(ie.LocalTrackPublished,a,this.localParticipant),Kr(a.track)&&(yield a.track.checkForSilence())&&this.emit(ie.LocalAudioSilenceDetected,a);const w=yield(v=a.track)===null||v===void 0?void 0:v.getDeviceId(!1),k=gg(a.source);k&&w&&w!==this.localParticipant.activeDeviceMap.get(k)&&(this.localParticipant.activeDeviceMap.set(k,w),this.emit(ie.ActiveDeviceChanged,k,w))}),this.onLocalTrackUnpublished=a=>{var c,u;(c=a.track)===null||c===void 0||c.off(le.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=a.track)===null||u===void 0||u.off(le.Restarted,this.onLocalTrackRestarted),this.emit(ie.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>A(this,void 0,void 0,function*(){const c=yield a.getDeviceId(!1),u=gg(a.source);u&&c&&c!==this.localParticipant.activeDeviceMap.get(u)&&(this.log.debug("local track restarted, setting ".concat(u," ").concat(c," active"),this.logContext),this.localParticipant.activeDeviceMap.set(u,c),this.emit(ie.ActiveDeviceChanged,u,c))}),this.onLocalConnectionQualityChanged=a=>{this.emit(ie.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,c)=>{this.emit(ie.MediaDevicesError,a,c)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(ie.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(ie.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},pI),e),this.log=ts((i=this.options.loggerName)!==null&&i!==void 0?i:ir.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},MT),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},LT),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},fI),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new qI,this.outgoingDataStreamManager=new HI(this.engine,this.log),this.disconnectLock=new Kn,this.localParticipant=new tO("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ys(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ys(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Ys(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),ci()){const a=new AbortController;(o=navigator.mediaDevices)===null||o===void 0||o.addEventListener("devicechange",this.handleDeviceChange,{signal:a.signal}),yl.cleanupRegistry&&yl.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return A(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new YN(i,n),this.e2eeManager.on(Gs.ParticipantEncryptionStatusChanged,(r,o)=>{UN(o)&&(this.isE2EEEnabled=r),this.emit(ie.ParticipantEncryptionStatusChanged,r,o)}),this.e2eeManager.on(Gs.EncryptionError,(r,o)=>{const a=o?this.getParticipantByIdentity(o):void 0;this.emit(ie.EncryptionError,r,a)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return A(this,void 0,void 0,function*(){return this.state===ot.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(ue.RoomUpdate,i),e(r.sid))};this.engine.on(ue.RoomUpdate,i),this.once(ie.Disconnected,()=>{this.engine.off(ue.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new BI(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ue.ParticipantUpdate,this.handleParticipantUpdates).on(ue.RoomUpdate,this.handleRoomUpdate).on(ue.SpeakersChanged,this.handleSpeakersChanged).on(ue.StreamStateChanged,this.handleStreamStateUpdate).on(ue.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ue.SubscriptionError,this.handleSubscriptionError).on(ue.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ue.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(ue.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(ue.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ue.DataPacketReceived,this.handleDataPacket).on(ue.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ot.SignalReconnecting)&&this.emit(ie.SignalReconnecting)}).on(ue.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ot.Connected)&&this.emit(ie.Reconnected)}).on(ue.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ot.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ue.Restarting,this.handleRestarting).on(ue.SignalRestarted,this.handleSignalRestarted).on(ue.Offline,()=>{this.setAndEmitConnectionState(ot.Reconnecting)&&this.emit(ie.Reconnecting)}).on(ue.DCBufferStatusChanged,(e,n)=>{this.emit(ie.DCBufferStatusChanged,e,n)}).on(ue.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(fe.LocalTrackSubscribed,n),this.emitWhenConnected(ie.LocalTrackSubscribed,n,this.localParticipant)}).on(ue.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(ie.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return wn.getInstance().getDevices(e,n)}prepareConnection(e,n){return A(this,void 0,void 0,function*(){if(this.state===ot.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(vl(new URL(e))&&n){this.regionUrlProvider=new rt(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ot.Disconnected&&(this.regionUrl=i,yield fetch(Zc(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Zc(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return A(this,void 0,void 0,function*(){let i=()=>A(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new mr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new mr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new mr({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new mr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>A(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new mr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>A(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new mr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new mr({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>A(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new Hh({reason:nr.CLIENT_INITIATED,action:ll.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new mr({scenario:{case:"subscriberBandwidth",value:Fo(n)}});break;case"leave-full-reconnect":r=new mr({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return A(this,arguments,void 0,function(i,r){var o=this;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var c,u,h,f,g,v,w;let k=!0,x=!1;const C=a?{exact:r}:r;if(i==="audioinput"){x=o.localParticipant.audioTrackPublications.size===0;const E=(c=o.getActiveDevice(i))!==null&&c!==void 0?c:o.options.audioCaptureDefaults.deviceId;o.options.audioCaptureDefaults.deviceId=C;const I=Array.from(o.localParticipant.audioTrackPublications.values()).filter(P=>P.source===W.Source.Microphone);try{k=(yield Promise.all(I.map(P=>{var R;return(R=P.audioTrack)===null||R===void 0?void 0:R.setDeviceId(C)}))).every(P=>P===!0)}catch(P){throw o.options.audioCaptureDefaults.deviceId=E,P}const N=I.some(P=>{var R,j;return(j=(R=P.track)===null||R===void 0?void 0:R.isMuted)!==null&&j!==void 0?j:!1});k&&N&&(x=!0)}else if(i==="videoinput"){x=o.localParticipant.videoTrackPublications.size===0;const E=(u=o.getActiveDevice(i))!==null&&u!==void 0?u:o.options.videoCaptureDefaults.deviceId;o.options.videoCaptureDefaults.deviceId=C;const I=Array.from(o.localParticipant.videoTrackPublications.values()).filter(P=>P.source===W.Source.Camera);try{k=(yield Promise.all(I.map(P=>{var R;return(R=P.videoTrack)===null||R===void 0?void 0:R.setDeviceId(C)}))).every(P=>P===!0)}catch(P){throw o.options.videoCaptureDefaults.deviceId=E,P}const N=I.some(P=>{var R,j;return(j=(R=P.track)===null||R===void 0?void 0:R.isMuted)!==null&&j!==void 0?j:!1});k&&N&&(x=!0)}else if(i==="audiooutput"){if(x=!0,!bg()&&!o.options.webAudioMix||o.options.webAudioMix&&o.audioContext&&!("setSinkId"in o.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");o.options.webAudioMix&&(r=(h=yield wn.getInstance().normalizeDeviceId("audiooutput",r))!==null&&h!==void 0?h:""),(f=(w=o.options).audioOutput)!==null&&f!==void 0||(w.audioOutput={});const E=(g=o.getActiveDevice(i))!==null&&g!==void 0?g:o.options.audioOutput.deviceId;o.options.audioOutput.deviceId=r;try{o.options.webAudioMix&&((v=o.audioContext)===null||v===void 0||v.setSinkId(r)),yield Promise.all(Array.from(o.remoteParticipants.values()).map(I=>I.setAudioOutput({deviceId:r})))}catch(I){throw o.options.audioOutput.deviceId=E,I}}return x&&(o.localParticipant.activeDeviceMap.set(i,r),o.emit(ie.ActiveDeviceChanged,i,r)),k})()})}setupLocalParticipantEvents(){this.localParticipant.on(fe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(fe.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(fe.AttributesChanged,this.onLocalAttributesChanged).on(fe.TrackMuted,this.onLocalTrackMuted).on(fe.TrackUnmuted,this.onLocalTrackUnmuted).on(fe.LocalTrackPublished,this.onLocalTrackPublished).on(fe.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(fe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(fe.MediaDevicesError,this.onMediaDevicesError).on(fe.AudioStreamAcquired,this.startAudio).on(fe.ChatMessage,this.onLocalChatMessageSent).on(fe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ot.Connecting||this.state===ot.Reconnecting){const g=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(w=>w.id)}),this.onTrackAdded(e,n,i),v()},v=()=>{this.off(ie.Reconnected,g),this.off(ie.Connected,g),this.off(ie.Disconnected,v)};this.once(ie.Reconnected,g),this.once(ie.Connected,g),this.once(ie.Disconnected,v);return}if(this.state===ot.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=SN(n.id),o=r[0];let a=r[1],c=e.id;if(a&&a.startsWith("TR")&&(c=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const u=Array.from(this.remoteParticipants.values()).find(g=>g.sid===o);if(!u){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}if(!c.startsWith("TR")){const g=this.engine.getTrackIdForReceiver(i);if(!g){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(o),this.logContext);return}c=g}c.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(o,", streamId: ").concat(a,", trackId: ").concat(c),Object.assign(Object.assign({},this.logContext),{rpID:o,streamId:a,trackId:c}));let h;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?h=this.options.adaptiveStream:h={});const f=u.addSubscribedMediaTrack(e,c,n,i,h);f?.isEncrypted&&!this.e2eeManager&&this.emit(ie.EncryptionError,new Error("Encrypted ".concat(f.source," track received from participant ").concat(u.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==ot.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,c;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(c=r.track)===null||c===void 0||c.stopMonitor()}),this.localParticipant.off(fe.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(fe.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(fe.AttributesChanged,this.onLocalAttributesChanged).off(fe.TrackMuted,this.onLocalTrackMuted).off(fe.TrackUnmuted,this.onLocalTrackUnmuted).off(fe.LocalTrackPublished,this.onLocalTrackPublished).off(fe.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(fe.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(fe.MediaDevicesError,this.onMediaDevicesError).off(fe.AudioStreamAcquired,this.startAudio).off(fe.ChatMessage,this.onLocalChatMessageSent).off(fe.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ci()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ot.Disconnected),this.emit(ie.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(ie.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,o,a){return A(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),a!==1){yield this.engine.publishRpcResponse(e,n,null,Vt.builtIn("UNSUPPORTED_VERSION"));return}const c=this.rpcHandlers.get(i);if(!c){yield this.engine.publishRpcResponse(e,n,null,Vt.builtIn("UNSUPPORTED_METHOD"));return}let u=null,h=null;try{const f=yield c({requestId:n,callerIdentity:e,payload:r,responseTimeout:o});Iv(f)>FT?(u=Vt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):h=f}catch(f){f instanceof Vt?u=f:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),f),u=Vt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,h,u)})}selectDefaultDevices(){return A(this,void 0,void 0,function*(){var e,n,i;const r=wn.getInstance().previousDevices,o=yield wn.getInstance().getDevices(void 0,!1),a=ui();if(a?.name==="Chrome"&&a.os!=="iOS")for(let u of o){const h=r.find(f=>f.deviceId===u.deviceId);h&&h.label!==""&&h.kind===u.kind&&h.label!==u.label&&this.getActiveDevice(u.kind)==="default"&&this.emit(ie.ActiveDeviceChanged,u.kind,u.deviceId)}const c=["audiooutput","audioinput","videoinput"];for(let u of c){const h=pN(u),f=this.localParticipant.getTrackPublication(h);if(f&&(!((e=f.track)===null||e===void 0)&&e.isUserProvided))continue;const g=o.filter(w=>w.kind===u),v=this.getActiveDevice(u);if(v===((n=r.filter(w=>w.kind===u)[0])===null||n===void 0?void 0:n.deviceId)&&g.length>0&&((i=g[0])===null||i===void 0?void 0:i.deviceId)!==v){yield this.switchActiveDevice(u,g[0].deviceId);continue}u==="audioinput"&&!Xc()||u==="videoinput"||g.length>0&&!g.find(w=>w.deviceId===this.getActiveDevice(u))&&(u!=="audiooutput"||!Xc())&&(yield this.switchActiveDevice(u,g[0].deviceId))}})}acquireAudioContext(){return A(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=RT())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Nn(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(ie.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Ch.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Ch(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ie.ParticipantConnected,i),i.on(fe.TrackPublished,r=>{this.emitWhenConnected(ie.TrackPublished,r,i)}).on(fe.TrackSubscribed,(r,o)=>{r.kind===W.Kind.Audio?(r.on(le.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(le.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===W.Kind.Video&&(r.on(le.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(le.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ie.TrackSubscribed,r,o,i)}).on(fe.TrackUnpublished,r=>{this.emit(ie.TrackUnpublished,r,i)}).on(fe.TrackUnsubscribed,(r,o)=>{this.emit(ie.TrackUnsubscribed,r,o,i)}).on(fe.TrackMuted,r=>{this.emitWhenConnected(ie.TrackMuted,r,i)}).on(fe.TrackUnmuted,r=>{this.emitWhenConnected(ie.TrackUnmuted,r,i)}).on(fe.ParticipantMetadataChanged,r=>{this.emitWhenConnected(ie.ParticipantMetadataChanged,r,i)}).on(fe.ParticipantNameChanged,r=>{this.emitWhenConnected(ie.ParticipantNameChanged,r,i)}).on(fe.AttributesChanged,r=>{this.emitWhenConnected(ie.ParticipantAttributesChanged,r,i)}).on(fe.ConnectionQualityChanged,r=>{this.emitWhenConnected(ie.ConnectionQualityChanged,r,i)}).on(fe.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(ie.ParticipantPermissionsChanged,r,i)}).on(fe.TrackSubscriptionStatusChanged,(r,o)=>{this.emitWhenConnected(ie.TrackSubscriptionStatusChanged,r,o,i)}).on(fe.TrackSubscriptionFailed,(r,o)=>{this.emit(ie.TrackSubscriptionFailed,r,i,o)}).on(fe.TrackSubscriptionPermissionChanged,(r,o)=>{this.emitWhenConnected(ie.TrackSubscriptionPermissionChanged,r,o,i)}).on(fe.Active,()=>{this.emitWhenConnected(ie.ParticipantActive,i),i.kind===Jc.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&LN(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Rn.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,nr.STATE_MISMATCH))):e=0},iO)}clearConnectionReconcile(){this.connectionReconcileInterval&&Rn.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(ie.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ot.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ot.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return A(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new $h({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:_t.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Yo({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ie.SignalConnected),this.emit(ie.Connected),this.setAndEmitConnectionState(ot.Connected),r.video){const a=new _g(W.Kind.Video,new Qa({source:Xt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO,name:"video-dummy"}),new Th(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:kw(160*((n=o.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(fe.LocalTrackPublished,a)}if(r.audio){const a=new _g(W.Kind.Audio,new Qa({source:Xt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO}),new Sh(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:dm(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(fe.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let c=new Yo({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:al.ACTIVE,tracks:[],joinedAt:_t.parse(Date.now())});const u=this.getOrCreateParticipant(c.identity,c);if(o.video){const h=kw(160*((i=o.aspectRatios[a%o.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),f=new Qa({source:Xt.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO});u.addSubscribedMediaTrack(h,f.sid,new MediaStream([h]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}if(o.audio){const h=dm(),f=new Qa({source:Xt.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO});u.addSubscribedMediaTrack(h,f.sid,new MediaStream([h]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}u.updateInfo(c)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==ie.ActiveSpeakersChanged&&e!==ie.TranscriptionReceived){const o=HT(i).filter(a=>a!==void 0);(e===ie.TrackSubscribed||e===ie.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...i)}}yl.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function HT(t){return t.map(e=>{if(e)return Array.isArray(e)?HT(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Qi;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Qi||(Qi={}));class io extends Sr.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Qi.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new yl(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return A(this,void 0,void 0,function*(){if(this.status!==Qi.IDLE)throw Error("check is running already");this.setStatus(Qi.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Qi.SKIPPED&&this.setStatus(this.isSuccess()?Qi.SUCCESS:Qi.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return A(this,void 0,void 0,function*(){return this.room.state===ot.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return A(this,void 0,void 0,function*(){this.room&&this.room.state!==ot.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Qi.SKIPPED)}switchProtocol(e){return A(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(ie.Reconnecting,()=>{n=!0}),this.room.once(ie.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(o=>setTimeout(o,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Nn(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class rO extends io{get description(){return"Cloud regions"}perform(){return A(this,void 0,void 0,function*(){const e=new rt(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let o=0;o<3;o++){const a=yield e.getNextBestRegionUrl();if(!a)break;if(i.has(a))continue;i.add(a);const c=yield this.checkCloudRegion(a);this.appendMessage("".concat(c.region," RTT: ").concat(c.rtt,"ms, duration: ").concat(c.duration,"ms")),n.push(c)}n.sort((o,a)=>(o.duration-a.duration)*.5+(o.rtt-a.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return A(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const o=yield this.room.localParticipant.streamText({topic:"test"}),a=1e3,u=1e6/a,h="A".repeat(a),f=Date.now();for(let k=0;k<u;k++)yield o.write(h);yield o.close();const g=Date.now(),v=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),w={region:r,rtt:1e4,duration:g-f};return v?.forEach(k=>{k.type==="candidate-pair"&&k.nominated&&(w.rtt=k.currentRoundTripTime*1e3)}),yield this.disconnect(),w})}}const wm=1e4;class sO extends io{get description(){return"Connection via UDP vs TCP"}perform(){return A(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(wm/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(wm/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return A(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const o=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(o)};o();const c=n.captureStream(30).getVideoTracks()[0],h=(yield this.room.localParticipant.publishTrack(c,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,f={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},g=setInterval(()=>A(this,void 0,void 0,function*(){const v=yield h.getRTCStatsReport();v?.forEach(w=>{w.type==="outbound-rtp"?(f.packetsSent=w.packetsSent,f.qualityLimitationDurations=w.qualityLimitationDurations,f.bitrateTotal+=w.targetBitrate,f.count++):w.type==="remote-inbound-rtp"&&(f.packetsLost=w.packetsLost,f.rttTotal+=w.roundTripTime,f.jitterTotal+=w.jitter)})}),1e3);return yield new Promise(v=>setTimeout(v,wm)),clearInterval(g),c.stop(),n.remove(),yield this.disconnect(),f})}}class oO extends io{get description(){return"Can publish audio"}perform(){return A(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield XI();if(yield PT(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(c=>setTimeout(c,3e3));const o=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!o)throw new Error("Could not get RTCStats");let a=0;if(o.forEach(c=>{c.type==="outbound-rtp"&&(c.kind==="audio"||!c.kind&&c.mediaType==="audio")&&(a=c.packetsSent)}),a===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(a," audio packets"))})}}class aO extends io{get description(){return"Can publish video"}perform(){return A(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield QI();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="video"||!a.kind&&a.mediaType==="video")&&(o+=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}checkForVideo(e){return A(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var o,a,c,u;const h=document.createElement("canvas"),f=e.getSettings(),g=(a=(o=f.width)!==null&&o!==void 0?o:i.videoWidth)!==null&&a!==void 0?a:1280,v=(u=(c=f.height)!==null&&c!==void 0?c:i.videoHeight)!==null&&u!==void 0?u:720;h.width=g,h.height=v;const w=h.getContext("2d");w.drawImage(i,0,0);const x=w.getImageData(0,0,h.width,h.height).data;let C=!0;for(let E=0;E<x.length;E+=4)if(x[E]!==0||x[E+1]!==0||x[E+2]!==0){C=!1;break}C?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class lO extends io{get description(){return"Resuming connection after interruption"}perform(){return A(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,o;const a=new Promise(h=>{setTimeout(h,5e3),o=h}),c=()=>{i=!0};n.on(ie.SignalReconnecting,c).on(ie.Reconnecting,c).on(ie.Reconnected,()=>{r=!0,o(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const u=n.engine.client.onClose;if(u&&u(""),yield a,i){if(!r||n.state!==ot.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class cO extends io{get description(){return"Can connect via TURN"}perform(){return A(this,void 0,void 0,function*(){var e,n,i;vl(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new rt(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new _v,o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let a=!1,c=!1,u=!1;for(let h of o.iceServers)for(let f of h.urls)f.startsWith("turn:")?(c=!0,u=!0):f.startsWith("turns:")&&(c=!0,u=!0,a=!0),f.startsWith("stun:")&&(u=!0);u?c&&!a&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||c?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(h=>setTimeout(h,0)))})}}class uO extends io{get description(){return"Establishing WebRTC connection"}perform(){return A(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(ie.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(o,a)=>{if(o.candidate){const c=new RTCIceCandidate(o);let u="".concat(c.protocol," ").concat(c.address,":").concat(c.port," ").concat(c.type);c.address&&(dO(c.address)?u+=" (private)":c.protocol==="tcp"&&c.tcpType==="passive"?(e=!0,u+=" (passive)"):c.protocol==="udp"&&(n=!0)),this.appendMessage(u)}r&&r(o,a)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=o=>{o instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(o.errorCode," ").concat(o.errorText," ").concat(o.url))})});try{yield this.connect(),He.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function dO(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class hO extends io{get description(){return"Connecting to signal connection via WebSocket"}perform(){return A(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new _v,o;try{o=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1})}catch(a){if(vl(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(a.message,". Retrying with region fallback"));const u=yield new rt(this.url,this.token).getNextBestRegionUrl();u&&(o=yield r.join(u,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1}),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}o?(this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===OS.Cloud&&(!((n=o.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=o.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class h5 extends Sr.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Qi.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Qi.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return A(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=a=>{this.updateCheck(n,a)};i.on("update",r);const o=yield i.run();return i.off("update",r),o})}checkWebsocket(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(hO)})}checkWebRTC(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(uO)})}checkTURN(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(cO)})}checkReconnect(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(lO)})}checkPublishAudio(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(oO)})}checkPublishVideo(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(aO)})}checkConnectionProtocol(){return A(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(sO);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return A(this,void 0,void 0,function*(){return this.createAndRunCheck(rO)})}}function Ze(t,e,n){return(e=pO(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fO(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function pO(t){var e=fO(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Wn extends Error{constructor(e,n){var i;super(e,n),Ze(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}Ze(Wn,"code","ERR_JOSE_GENERIC");class mO extends Wn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ze(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ze(this,"claim",void 0),Ze(this,"reason",void 0),Ze(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ze(mO,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class gO extends Wn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),Ze(this,"code","ERR_JWT_EXPIRED"),Ze(this,"claim",void 0),Ze(this,"reason",void 0),Ze(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}Ze(gO,"code","ERR_JWT_EXPIRED");class vO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ze(vO,"code","ERR_JOSE_ALG_NOT_ALLOWED");class yO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ze(yO,"code","ERR_JOSE_NOT_SUPPORTED");class bO extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ze(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ze(bO,"code","ERR_JWE_DECRYPTION_FAILED");class wO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JWE_INVALID")}}Ze(wO,"code","ERR_JWE_INVALID");class kO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JWS_INVALID")}}Ze(kO,"code","ERR_JWS_INVALID");class xO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JWT_INVALID")}}Ze(xO,"code","ERR_JWT_INVALID");class SO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JWK_INVALID")}}Ze(SO,"code","ERR_JWK_INVALID");class TO extends Wn{constructor(){super(...arguments),Ze(this,"code","ERR_JWKS_INVALID")}}Ze(TO,"code","ERR_JWKS_INVALID");class CO extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ze(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ze(CO,"code","ERR_JWKS_NO_MATCHING_KEY");class _O extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ze(this,Symbol.asyncIterator,void 0),Ze(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ze(_O,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class EO extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ze(this,"code","ERR_JWKS_TIMEOUT")}}Ze(EO,"code","ERR_JWKS_TIMEOUT");class PO extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ze(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ze(PO,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function RO(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return S.useMemo(()=>i=>{e.forEach(r=>r(i))},e)}const Qh=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function xl(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function jv(t){return"nodeType"in t}function di(t){var e,n;return t?xl(t)?t:jv(t)&&(e=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?e:window:window}function Dv(t){const{Document:e}=di(t);return t instanceof e}function gu(t){return xl(t)?!1:t instanceof di(t).HTMLElement}function GT(t){return t instanceof di(t).SVGElement}function Sl(t){return t?xl(t)?t.document:jv(t)?Dv(t)?t:gu(t)||GT(t)?t.ownerDocument:document:document:document}const xr=Qh?S.useLayoutEffect:S.useEffect;function Mv(t){const e=S.useRef(t);return xr(()=>{e.current=t}),S.useCallback(function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e.current==null?void 0:e.current(...i)},[])}function NO(){const t=S.useRef(null),e=S.useCallback((i,r)=>{t.current=setInterval(i,r)},[]),n=S.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,n]}function eu(t,e){e===void 0&&(e=[t]);const n=S.useRef(t);return xr(()=>{n.current!==t&&(n.current=t)},e),n}function vu(t,e){const n=S.useRef();return S.useMemo(()=>{const i=t(n.current);return n.current=i,i},[...e])}function _h(t){const e=Mv(t),n=S.useRef(null),i=S.useCallback(r=>{r!==n.current&&e?.(r,n.current),n.current=r},[]);return[n,i]}function Eg(t){const e=S.useRef();return S.useEffect(()=>{e.current=t},[t]),e.current}let km={};function yu(t,e){return S.useMemo(()=>{if(e)return e;const n=km[t]==null?0:km[t]+1;return km[t]=n,t+"-"+n},[t,e])}function JT(t){return function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.reduce((o,a)=>{const c=Object.entries(a);for(const[u,h]of c){const f=o[u];f!=null&&(o[u]=f+t*h)}return o},{...e})}}const pl=JT(1),tu=JT(-1);function IO(t){return"clientX"in t&&"clientY"in t}function Lv(t){if(!t)return!1;const{KeyboardEvent:e}=di(t.target);return e&&t instanceof e}function OO(t){if(!t)return!1;const{TouchEvent:e}=di(t.target);return e&&t instanceof e}function Pg(t){if(OO(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:n}=t.touches[0];return{x:e,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:n}=t.changedTouches[0];return{x:e,y:n}}}return IO(t)?{x:t.clientX,y:t.clientY}:null}const nu=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:n}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:n}=t;return"scaleX("+e+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[nu.Translate.toString(t),nu.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:n,easing:i}=t;return e+" "+n+"ms "+i}}}),Kw="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function AO(t){return t.matches(Kw)?t:t.querySelector(Kw)}const jO={display:"none"};function DO(t){let{id:e,value:n}=t;return pt.createElement("div",{id:e,style:jO},n)}function MO(t){let{id:e,announcement:n,ariaLiveType:i="assertive"}=t;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return pt.createElement("div",{id:e,style:r,role:"status","aria-live":i,"aria-atomic":!0},n)}function LO(){const[t,e]=S.useState("");return{announce:S.useCallback(i=>{i!=null&&e(i)},[]),announcement:t}}const YT=S.createContext(null);function UO(t){const e=S.useContext(YT);S.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function FO(){const[t]=S.useState(()=>new Set),e=S.useCallback(i=>(t.add(i),()=>t.delete(i)),[t]);return[S.useCallback(i=>{let{type:r,event:o}=i;t.forEach(a=>{var c;return(c=a[r])==null?void 0:c.call(a,o)})},[t]),e]}const BO={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},VO={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:n}=t;return n?"Draggable item "+e.id+" was moved over droppable area "+n.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:n}=t;return n?"Draggable item "+e.id+" was dropped over droppable area "+n.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function zO(t){let{announcements:e=VO,container:n,hiddenTextDescribedById:i,screenReaderInstructions:r=BO}=t;const{announce:o,announcement:a}=LO(),c=yu("DndLiveRegion"),[u,h]=S.useState(!1);if(S.useEffect(()=>{h(!0)},[]),UO(S.useMemo(()=>({onDragStart(g){let{active:v}=g;o(e.onDragStart({active:v}))},onDragMove(g){let{active:v,over:w}=g;e.onDragMove&&o(e.onDragMove({active:v,over:w}))},onDragOver(g){let{active:v,over:w}=g;o(e.onDragOver({active:v,over:w}))},onDragEnd(g){let{active:v,over:w}=g;o(e.onDragEnd({active:v,over:w}))},onDragCancel(g){let{active:v,over:w}=g;o(e.onDragCancel({active:v,over:w}))}}),[o,e])),!u)return null;const f=pt.createElement(pt.Fragment,null,pt.createElement(DO,{id:i,value:r.draggable}),pt.createElement(MO,{id:c,announcement:a}));return n?Hs.createPortal(f,n):f}var cn;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(cn||(cn={}));function Eh(){}function Ww(t,e){return S.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function $O(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return S.useMemo(()=>[...e].filter(i=>i!=null),[...e])}const rr=Object.freeze({x:0,y:0});function QT(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function XT(t,e){let{data:{value:n}}=t,{data:{value:i}}=e;return n-i}function qO(t,e){let{data:{value:n}}=t,{data:{value:i}}=e;return i-n}function Hw(t){let{left:e,top:n,height:i,width:r}=t;return[{x:e,y:n},{x:e+r,y:n},{x:e,y:n+i},{x:e+r,y:n+i}]}function ZT(t,e){if(!t||t.length===0)return null;const[n]=t;return n[e]}function Gw(t,e,n){return e===void 0&&(e=t.left),n===void 0&&(n=t.top),{x:e+t.width*.5,y:n+t.height*.5}}const KO=t=>{let{collisionRect:e,droppableRects:n,droppableContainers:i}=t;const r=Gw(e,e.left,e.top),o=[];for(const a of i){const{id:c}=a,u=n.get(c);if(u){const h=QT(Gw(u),r);o.push({id:c,data:{droppableContainer:a,value:h}})}}return o.sort(XT)},WO=t=>{let{collisionRect:e,droppableRects:n,droppableContainers:i}=t;const r=Hw(e),o=[];for(const a of i){const{id:c}=a,u=n.get(c);if(u){const h=Hw(u),f=r.reduce((v,w,k)=>v+QT(h[k],w),0),g=Number((f/4).toFixed(4));o.push({id:c,data:{droppableContainer:a,value:g}})}}return o.sort(XT)};function HO(t,e){const n=Math.max(e.top,t.top),i=Math.max(e.left,t.left),r=Math.min(e.left+e.width,t.left+t.width),o=Math.min(e.top+e.height,t.top+t.height),a=r-i,c=o-n;if(i<r&&n<o){const u=e.width*e.height,h=t.width*t.height,f=a*c,g=f/(u+h-f);return Number(g.toFixed(4))}return 0}const GO=t=>{let{collisionRect:e,droppableRects:n,droppableContainers:i}=t;const r=[];for(const o of i){const{id:a}=o,c=n.get(a);if(c){const u=HO(c,e);u>0&&r.push({id:a,data:{droppableContainer:o,value:u}})}}return r.sort(qO)};function JO(t,e,n){return{...t,scaleX:e&&n?e.width/n.width:1,scaleY:e&&n?e.height/n.height:1}}function eC(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:rr}function YO(t){return function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r.reduce((a,c)=>({...a,top:a.top+t*c.y,bottom:a.bottom+t*c.y,left:a.left+t*c.x,right:a.right+t*c.x}),{...n})}}const QO=YO(1);function XO(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function ZO(t,e,n){const i=XO(e);if(!i)return t;const{scaleX:r,scaleY:o,x:a,y:c}=i,u=t.left-a-(1-r)*parseFloat(n),h=t.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),f=r?t.width/r:t.width,g=o?t.height/o:t.height;return{width:f,height:g,top:h,right:u+f,bottom:h+g,left:u}}const eA={ignoreTransform:!1};function Tl(t,e){e===void 0&&(e=eA);let n=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:h,transformOrigin:f}=di(t).getComputedStyle(t);h&&(n=ZO(n,h,f))}const{top:i,left:r,width:o,height:a,bottom:c,right:u}=n;return{top:i,left:r,width:o,height:a,bottom:c,right:u}}function Jw(t){return Tl(t,{ignoreTransform:!0})}function tA(t){const e=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:e,bottom:n,width:e,height:n}}function nA(t,e){return e===void 0&&(e=di(t).getComputedStyle(t)),e.position==="fixed"}function iA(t,e){e===void 0&&(e=di(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const o=e[r];return typeof o=="string"?n.test(o):!1})}function Xh(t,e){const n=[];function i(r){if(e!=null&&n.length>=e||!r)return n;if(Dv(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!gu(r)||GT(r)||n.includes(r))return n;const o=di(t).getComputedStyle(r);return r!==t&&iA(r,o)&&n.push(r),nA(r,o)?n:i(r.parentNode)}return t?i(t):n}function tC(t){const[e]=Xh(t,1);return e??null}function xm(t){return!Qh||!t?null:xl(t)?t:jv(t)?Dv(t)||t===Sl(t).scrollingElement?window:gu(t)?t:null:null}function nC(t){return xl(t)?t.scrollX:t.scrollLeft}function iC(t){return xl(t)?t.scrollY:t.scrollTop}function Rg(t){return{x:nC(t),y:iC(t)}}var yn;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(yn||(yn={}));function rC(t){return!Qh||!t?!1:t===document.scrollingElement}function sC(t){const e={x:0,y:0},n=rC(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},i={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},r=t.scrollTop<=e.y,o=t.scrollLeft<=e.x,a=t.scrollTop>=i.y,c=t.scrollLeft>=i.x;return{isTop:r,isLeft:o,isBottom:a,isRight:c,maxScroll:i,minScroll:e}}const rA={x:.2,y:.2};function sA(t,e,n,i,r){let{top:o,left:a,right:c,bottom:u}=n;i===void 0&&(i=10),r===void 0&&(r=rA);const{isTop:h,isBottom:f,isLeft:g,isRight:v}=sC(t),w={x:0,y:0},k={x:0,y:0},x={height:e.height*r.y,width:e.width*r.x};return!h&&o<=e.top+x.height?(w.y=yn.Backward,k.y=i*Math.abs((e.top+x.height-o)/x.height)):!f&&u>=e.bottom-x.height&&(w.y=yn.Forward,k.y=i*Math.abs((e.bottom-x.height-u)/x.height)),!v&&c>=e.right-x.width?(w.x=yn.Forward,k.x=i*Math.abs((e.right-x.width-c)/x.width)):!g&&a<=e.left+x.width&&(w.x=yn.Backward,k.x=i*Math.abs((e.left+x.width-a)/x.width)),{direction:w,speed:k}}function oA(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:e,left:n,right:i,bottom:r}=t.getBoundingClientRect();return{top:e,left:n,right:i,bottom:r,width:t.clientWidth,height:t.clientHeight}}function oC(t){return t.reduce((e,n)=>pl(e,Rg(n)),rr)}function aA(t){return t.reduce((e,n)=>e+nC(n),0)}function lA(t){return t.reduce((e,n)=>e+iC(n),0)}function cA(t,e){if(e===void 0&&(e=Tl),!t)return;const{top:n,left:i,bottom:r,right:o}=e(t);tC(t)&&(r<=0||o<=0||n>=window.innerHeight||i>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const uA=[["x",["left","right"],aA],["y",["top","bottom"],lA]];class Uv{constructor(e,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const i=Xh(n),r=oC(i);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,a,c]of uA)for(const u of a)Object.defineProperty(this,u,{get:()=>{const h=c(i),f=r[o]-h;return this.rect[u]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Mc{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var i;return(i=this.target)==null?void 0:i.removeEventListener(...n)})},this.target=e}add(e,n,i){var r;(r=this.target)==null||r.addEventListener(e,n,i),this.listeners.push([e,n,i])}}function dA(t){const{EventTarget:e}=di(t);return t instanceof e?t:Sl(t)}function Sm(t,e){const n=Math.abs(t.x),i=Math.abs(t.y);return typeof e=="number"?Math.sqrt(n**2+i**2)>e:"x"in e&&"y"in e?n>e.x&&i>e.y:"x"in e?n>e.x:"y"in e?i>e.y:!1}var Li;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Li||(Li={}));function Yw(t){t.preventDefault()}function hA(t){t.stopPropagation()}var tt;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(tt||(tt={}));const aC={start:[tt.Space,tt.Enter],cancel:[tt.Esc],end:[tt.Space,tt.Enter,tt.Tab]},fA=(t,e)=>{let{currentCoordinates:n}=e;switch(t.code){case tt.Right:return{...n,x:n.x+25};case tt.Left:return{...n,x:n.x-25};case tt.Down:return{...n,y:n.y+25};case tt.Up:return{...n,y:n.y-25}}};class Fv{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:n}}=e;this.props=e,this.listeners=new Mc(Sl(n)),this.windowListeners=new Mc(di(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Li.Resize,this.handleCancel),this.windowListeners.add(Li.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Li.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:n}=this.props,i=e.node.current;i&&cA(i),n(rr)}handleKeyDown(e){if(Lv(e)){const{active:n,context:i,options:r}=this.props,{keyboardCodes:o=aC,coordinateGetter:a=fA,scrollBehavior:c="smooth"}=r,{code:u}=e;if(o.end.includes(u)){this.handleEnd(e);return}if(o.cancel.includes(u)){this.handleCancel(e);return}const{collisionRect:h}=i.current,f=h?{x:h.left,y:h.top}:rr;this.referenceCoordinates||(this.referenceCoordinates=f);const g=a(e,{active:n,context:i.current,currentCoordinates:f});if(g){const v=tu(g,f),w={x:0,y:0},{scrollableAncestors:k}=i.current;for(const x of k){const C=e.code,{isTop:E,isRight:I,isLeft:N,isBottom:P,maxScroll:R,minScroll:j}=sC(x),U=oA(x),F={x:Math.min(C===tt.Right?U.right-U.width/2:U.right,Math.max(C===tt.Right?U.left:U.left+U.width/2,g.x)),y:Math.min(C===tt.Down?U.bottom-U.height/2:U.bottom,Math.max(C===tt.Down?U.top:U.top+U.height/2,g.y))},H=C===tt.Right&&!I||C===tt.Left&&!N,q=C===tt.Down&&!P||C===tt.Up&&!E;if(H&&F.x!==g.x){const Q=x.scrollLeft+v.x,ne=C===tt.Right&&Q<=R.x||C===tt.Left&&Q>=j.x;if(ne&&!v.y){x.scrollTo({left:Q,behavior:c});return}ne?w.x=x.scrollLeft-Q:w.x=C===tt.Right?x.scrollLeft-R.x:x.scrollLeft-j.x,w.x&&x.scrollBy({left:-w.x,behavior:c});break}else if(q&&F.y!==g.y){const Q=x.scrollTop+v.y,ne=C===tt.Down&&Q<=R.y||C===tt.Up&&Q>=j.y;if(ne&&!v.x){x.scrollTo({top:Q,behavior:c});return}ne?w.y=x.scrollTop-Q:w.y=C===tt.Down?x.scrollTop-R.y:x.scrollTop-j.y,w.y&&x.scrollBy({top:-w.y,behavior:c});break}}this.handleMove(e,pl(tu(g,this.referenceCoordinates),w))}}}handleMove(e,n){const{onMove:i}=this.props;e.preventDefault(),i(n)}handleEnd(e){const{onEnd:n}=this.props;e.preventDefault(),this.detach(),n()}handleCancel(e){const{onCancel:n}=this.props;e.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Fv.activators=[{eventName:"onKeyDown",handler:(t,e,n)=>{let{keyboardCodes:i=aC,onActivation:r}=e,{active:o}=n;const{code:a}=t.nativeEvent;if(i.start.includes(a)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),r?.({event:t.nativeEvent}),!0)}return!1}}];function Qw(t){return!!(t&&"distance"in t)}function Xw(t){return!!(t&&"delay"in t)}class Bv{constructor(e,n,i){var r;i===void 0&&(i=dA(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=n;const{event:o}=e,{target:a}=o;this.props=e,this.events=n,this.document=Sl(a),this.documentListeners=new Mc(this.document),this.listeners=new Mc(i),this.windowListeners=new Mc(di(a)),this.initialCoordinates=(r=Pg(o))!=null?r:rr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:n,bypassActivationConstraint:i}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Li.Resize,this.handleCancel),this.windowListeners.add(Li.DragStart,Yw),this.windowListeners.add(Li.VisibilityChange,this.handleCancel),this.windowListeners.add(Li.ContextMenu,Yw),this.documentListeners.add(Li.Keydown,this.handleKeydown),n){if(i!=null&&i({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Xw(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Qw(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,n){const{active:i,onPending:r}=this.props;r(i,e,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:e}=this,{onStart:n}=this.props;e&&(this.activated=!0,this.documentListeners.add(Li.Click,hA,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Li.SelectionChange,this.removeTextSelection),n(e))}handleMove(e){var n;const{activated:i,initialCoordinates:r,props:o}=this,{onMove:a,options:{activationConstraint:c}}=o;if(!r)return;const u=(n=Pg(e))!=null?n:rr,h=tu(r,u);if(!i&&c){if(Qw(c)){if(c.tolerance!=null&&Sm(h,c.tolerance))return this.handleCancel();if(Sm(h,c.distance))return this.handleStart()}if(Xw(c)&&Sm(h,c.tolerance))return this.handleCancel();this.handlePending(c,h);return}e.cancelable&&e.preventDefault(),a(u)}handleEnd(){const{onAbort:e,onEnd:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleCancel(){const{onAbort:e,onCancel:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleKeydown(e){e.code===tt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const pA={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Vv extends Bv{constructor(e){const{event:n}=e,i=Sl(n.target);super(e,pA,i)}}Vv.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:i}=e;return!n.isPrimary||n.button!==0?!1:(i?.({event:n}),!0)}}];const mA={move:{name:"mousemove"},end:{name:"mouseup"}};var Ng;(function(t){t[t.RightClick=2]="RightClick"})(Ng||(Ng={}));class gA extends Bv{constructor(e){super(e,mA,Sl(e.event.target))}}gA.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:i}=e;return n.button===Ng.RightClick?!1:(i?.({event:n}),!0)}}];const Tm={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class vA extends Bv{constructor(e){super(e,Tm)}static setup(){return window.addEventListener(Tm.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Tm.move.name,e)};function e(){}}}vA.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:i}=e;const{touches:r}=n;return r.length>1?!1:(i?.({event:n}),!0)}}];var Lc;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Lc||(Lc={}));var Ph;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ph||(Ph={}));function yA(t){let{acceleration:e,activator:n=Lc.Pointer,canScroll:i,draggingRect:r,enabled:o,interval:a=5,order:c=Ph.TreeOrder,pointerCoordinates:u,scrollableAncestors:h,scrollableAncestorRects:f,delta:g,threshold:v}=t;const w=wA({delta:g,disabled:!o}),[k,x]=NO(),C=S.useRef({x:0,y:0}),E=S.useRef({x:0,y:0}),I=S.useMemo(()=>{switch(n){case Lc.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Lc.DraggableRect:return r}},[n,r,u]),N=S.useRef(null),P=S.useCallback(()=>{const j=N.current;if(!j)return;const U=C.current.x*E.current.x,F=C.current.y*E.current.y;j.scrollBy(U,F)},[]),R=S.useMemo(()=>c===Ph.TreeOrder?[...h].reverse():h,[c,h]);S.useEffect(()=>{if(!o||!h.length||!I){x();return}for(const j of R){if(i?.(j)===!1)continue;const U=h.indexOf(j),F=f[U];if(!F)continue;const{direction:H,speed:q}=sA(j,F,I,e,v);for(const Q of["x","y"])w[Q][H[Q]]||(q[Q]=0,H[Q]=0);if(q.x>0||q.y>0){x(),N.current=j,k(P,a),C.current=q,E.current=H;return}}C.current={x:0,y:0},E.current={x:0,y:0},x()},[e,P,i,x,o,a,JSON.stringify(I),JSON.stringify(w),k,h,R,f,JSON.stringify(v)])}const bA={x:{[yn.Backward]:!1,[yn.Forward]:!1},y:{[yn.Backward]:!1,[yn.Forward]:!1}};function wA(t){let{delta:e,disabled:n}=t;const i=Eg(e);return vu(r=>{if(n||!i||!r)return bA;const o={x:Math.sign(e.x-i.x),y:Math.sign(e.y-i.y)};return{x:{[yn.Backward]:r.x[yn.Backward]||o.x===-1,[yn.Forward]:r.x[yn.Forward]||o.x===1},y:{[yn.Backward]:r.y[yn.Backward]||o.y===-1,[yn.Forward]:r.y[yn.Forward]||o.y===1}}},[n,e,i])}function kA(t,e){const n=e!=null?t.get(e):void 0,i=n?n.node.current:null;return vu(r=>{var o;return e==null?null:(o=i??r)!=null?o:null},[i,e])}function xA(t,e){return S.useMemo(()=>t.reduce((n,i)=>{const{sensor:r}=i,o=r.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,i)}));return[...n,...o]},[]),[t,e])}var iu;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(iu||(iu={}));var Ig;(function(t){t.Optimized="optimized"})(Ig||(Ig={}));const Zw=new Map;function SA(t,e){let{dragging:n,dependencies:i,config:r}=e;const[o,a]=S.useState(null),{frequency:c,measure:u,strategy:h}=r,f=S.useRef(t),g=C(),v=eu(g),w=S.useCallback(function(E){E===void 0&&(E=[]),!v.current&&a(I=>I===null?E:I.concat(E.filter(N=>!I.includes(N))))},[v]),k=S.useRef(null),x=vu(E=>{if(g&&!n)return Zw;if(!E||E===Zw||f.current!==t||o!=null){const I=new Map;for(let N of t){if(!N)continue;if(o&&o.length>0&&!o.includes(N.id)&&N.rect.current){I.set(N.id,N.rect.current);continue}const P=N.node.current,R=P?new Uv(u(P),P):null;N.rect.current=R,R&&I.set(N.id,R)}return I}return E},[t,o,n,g,u]);return S.useEffect(()=>{f.current=t},[t]),S.useEffect(()=>{g||w()},[n,g]),S.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),S.useEffect(()=>{g||typeof c!="number"||k.current!==null||(k.current=setTimeout(()=>{w(),k.current=null},c))},[c,g,w,...i]),{droppableRects:x,measureDroppableContainers:w,measuringScheduled:o!=null};function C(){switch(h){case iu.Always:return!1;case iu.BeforeDragging:return n;default:return!n}}}function lC(t,e){return vu(n=>t?n||(typeof e=="function"?e(t):t):null,[e,t])}function TA(t,e){return lC(t,e)}function CA(t){let{callback:e,disabled:n}=t;const i=Mv(e),r=S.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(i)},[i,n]);return S.useEffect(()=>()=>r?.disconnect(),[r]),r}function Zh(t){let{callback:e,disabled:n}=t;const i=Mv(e),r=S.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(i)},[n]);return S.useEffect(()=>()=>r?.disconnect(),[r]),r}function _A(t){return new Uv(Tl(t),t)}function ek(t,e,n){e===void 0&&(e=_A);const[i,r]=S.useState(null);function o(){r(u=>{if(!t)return null;if(t.isConnected===!1){var h;return(h=u??n)!=null?h:null}const f=e(t);return JSON.stringify(u)===JSON.stringify(f)?u:f})}const a=CA({callback(u){if(t)for(const h of u){const{type:f,target:g}=h;if(f==="childList"&&g instanceof HTMLElement&&g.contains(t)){o();break}}}}),c=Zh({callback:o});return xr(()=>{o(),t?(c?.observe(t),a?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),a?.disconnect())},[t]),i}function EA(t){const e=lC(t);return eC(t,e)}const tk=[];function PA(t){const e=S.useRef(t),n=vu(i=>t?i&&i!==tk&&t&&e.current&&t.parentNode===e.current.parentNode?i:Xh(t):tk,[t]);return S.useEffect(()=>{e.current=t},[t]),n}function RA(t){const[e,n]=S.useState(null),i=S.useRef(t),r=S.useCallback(o=>{const a=xm(o.target);a&&n(c=>c?(c.set(a,Rg(a)),new Map(c)):null)},[]);return S.useEffect(()=>{const o=i.current;if(t!==o){a(o);const c=t.map(u=>{const h=xm(u);return h?(h.addEventListener("scroll",r,{passive:!0}),[h,Rg(h)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),i.current=t}return()=>{a(t),a(o)};function a(c){c.forEach(u=>{const h=xm(u);h?.removeEventListener("scroll",r)})}},[r,t]),S.useMemo(()=>t.length?e?Array.from(e.values()).reduce((o,a)=>pl(o,a),rr):oC(t):rr,[t,e])}function nk(t,e){e===void 0&&(e=[]);const n=S.useRef(null);return S.useEffect(()=>{n.current=null},e),S.useEffect(()=>{const i=t!==rr;i&&!n.current&&(n.current=t),!i&&n.current&&(n.current=null)},[t]),n.current?tu(t,n.current):rr}function NA(t){S.useEffect(()=>{if(!Qh)return;const e=t.map(n=>{let{sensor:i}=n;return i.setup==null?void 0:i.setup()});return()=>{for(const n of e)n?.()}},t.map(e=>{let{sensor:n}=e;return n}))}function IA(t,e){return S.useMemo(()=>t.reduce((n,i)=>{let{eventName:r,handler:o}=i;return n[r]=a=>{o(a,e)},n},{}),[t,e])}function cC(t){return S.useMemo(()=>t?tA(t):null,[t])}const ik=[];function OA(t,e){e===void 0&&(e=Tl);const[n]=t,i=cC(n?di(n):null),[r,o]=S.useState(ik);function a(){o(()=>t.length?t.map(u=>rC(u)?i:new Uv(e(u),u)):ik)}const c=Zh({callback:a});return xr(()=>{c?.disconnect(),a(),t.forEach(u=>c?.observe(u))},[t]),r}function AA(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return gu(e)?e:t}function jA(t){let{measure:e}=t;const[n,i]=S.useState(null),r=S.useCallback(h=>{for(const{target:f}of h)if(gu(f)){i(g=>{const v=e(f);return g?{...g,width:v.width,height:v.height}:v});break}},[e]),o=Zh({callback:r}),a=S.useCallback(h=>{const f=AA(h);o?.disconnect(),f&&o?.observe(f),i(f?e(f):null)},[e,o]),[c,u]=_h(a);return S.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const DA=[{sensor:Vv,options:{}},{sensor:Fv,options:{}}],MA={current:{}},ch={draggable:{measure:Jw},droppable:{measure:Jw,strategy:iu.WhileDragging,frequency:Ig.Optimized},dragOverlay:{measure:Tl}};class Uc extends Map{get(e){var n;return e!=null&&(n=super.get(e))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:n}=e;return!n})}getNodeFor(e){var n,i;return(n=(i=this.get(e))==null?void 0:i.node.current)!=null?n:void 0}}const LA={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Uc,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Eh},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ch,measureDroppableContainers:Eh,windowRect:null,measuringScheduled:!1},UA={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Eh,draggableNodes:new Map,over:null,measureDroppableContainers:Eh},ef=S.createContext(UA),uC=S.createContext(LA);function FA(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Uc}}}function BA(t,e){switch(e.type){case cn.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case cn.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case cn.DragEnd:case cn.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case cn.RegisterDroppable:{const{element:n}=e,{id:i}=n,r=new Uc(t.droppable.containers);return r.set(i,n),{...t,droppable:{...t.droppable,containers:r}}}case cn.SetDroppableDisabled:{const{id:n,key:i,disabled:r}=e,o=t.droppable.containers.get(n);if(!o||i!==o.key)return t;const a=new Uc(t.droppable.containers);return a.set(n,{...o,disabled:r}),{...t,droppable:{...t.droppable,containers:a}}}case cn.UnregisterDroppable:{const{id:n,key:i}=e,r=t.droppable.containers.get(n);if(!r||i!==r.key)return t;const o=new Uc(t.droppable.containers);return o.delete(n),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function VA(t){let{disabled:e}=t;const{active:n,activatorEvent:i,draggableNodes:r}=S.useContext(ef),o=Eg(i),a=Eg(n?.id);return S.useEffect(()=>{if(!e&&!i&&o&&a!=null){if(!Lv(o)||document.activeElement===o.target)return;const c=r.get(a);if(!c)return;const{activatorNode:u,node:h}=c;if(!u.current&&!h.current)return;requestAnimationFrame(()=>{for(const f of[u.current,h.current]){if(!f)continue;const g=AO(f);if(g){g.focus();break}}})}},[i,e,r,a,o]),null}function zA(t,e){let{transform:n,...i}=e;return t!=null&&t.length?t.reduce((r,o)=>o({transform:r,...i}),n):n}function $A(t){return S.useMemo(()=>({draggable:{...ch.draggable,...t?.draggable},droppable:{...ch.droppable,...t?.droppable},dragOverlay:{...ch.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function qA(t){let{activeNode:e,measure:n,initialRect:i,config:r=!0}=t;const o=S.useRef(!1),{x:a,y:c}=typeof r=="boolean"?{x:r,y:r}:r;xr(()=>{if(!a&&!c||!e){o.current=!1;return}if(o.current||!i)return;const h=e?.node.current;if(!h||h.isConnected===!1)return;const f=n(h),g=eC(f,i);if(a||(g.x=0),c||(g.y=0),o.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const v=tC(h);v&&v.scrollBy({top:g.y,left:g.x})}},[e,a,c,i,n])}const dC=S.createContext({...rr,scaleX:1,scaleY:1});var zs;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(zs||(zs={}));const KA=S.memo(function(e){var n,i,r,o;let{id:a,accessibility:c,autoScroll:u=!0,children:h,sensors:f=DA,collisionDetection:g=GO,measuring:v,modifiers:w,...k}=e;const x=S.useReducer(BA,void 0,FA),[C,E]=x,[I,N]=FO(),[P,R]=S.useState(zs.Uninitialized),j=P===zs.Initialized,{draggable:{active:U,nodes:F,translate:H},droppable:{containers:q}}=C,Q=U!=null?F.get(U):null,ne=S.useRef({initial:null,translated:null}),Se=S.useMemo(()=>{var lt;return U!=null?{id:U,data:(lt=Q?.data)!=null?lt:MA,rect:ne}:null},[U,Q]),De=S.useRef(null),[Ke,de]=S.useState(null),[V,Z]=S.useState(null),he=eu(k,Object.values(k)),oe=yu("DndDescribedBy",a),L=S.useMemo(()=>q.getEnabled(),[q]),G=$A(v),{droppableRects:ke,measureDroppableContainers:Te,measuringScheduled:Ne}=SA(L,{dragging:j,dependencies:[H.x,H.y],config:G.droppable}),Ce=kA(F,U),qe=S.useMemo(()=>V?Pg(V):null,[V]),se=Ge(),_e=TA(Ce,G.draggable.measure);qA({activeNode:U!=null?F.get(U):null,config:se.layoutShiftCompensation,initialRect:_e,measure:G.draggable.measure});const Pe=ek(Ce,G.draggable.measure,_e),zt=ek(Ce?Ce.parentElement:null),mt=S.useRef({activatorEvent:null,active:null,activeNode:Ce,collisionRect:null,collisions:null,droppableRects:ke,draggableNodes:F,draggingNode:null,draggingNodeRect:null,droppableContainers:q,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Et=q.getNodeFor((n=mt.current.over)==null?void 0:n.id),wt=jA({measure:G.dragOverlay.measure}),kn=(i=wt.nodeRef.current)!=null?i:Ce,hi=j?(r=wt.rect)!=null?r:Pe:null,$t=!!(wt.nodeRef.current&&wt.rect),et=EA($t?null:Pe),Hn=cC(kn?di(kn):null),Zt=PA(j?Et??Ce:null),en=OA(Zt),be=zA(w,{transform:{x:H.x-et.x,y:H.y-et.y,scaleX:1,scaleY:1},activatorEvent:V,active:Se,activeNodeRect:Pe,containerNodeRect:zt,draggingNodeRect:hi,over:mt.current.over,overlayNodeRect:wt.rect,scrollableAncestors:Zt,scrollableAncestorRects:en,windowRect:Hn}),jt=qe?pl(qe,H):null,Gn=RA(Zt),xn=nk(Gn),Sn=nk(Gn,[Pe]),dn=pl(be,xn),Jn=hi?QO(hi,be):null,fi=Se&&Jn?g({active:Se,collisionRect:Jn,droppableRects:ke,droppableContainers:L,pointerCoordinates:jt}):null,Fi=ZT(fi,"id"),[kt,so]=S.useState(null),Cr=$t?be:pl(be,Sn),rs=JO(Cr,(o=kt?.rect)!=null?o:null,Pe),or=S.useRef(null),_r=S.useCallback((lt,tn)=>{let{sensor:Ht,options:xt}=tn;if(De.current==null)return;const nn=F.get(De.current);if(!nn)return;const rn=lt.nativeEvent,St=new Ht({active:De.current,activeNode:nn,event:rn,options:xt,context:mt,onAbort(dt){if(!F.get(dt))return;const{onDragAbort:Gt}=he.current,pi={id:dt};Gt?.(pi),I({type:"onDragAbort",event:pi})},onPending(dt,Yn,Gt,pi){if(!F.get(dt))return;const{onDragPending:hn}=he.current,In={id:dt,constraint:Yn,initialCoordinates:Gt,offset:pi};hn?.(In),I({type:"onDragPending",event:In})},onStart(dt){const Yn=De.current;if(Yn==null)return;const Gt=F.get(Yn);if(!Gt)return;const{onDragStart:pi}=he.current,Qn={activatorEvent:rn,active:{id:Yn,data:Gt.data,rect:ne}};Hs.unstable_batchedUpdates(()=>{pi?.(Qn),R(zs.Initializing),E({type:cn.DragStart,initialCoordinates:dt,active:Yn}),I({type:"onDragStart",event:Qn}),de(or.current),Z(rn)})},onMove(dt){E({type:cn.DragMove,coordinates:dt})},onEnd:_i(cn.DragEnd),onCancel:_i(cn.DragCancel)});or.current=St;function _i(dt){return async function(){const{active:Gt,collisions:pi,over:Qn,scrollAdjustedTranslate:hn}=mt.current;let In=null;if(Gt&&hn){const{cancelDrop:Fn}=he.current;In={activatorEvent:rn,active:Gt,collisions:pi,delta:hn,over:Qn},dt===cn.DragEnd&&typeof Fn=="function"&&await Promise.resolve(Fn(In))&&(dt=cn.DragCancel)}De.current=null,Hs.unstable_batchedUpdates(()=>{E({type:dt}),R(zs.Uninitialized),so(null),de(null),Z(null),or.current=null;const Fn=dt===cn.DragEnd?"onDragEnd":"onDragCancel";if(In){const Rr=he.current[Fn];Rr?.(In),I({type:Fn,event:In})}})}}},[F]),ss=S.useCallback((lt,tn)=>(Ht,xt)=>{const nn=Ht.nativeEvent,rn=F.get(xt);if(De.current!==null||!rn||nn.dndKit||nn.defaultPrevented)return;const St={active:rn};lt(Ht,tn.options,St)===!0&&(nn.dndKit={capturedBy:tn.sensor},De.current=xt,_r(Ht,tn))},[F,_r]),Er=xA(f,ss);NA(f),xr(()=>{Pe&&P===zs.Initializing&&R(zs.Initialized)},[Pe,P]),S.useEffect(()=>{const{onDragMove:lt}=he.current,{active:tn,activatorEvent:Ht,collisions:xt,over:nn}=mt.current;if(!tn||!Ht)return;const rn={active:tn,activatorEvent:Ht,collisions:xt,delta:{x:dn.x,y:dn.y},over:nn};Hs.unstable_batchedUpdates(()=>{lt?.(rn),I({type:"onDragMove",event:rn})})},[dn.x,dn.y]),S.useEffect(()=>{const{active:lt,activatorEvent:tn,collisions:Ht,droppableContainers:xt,scrollAdjustedTranslate:nn}=mt.current;if(!lt||De.current==null||!tn||!nn)return;const{onDragOver:rn}=he.current,St=xt.get(Fi),_i=St&&St.rect.current?{id:St.id,rect:St.rect.current,data:St.data,disabled:St.disabled}:null,dt={active:lt,activatorEvent:tn,collisions:Ht,delta:{x:nn.x,y:nn.y},over:_i};Hs.unstable_batchedUpdates(()=>{so(_i),rn?.(dt),I({type:"onDragOver",event:dt})})},[Fi]),xr(()=>{mt.current={activatorEvent:V,active:Se,activeNode:Ce,collisionRect:Jn,collisions:fi,droppableRects:ke,draggableNodes:F,draggingNode:kn,draggingNodeRect:hi,droppableContainers:q,over:kt,scrollableAncestors:Zt,scrollAdjustedTranslate:dn},ne.current={initial:hi,translated:Jn}},[Se,Ce,fi,Jn,F,kn,hi,ke,q,kt,Zt,dn]),yA({...se,delta:H,draggingRect:Jn,pointerCoordinates:jt,scrollableAncestors:Zt,scrollableAncestorRects:en});const Ci=S.useMemo(()=>({active:Se,activeNode:Ce,activeNodeRect:Pe,activatorEvent:V,collisions:fi,containerNodeRect:zt,dragOverlay:wt,draggableNodes:F,droppableContainers:q,droppableRects:ke,over:kt,measureDroppableContainers:Te,scrollableAncestors:Zt,scrollableAncestorRects:en,measuringConfiguration:G,measuringScheduled:Ne,windowRect:Hn}),[Se,Ce,Pe,V,fi,zt,wt,F,q,ke,kt,Te,Zt,en,G,Ne,Hn]),Pr=S.useMemo(()=>({activatorEvent:V,activators:Er,active:Se,activeNodeRect:Pe,ariaDescribedById:{draggable:oe},dispatch:E,draggableNodes:F,over:kt,measureDroppableContainers:Te}),[V,Er,Se,Pe,E,oe,F,kt,Te]);return pt.createElement(YT.Provider,{value:N},pt.createElement(ef.Provider,{value:Pr},pt.createElement(uC.Provider,{value:Ci},pt.createElement(dC.Provider,{value:rs},h)),pt.createElement(VA,{disabled:c?.restoreFocus===!1})),pt.createElement(zO,{...c,hiddenTextDescribedById:oe}));function Ge(){const lt=Ke?.autoScrollEnabled===!1,tn=typeof u=="object"?u.enabled===!1:u===!1,Ht=j&&!lt&&!tn;return typeof u=="object"?{...u,enabled:Ht}:{enabled:Ht}}}),WA=S.createContext(null),rk="button",HA="Draggable";function GA(t){let{id:e,data:n,disabled:i=!1,attributes:r}=t;const o=yu(HA),{activators:a,activatorEvent:c,active:u,activeNodeRect:h,ariaDescribedById:f,draggableNodes:g,over:v}=S.useContext(ef),{role:w=rk,roleDescription:k="draggable",tabIndex:x=0}=r??{},C=u?.id===e,E=S.useContext(C?dC:WA),[I,N]=_h(),[P,R]=_h(),j=IA(a,e),U=eu(n);xr(()=>(g.set(e,{id:e,key:o,node:I,activatorNode:P,data:U}),()=>{const H=g.get(e);H&&H.key===o&&g.delete(e)}),[g,e]);const F=S.useMemo(()=>({role:w,tabIndex:x,"aria-disabled":i,"aria-pressed":C&&w===rk?!0:void 0,"aria-roledescription":k,"aria-describedby":f.draggable}),[i,w,x,C,k,f.draggable]);return{active:u,activatorEvent:c,activeNodeRect:h,attributes:F,isDragging:C,listeners:i?void 0:j,node:I,over:v,setNodeRef:N,setActivatorNodeRef:R,transform:E}}function JA(){return S.useContext(uC)}const YA="Droppable",QA={timeout:25};function XA(t){let{data:e,disabled:n=!1,id:i,resizeObserverConfig:r}=t;const o=yu(YA),{active:a,dispatch:c,over:u,measureDroppableContainers:h}=S.useContext(ef),f=S.useRef({disabled:n}),g=S.useRef(!1),v=S.useRef(null),w=S.useRef(null),{disabled:k,updateMeasurementsFor:x,timeout:C}={...QA,...r},E=eu(x??i),I=S.useCallback(()=>{if(!g.current){g.current=!0;return}w.current!=null&&clearTimeout(w.current),w.current=setTimeout(()=>{h(Array.isArray(E.current)?E.current:[E.current]),w.current=null},C)},[C]),N=Zh({callback:I,disabled:k||!a}),P=S.useCallback((F,H)=>{N&&(H&&(N.unobserve(H),g.current=!1),F&&N.observe(F))},[N]),[R,j]=_h(P),U=eu(e);return S.useEffect(()=>{!N||!R.current||(N.disconnect(),g.current=!1,N.observe(R.current))},[R,N]),S.useEffect(()=>(c({type:cn.RegisterDroppable,element:{id:i,key:o,disabled:n,node:R,rect:v,data:U}}),()=>c({type:cn.UnregisterDroppable,key:o,id:i})),[i]),S.useEffect(()=>{n!==f.current.disabled&&(c({type:cn.SetDroppableDisabled,id:i,key:o,disabled:n}),f.current.disabled=n)},[i,o,n,c]),{active:a,rect:v,isOver:u?.id===i,node:R,over:u,setNodeRef:j}}function zv(t,e,n){const i=t.slice();return i.splice(n<0?i.length+n:n,0,i.splice(e,1)[0]),i}function ZA(t,e){return t.reduce((n,i,r)=>{const o=e.get(i);return o&&(n[r]=o),n},Array(t.length))}function jd(t){return t!==null&&t>=0}function ej(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function tj(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const hC=t=>{let{rects:e,activeIndex:n,overIndex:i,index:r}=t;const o=zv(e,i,n),a=e[r],c=o[r];return!c||!a?null:{x:c.left-a.left,y:c.top-a.top,scaleX:c.width/a.width,scaleY:c.height/a.height}},Dd={scaleX:1,scaleY:1},nj=t=>{var e;let{activeIndex:n,activeNodeRect:i,index:r,rects:o,overIndex:a}=t;const c=(e=o[n])!=null?e:i;if(!c)return null;if(r===n){const h=o[a];return h?{x:0,y:n<a?h.top+h.height-(c.top+c.height):h.top-c.top,...Dd}:null}const u=ij(o,r,n);return r>n&&r<=a?{x:0,y:-c.height-u,...Dd}:r<n&&r>=a?{x:0,y:c.height+u,...Dd}:{x:0,y:0,...Dd}};function ij(t,e,n){const i=t[e],r=t[e-1],o=t[e+1];return i?n<e?r?i.top-(r.top+r.height):o?o.top-(i.top+i.height):0:o?o.top-(i.top+i.height):r?i.top-(r.top+r.height):0:0}const fC="Sortable",pC=pt.createContext({activeIndex:-1,containerId:fC,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:hC,disabled:{draggable:!1,droppable:!1}});function rj(t){let{children:e,id:n,items:i,strategy:r=hC,disabled:o=!1}=t;const{active:a,dragOverlay:c,droppableRects:u,over:h,measureDroppableContainers:f}=JA(),g=yu(fC,n),v=c.rect!==null,w=S.useMemo(()=>i.map(j=>typeof j=="object"&&"id"in j?j.id:j),[i]),k=a!=null,x=a?w.indexOf(a.id):-1,C=h?w.indexOf(h.id):-1,E=S.useRef(w),I=!ej(w,E.current),N=C!==-1&&x===-1||I,P=tj(o);xr(()=>{I&&k&&f(w)},[I,w,k,f]),S.useEffect(()=>{E.current=w},[w]);const R=S.useMemo(()=>({activeIndex:x,containerId:g,disabled:P,disableTransforms:N,items:w,overIndex:C,useDragOverlay:v,sortedRects:ZA(w,u),strategy:r}),[x,g,P.draggable,P.droppable,N,w,C,u,v,r]);return pt.createElement(pC.Provider,{value:R},e)}const sj=t=>{let{id:e,items:n,activeIndex:i,overIndex:r}=t;return zv(n,i,r).indexOf(e)},oj=t=>{let{containerId:e,isSorting:n,wasDragging:i,index:r,items:o,newIndex:a,previousItems:c,previousContainerId:u,transition:h}=t;return!h||!i||c!==o&&r===a?!1:n?!0:a!==r&&e===u},aj={duration:200,easing:"ease"},mC="transform",lj=nu.Transition.toString({property:mC,duration:0,easing:"linear"}),cj={roleDescription:"sortable"};function uj(t){let{disabled:e,index:n,node:i,rect:r}=t;const[o,a]=S.useState(null),c=S.useRef(n);return xr(()=>{if(!e&&n!==c.current&&i.current){const u=r.current;if(u){const h=Tl(i.current,{ignoreTransform:!0}),f={x:u.left-h.left,y:u.top-h.top,scaleX:u.width/h.width,scaleY:u.height/h.height};(f.x||f.y)&&a(f)}}n!==c.current&&(c.current=n)},[e,n,i,r]),S.useEffect(()=>{o&&a(null)},[o]),o}function dj(t){let{animateLayoutChanges:e=oj,attributes:n,disabled:i,data:r,getNewIndex:o=sj,id:a,strategy:c,resizeObserverConfig:u,transition:h=aj}=t;const{items:f,containerId:g,activeIndex:v,disabled:w,disableTransforms:k,sortedRects:x,overIndex:C,useDragOverlay:E,strategy:I}=S.useContext(pC),N=hj(i,w),P=f.indexOf(a),R=S.useMemo(()=>({sortable:{containerId:g,index:P,items:f},...r}),[g,r,P,f]),j=S.useMemo(()=>f.slice(f.indexOf(a)),[f,a]),{rect:U,node:F,isOver:H,setNodeRef:q}=XA({id:a,data:R,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...u}}),{active:Q,activatorEvent:ne,activeNodeRect:Se,attributes:De,setNodeRef:Ke,listeners:de,isDragging:V,over:Z,setActivatorNodeRef:he,transform:oe}=GA({id:a,data:R,attributes:{...cj,...n},disabled:N.draggable}),L=RO(q,Ke),G=!!Q,ke=G&&!k&&jd(v)&&jd(C),Te=!E&&V,Ne=Te&&ke?oe:null,qe=ke?Ne??(c??I)({rects:x,activeNodeRect:Se,activeIndex:v,overIndex:C,index:P}):null,se=jd(v)&&jd(C)?o({id:a,items:f,activeIndex:v,overIndex:C}):P,_e=Q?.id,Pe=S.useRef({activeId:_e,items:f,newIndex:se,containerId:g}),zt=f!==Pe.current.items,mt=e({active:Q,containerId:g,isDragging:V,isSorting:G,id:a,index:P,items:f,newIndex:Pe.current.newIndex,previousItems:Pe.current.items,previousContainerId:Pe.current.containerId,transition:h,wasDragging:Pe.current.activeId!=null}),Et=uj({disabled:!mt,index:P,node:F,rect:U});return S.useEffect(()=>{G&&Pe.current.newIndex!==se&&(Pe.current.newIndex=se),g!==Pe.current.containerId&&(Pe.current.containerId=g),f!==Pe.current.items&&(Pe.current.items=f)},[G,se,g,f]),S.useEffect(()=>{if(_e===Pe.current.activeId)return;if(_e!=null&&Pe.current.activeId==null){Pe.current.activeId=_e;return}const kn=setTimeout(()=>{Pe.current.activeId=_e},50);return()=>clearTimeout(kn)},[_e]),{active:Q,activeIndex:v,attributes:De,data:R,rect:U,index:P,newIndex:se,items:f,isOver:H,isSorting:G,isDragging:V,listeners:de,node:F,overIndex:C,over:Z,setNodeRef:L,setActivatorNodeRef:he,setDroppableNodeRef:q,setDraggableNodeRef:Ke,transform:Et??qe,transition:wt()};function wt(){if(Et||zt&&Pe.current.newIndex===P)return lj;if(!(Te&&!Lv(ne)||!h)&&(G||mt))return nu.Transition.toString({...h,property:mC})}}function hj(t,e){var n,i;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(n=t?.draggable)!=null?n:e.draggable,droppable:(i=t?.droppable)!=null?i:e.droppable}}function Rh(t){if(!t)return!1;const e=t.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const fj=[tt.Down,tt.Right,tt.Up,tt.Left],pj=(t,e)=>{let{context:{active:n,collisionRect:i,droppableRects:r,droppableContainers:o,over:a,scrollableAncestors:c}}=e;if(fj.includes(t.code)){if(t.preventDefault(),!n||!i)return;const u=[];o.getEnabled().forEach(g=>{if(!g||g!=null&&g.disabled)return;const v=r.get(g.id);if(v)switch(t.code){case tt.Down:i.top<v.top&&u.push(g);break;case tt.Up:i.top>v.top&&u.push(g);break;case tt.Left:i.left>v.left&&u.push(g);break;case tt.Right:i.left<v.left&&u.push(g);break}});const h=WO({collisionRect:i,droppableRects:r,droppableContainers:u});let f=ZT(h,"id");if(f===a?.id&&h.length>1&&(f=h[1].id),f!=null){const g=o.get(n.id),v=o.get(f),w=v?r.get(v.id):null,k=v?.node.current;if(k&&w&&g&&v){const C=Xh(k).some((j,U)=>c[U]!==j),E=gC(g,v),I=mj(g,v),N=C||!E?{x:0,y:0}:{x:I?i.width-w.width:0,y:I?i.height-w.height:0},P={x:w.left,y:w.top};return N.x&&N.y?P:tu(P,N)}}}};function gC(t,e){return!Rh(t)||!Rh(e)?!1:t.data.current.sortable.containerId===e.data.current.sortable.containerId}function mj(t,e){return!Rh(t)||!Rh(e)||!gC(t,e)?!1:t.data.current.sortable.index<e.data.current.sortable.index}const Ko=({children:t,className:e=""})=>m.jsx("div",{className:`backdrop-blur-md bg-[#121217]/92 border border-white/[0.06] shadow-xl shadow-black/20 ${e}`,children:t}),Xr=({src:t,size:e="md",status:n,className:i="",onClick:r})=>{const o={sm:"w-8 h-8",md:"w-10 h-10",lg:"w-16 h-16",xl:"w-24 h-24",xxl:"w-32 h-32"},a={online:"bg-green-500",idle:"bg-yellow-500",dnd:"bg-red-500",invisible:"bg-zinc-500"};return m.jsxs("div",{onClick:r,className:`relative ${o[e]} ${i} cursor-pointer group flex-shrink-0`,children:[m.jsx("img",{src:t,className:"w-full h-full object-cover rounded-2xl border-2 border-transparent group-hover:border-white/20 transition-all"}),n&&m.jsx("div",{className:`absolute -bottom-1 -right-1 w-3.5 h-3.5 ${a[n]||"bg-zinc-500"} rounded-full border-2 border-[#121217] shadow-sm z-10`})]})},$v={log:(...t)=>{},error:(...t)=>{},warn:(...t)=>{},debug:(...t)=>{}};class gj{room=null;localStream=null;audioInputDevice=null;videoInputDevice=null;onParticipantConnected;onParticipantDisconnected;onTrackSubscribed;onTrackUnsubscribed;onLocalTrackPublished;async generateToken(e,n,i){try{const r="https://mzlpnbjubwdhfytwbvit.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16bHBuYmp1YndkaGZ5dHdidml0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MTY4ODUsImV4cCI6MjA4Mzk5Mjg4NX0.sB9IYsdmTpwNigX7TLyQeFllRNncmQWfQ8HNlHZrzbc",a=await fetch(`${r}/functions/v1/livekit-token`,{method:"POST",headers:{"Content-Type":"application/json",apikey:o,Authorization:`Bearer ${o}`},body:JSON.stringify({userId:e,roomName:n,userName:i})}),c=await a.text();let u=null;try{u=c?JSON.parse(c):null}catch{u=null}if(!a.ok){const h=u?.error||c||"Token oluturulamad";throw new Error(h)}if(!u?.token)throw new Error("Token yant geersiz");return{token:u.token,url:u?.url||""}}catch(r){throw new Error(r instanceof Error?r.message:"LiveKit token oluturulamad. Supabase Edge Function yaplandrmasn kontrol edin.")}}async joinRoom(e,n,i){if(this.room&&this.room.name===e)return this.room;this.room&&await this.leaveRoom();try{const{token:r,url:o}=await this.generateToken(n,e,i),a=o||void 0;if(!a)throw new Error("LiveKit URL eksik. VITE_LIVEKIT_URL ayarlayn veya Edge Function LIVEKIT_URL dndrsn.");const c=new yl({adaptiveStream:!0,dynacast:!0});return this.setupRoomListeners(c),await c.connect(a,r),await c.localParticipant.setName(i),this.room=c,await this.enableAudio(),c}catch(r){throw r}}async leaveRoom(){if(this.room)try{this.room.localParticipant.trackPublications.forEach(e=>{e.track&&e.track.stop()}),await this.room.disconnect(),this.room=null,this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null)}catch{}}async getAudioInputDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput").map(n=>({deviceId:n.deviceId,label:n.label||`Mikrofon ${n.deviceId.substring(0,8)}`,kind:n.kind}))}catch{return[]}}async getVideoInputDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput").map(n=>({deviceId:n.deviceId,label:n.label||`Kamera ${n.deviceId.substring(0,8)}`,kind:n.kind}))}catch{return[]}}async getAudioOutputDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audiooutput").map(n=>({deviceId:n.deviceId,label:n.label||`Hoparlr ${n.deviceId.substring(0,8)}`,kind:n.kind}))}catch{return[]}}async enableAudio(e=!0){if(this.room)try{if(e){const n={audio:this.audioInputDevice?{deviceId:{exact:this.audioInputDevice}}:!0},i=await navigator.mediaDevices.getUserMedia(n),r=i.getAudioTracks()[0];r&&(await this.room.localParticipant.publishTrack(r,{source:W.Source.Microphone}),this.localStream=i)}else{const n=this.room.localParticipant.getTrackPublication(W.Source.Microphone);n&&await this.room.localParticipant.unpublishTrack(n.track)}}catch(n){throw n}}async setMicrophoneEnabled(e){if(this.room)try{await this.room.localParticipant.setMicrophoneEnabled(e)}catch{await this.enableAudio(e)}}async enableVideo(e=!0){if(this.room)try{if(e){const n={video:this.videoInputDevice?{deviceId:{exact:this.videoInputDevice}}:{width:{ideal:1280},height:{ideal:720}}},r=(await navigator.mediaDevices.getUserMedia(n)).getVideoTracks()[0];r&&await this.room.localParticipant.publishTrack(r,{source:W.Source.Camera})}else{const n=this.room.localParticipant.getTrackPublication(W.Source.Camera);n&&await this.room.localParticipant.unpublishTrack(n.track)}}catch(n){throw n}}async setCameraEnabled(e){if(this.room)try{await this.room.localParticipant.setCameraEnabled(e)}catch{await this.enableVideo(e)}}async enableScreenShare(e=!0){if(this.room)try{if(e){const i=(await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1})).getVideoTracks()[0];if(i)await this.room.localParticipant.publishTrack(i,{source:W.Source.ScreenShare}),i.onended=()=>{this.enableScreenShare(!1)};else throw new Error("Ekran grnts alnamad")}else{const n=this.room.localParticipant.getTrackPublication(W.Source.ScreenShare);n?.track&&await this.room.localParticipant.unpublishTrack(n.track)}}catch(n){throw n}}async setScreenShareEnabled(e){if(this.room)try{await this.enableScreenShare(e)}catch(n){throw n}}async setDeafened(e){if(this.room)try{await this.setMicrophoneEnabled(!e),this.room.remoteParticipants.forEach(n=>{n.audioTrackPublications.forEach(i=>{i.track&&typeof i.track.setVolume=="function"&&i.track.setVolume(e?0:1)})})}catch{}}setRemoteVolumes(e,n){this.room&&this.room.remoteParticipants.forEach(i=>{typeof i.setVolume=="function"&&(i.setVolume(e,W.Source.Microphone),i.setVolume(n,W.Source.ScreenShareAudio))})}async setAudioInputDevice(e){if(this.audioInputDevice=e,this.room){const n=this.room.localParticipant.getTrackPublication(W.Source.Microphone);n&&n.isMuted===!1&&(await this.enableAudio(!1),await this.enableAudio(!0))}}async setVideoInputDevice(e){if(this.videoInputDevice=e,this.room){const n=this.room.localParticipant.getTrackPublication(W.Source.Camera);n&&n.isMuted===!1&&(await this.enableVideo(!1),await this.enableVideo(!0))}}async setAudioOutputDevice(e){this.room&&this.room.remoteParticipants.forEach(n=>{n.audioTrackPublications.forEach(i=>{if(i.track&&i.track instanceof MediaStreamTrack){const r=new Audio;r.srcObject=new MediaStream([i.track]),r.setSinkId&&r.setSinkId(e)}})})}setupRoomListeners(e){const n=(...i)=>$v.log(...i);e.on(ie.ParticipantConnected,i=>{n("Katlmc baland:",i.identity),this.onParticipantConnected&&this.onParticipantConnected(i)}),e.on(ie.ParticipantDisconnected,i=>{n("Katlmc ayrld:",i.identity),this.onParticipantDisconnected&&this.onParticipantDisconnected(i)}),e.on(ie.TrackSubscribed,(i,r,o)=>{n("Track abone olundu:",i.kind,o.identity),this.onTrackSubscribed&&this.onTrackSubscribed(i,r,o)}),e.on(ie.TrackUnsubscribed,(i,r,o)=>{n("Track abonelik iptal edildi:",i.kind,o.identity),this.onTrackUnsubscribed&&this.onTrackUnsubscribed(i,r,o)}),e.on(ie.LocalTrackPublished,(i,r)=>{n("Local track yaynland:",i.kind),this.onLocalTrackPublished&&this.onLocalTrackPublished(i,r)})}setOnParticipantConnected(e){this.onParticipantConnected=e}setOnParticipantDisconnected(e){this.onParticipantDisconnected=e}setOnTrackSubscribed(e){this.onTrackSubscribed=e}setOnTrackUnsubscribed(e){this.onTrackUnsubscribed=e}setOnLocalTrackPublished(e){this.onLocalTrackPublished=e}getRoom(){return this.room}getLocalStream(){return this.localStream}async cleanup(){await this.leaveRoom()}}const Ct=new gj,ru=({track:t,muted:e=!1,className:n="w-full h-full object-cover"})=>{const i=S.useRef(null);return S.useEffect(()=>{const r=i.current;if(!(!r||!t))return t.attach(r),()=>{t.detach(r)}},[t]),m.jsx("video",{ref:i,className:n,muted:e,playsInline:!0})},qv=S.createContext({});function Kv(t){const e=S.useRef(null);return e.current===null&&(e.current=t()),e.current}const tf=S.createContext(null),Wv=S.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class vj extends S.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function yj({children:t,isPresent:e}){const n=S.useId(),i=S.useRef(null),r=S.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=S.useContext(Wv);return S.useInsertionEffect(()=>{const{width:a,height:c,top:u,left:h}=r.current;if(e||!i.current||!a||!c)return;i.current.dataset.motionPopId=n;const f=document.createElement("style");return o&&(f.nonce=o),document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${c}px !important;
            top: ${u}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[e]),m.jsx(vj,{isPresent:e,childRef:i,sizeRef:r,children:S.cloneElement(t,{ref:i})})}const bj=({children:t,initial:e,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:o,mode:a})=>{const c=Kv(wj),u=S.useId(),h=S.useCallback(g=>{c.set(g,!0);for(const v of c.values())if(!v)return;i&&i()},[c,i]),f=S.useMemo(()=>({id:u,initial:e,isPresent:n,custom:r,onExitComplete:h,register:g=>(c.set(g,!1),()=>c.delete(g))}),o?[Math.random(),h]:[n,h]);return S.useMemo(()=>{c.forEach((g,v)=>c.set(v,!1))},[n]),S.useEffect(()=>{!n&&!c.size&&i&&i()},[n]),a==="popLayout"&&(t=m.jsx(yj,{isPresent:n,children:t})),m.jsx(tf.Provider,{value:f,children:t})};function wj(){return new Map}function vC(t=!0){const e=S.useContext(tf);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,o=S.useId();S.useEffect(()=>{t&&r(o)},[t]);const a=S.useCallback(()=>t&&i&&i(o),[o,i,t]);return!n&&i?[!1,a]:[!0]}const Md=t=>t.key||"";function sk(t){const e=[];return S.Children.forEach(t,n=>{S.isValidElement(n)&&e.push(n)}),e}const Hv=typeof window<"u",yC=Hv?S.useLayoutEffect:S.useEffect,ok=({children:t,custom:e,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:o="sync",propagate:a=!1})=>{const[c,u]=vC(a),h=S.useMemo(()=>sk(t),[t]),f=a&&!c?[]:h.map(Md),g=S.useRef(!0),v=S.useRef(h),w=Kv(()=>new Map),[k,x]=S.useState(h),[C,E]=S.useState(h);yC(()=>{g.current=!1,v.current=h;for(let P=0;P<C.length;P++){const R=Md(C[P]);f.includes(R)?w.delete(R):w.get(R)!==!0&&w.set(R,!1)}},[C,f.length,f.join("-")]);const I=[];if(h!==k){let P=[...h];for(let R=0;R<C.length;R++){const j=C[R],U=Md(j);f.includes(U)||(P.splice(R,0,j),I.push(j))}o==="wait"&&I.length&&(P=I),E(sk(P)),x(h);return}const{forceRender:N}=S.useContext(qv);return m.jsx(m.Fragment,{children:C.map(P=>{const R=Md(P),j=a&&!c?!1:h===C||f.includes(R),U=()=>{if(w.has(R))w.set(R,!0);else return;let F=!0;w.forEach(H=>{H||(F=!1)}),F&&(N?.(),E(v.current),a&&u?.(),i&&i())};return m.jsx(bj,{isPresent:j,initial:!g.current||n?void 0:!1,custom:j?void 0:e,presenceAffectsLayout:r,mode:o,onExitComplete:j?void 0:U,children:P},R)})})},Si=t=>t;let bC=Si;function Gv(t){let e;return()=>(e===void 0&&(e=t()),e)}const bl=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i},Zr=t=>t*1e3,es=t=>t/1e3,kj={useManualTiming:!1};function xj(t){let e=new Set,n=new Set,i=!1,r=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function c(h){o.has(h)&&(u.schedule(h),t()),h(a)}const u={schedule:(h,f=!1,g=!1)=>{const w=g&&i?e:n;return f&&o.add(h),w.has(h)||w.add(h),h},cancel:h=>{n.delete(h),o.delete(h)},process:h=>{if(a=h,i){r=!0;return}i=!0,[e,n]=[n,e],e.forEach(c),e.clear(),i=!1,r&&(r=!1,u.process(h))}};return u}const Ld=["read","resolveKeyframes","update","preRender","render","postRender"],Sj=40;function wC(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=Ld.reduce((E,I)=>(E[I]=xj(o),E),{}),{read:c,resolveKeyframes:u,update:h,preRender:f,render:g,postRender:v}=a,w=()=>{const E=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(E-r.timestamp,Sj),1),r.timestamp=E,r.isProcessing=!0,c.process(r),u.process(r),h.process(r),f.process(r),g.process(r),v.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(w))},k=()=>{n=!0,i=!0,r.isProcessing||t(w)};return{schedule:Ld.reduce((E,I)=>{const N=a[I];return E[I]=(P,R=!1,j=!1)=>(n||k(),N.schedule(P,R,j)),E},{}),cancel:E=>{for(let I=0;I<Ld.length;I++)a[Ld[I]].cancel(E)},state:r,steps:a}}const{schedule:bt,cancel:eo,state:Pn,steps:Cm}=wC(typeof requestAnimationFrame<"u"?requestAnimationFrame:Si,!0),kC=S.createContext({strict:!1}),ak={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},wl={};for(const t in ak)wl[t]={isEnabled:e=>ak[t].some(n=>!!e[n])};function Tj(t){for(const e in t)wl[e]={...wl[e],...t[e]}}const Cj=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Nh(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Cj.has(t)}let xC=t=>!Nh(t);function _j(t){t&&(xC=e=>e.startsWith("on")?!Nh(e):t(e))}try{_j(require("@emotion/is-prop-valid").default)}catch{}function Ej(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(xC(r)||n===!0&&Nh(r)||!e&&!Nh(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}function Pj(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...i)=>t(...i);return new Proxy(n,{get:(i,r)=>r==="create"?t:(e.has(r)||e.set(r,t(r)),e.get(r))})}const nf=S.createContext({});function su(t){return typeof t=="string"||Array.isArray(t)}function rf(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Jv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Yv=["initial",...Jv];function sf(t){return rf(t.animate)||Yv.some(e=>su(t[e]))}function SC(t){return!!(sf(t)||t.variants)}function Rj(t,e){if(sf(t)){const{initial:n,animate:i}=t;return{initial:n===!1||su(n)?n:void 0,animate:su(i)?i:void 0}}return t.inherit!==!1?e:{}}function Nj(t){const{initial:e,animate:n}=Rj(t,S.useContext(nf));return S.useMemo(()=>({initial:e,animate:n}),[lk(e),lk(n)])}function lk(t){return Array.isArray(t)?t.join(" "):t}const Ij=Symbol.for("motionComponentSymbol");function el(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function Oj(t,e,n){return S.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):el(n)&&(n.current=i))},[e])}const Qv=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Aj="framerAppearId",TC="data-"+Qv(Aj),{schedule:Xv}=wC(queueMicrotask,!1),CC=S.createContext({});function jj(t,e,n,i,r){var o,a;const{visualElement:c}=S.useContext(nf),u=S.useContext(kC),h=S.useContext(tf),f=S.useContext(Wv).reducedMotion,g=S.useRef(null);i=i||u.renderer,!g.current&&i&&(g.current=i(t,{visualState:e,parent:c,props:n,presenceContext:h,blockInitialAnimation:h?h.initial===!1:!1,reducedMotionConfig:f}));const v=g.current,w=S.useContext(CC);v&&!v.projection&&r&&(v.type==="html"||v.type==="svg")&&Dj(g.current,n,r,w);const k=S.useRef(!1);S.useInsertionEffect(()=>{v&&k.current&&v.update(n,h)});const x=n[TC],C=S.useRef(!!x&&!(!((o=window.MotionHandoffIsComplete)===null||o===void 0)&&o.call(window,x))&&((a=window.MotionHasOptimisedAnimation)===null||a===void 0?void 0:a.call(window,x)));return yC(()=>{v&&(k.current=!0,window.MotionIsMounted=!0,v.updateFeatures(),Xv.render(v.render),C.current&&v.animationState&&v.animationState.animateChanges())}),S.useEffect(()=>{v&&(!C.current&&v.animationState&&v.animationState.animateChanges(),C.current&&(queueMicrotask(()=>{var E;(E=window.MotionHandoffMarkAsComplete)===null||E===void 0||E.call(window,x)}),C.current=!1))}),v}function Dj(t,e,n,i){const{layoutId:r,layout:o,drag:a,dragConstraints:c,layoutScroll:u,layoutRoot:h}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:_C(t.parent)),t.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:!!a||c&&el(c),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,layoutScroll:u,layoutRoot:h})}function _C(t){if(t)return t.options.allowProjection!==!1?t.projection:_C(t.parent)}function Mj({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:i,Component:r}){var o,a;t&&Tj(t);function c(h,f){let g;const v={...S.useContext(Wv),...h,layoutId:Lj(h)},{isStatic:w}=v,k=Nj(h),x=i(h,w);if(!w&&Hv){Uj();const C=Fj(v);g=C.MeasureLayout,k.visualElement=jj(r,x,v,e,C.ProjectionNode)}return m.jsxs(nf.Provider,{value:k,children:[g&&k.visualElement?m.jsx(g,{visualElement:k.visualElement,...v}):null,n(r,h,Oj(x,k.visualElement,f),x,w,k.visualElement)]})}c.displayName=`motion.${typeof r=="string"?r:`create(${(a=(o=r.displayName)!==null&&o!==void 0?o:r.name)!==null&&a!==void 0?a:""})`}`;const u=S.forwardRef(c);return u[Ij]=r,u}function Lj({layoutId:t}){const e=S.useContext(qv).id;return e&&t!==void 0?e+"-"+t:t}function Uj(t,e){S.useContext(kC).strict}function Fj(t){const{drag:e,layout:n}=wl;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const Bj=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Zv(t){return typeof t!="string"||t.includes("-")?!1:!!(Bj.indexOf(t)>-1||/[A-Z]/u.test(t))}function ck(t){const e=[{},{}];return t?.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function e0(t,e,n,i){if(typeof e=="function"){const[r,o]=ck(i);e=e(n!==void 0?n:t.custom,r,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,o]=ck(i);e=e(n!==void 0?n:t.custom,r,o)}return e}const Og=t=>Array.isArray(t),Vj=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),zj=t=>Og(t)?t[t.length-1]||0:t,Un=t=>!!(t&&t.getVelocity);function uh(t){const e=Un(t)?t.get():t;return Vj(e)?e.toValue():e}function $j({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},i,r,o){const a={latestValues:qj(i,r,o,t),renderState:e()};return n&&(a.onMount=c=>n({props:i,current:c,...a}),a.onUpdate=c=>n(c)),a}const EC=t=>(e,n)=>{const i=S.useContext(nf),r=S.useContext(tf),o=()=>$j(t,e,i,r);return n?o():Kv(o)};function qj(t,e,n,i){const r={},o=i(t,{});for(const v in o)r[v]=uh(o[v]);let{initial:a,animate:c}=t;const u=sf(t),h=SC(t);e&&h&&!u&&t.inherit!==!1&&(a===void 0&&(a=e.initial),c===void 0&&(c=e.animate));let f=n?n.initial===!1:!1;f=f||a===!1;const g=f?c:a;if(g&&typeof g!="boolean"&&!rf(g)){const v=Array.isArray(g)?g:[g];for(let w=0;w<v.length;w++){const k=e0(t,v[w]);if(k){const{transitionEnd:x,transition:C,...E}=k;for(const I in E){let N=E[I];if(Array.isArray(N)){const P=f?N.length-1:0;N=N[P]}N!==null&&(r[I]=N)}for(const I in x)r[I]=x[I]}}}return r}const Cl=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ea=new Set(Cl),PC=t=>e=>typeof e=="string"&&e.startsWith(t),RC=PC("--"),Kj=PC("var(--"),t0=t=>Kj(t)?Wj.test(t.split("/*")[0].trim()):!1,Wj=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,NC=(t,e)=>e&&typeof t=="number"?e.transform(t):t,ns=(t,e,n)=>n>e?e:n<t?t:n,_l={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ou={..._l,transform:t=>ns(0,1,t)},Ud={..._l,default:1},bu=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Vs=bu("deg"),yr=bu("%"),Le=bu("px"),Hj=bu("vh"),Gj=bu("vw"),uk={...yr,parse:t=>yr.parse(t)/100,transform:t=>yr.transform(t*100)},Jj={borderWidth:Le,borderTopWidth:Le,borderRightWidth:Le,borderBottomWidth:Le,borderLeftWidth:Le,borderRadius:Le,radius:Le,borderTopLeftRadius:Le,borderTopRightRadius:Le,borderBottomRightRadius:Le,borderBottomLeftRadius:Le,width:Le,maxWidth:Le,height:Le,maxHeight:Le,top:Le,right:Le,bottom:Le,left:Le,padding:Le,paddingTop:Le,paddingRight:Le,paddingBottom:Le,paddingLeft:Le,margin:Le,marginTop:Le,marginRight:Le,marginBottom:Le,marginLeft:Le,backgroundPositionX:Le,backgroundPositionY:Le},Yj={rotate:Vs,rotateX:Vs,rotateY:Vs,rotateZ:Vs,scale:Ud,scaleX:Ud,scaleY:Ud,scaleZ:Ud,skew:Vs,skewX:Vs,skewY:Vs,distance:Le,translateX:Le,translateY:Le,translateZ:Le,x:Le,y:Le,z:Le,perspective:Le,transformPerspective:Le,opacity:ou,originX:uk,originY:uk,originZ:Le},dk={..._l,transform:Math.round},n0={...Jj,...Yj,zIndex:dk,size:Le,fillOpacity:ou,strokeOpacity:ou,numOctaves:dk},Qj={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Xj=Cl.length;function Zj(t,e,n){let i="",r=!0;for(let o=0;o<Xj;o++){const a=Cl[o],c=t[a];if(c===void 0)continue;let u=!0;if(typeof c=="number"?u=c===(a.startsWith("scale")?1:0):u=parseFloat(c)===0,!u||n){const h=NC(c,n0[a]);if(!u){r=!1;const f=Qj[a]||a;i+=`${f}(${h}) `}n&&(e[a]=h)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function i0(t,e,n){const{style:i,vars:r,transformOrigin:o}=t;let a=!1,c=!1;for(const u in e){const h=e[u];if(ea.has(u)){a=!0;continue}else if(RC(u)){r[u]=h;continue}else{const f=NC(h,n0[u]);u.startsWith("origin")?(c=!0,o[u]=f):i[u]=f}}if(e.transform||(a||n?i.transform=Zj(e,t.transform,n):i.transform&&(i.transform="none")),c){const{originX:u="50%",originY:h="50%",originZ:f=0}=o;i.transformOrigin=`${u} ${h} ${f}`}}const eD={offset:"stroke-dashoffset",array:"stroke-dasharray"},tD={offset:"strokeDashoffset",array:"strokeDasharray"};function nD(t,e,n=1,i=0,r=!0){t.pathLength=1;const o=r?eD:tD;t[o.offset]=Le.transform(-i);const a=Le.transform(e),c=Le.transform(n);t[o.array]=`${a} ${c}`}function hk(t,e,n){return typeof t=="string"?t:Le.transform(e+n*t)}function iD(t,e,n){const i=hk(e,t.x,t.width),r=hk(n,t.y,t.height);return`${i} ${r}`}function r0(t,{attrX:e,attrY:n,attrScale:i,originX:r,originY:o,pathLength:a,pathSpacing:c=1,pathOffset:u=0,...h},f,g){if(i0(t,h,g),f){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:v,style:w,dimensions:k}=t;v.transform&&(k&&(w.transform=v.transform),delete v.transform),k&&(r!==void 0||o!==void 0||w.transform)&&(w.transformOrigin=iD(k,r!==void 0?r:.5,o!==void 0?o:.5)),e!==void 0&&(v.x=e),n!==void 0&&(v.y=n),i!==void 0&&(v.scale=i),a!==void 0&&nD(v,a,c,u,!1)}const s0=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),IC=()=>({...s0(),attrs:{}}),o0=t=>typeof t=="string"&&t.toLowerCase()==="svg";function OC(t,{style:e,vars:n},i,r){Object.assign(t.style,e,r&&r.getProjectionStyles(i));for(const o in n)t.style.setProperty(o,n[o])}const AC=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jC(t,e,n,i){OC(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(AC.has(r)?r:Qv(r),e.attrs[r])}const Ih={};function rD(t){Object.assign(Ih,t)}function DC(t,{layout:e,layoutId:n}){return ea.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Ih[t]||t==="opacity")}function a0(t,e,n){var i;const{style:r}=t,o={};for(const a in r)(Un(r[a])||e.style&&Un(e.style[a])||DC(a,t)||((i=n?.getValue(a))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(o[a]=r[a]);return o}function MC(t,e,n){const i=a0(t,e,n);for(const r in t)if(Un(t[r])||Un(e[r])){const o=Cl.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[o]=t[r]}return i}function sD(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const fk=["x","y","width","height","cx","cy","r"],oD={useVisualState:EC({scrapeMotionValuesFromProps:MC,createRenderState:IC,onUpdate:({props:t,prevProps:e,current:n,renderState:i,latestValues:r})=>{if(!n)return;let o=!!t.drag;if(!o){for(const c in r)if(ea.has(c)){o=!0;break}}if(!o)return;let a=!e;if(e)for(let c=0;c<fk.length;c++){const u=fk[c];t[u]!==e[u]&&(a=!0)}a&&bt.read(()=>{sD(n,i),bt.render(()=>{r0(i,r,o0(n.tagName),t.transformTemplate),jC(n,i)})})}})},aD={useVisualState:EC({scrapeMotionValuesFromProps:a0,createRenderState:s0})};function LC(t,e,n){for(const i in e)!Un(e[i])&&!DC(i,n)&&(t[i]=e[i])}function lD({transformTemplate:t},e){return S.useMemo(()=>{const n=s0();return i0(n,e,t),Object.assign({},n.vars,n.style)},[e])}function cD(t,e){const n=t.style||{},i={};return LC(i,n,t),Object.assign(i,lD(t,e)),i}function uD(t,e){const n={},i=cD(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}function dD(t,e,n,i){const r=S.useMemo(()=>{const o=IC();return r0(o,e,o0(i),t.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};LC(o,t.style,t),r.style={...o,...r.style}}return r}function hD(t=!1){return(n,i,r,{latestValues:o},a)=>{const u=(Zv(n)?dD:uD)(i,o,a,n),h=Ej(i,typeof n=="string",t),f=n!==S.Fragment?{...h,...u,ref:r}:{},{children:g}=i,v=S.useMemo(()=>Un(g)?g.get():g,[g]);return S.createElement(n,{...f,children:v})}}function fD(t,e){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const a={...Zv(i)?oD:aD,preloadedFeatures:t,useRender:hD(r),createVisualElement:e,Component:i};return Mj(a)}}function UC(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function of(t,e,n){const i=t.getProps();return e0(i,e,n!==void 0?n:i.custom,t)}const pD=Gv(()=>window.ScrollTimeline!==void 0);class mD{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=n}attachTimeline(e,n){const i=this.animations.map(r=>{if(pD()&&r.attachTimeline)return r.attachTimeline(e);if(typeof n=="function")return n(r)});return()=>{i.forEach((r,o)=>{r&&r(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class gD extends mD{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function l0(t,e){return t?t[e]||t.default||t:void 0}const Ag=2e4;function FC(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<Ag;)e+=n,i=t.next(e);return e>=Ag?1/0:e}function c0(t){return typeof t=="function"}function pk(t,e){t.timeline=e,t.onfinish=null}const u0=t=>Array.isArray(t)&&typeof t[0]=="number",vD={linearEasing:void 0};function yD(t,e){const n=Gv(t);return()=>{var i;return(i=vD[e])!==null&&i!==void 0?i:n()}}const Oh=yD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),BC=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let o=0;o<r;o++)i+=t(bl(0,r-1,o))+", ";return`linear(${i.substring(0,i.length-2)})`};function VC(t){return!!(typeof t=="function"&&Oh()||!t||typeof t=="string"&&(t in jg||Oh())||u0(t)||Array.isArray(t)&&t.every(VC))}const Pc=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,jg={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Pc([0,.65,.55,1]),circOut:Pc([.55,0,1,.45]),backIn:Pc([.31,.01,.66,-.59]),backOut:Pc([.33,1.53,.69,.99])};function zC(t,e){if(t)return typeof t=="function"&&Oh()?BC(t,e):u0(t)?Pc(t):Array.isArray(t)?t.map(n=>zC(n,e)||jg.easeOut):jg[t]}const Gi={x:!1,y:!1};function $C(){return Gi.x||Gi.y}function bD(t,e,n){var i;if(t instanceof Element)return[t];if(typeof t=="string"){let r=document;const o=(i=void 0)!==null&&i!==void 0?i:r.querySelectorAll(t);return o?Array.from(o):[]}return Array.from(t)}function qC(t,e){const n=bD(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function mk(t){return e=>{e.pointerType==="touch"||$C()||t(e)}}function wD(t,e,n={}){const[i,r,o]=qC(t,n),a=mk(c=>{const{target:u}=c,h=e(c);if(typeof h!="function"||!u)return;const f=mk(g=>{h(g),u.removeEventListener("pointerleave",f)});u.addEventListener("pointerleave",f,r)});return i.forEach(c=>{c.addEventListener("pointerenter",a,r)}),o}const KC=(t,e)=>e?t===e?!0:KC(t,e.parentElement):!1,d0=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,kD=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function xD(t){return kD.has(t.tagName)||t.tabIndex!==-1}const Rc=new WeakSet;function gk(t){return e=>{e.key==="Enter"&&t(e)}}function _m(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const SD=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=gk(()=>{if(Rc.has(n))return;_m(n,"down");const r=gk(()=>{_m(n,"up")}),o=()=>_m(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function vk(t){return d0(t)&&!$C()}function TD(t,e,n={}){const[i,r,o]=qC(t,n),a=c=>{const u=c.currentTarget;if(!vk(c)||Rc.has(u))return;Rc.add(u);const h=e(c),f=(w,k)=>{window.removeEventListener("pointerup",g),window.removeEventListener("pointercancel",v),!(!vk(w)||!Rc.has(u))&&(Rc.delete(u),typeof h=="function"&&h(w,{success:k}))},g=w=>{f(w,n.useGlobalTarget||KC(u,w.target))},v=w=>{f(w,!1)};window.addEventListener("pointerup",g,r),window.addEventListener("pointercancel",v,r)};return i.forEach(c=>{!xD(c)&&c.getAttribute("tabindex")===null&&(c.tabIndex=0),(n.useGlobalTarget?window:c).addEventListener("pointerdown",a,r),c.addEventListener("focus",h=>SD(h,r),r)}),o}function CD(t){return t==="x"||t==="y"?Gi[t]?null:(Gi[t]=!0,()=>{Gi[t]=!1}):Gi.x||Gi.y?null:(Gi.x=Gi.y=!0,()=>{Gi.x=Gi.y=!1})}const WC=new Set(["width","height","top","left","right","bottom",...Cl]);let dh;function _D(){dh=void 0}const br={now:()=>(dh===void 0&&br.set(Pn.isProcessing||kj.useManualTiming?Pn.timestamp:performance.now()),dh),set:t=>{dh=t,queueMicrotask(_D)}};function h0(t,e){t.indexOf(e)===-1&&t.push(e)}function f0(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class p0{constructor(){this.subscriptions=[]}add(e){return h0(this.subscriptions,e),()=>f0(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let o=0;o<r;o++){const a=this.subscriptions[o];a&&a(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function HC(t,e){return e?t*(1e3/e):0}const yk=30,ED=t=>!isNaN(parseFloat(t));class PD{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const o=br.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=br.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=ED(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new p0);const i=this.events[e].add(n);return e==="change"?()=>{i(),bt.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=br.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>yk)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,yk);return HC(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function au(t,e){return new PD(t,e)}function RD(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,au(n))}function ND(t,e){const n=of(t,e);let{transitionEnd:i={},transition:r={},...o}=n||{};o={...o,...i};for(const a in o){const c=zj(o[a]);RD(t,a,c)}}function ID(t){return!!(Un(t)&&t.add)}function Dg(t,e){const n=t.getValue("willChange");if(ID(n))return n.add(e)}function GC(t){return t.props[TC]}const JC=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,OD=1e-7,AD=12;function jD(t,e,n,i,r){let o,a,c=0;do a=e+(n-e)/2,o=JC(a,i,r)-t,o>0?n=a:e=a;while(Math.abs(o)>OD&&++c<AD);return a}function wu(t,e,n,i){if(t===e&&n===i)return Si;const r=o=>jD(o,0,1,t,n);return o=>o===0||o===1?o:JC(r(o),e,i)}const YC=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,QC=t=>e=>1-t(1-e),XC=wu(.33,1.53,.69,.99),m0=QC(XC),ZC=YC(m0),e1=t=>(t*=2)<1?.5*m0(t):.5*(2-Math.pow(2,-10*(t-1))),g0=t=>1-Math.sin(Math.acos(t)),t1=QC(g0),n1=YC(g0),i1=t=>/^0[^.\s]+$/u.test(t);function DD(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||i1(t):!0}const Fc=t=>Math.round(t*1e5)/1e5,v0=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function MD(t){return t==null}const LD=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,y0=(t,e)=>n=>!!(typeof n=="string"&&LD.test(n)&&n.startsWith(t)||e&&!MD(n)&&Object.prototype.hasOwnProperty.call(n,e)),r1=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,o,a,c]=i.match(v0);return{[t]:parseFloat(r),[e]:parseFloat(o),[n]:parseFloat(a),alpha:c!==void 0?parseFloat(c):1}},UD=t=>ns(0,255,t),Em={..._l,transform:t=>Math.round(UD(t))},Wo={test:y0("rgb","red"),parse:r1("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+Em.transform(t)+", "+Em.transform(e)+", "+Em.transform(n)+", "+Fc(ou.transform(i))+")"};function FD(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const Mg={test:y0("#"),parse:FD,transform:Wo.transform},tl={test:y0("hsl","hue"),parse:r1("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+yr.transform(Fc(e))+", "+yr.transform(Fc(n))+", "+Fc(ou.transform(i))+")"},Ln={test:t=>Wo.test(t)||Mg.test(t)||tl.test(t),parse:t=>Wo.test(t)?Wo.parse(t):tl.test(t)?tl.parse(t):Mg.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Wo.transform(t):tl.transform(t)},BD=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function VD(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(v0))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(BD))===null||n===void 0?void 0:n.length)||0)>0}const s1="number",o1="color",zD="var",$D="var(",bk="${}",qD=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function lu(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const c=e.replace(qD,u=>(Ln.test(u)?(i.color.push(o),r.push(o1),n.push(Ln.parse(u))):u.startsWith($D)?(i.var.push(o),r.push(zD),n.push(u)):(i.number.push(o),r.push(s1),n.push(parseFloat(u))),++o,bk)).split(bk);return{values:n,split:c,indexes:i,types:r}}function a1(t){return lu(t).values}function l1(t){const{split:e,types:n}=lu(t),i=e.length;return r=>{let o="";for(let a=0;a<i;a++)if(o+=e[a],r[a]!==void 0){const c=n[a];c===s1?o+=Fc(r[a]):c===o1?o+=Ln.transform(r[a]):o+=r[a]}return o}}const KD=t=>typeof t=="number"?0:t;function WD(t){const e=a1(t);return l1(t)(e.map(KD))}const to={test:VD,parse:a1,createTransformer:l1,getAnimatableNone:WD},HD=new Set(["brightness","contrast","saturate","opacity"]);function GD(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(v0)||[];if(!i)return t;const r=n.replace(i,"");let o=HD.has(e)?1:0;return i!==n&&(o*=100),e+"("+o+r+")"}const JD=/\b([a-z-]*)\(.*?\)/gu,Lg={...to,getAnimatableNone:t=>{const e=t.match(JD);return e?e.map(GD).join(" "):t}},YD={...n0,color:Ln,backgroundColor:Ln,outlineColor:Ln,fill:Ln,stroke:Ln,borderColor:Ln,borderTopColor:Ln,borderRightColor:Ln,borderBottomColor:Ln,borderLeftColor:Ln,filter:Lg,WebkitFilter:Lg},b0=t=>YD[t];function c1(t,e){let n=b0(t);return n!==Lg&&(n=to),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const QD=new Set(["auto","none","0"]);function XD(t,e,n){let i=0,r;for(;i<t.length&&!r;){const o=t[i];typeof o=="string"&&!QD.has(o)&&lu(o).values.length&&(r=t[i]),i++}if(r&&n)for(const o of e)t[o]=c1(n,r)}const wk=t=>t===_l||t===Le,kk=(t,e)=>parseFloat(t.split(", ")[e]),xk=(t,e)=>(n,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return kk(r[1],e);{const o=i.match(/^matrix\((.+)\)$/u);return o?kk(o[1],t):0}},ZD=new Set(["x","y","z"]),eM=Cl.filter(t=>!ZD.has(t));function tM(t){const e=[];return eM.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const kl={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:xk(4,13),y:xk(5,14)};kl.translateX=kl.x;kl.translateY=kl.y;const Jo=new Set;let Ug=!1,Fg=!1;function u1(){if(Fg){const t=Array.from(Jo).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=tM(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([o,a])=>{var c;(c=i.getValue(o))===null||c===void 0||c.set(a)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}Fg=!1,Ug=!1,Jo.forEach(t=>t.complete()),Jo.clear()}function d1(){Jo.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Fg=!0)})}function nM(){d1(),u1()}class w0{constructor(e,n,i,r,o,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=o,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Jo.add(this),Ug||(Ug=!0,bt.read(d1),bt.resolveKeyframes(u1))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;for(let o=0;o<e.length;o++)if(e[o]===null)if(o===0){const a=r?.get(),c=e[e.length-1];if(a!==void 0)e[0]=a;else if(i&&n){const u=i.readValue(n,c);u!=null&&(e[0]=u)}e[0]===void 0&&(e[0]=c),r&&a===void 0&&r.set(e[0])}else e[o]=e[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Jo.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Jo.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const h1=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),iM=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function rM(t){const e=iM.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function f1(t,e,n=1){const[i,r]=rM(t);if(!i)return;const o=window.getComputedStyle(e).getPropertyValue(i);if(o){const a=o.trim();return h1(a)?parseFloat(a):a}return t0(r)?f1(r,e,n+1):r}const p1=t=>e=>e.test(t),sM={test:t=>t==="auto",parse:t=>t},m1=[_l,Le,yr,Vs,Gj,Hj,sM],Sk=t=>m1.find(p1(t));class g1 extends w0{constructor(e,n,i,r,o){super(e,n,i,r,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let h=e[u];if(typeof h=="string"&&(h=h.trim(),t0(h))){const f=f1(h,n.current);f!==void 0&&(e[u]=f),u===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!WC.has(i)||e.length!==2)return;const[r,o]=e,a=Sk(r),c=Sk(o);if(a!==c)if(wk(a)&&wk(c))for(let u=0;u<e.length;u++){const h=e[u];typeof h=="string"&&(e[u]=parseFloat(h))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)DD(e[r])&&i.push(r);i.length&&XD(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=kl[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:i,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const o=n.getValue(i);o&&o.jump(this.measuredOrigin,!1);const a=r.length-1,c=r[a];r[a]=kl[i](n.measureViewportBox(),window.getComputedStyle(n.current)),c!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=c),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([u,h])=>{n.getValue(u).set(h)}),this.resolveNoneKeyframes()}}const Tk=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(to.test(t)||t==="0")&&!t.startsWith("url("));function oM(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function aM(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=Tk(r,e),c=Tk(o,e);return!a||!c?!1:oM(t)||(n==="spring"||c0(n))&&i}const lM=t=>t!==null;function af(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(lM),o=e&&n!=="loop"&&e%2===1?0:r.length-1;return!o||i===void 0?r[o]:i}const cM=40;class v1{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:a="loop",...c}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=br.now(),this.options={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:o,repeatType:a,...c},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>cM?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&nM(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=br.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:o,delay:a,onComplete:c,onUpdate:u,isGenerator:h}=this.options;if(!h&&!aM(e,i,r,o))if(a)this.options.duration=0;else{u&&u(af(e,this.options,n)),c&&c(),this.resolveFinishedPromise();return}const f=this.initPlayback(e,n);f!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...f},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const At=(t,e,n)=>t+(e-t)*n;function Pm(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function uM({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,o=0,a=0;if(!e)r=o=a=n;else{const c=n<.5?n*(1+e):n+e-n*e,u=2*n-c;r=Pm(u,c,t+1/3),o=Pm(u,c,t),a=Pm(u,c,t-1/3)}return{red:Math.round(r*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:i}}function Ah(t,e){return n=>n>0?e:t}const Rm=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},dM=[Mg,Wo,tl],hM=t=>dM.find(e=>e.test(t));function Ck(t){const e=hM(t);if(!e)return!1;let n=e.parse(t);return e===tl&&(n=uM(n)),n}const _k=(t,e)=>{const n=Ck(t),i=Ck(e);if(!n||!i)return Ah(t,e);const r={...n};return o=>(r.red=Rm(n.red,i.red,o),r.green=Rm(n.green,i.green,o),r.blue=Rm(n.blue,i.blue,o),r.alpha=At(n.alpha,i.alpha,o),Wo.transform(r))},fM=(t,e)=>n=>e(t(n)),ku=(...t)=>t.reduce(fM),Bg=new Set(["none","hidden"]);function pM(t,e){return Bg.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function mM(t,e){return n=>At(t,e,n)}function k0(t){return typeof t=="number"?mM:typeof t=="string"?t0(t)?Ah:Ln.test(t)?_k:yM:Array.isArray(t)?y1:typeof t=="object"?Ln.test(t)?_k:gM:Ah}function y1(t,e){const n=[...t],i=n.length,r=t.map((o,a)=>k0(o)(o,e[a]));return o=>{for(let a=0;a<i;a++)n[a]=r[a](o);return n}}function gM(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=k0(t[r])(t[r],e[r]));return r=>{for(const o in i)n[o]=i[o](r);return n}}function vM(t,e){var n;const i=[],r={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const a=e.types[o],c=t.indexes[a][r[a]],u=(n=t.values[c])!==null&&n!==void 0?n:0;i[o]=u,r[a]++}return i}const yM=(t,e)=>{const n=to.createTransformer(e),i=lu(t),r=lu(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?Bg.has(t)&&!r.values.length||Bg.has(e)&&!i.values.length?pM(t,e):ku(y1(vM(i,r),r.values),n):Ah(t,e)};function b1(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?At(t,e,n):k0(t)(t,e)}const bM=5;function w1(t,e,n){const i=Math.max(e-bM,0);return HC(n-t(i),e-i)}const Ft={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Nm=.001;function wM({duration:t=Ft.duration,bounce:e=Ft.bounce,velocity:n=Ft.velocity,mass:i=Ft.mass}){let r,o,a=1-e;a=ns(Ft.minDamping,Ft.maxDamping,a),t=ns(Ft.minDuration,Ft.maxDuration,es(t)),a<1?(r=h=>{const f=h*a,g=f*t,v=f-n,w=Vg(h,a),k=Math.exp(-g);return Nm-v/w*k},o=h=>{const g=h*a*t,v=g*n+n,w=Math.pow(a,2)*Math.pow(h,2)*t,k=Math.exp(-g),x=Vg(Math.pow(h,2),a);return(-r(h)+Nm>0?-1:1)*((v-w)*k)/x}):(r=h=>{const f=Math.exp(-h*t),g=(h-n)*t+1;return-Nm+f*g},o=h=>{const f=Math.exp(-h*t),g=(n-h)*(t*t);return f*g});const c=5/t,u=xM(r,o,c);if(t=Zr(t),isNaN(u))return{stiffness:Ft.stiffness,damping:Ft.damping,duration:t};{const h=Math.pow(u,2)*i;return{stiffness:h,damping:a*2*Math.sqrt(i*h),duration:t}}}const kM=12;function xM(t,e,n){let i=n;for(let r=1;r<kM;r++)i=i-t(i)/e(i);return i}function Vg(t,e){return t*Math.sqrt(1-e*e)}const SM=["duration","bounce"],TM=["stiffness","damping","mass"];function Ek(t,e){return e.some(n=>t[n]!==void 0)}function CM(t){let e={velocity:Ft.velocity,stiffness:Ft.stiffness,damping:Ft.damping,mass:Ft.mass,isResolvedFromDuration:!1,...t};if(!Ek(t,TM)&&Ek(t,SM))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,o=2*ns(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:Ft.mass,stiffness:r,damping:o}}else{const n=wM(t);e={...e,...n,mass:Ft.mass},e.isResolvedFromDuration=!0}return e}function k1(t=Ft.visualDuration,e=Ft.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],c={done:!1,value:o},{stiffness:u,damping:h,mass:f,duration:g,velocity:v,isResolvedFromDuration:w}=CM({...n,velocity:-es(n.velocity||0)}),k=v||0,x=h/(2*Math.sqrt(u*f)),C=a-o,E=es(Math.sqrt(u/f)),I=Math.abs(C)<5;i||(i=I?Ft.restSpeed.granular:Ft.restSpeed.default),r||(r=I?Ft.restDelta.granular:Ft.restDelta.default);let N;if(x<1){const R=Vg(E,x);N=j=>{const U=Math.exp(-x*E*j);return a-U*((k+x*E*C)/R*Math.sin(R*j)+C*Math.cos(R*j))}}else if(x===1)N=R=>a-Math.exp(-E*R)*(C+(k+E*C)*R);else{const R=E*Math.sqrt(x*x-1);N=j=>{const U=Math.exp(-x*E*j),F=Math.min(R*j,300);return a-U*((k+x*E*C)*Math.sinh(F)+R*C*Math.cosh(F))/R}}const P={calculatedDuration:w&&g||null,next:R=>{const j=N(R);if(w)c.done=R>=g;else{let U=0;x<1&&(U=R===0?Zr(k):w1(N,R,j));const F=Math.abs(U)<=i,H=Math.abs(a-j)<=r;c.done=F&&H}return c.value=c.done?a:j,c},toString:()=>{const R=Math.min(FC(P),Ag),j=BC(U=>P.next(R*U).value,R,30);return R+"ms "+j}};return P}function Pk({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:o=500,modifyTarget:a,min:c,max:u,restDelta:h=.5,restSpeed:f}){const g=t[0],v={done:!1,value:g},w=F=>c!==void 0&&F<c||u!==void 0&&F>u,k=F=>c===void 0?u:u===void 0||Math.abs(c-F)<Math.abs(u-F)?c:u;let x=n*e;const C=g+x,E=a===void 0?C:a(C);E!==C&&(x=E-g);const I=F=>-x*Math.exp(-F/i),N=F=>E+I(F),P=F=>{const H=I(F),q=N(F);v.done=Math.abs(H)<=h,v.value=v.done?E:q};let R,j;const U=F=>{w(v.value)&&(R=F,j=k1({keyframes:[v.value,k(v.value)],velocity:w1(N,F,v.value),damping:r,stiffness:o,restDelta:h,restSpeed:f}))};return U(0),{calculatedDuration:null,next:F=>{let H=!1;return!j&&R===void 0&&(H=!0,P(F),U(F)),R!==void 0&&F>=R?j.next(F-R):(!H&&P(F),v)}}}const _M=wu(.42,0,1,1),EM=wu(0,0,.58,1),x1=wu(.42,0,.58,1),PM=t=>Array.isArray(t)&&typeof t[0]!="number",RM={linear:Si,easeIn:_M,easeInOut:x1,easeOut:EM,circIn:g0,circInOut:n1,circOut:t1,backIn:m0,backInOut:ZC,backOut:XC,anticipate:e1},Rk=t=>{if(u0(t)){bC(t.length===4);const[e,n,i,r]=t;return wu(e,n,i,r)}else if(typeof t=="string")return RM[t];return t};function NM(t,e,n){const i=[],r=n||b1,o=t.length-1;for(let a=0;a<o;a++){let c=r(t[a],t[a+1]);if(e){const u=Array.isArray(e)?e[a]||Si:e;c=ku(u,c)}i.push(c)}return i}function IM(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const o=t.length;if(bC(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const c=NM(e,i,r),u=c.length,h=f=>{if(a&&f<t[0])return e[0];let g=0;if(u>1)for(;g<t.length-2&&!(f<t[g+1]);g++);const v=bl(t[g],t[g+1],f);return c[g](v)};return n?f=>h(ns(t[0],t[o-1],f)):h}function OM(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=bl(0,e,i);t.push(At(n,1,r))}}function AM(t){const e=[0];return OM(e,t.length-1),e}function jM(t,e){return t.map(n=>n*e)}function DM(t,e){return t.map(()=>e||x1).splice(0,t.length-1)}function jh({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=PM(i)?i.map(Rk):Rk(i),o={done:!1,value:e[0]},a=jM(n&&n.length===e.length?n:AM(e),t),c=IM(a,e,{ease:Array.isArray(r)?r:DM(e,r)});return{calculatedDuration:t,next:u=>(o.value=c(u),o.done=u>=t,o)}}const MM=t=>{const e=({timestamp:n})=>t(n);return{start:()=>bt.update(e,!0),stop:()=>eo(e),now:()=>Pn.isProcessing?Pn.timestamp:br.now()}},LM={decay:Pk,inertia:Pk,tween:jh,keyframes:jh,spring:k1},UM=t=>t/100;class x0 extends v1{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:u}=this.options;u&&u()};const{name:n,motionValue:i,element:r,keyframes:o}=this.options,a=r?.KeyframeResolver||w0,c=(u,h)=>this.onKeyframesResolved(u,h);this.resolver=new a(o,c,n,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:o,velocity:a=0}=this.options,c=c0(n)?n:LM[n]||jh;let u,h;c!==jh&&typeof e[0]!="number"&&(u=ku(UM,b1(e[0],e[1])),e=[0,100]);const f=c({...this.options,keyframes:e});o==="mirror"&&(h=c({...this.options,keyframes:[...e].reverse(),velocity:-a})),f.calculatedDuration===null&&(f.calculatedDuration=FC(f));const{calculatedDuration:g}=f,v=g+r,w=v*(i+1)-r;return{generator:f,mirroredGenerator:h,mapPercentToKeyframes:u,calculatedDuration:g,resolvedDuration:v,totalDuration:w}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:i}=this;if(!i){const{keyframes:F}=this.options;return{done:!0,value:F[F.length-1]}}const{finalKeyframe:r,generator:o,mirroredGenerator:a,mapPercentToKeyframes:c,keyframes:u,calculatedDuration:h,totalDuration:f,resolvedDuration:g}=i;if(this.startTime===null)return o.next(0);const{delay:v,repeat:w,repeatType:k,repeatDelay:x,onUpdate:C}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-f/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const E=this.currentTime-v*(this.speed>=0?1:-1),I=this.speed>=0?E<0:E>f;this.currentTime=Math.max(E,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=f);let N=this.currentTime,P=o;if(w){const F=Math.min(this.currentTime,f)/g;let H=Math.floor(F),q=F%1;!q&&F>=1&&(q=1),q===1&&H--,H=Math.min(H,w+1),H%2&&(k==="reverse"?(q=1-q,x&&(q-=x/g)):k==="mirror"&&(P=a)),N=ns(0,1,q)*g}const R=I?{done:!1,value:u[0]}:P.next(N);c&&(R.value=c(R.value));let{done:j}=R;!I&&h!==null&&(j=this.speed>=0?this.currentTime>=f:this.currentTime<=0);const U=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return U&&r!==void 0&&(R.value=af(u,this.options,r)),C&&C(R.value),U&&this.finish(),R}get duration(){const{resolved:e}=this;return e?es(e.calculatedDuration):0}get time(){return es(this.currentTime)}set time(e){e=Zr(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=es(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=MM,onPlay:n,startTime:i}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),n&&n();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const FM=new Set(["opacity","clipPath","filter","transform"]);function BM(t,e,n,{delay:i=0,duration:r=300,repeat:o=0,repeatType:a="loop",ease:c="easeInOut",times:u}={}){const h={[e]:n};u&&(h.offset=u);const f=zC(c,r);return Array.isArray(f)&&(h.easing=f),t.animate(h,{delay:i,duration:r,easing:Array.isArray(f)?"linear":f,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"})}const VM=Gv(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Dh=10,zM=2e4;function $M(t){return c0(t.type)||t.type==="spring"||!VC(t.ease)}function qM(t,e){const n=new x0({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:t[0]};const r=[];let o=0;for(;!i.done&&o<zM;)i=n.sample(o),r.push(i.value),o+=Dh;return{times:void 0,keyframes:r,duration:o-Dh,ease:"linear"}}const S1={anticipate:e1,backInOut:ZC,circInOut:n1};function KM(t){return t in S1}class Nk extends v1{constructor(e){super(e);const{name:n,motionValue:i,element:r,keyframes:o}=this.options;this.resolver=new g1(o,(a,c)=>this.onKeyframesResolved(a,c),n,i,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:i=300,times:r,ease:o,type:a,motionValue:c,name:u,startTime:h}=this.options;if(!c.owner||!c.owner.current)return!1;if(typeof o=="string"&&Oh()&&KM(o)&&(o=S1[o]),$M(this.options)){const{onComplete:g,onUpdate:v,motionValue:w,element:k,...x}=this.options,C=qM(e,x);e=C.keyframes,e.length===1&&(e[1]=e[0]),i=C.duration,r=C.times,o=C.ease,a="keyframes"}const f=BM(c.owner.current,u,e,{...this.options,duration:i,times:r,ease:o});return f.startTime=h??this.calcStartTime(),this.pendingTimeline?(pk(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:g}=this.options;c.set(af(e,this.options,n)),g&&g(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:i,times:r,type:a,ease:o,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return es(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return es(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.currentTime=Zr(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return Si;const{animation:i}=n;pk(i,e)}return Si}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:i,duration:r,type:o,ease:a,times:c}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:h,onUpdate:f,onComplete:g,element:v,...w}=this.options,k=new x0({...w,keyframes:i,duration:r,type:o,ease:a,times:c,isGenerator:!0}),x=Zr(this.time);h.setWithVelocity(k.sample(x-Dh).value,k.sample(x).value,Dh)}const{onStop:u}=this.options;u&&u(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:i,repeatDelay:r,repeatType:o,damping:a,type:c}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:h}=n.owner.getProps();return VM()&&i&&FM.has(i)&&!u&&!h&&!r&&o!=="mirror"&&a!==0&&c!=="inertia"}}const WM={type:"spring",stiffness:500,damping:25,restSpeed:10},HM=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),GM={type:"keyframes",duration:.8},JM={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},YM=(t,{keyframes:e})=>e.length>2?GM:ea.has(t)?t.startsWith("scale")?HM(e[1]):WM:JM;function QM({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:o,repeatType:a,repeatDelay:c,from:u,elapsed:h,...f}){return!!Object.keys(f).length}const S0=(t,e,n,i={},r,o)=>a=>{const c=l0(i,t)||{},u=c.delay||i.delay||0;let{elapsed:h=0}=i;h=h-Zr(u);let f={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...c,delay:-h,onUpdate:v=>{e.set(v),c.onUpdate&&c.onUpdate(v)},onComplete:()=>{a(),c.onComplete&&c.onComplete()},name:t,motionValue:e,element:o?void 0:r};QM(c)||(f={...f,...YM(t,f)}),f.duration&&(f.duration=Zr(f.duration)),f.repeatDelay&&(f.repeatDelay=Zr(f.repeatDelay)),f.from!==void 0&&(f.keyframes[0]=f.from);let g=!1;if((f.type===!1||f.duration===0&&!f.repeatDelay)&&(f.duration=0,f.delay===0&&(g=!0)),g&&!o&&e.get()!==void 0){const v=af(f.keyframes,c);if(v!==void 0)return bt.update(()=>{f.onUpdate(v),f.onComplete()}),new gD([])}return!o&&Nk.supports(f)?new Nk(f):new x0(f)};function XM({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function T1(t,e,{delay:n=0,transitionOverride:i,type:r}={}){var o;let{transition:a=t.getDefaultTransition(),transitionEnd:c,...u}=e;i&&(a=i);const h=[],f=r&&t.animationState&&t.animationState.getState()[r];for(const g in u){const v=t.getValue(g,(o=t.latestValues[g])!==null&&o!==void 0?o:null),w=u[g];if(w===void 0||f&&XM(f,g))continue;const k={delay:n,...l0(a||{},g)};let x=!1;if(window.MotionHandoffAnimation){const E=GC(t);if(E){const I=window.MotionHandoffAnimation(E,g,bt);I!==null&&(k.startTime=I,x=!0)}}Dg(t,g),v.start(S0(g,v,w,t.shouldReduceMotion&&WC.has(g)?{type:!1}:k,t,x));const C=v.animation;C&&h.push(C)}return c&&Promise.all(h).then(()=>{bt.update(()=>{c&&ND(t,c)})}),h}function zg(t,e,n={}){var i;const r=of(t,e,n.type==="exit"?(i=t.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:o=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(o=n.transitionOverride);const a=r?()=>Promise.all(T1(t,r,n)):()=>Promise.resolve(),c=t.variantChildren&&t.variantChildren.size?(h=0)=>{const{delayChildren:f=0,staggerChildren:g,staggerDirection:v}=o;return ZM(t,e,f+h,g,v,n)}:()=>Promise.resolve(),{when:u}=o;if(u){const[h,f]=u==="beforeChildren"?[a,c]:[c,a];return h().then(()=>f())}else return Promise.all([a(),c(n.delay)])}function ZM(t,e,n=0,i=0,r=1,o){const a=[],c=(t.variantChildren.size-1)*i,u=r===1?(h=0)=>h*i:(h=0)=>c-h*i;return Array.from(t.variantChildren).sort(e2).forEach((h,f)=>{h.notify("AnimationStart",e),a.push(zg(h,e,{...o,delay:n+u(f)}).then(()=>h.notify("AnimationComplete",e)))}),Promise.all(a)}function e2(t,e){return t.sortNodePosition(e)}function t2(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(o=>zg(t,o,n));i=Promise.all(r)}else if(typeof e=="string")i=zg(t,e,n);else{const r=typeof e=="function"?of(t,e,n.custom):e;i=Promise.all(T1(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}const n2=Yv.length;function C1(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?C1(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<n2;n++){const i=Yv[n],r=t.props[i];(su(r)||r===!1)&&(e[i]=r)}return e}const i2=[...Jv].reverse(),r2=Jv.length;function s2(t){return e=>Promise.all(e.map(({animation:n,options:i})=>t2(t,n,i)))}function o2(t){let e=s2(t),n=Ik(),i=!0;const r=u=>(h,f)=>{var g;const v=of(t,f,u==="exit"?(g=t.presenceContext)===null||g===void 0?void 0:g.custom:void 0);if(v){const{transition:w,transitionEnd:k,...x}=v;h={...h,...x,...k}}return h};function o(u){e=u(t)}function a(u){const{props:h}=t,f=C1(t.parent)||{},g=[],v=new Set;let w={},k=1/0;for(let C=0;C<r2;C++){const E=i2[C],I=n[E],N=h[E]!==void 0?h[E]:f[E],P=su(N),R=E===u?I.isActive:null;R===!1&&(k=C);let j=N===f[E]&&N!==h[E]&&P;if(j&&i&&t.manuallyAnimateOnMount&&(j=!1),I.protectedKeys={...w},!I.isActive&&R===null||!N&&!I.prevProp||rf(N)||typeof N=="boolean")continue;const U=a2(I.prevProp,N);let F=U||E===u&&I.isActive&&!j&&P||C>k&&P,H=!1;const q=Array.isArray(N)?N:[N];let Q=q.reduce(r(E),{});R===!1&&(Q={});const{prevResolvedValues:ne={}}=I,Se={...ne,...Q},De=V=>{F=!0,v.has(V)&&(H=!0,v.delete(V)),I.needsAnimating[V]=!0;const Z=t.getValue(V);Z&&(Z.liveStyle=!1)};for(const V in Se){const Z=Q[V],he=ne[V];if(w.hasOwnProperty(V))continue;let oe=!1;Og(Z)&&Og(he)?oe=!UC(Z,he):oe=Z!==he,oe?Z!=null?De(V):v.add(V):Z!==void 0&&v.has(V)?De(V):I.protectedKeys[V]=!0}I.prevProp=N,I.prevResolvedValues=Q,I.isActive&&(w={...w,...Q}),i&&t.blockInitialAnimation&&(F=!1),F&&(!(j&&U)||H)&&g.push(...q.map(V=>({animation:V,options:{type:E}})))}if(v.size){const C={};v.forEach(E=>{const I=t.getBaseTarget(E),N=t.getValue(E);N&&(N.liveStyle=!0),C[E]=I??null}),g.push({animation:C})}let x=!!g.length;return i&&(h.initial===!1||h.initial===h.animate)&&!t.manuallyAnimateOnMount&&(x=!1),i=!1,x?e(g):Promise.resolve()}function c(u,h){var f;if(n[u].isActive===h)return Promise.resolve();(f=t.variantChildren)===null||f===void 0||f.forEach(v=>{var w;return(w=v.animationState)===null||w===void 0?void 0:w.setActive(u,h)}),n[u].isActive=h;const g=a(u);for(const v in n)n[v].protectedKeys={};return g}return{animateChanges:a,setActive:c,setAnimateFunction:o,getState:()=>n,reset:()=>{n=Ik(),i=!0}}}function a2(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!UC(e,t):!1}function jo(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ik(){return{animate:jo(!0),whileInView:jo(),whileHover:jo(),whileTap:jo(),whileDrag:jo(),whileFocus:jo(),exit:jo()}}class ro{constructor(e){this.isMounted=!1,this.node=e}update(){}}class l2 extends ro{constructor(e){super(e),e.animationState||(e.animationState=o2(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();rf(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let c2=0;class u2 extends ro{constructor(){super(...arguments),this.id=c2++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const d2={animation:{Feature:l2},exit:{Feature:u2}};function cu(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function xu(t){return{point:{x:t.pageX,y:t.pageY}}}const h2=t=>e=>d0(e)&&t(e,xu(e));function Bc(t,e,n,i){return cu(t,e,h2(n),i)}const Ok=(t,e)=>Math.abs(t-e);function f2(t,e){const n=Ok(t.x,e.x),i=Ok(t.y,e.y);return Math.sqrt(n**2+i**2)}class _1{constructor(e,n,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=Om(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,w=f2(g.offset,{x:0,y:0})>=3;if(!v&&!w)return;const{point:k}=g,{timestamp:x}=Pn;this.history.push({...k,timestamp:x});const{onStart:C,onMove:E}=this.handlers;v||(C&&C(this.lastMoveEvent,g),this.startEvent=this.lastMoveEvent),E&&E(this.lastMoveEvent,g)},this.handlePointerMove=(g,v)=>{this.lastMoveEvent=g,this.lastMoveEventInfo=Im(v,this.transformPagePoint),bt.update(this.updatePoint,!0)},this.handlePointerUp=(g,v)=>{this.end();const{onEnd:w,onSessionEnd:k,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const C=Om(g.type==="pointercancel"?this.lastMoveEventInfo:Im(v,this.transformPagePoint),this.history);this.startEvent&&w&&w(g,C),k&&k(g,C)},!d0(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.contextWindow=r||window;const a=xu(e),c=Im(a,this.transformPagePoint),{point:u}=c,{timestamp:h}=Pn;this.history=[{...u,timestamp:h}];const{onSessionStart:f}=n;f&&f(e,Om(c,this.history)),this.removeListeners=ku(Bc(this.contextWindow,"pointermove",this.handlePointerMove),Bc(this.contextWindow,"pointerup",this.handlePointerUp),Bc(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),eo(this.updatePoint)}}function Im(t,e){return e?{point:e(t.point)}:t}function Ak(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Om({point:t},e){return{point:t,delta:Ak(t,E1(e)),offset:Ak(t,p2(e)),velocity:m2(e,.1)}}function p2(t){return t[0]}function E1(t){return t[t.length-1]}function m2(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=E1(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>Zr(e)));)n--;if(!i)return{x:0,y:0};const o=es(r.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const a={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}const P1=1e-4,g2=1-P1,v2=1+P1,R1=.01,y2=0-R1,b2=0+R1;function Ti(t){return t.max-t.min}function w2(t,e,n){return Math.abs(t-e)<=n}function jk(t,e,n,i=.5){t.origin=i,t.originPoint=At(e.min,e.max,t.origin),t.scale=Ti(n)/Ti(e),t.translate=At(n.min,n.max,t.origin)-t.originPoint,(t.scale>=g2&&t.scale<=v2||isNaN(t.scale))&&(t.scale=1),(t.translate>=y2&&t.translate<=b2||isNaN(t.translate))&&(t.translate=0)}function Vc(t,e,n,i){jk(t.x,e.x,n.x,i?i.originX:void 0),jk(t.y,e.y,n.y,i?i.originY:void 0)}function Dk(t,e,n){t.min=n.min+e.min,t.max=t.min+Ti(e)}function k2(t,e,n){Dk(t.x,e.x,n.x),Dk(t.y,e.y,n.y)}function Mk(t,e,n){t.min=e.min-n.min,t.max=t.min+Ti(e)}function zc(t,e,n){Mk(t.x,e.x,n.x),Mk(t.y,e.y,n.y)}function x2(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?At(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?At(n,t,i.max):Math.min(t,n)),t}function Lk(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function S2(t,{top:e,left:n,bottom:i,right:r}){return{x:Lk(t.x,n,r),y:Lk(t.y,e,i)}}function Uk(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function T2(t,e){return{x:Uk(t.x,e.x),y:Uk(t.y,e.y)}}function C2(t,e){let n=.5;const i=Ti(t),r=Ti(e);return r>i?n=bl(e.min,e.max-i,t.min):i>r&&(n=bl(t.min,t.max-r,e.min)),ns(0,1,n)}function _2(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const $g=.35;function E2(t=$g){return t===!1?t=0:t===!0&&(t=$g),{x:Fk(t,"left","right"),y:Fk(t,"top","bottom")}}function Fk(t,e,n){return{min:Bk(t,e),max:Bk(t,n)}}function Bk(t,e){return typeof t=="number"?t:t[e]||0}const Vk=()=>({translate:0,scale:1,origin:0,originPoint:0}),nl=()=>({x:Vk(),y:Vk()}),zk=()=>({min:0,max:0}),Kt=()=>({x:zk(),y:zk()});function Di(t){return[t("x"),t("y")]}function N1({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function P2({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function R2(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Am(t){return t===void 0||t===1}function qg({scale:t,scaleX:e,scaleY:n}){return!Am(t)||!Am(e)||!Am(n)}function Bo(t){return qg(t)||I1(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function I1(t){return $k(t.x)||$k(t.y)}function $k(t){return t&&t!=="0%"}function Mh(t,e,n){const i=t-n,r=e*i;return n+r}function qk(t,e,n,i,r){return r!==void 0&&(t=Mh(t,r,i)),Mh(t,n,i)+e}function Kg(t,e=0,n=1,i,r){t.min=qk(t.min,e,n,i,r),t.max=qk(t.max,e,n,i,r)}function O1(t,{x:e,y:n}){Kg(t.x,e.translate,e.scale,e.originPoint),Kg(t.y,n.translate,n.scale,n.originPoint)}const Kk=.999999999999,Wk=1.0000000000001;function N2(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let o,a;for(let c=0;c<r;c++){o=n[c],a=o.projectionDelta;const{visualElement:u}=o.options;u&&u.props.style&&u.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&rl(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,O1(t,a)),i&&Bo(o.latestValues)&&rl(t,o.latestValues))}e.x<Wk&&e.x>Kk&&(e.x=1),e.y<Wk&&e.y>Kk&&(e.y=1)}function il(t,e){t.min=t.min+e,t.max=t.max+e}function Hk(t,e,n,i,r=.5){const o=At(t.min,t.max,r);Kg(t,e,n,o,i)}function rl(t,e){Hk(t.x,e.x,e.scaleX,e.scale,e.originX),Hk(t.y,e.y,e.scaleY,e.scale,e.originY)}function A1(t,e){return N1(R2(t.getBoundingClientRect(),e))}function I2(t,e,n){const i=A1(t,n),{scroll:r}=e;return r&&(il(i.x,r.offset.x),il(i.y,r.offset.y)),i}const j1=({current:t})=>t?t.ownerDocument.defaultView:null,O2=new WeakMap;class A2{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Kt(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=f=>{const{dragSnapToOrigin:g}=this.getProps();g?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(xu(f).point)},o=(f,g)=>{const{drag:v,dragPropagation:w,onDragStart:k}=this.getProps();if(v&&!w&&(this.openDragLock&&this.openDragLock(),this.openDragLock=CD(v),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Di(C=>{let E=this.getAxisMotionValue(C).get()||0;if(yr.test(E)){const{projection:I}=this.visualElement;if(I&&I.layout){const N=I.layout.layoutBox[C];N&&(E=Ti(N)*(parseFloat(E)/100))}}this.originPoint[C]=E}),k&&bt.postRender(()=>k(f,g)),Dg(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(f,g)=>{const{dragPropagation:v,dragDirectionLock:w,onDirectionLock:k,onDrag:x}=this.getProps();if(!v&&!this.openDragLock)return;const{offset:C}=g;if(w&&this.currentDirection===null){this.currentDirection=j2(C),this.currentDirection!==null&&k&&k(this.currentDirection);return}this.updateAxis("x",g.point,C),this.updateAxis("y",g.point,C),this.visualElement.render(),x&&x(f,g)},c=(f,g)=>this.stop(f,g),u=()=>Di(f=>{var g;return this.getAnimationState(f)==="paused"&&((g=this.getAxisMotionValue(f).animation)===null||g===void 0?void 0:g.play())}),{dragSnapToOrigin:h}=this.getProps();this.panSession=new _1(e,{onSessionStart:r,onStart:o,onMove:a,onSessionEnd:c,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,contextWindow:j1(this.visualElement)})}stop(e,n){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:o}=this.getProps();o&&bt.postRender(()=>o(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!Fd(e,r,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(a=x2(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,o=this.constraints;n&&el(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=S2(r.layoutBox,n):this.constraints=!1,this.elastic=E2(i),o!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Di(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=_2(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!el(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const o=I2(i,r.root,this.visualElement.getTransformPagePoint());let a=T2(r.layout.layoutBox,o);if(n){const c=n(P2(a));this.hasMutatedConstraints=!!c,c&&(a=N1(c))}return a}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:c}=this.getProps(),u=this.constraints||{},h=Di(f=>{if(!Fd(f,n,this.currentDirection))return;let g=u&&u[f]||{};a&&(g={min:0,max:0});const v=r?200:1e6,w=r?40:1e7,k={type:"inertia",velocity:i?e[f]:0,bounceStiffness:v,bounceDamping:w,timeConstant:750,restDelta:1,restSpeed:10,...o,...g};return this.startAxisValueAnimation(f,k)});return Promise.all(h).then(c)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return Dg(this.visualElement,e),i.start(S0(e,i,0,n,this.visualElement,!1))}stopAnimation(){Di(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Di(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){Di(n=>{const{drag:i}=this.getProps();if(!Fd(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,o=this.getAxisMotionValue(n);if(r&&r.layout){const{min:a,max:c}=r.layout.layoutBox[n];o.set(e[n]-At(a,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!el(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Di(a=>{const c=this.getAxisMotionValue(a);if(c&&this.constraints!==!1){const u=c.get();r[a]=C2({min:u,max:u},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Di(a=>{if(!Fd(a,e,null))return;const c=this.getAxisMotionValue(a),{min:u,max:h}=this.constraints[a];c.set(At(u,h,r[a]))})}addListeners(){if(!this.visualElement.current)return;O2.set(this.visualElement,this);const e=this.visualElement.current,n=Bc(e,"pointerdown",u=>{const{drag:h,dragListener:f=!0}=this.getProps();h&&f&&this.start(u)}),i=()=>{const{dragConstraints:u}=this.getProps();el(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,o=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),bt.read(i);const a=cu(window,"resize",()=>this.scalePositionWithinConstraints()),c=r.addEventListener("didUpdate",(({delta:u,hasLayoutChanged:h})=>{this.isDragging&&h&&(Di(f=>{const g=this.getAxisMotionValue(f);g&&(this.originPoint[f]+=u[f].translate,g.set(g.get()+u[f].translate))}),this.visualElement.render())}));return()=>{a(),n(),o(),c&&c()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:o=!1,dragElastic:a=$g,dragMomentum:c=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:o,dragElastic:a,dragMomentum:c}}}function Fd(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function j2(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class D2 extends ro{constructor(e){super(e),this.removeGroupControls=Si,this.removeListeners=Si,this.controls=new A2(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Si}unmount(){this.removeGroupControls(),this.removeListeners()}}const Gk=t=>(e,n)=>{t&&bt.postRender(()=>t(e,n))};class M2 extends ro{constructor(){super(...arguments),this.removePointerDownListener=Si}onPointerDown(e){this.session=new _1(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:j1(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Gk(e),onStart:Gk(n),onMove:i,onEnd:(o,a)=>{delete this.session,r&&bt.postRender(()=>r(o,a))}}}mount(){this.removePointerDownListener=Bc(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const hh={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Jk(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Cc={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Le.test(t))t=parseFloat(t);else return t;const n=Jk(t,e.target.x),i=Jk(t,e.target.y);return`${n}% ${i}%`}},L2={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=to.parse(t);if(r.length>5)return i;const o=to.createTransformer(t),a=typeof r[0]!="number"?1:0,c=n.x.scale*e.x,u=n.y.scale*e.y;r[0+a]/=c,r[1+a]/=u;const h=At(c,u,.5);return typeof r[2+a]=="number"&&(r[2+a]/=h),typeof r[3+a]=="number"&&(r[3+a]/=h),o(r)}};class U2 extends S.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:o}=e;rD(F2),o&&(n.group&&n.group.add(o),i&&i.register&&r&&i.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),hh.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:o}=this.props,a=i.projection;return a&&(a.isPresent=o,r||e.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||bt.postRender(()=>{const c=a.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Xv.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function D1(t){const[e,n]=vC(),i=S.useContext(qv);return m.jsx(U2,{...t,layoutGroup:i,switchLayoutGroup:S.useContext(CC),isPresent:e,safeToRemove:n})}const F2={borderRadius:{...Cc,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cc,borderTopRightRadius:Cc,borderBottomLeftRadius:Cc,borderBottomRightRadius:Cc,boxShadow:L2};function B2(t,e,n){const i=Un(t)?t:au(t);return i.start(S0("",i,e,n)),i.animation}function V2(t){return t instanceof SVGElement&&t.tagName!=="svg"}const z2=(t,e)=>t.depth-e.depth;class $2{constructor(){this.children=[],this.isDirty=!1}add(e){h0(this.children,e),this.isDirty=!0}remove(e){f0(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(z2),this.isDirty=!1,this.children.forEach(e)}}function q2(t,e){const n=br.now(),i=({timestamp:r})=>{const o=r-n;o>=e&&(eo(i),t(o-e))};return bt.read(i,!0),()=>eo(i)}const M1=["TopLeft","TopRight","BottomLeft","BottomRight"],K2=M1.length,Yk=t=>typeof t=="string"?parseFloat(t):t,Qk=t=>typeof t=="number"||Le.test(t);function W2(t,e,n,i,r,o){r?(t.opacity=At(0,n.opacity!==void 0?n.opacity:1,H2(i)),t.opacityExit=At(e.opacity!==void 0?e.opacity:1,0,G2(i))):o&&(t.opacity=At(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,i));for(let a=0;a<K2;a++){const c=`border${M1[a]}Radius`;let u=Xk(e,c),h=Xk(n,c);if(u===void 0&&h===void 0)continue;u||(u=0),h||(h=0),u===0||h===0||Qk(u)===Qk(h)?(t[c]=Math.max(At(Yk(u),Yk(h),i),0),(yr.test(h)||yr.test(u))&&(t[c]+="%")):t[c]=h}(e.rotate||n.rotate)&&(t.rotate=At(e.rotate||0,n.rotate||0,i))}function Xk(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const H2=L1(0,.5,t1),G2=L1(.5,.95,Si);function L1(t,e,n){return i=>i<t?0:i>e?1:n(bl(t,e,i))}function Zk(t,e){t.min=e.min,t.max=e.max}function Ai(t,e){Zk(t.x,e.x),Zk(t.y,e.y)}function ex(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function tx(t,e,n,i,r){return t-=e,t=Mh(t,1/n,i),r!==void 0&&(t=Mh(t,1/r,i)),t}function J2(t,e=0,n=1,i=.5,r,o=t,a=t){if(yr.test(e)&&(e=parseFloat(e),e=At(a.min,a.max,e/100)-a.min),typeof e!="number")return;let c=At(o.min,o.max,i);t===o&&(c-=e),t.min=tx(t.min,e,n,c,r),t.max=tx(t.max,e,n,c,r)}function nx(t,e,[n,i,r],o,a){J2(t,e[n],e[i],e[r],e.scale,o,a)}const Y2=["x","scaleX","originX"],Q2=["y","scaleY","originY"];function ix(t,e,n,i){nx(t.x,e,Y2,n?n.x:void 0,i?i.x:void 0),nx(t.y,e,Q2,n?n.y:void 0,i?i.y:void 0)}function rx(t){return t.translate===0&&t.scale===1}function U1(t){return rx(t.x)&&rx(t.y)}function sx(t,e){return t.min===e.min&&t.max===e.max}function X2(t,e){return sx(t.x,e.x)&&sx(t.y,e.y)}function ox(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function F1(t,e){return ox(t.x,e.x)&&ox(t.y,e.y)}function ax(t){return Ti(t.x)/Ti(t.y)}function lx(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class Z2{constructor(){this.members=[]}add(e){h0(this.members,e),e.scheduleRender()}remove(e){if(f0(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const o=this.members[r];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function eL(t,e,n){let i="";const r=t.x.translate/e.x,o=t.y.translate/e.y,a=n?.z||0;if((r||o||a)&&(i=`translate3d(${r}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:h,rotate:f,rotateX:g,rotateY:v,skewX:w,skewY:k}=n;h&&(i=`perspective(${h}px) ${i}`),f&&(i+=`rotate(${f}deg) `),g&&(i+=`rotateX(${g}deg) `),v&&(i+=`rotateY(${v}deg) `),w&&(i+=`skewX(${w}deg) `),k&&(i+=`skewY(${k}deg) `)}const c=t.x.scale*e.x,u=t.y.scale*e.y;return(c!==1||u!==1)&&(i+=`scale(${c}, ${u})`),i||"none"}const Vo={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Nc=typeof window<"u"&&window.MotionDebug!==void 0,jm=["","X","Y","Z"],tL={visibility:"hidden"},cx=1e3;let nL=0;function Dm(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function B1(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=GC(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",bt,!(r||o))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&B1(i)}function V1({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(a={},c=e?.()){this.id=nL++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Nc&&(Vo.totalNodes=Vo.resolvedTargetDeltas=Vo.recalculatedProjection=0),this.nodes.forEach(sL),this.nodes.forEach(uL),this.nodes.forEach(dL),this.nodes.forEach(oL),Nc&&window.MotionDebug.record(Vo)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new $2)}addEventListener(a,c){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new p0),this.eventHandlers.get(a).add(c)}notifyListeners(a,...c){const u=this.eventHandlers.get(a);u&&u.notify(...c)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,c=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=V2(a),this.instance=a;const{layoutId:u,layout:h,visualElement:f}=this.options;if(f&&!f.current&&f.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),c&&(h||u)&&(this.isLayoutDirty=!0),t){let g;const v=()=>this.root.updateBlockedByResize=!1;t(a,()=>{this.root.updateBlockedByResize=!0,g&&g(),g=q2(v,250),hh.hasAnimatedSinceResize&&(hh.hasAnimatedSinceResize=!1,this.nodes.forEach(dx))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&f&&(u||h)&&this.addEventListener("didUpdate",({delta:g,hasLayoutChanged:v,hasRelativeTargetChanged:w,layout:k})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||f.getDefaultTransition()||gL,{onLayoutAnimationStart:C,onLayoutAnimationComplete:E}=f.getProps(),I=!this.targetLayout||!F1(this.targetLayout,k)||w,N=!v&&w;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||N||v&&(I||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(g,N);const P={...l0(x,"layout"),onPlay:C,onComplete:E};(f.shouldReduceMotion||this.options.layoutRoot)&&(P.delay=0,P.type=!1),this.startAnimation(P)}else v||dx(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=k})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,eo(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hL),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&B1(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let f=0;f<this.path.length;f++){const g=this.path[f];g.shouldResetTransform=!0,g.updateScroll("snapshot"),g.options.layoutRoot&&g.willUpdate(!1)}const{layoutId:c,layout:u}=this.options;if(c===void 0&&!u)return;const h=this.getTransformTemplate();this.prevTransformTemplateValue=h?h(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(ux);return}this.isUpdating||this.nodes.forEach(lL),this.isUpdating=!1,this.nodes.forEach(cL),this.nodes.forEach(iL),this.nodes.forEach(rL),this.clearAllSnapshots();const c=br.now();Pn.delta=ns(0,1e3/60,c-Pn.timestamp),Pn.timestamp=c,Pn.isProcessing=!0,Cm.update.process(Pn),Cm.preRender.process(Pn),Cm.render.process(Pn),Pn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Xv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(aL),this.sharedNodes.forEach(fL)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,bt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){bt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Kt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(c=!1),c){const u=i(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:u,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!U1(this.projectionDelta),u=this.getTransformTemplate(),h=u?u(this.latestValues,""):void 0,f=h!==this.prevTransformTemplateValue;a&&(c||Bo(this.latestValues)||f)&&(r(this.instance,h),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const c=this.measurePageBox();let u=this.removeElementScroll(c);return a&&(u=this.removeTransform(u)),vL(u),{animationId:this.root.animationId,measuredBox:c,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:c}=this.options;if(!c)return Kt();const u=c.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(yL))){const{scroll:f}=this.root;f&&(il(u.x,f.offset.x),il(u.y,f.offset.y))}return u}removeElementScroll(a){var c;const u=Kt();if(Ai(u,a),!((c=this.scroll)===null||c===void 0)&&c.wasRoot)return u;for(let h=0;h<this.path.length;h++){const f=this.path[h],{scroll:g,options:v}=f;f!==this.root&&g&&v.layoutScroll&&(g.wasRoot&&Ai(u,a),il(u.x,g.offset.x),il(u.y,g.offset.y))}return u}applyTransform(a,c=!1){const u=Kt();Ai(u,a);for(let h=0;h<this.path.length;h++){const f=this.path[h];!c&&f.options.layoutScroll&&f.scroll&&f!==f.root&&rl(u,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),Bo(f.latestValues)&&rl(u,f.latestValues)}return Bo(this.latestValues)&&rl(u,this.latestValues),u}removeTransform(a){const c=Kt();Ai(c,a);for(let u=0;u<this.path.length;u++){const h=this.path[u];if(!h.instance||!Bo(h.latestValues))continue;qg(h.latestValues)&&h.updateSnapshot();const f=Kt(),g=h.measurePageBox();Ai(f,g),ix(c,h.latestValues,h.snapshot?h.snapshot.layoutBox:void 0,f)}return Bo(this.latestValues)&&ix(c,this.latestValues),c}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Pn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var c;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const h=!!this.resumingFrom||this!==u;if(!(a||h&&this.isSharedProjectionDirty||this.isProjectionDirty||!((c=this.parent)===null||c===void 0)&&c.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:g,layoutId:v}=this.options;if(!(!this.layout||!(g||v))){if(this.resolvedRelativeTargetAt=Pn.timestamp,!this.targetDelta&&!this.relativeTarget){const w=this.getClosestProjectingParent();w&&w.layout&&this.animationProgress!==1?(this.relativeParent=w,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Kt(),this.relativeTargetOrigin=Kt(),zc(this.relativeTargetOrigin,this.layout.layoutBox,w.layout.layoutBox),Ai(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Kt(),this.targetWithTransforms=Kt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),k2(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ai(this.target,this.layout.layoutBox),O1(this.target,this.targetDelta)):Ai(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const w=this.getClosestProjectingParent();w&&!!w.resumingFrom==!!this.resumingFrom&&!w.options.layoutScroll&&w.target&&this.animationProgress!==1?(this.relativeParent=w,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Kt(),this.relativeTargetOrigin=Kt(),zc(this.relativeTargetOrigin,this.target,w.target),Ai(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Nc&&Vo.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||qg(this.parent.latestValues)||I1(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const c=this.getLead(),u=!!this.resumingFrom||this!==c;let h=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(h=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(h=!1),this.resolvedRelativeTargetAt===Pn.timestamp&&(h=!1),h)return;const{layout:f,layoutId:g}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(f||g))return;Ai(this.layoutCorrected,this.layout.layoutBox);const v=this.treeScale.x,w=this.treeScale.y;N2(this.layoutCorrected,this.treeScale,this.path,u),c.layout&&!c.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(c.target=c.layout.layoutBox,c.targetWithTransforms=Kt());const{target:k}=c;if(!k){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(ex(this.prevProjectionDelta.x,this.projectionDelta.x),ex(this.prevProjectionDelta.y,this.projectionDelta.y)),Vc(this.projectionDelta,this.layoutCorrected,k,this.latestValues),(this.treeScale.x!==v||this.treeScale.y!==w||!lx(this.projectionDelta.x,this.prevProjectionDelta.x)||!lx(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",k)),Nc&&Vo.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var c;if((c=this.options.visualElement)===null||c===void 0||c.scheduleRender(),a){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=nl(),this.projectionDelta=nl(),this.projectionDeltaWithTransform=nl()}setAnimationOrigin(a,c=!1){const u=this.snapshot,h=u?u.latestValues:{},f={...this.latestValues},g=nl();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const v=Kt(),w=u?u.source:void 0,k=this.layout?this.layout.source:void 0,x=w!==k,C=this.getStack(),E=!C||C.members.length<=1,I=!!(x&&!E&&this.options.crossfade===!0&&!this.path.some(mL));this.animationProgress=0;let N;this.mixTargetDelta=P=>{const R=P/1e3;hx(g.x,a.x,R),hx(g.y,a.y,R),this.setTargetDelta(g),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(zc(v,this.layout.layoutBox,this.relativeParent.layout.layoutBox),pL(this.relativeTarget,this.relativeTargetOrigin,v,R),N&&X2(this.relativeTarget,N)&&(this.isProjectionDirty=!1),N||(N=Kt()),Ai(N,this.relativeTarget)),x&&(this.animationValues=f,W2(f,h,this.latestValues,R,I,E)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=R},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(eo(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=bt.update(()=>{hh.hasAnimatedSinceResize=!0,this.currentAnimation=B2(0,cx,{...a,onUpdate:c=>{this.mixTargetDelta(c),a.onUpdate&&a.onUpdate(c)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(cx),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:c,target:u,layout:h,latestValues:f}=a;if(!(!c||!u||!h)){if(this!==a&&this.layout&&h&&z1(this.options.animationType,this.layout.layoutBox,h.layoutBox)){u=this.target||Kt();const g=Ti(this.layout.layoutBox.x);u.x.min=a.target.x.min,u.x.max=u.x.min+g;const v=Ti(this.layout.layoutBox.y);u.y.min=a.target.y.min,u.y.max=u.y.min+v}Ai(c,u),rl(c,f),Vc(this.projectionDeltaWithTransform,this.layoutCorrected,c,f)}}registerSharedNode(a,c){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Z2),this.sharedNodes.get(a).add(c);const h=c.options.initialPromotionConfig;c.promote({transition:h?h.transition:void 0,preserveFollowOpacity:h&&h.shouldPreserveFollowOpacity?h.shouldPreserveFollowOpacity(c):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:c}=this.options;return c?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:c}=this.options;return c?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:c,preserveFollowOpacity:u}={}){const h=this.getStack();h&&h.promote(this,u),a&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let c=!1;const{latestValues:u}=a;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(c=!0),!c)return;const h={};u.z&&Dm("z",a,h,this.animationValues);for(let f=0;f<jm.length;f++)Dm(`rotate${jm[f]}`,a,h,this.animationValues),Dm(`skew${jm[f]}`,a,h,this.animationValues);a.render();for(const f in h)a.setStaticValue(f,h[f]),this.animationValues&&(this.animationValues[f]=h[f]);a.scheduleRender()}getProjectionStyles(a){var c,u;if(!this.instance||this.isSVG)return;if(!this.isVisible)return tL;const h={visibility:""},f=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,h.opacity="",h.pointerEvents=uh(a?.pointerEvents)||"",h.transform=f?f(this.latestValues,""):"none",h;const g=this.getLead();if(!this.projectionDelta||!this.layout||!g.target){const x={};return this.options.layoutId&&(x.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,x.pointerEvents=uh(a?.pointerEvents)||""),this.hasProjected&&!Bo(this.latestValues)&&(x.transform=f?f({},""):"none",this.hasProjected=!1),x}const v=g.animationValues||g.latestValues;this.applyTransformsToTarget(),h.transform=eL(this.projectionDeltaWithTransform,this.treeScale,v),f&&(h.transform=f(v,h.transform));const{x:w,y:k}=this.projectionDelta;h.transformOrigin=`${w.origin*100}% ${k.origin*100}% 0`,g.animationValues?h.opacity=g===this?(u=(c=v.opacity)!==null&&c!==void 0?c:this.latestValues.opacity)!==null&&u!==void 0?u:1:this.preserveOpacity?this.latestValues.opacity:v.opacityExit:h.opacity=g===this?v.opacity!==void 0?v.opacity:"":v.opacityExit!==void 0?v.opacityExit:0;for(const x in Ih){if(v[x]===void 0)continue;const{correct:C,applyTo:E}=Ih[x],I=h.transform==="none"?v[x]:C(v[x],g);if(E){const N=E.length;for(let P=0;P<N;P++)h[E[P]]=I}else h[x]=I}return this.options.layoutId&&(h.pointerEvents=g===this?uh(a?.pointerEvents)||"":"none"),h}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var c;return(c=a.currentAnimation)===null||c===void 0?void 0:c.stop()}),this.root.nodes.forEach(ux),this.root.sharedNodes.clear()}}}function iL(t){t.updateLayout()}function rL(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:o}=t.options,a=n.source!==t.layout.source;o==="size"?Di(g=>{const v=a?n.measuredBox[g]:n.layoutBox[g],w=Ti(v);v.min=i[g].min,v.max=v.min+w}):z1(o,n.layoutBox,i)&&Di(g=>{const v=a?n.measuredBox[g]:n.layoutBox[g],w=Ti(i[g]);v.max=v.min+w,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[g].max=t.relativeTarget[g].min+w)});const c=nl();Vc(c,i,n.layoutBox);const u=nl();a?Vc(u,t.applyTransform(r,!0),n.measuredBox):Vc(u,i,n.layoutBox);const h=!U1(c);let f=!1;if(!t.resumeFrom){const g=t.getClosestProjectingParent();if(g&&!g.resumeFrom){const{snapshot:v,layout:w}=g;if(v&&w){const k=Kt();zc(k,n.layoutBox,v.layoutBox);const x=Kt();zc(x,i,w.layoutBox),F1(k,x)||(f=!0),g.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=k,t.relativeParent=g)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:n,delta:u,layoutDelta:c,hasLayoutChanged:h,hasRelativeTargetChanged:f})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function sL(t){Nc&&Vo.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function oL(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function aL(t){t.clearSnapshot()}function ux(t){t.clearMeasurements()}function lL(t){t.isLayoutDirty=!1}function cL(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function dx(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function uL(t){t.resolveTargetDelta()}function dL(t){t.calcProjection()}function hL(t){t.resetSkewAndRotation()}function fL(t){t.removeLeadSnapshot()}function hx(t,e,n){t.translate=At(e.translate,0,n),t.scale=At(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function fx(t,e,n,i){t.min=At(e.min,n.min,i),t.max=At(e.max,n.max,i)}function pL(t,e,n,i){fx(t.x,e.x,n.x,i),fx(t.y,e.y,n.y,i)}function mL(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const gL={duration:.45,ease:[.4,0,.1,1]},px=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),mx=px("applewebkit/")&&!px("chrome/")?Math.round:Si;function gx(t){t.min=mx(t.min),t.max=mx(t.max)}function vL(t){gx(t.x),gx(t.y)}function z1(t,e,n){return t==="position"||t==="preserve-aspect"&&!w2(ax(e),ax(n),.2)}function yL(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const bL=V1({attachResizeListener:(t,e)=>cu(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Mm={current:void 0},$1=V1({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Mm.current){const t=new bL({});t.mount(window),t.setOptions({layoutScroll:!0}),Mm.current=t}return Mm.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),wL={pan:{Feature:M2},drag:{Feature:D2,ProjectionNode:$1,MeasureLayout:D1}};function vx(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,o=i[r];o&&bt.postRender(()=>o(e,xu(e)))}class kL extends ro{mount(){const{current:e}=this.node;e&&(this.unmount=wD(e,n=>(vx(this.node,n,"Start"),i=>vx(this.node,i,"End"))))}unmount(){}}class xL extends ro{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ku(cu(this.node.current,"focus",()=>this.onFocus()),cu(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function yx(t,e,n){const{props:i}=t;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),o=i[r];o&&bt.postRender(()=>o(e,xu(e)))}class SL extends ro{mount(){const{current:e}=this.node;e&&(this.unmount=TD(e,n=>(yx(this.node,n,"Start"),(i,{success:r})=>yx(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Wg=new WeakMap,Lm=new WeakMap,TL=t=>{const e=Wg.get(t.target);e&&e(t)},CL=t=>{t.forEach(TL)};function _L({root:t,...e}){const n=t||document;Lm.has(n)||Lm.set(n,{});const i=Lm.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(CL,{root:t,...e})),i[r]}function EL(t,e,n){const i=_L(e);return Wg.set(t,n),i.observe(t),()=>{Wg.delete(t),i.unobserve(t)}}const PL={some:0,all:1};class RL extends ro{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:PL[r]},c=u=>{const{isIntersecting:h}=u;if(this.isInView===h||(this.isInView=h,o&&!h&&this.hasEnteredView))return;h&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",h);const{onViewportEnter:f,onViewportLeave:g}=this.node.getProps(),v=h?f:g;v&&v(u)};return EL(this.node.current,a,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(NL(e,n))&&this.startObserver()}unmount(){}}function NL({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const IL={inView:{Feature:RL},tap:{Feature:SL},focus:{Feature:xL},hover:{Feature:kL}},OL={layout:{ProjectionNode:$1,MeasureLayout:D1}},Hg={current:null},q1={current:!1};function AL(){if(q1.current=!0,!!Hv)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Hg.current=t.matches;t.addListener(e),e()}else Hg.current=!1}const jL=[...m1,Ln,to],DL=t=>jL.find(p1(t)),bx=new WeakMap;function ML(t,e,n){for(const i in e){const r=e[i],o=n[i];if(Un(r))t.addValue(i,r);else if(Un(o))t.addValue(i,au(r,{owner:t}));else if(o!==r)if(t.hasValue(i)){const a=t.getValue(i);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=t.getStaticValue(i);t.addValue(i,au(a!==void 0?a:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const wx=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class LL{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:a},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=w0,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const w=br.now();this.renderScheduledAt<w&&(this.renderScheduledAt=w,bt.render(this.render,!1,!0))};const{latestValues:u,renderState:h,onUpdate:f}=a;this.onUpdate=f,this.latestValues=u,this.baseTarget={...u},this.initialValues=n.initial?{...u}:{},this.renderState=h,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=c,this.blockInitialAnimation=!!o,this.isControllingVariants=sf(n),this.isVariantNode=SC(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:g,...v}=this.scrapeMotionValuesFromProps(n,{},this);for(const w in v){const k=v[w];u[w]!==void 0&&Un(k)&&k.set(u[w],!1)}}mount(e){this.current=e,bx.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),q1.current||AL(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Hg.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){bx.delete(this.current),this.projection&&this.projection.unmount(),eo(this.notifyUpdate),eo(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=ea.has(e),r=n.on("change",c=>{this.latestValues[e]=c,this.props.onUpdate&&bt.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),o(),a&&a(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in wl){const n=wl[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Kt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<wx.length;i++){const r=wx[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const o="on"+r,a=e[o];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=ML(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=au(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){var i;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(h1(r)||i1(r))?r=parseFloat(r):!DL(r)&&to.test(n)&&(r=c1(e,n)),this.setBaseTarget(e,Un(r)?r.get():r)),Un(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const a=e0(this.props,i,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(r=a[e])}if(i&&r!==void 0)return r;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!Un(o)?o:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new p0),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class K1 extends LL{constructor(){super(...arguments),this.KeyframeResolver=g1}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Un(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function UL(t){return window.getComputedStyle(t)}class FL extends K1{constructor(){super(...arguments),this.type="html",this.renderInstance=OC}readValueFromInstance(e,n){if(ea.has(n)){const i=b0(n);return i&&i.default||0}else{const i=UL(e),r=(RC(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return A1(e,n)}build(e,n,i){i0(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return a0(e,n,i)}}class BL extends K1{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Kt}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(ea.has(n)){const i=b0(n);return i&&i.default||0}return n=AC.has(n)?n:Qv(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return MC(e,n,i)}build(e,n,i){r0(e,n,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,i,r){jC(e,n,i,r)}mount(e){this.isSVGTag=o0(e.tagName),super.mount(e)}}const VL=(t,e)=>Zv(t)?new BL(e):new FL(e,{allowProjection:t!==S.Fragment}),zL=fD({...d2,...IL,...wL,...OL},VL),Um=Pj(zL),Bd=16/9;function $L(t,e,n){return t<=0?{cols:1,rows:1}:t===1?{cols:1,rows:1}:t===2?n>e?{cols:1,rows:2}:{cols:2,rows:1}:t<=4?{cols:2,rows:2}:t<=6?{cols:3,rows:2}:t<=9?{cols:3,rows:3}:t<=12?{cols:4,rows:3}:{cols:4,rows:3}}function qL(t,e,n){const i=$L(t,e,n);let r=i.cols,o=i.rows;const a=r*o,c=Math.min(t,a);if(c<=0)return{cols:1,rows:1,cellWidth:e,cellHeight:n};for(;o*r<c&&o*r<12;)r>=o?o+=1:r+=1;o=Math.max(1,Math.min(o,Math.ceil(c/r))),r=Math.max(1,Math.min(r,Math.ceil(c/o)));const u=8,h=e-(r-1)*u,f=n-(o-1)*u;let g=h/r,v=f/o;const w=g/v;return w>Bd?g=v*Bd:w<Bd&&(v=g/Bd),{cols:r,rows:o,cellWidth:g,cellHeight:v}}function KL(t){const[e,n]=S.useState(null),[i,r]=S.useState({width:640,height:360}),o=S.useCallback(h=>{n(h)},[]);S.useEffect(()=>{if(!e)return;const h=new ResizeObserver(f=>{const{width:g,height:v}=f[0]?.contentRect??{width:640,height:360};r({width:g,height:v})});return h.observe(e),()=>h.disconnect()},[e]);const{width:a,height:c}=i;return{...qL(t,a,c),containerRef:o}}const Fm=({participant:t,track:e,trackMuted:n=!1,isScreenShare:i=!1,className:r="",style:o,onClick:a,isActive:c=!1})=>{const u=e&&e.mediaStreamTrack,h=t.avatar||`https://api.dicebear.com/7.x/notionists/svg?seed=${t.id}`;return m.jsxs("div",{role:a?"button":void 0,onClick:a,className:`
        relative w-full h-full min-h-0 rounded-xl overflow-hidden bg-[#2b2d31] border border-white/10
        flex items-center justify-center
        ${a?"cursor-pointer hover:border-white/20 transition-colors":""}
        ${c?"ring-2 ring-orange-500 ring-offset-2 ring-offset-[#0e0e12]":""}
        ${r}
      `,style:o,children:[u?m.jsxs(m.Fragment,{children:[m.jsx(ru,{track:e,muted:i?!1:n,className:i?"w-full h-full object-contain":"w-full h-full object-cover"}),!i&&m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent pointer-events-none"})]}):m.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-[#1e1f22] text-zinc-400",children:[m.jsx("img",{src:h,alt:"",className:"w-16 h-16 md:w-20 md:h-20 rounded-full object-cover border-2 border-white/10"}),m.jsx("span",{className:"mt-2 text-xs font-medium text-zinc-500 truncate max-w-full px-2",children:t.name})]}),m.jsxs("div",{className:"absolute bottom-0 left-0 right-0 h-8 md:h-9 bg-gradient-to-t from-black/80 to-transparent flex items-center justify-between px-2 gap-2",children:[m.jsx("span",{className:"text-xs font-medium text-white truncate flex-1 min-w-0",children:t.name}),m.jsx("span",{className:`flex-shrink-0 p-1 rounded ${t.muted?"bg-red-500/80 text-white":"bg-white/20 text-white/90"}`,title:t.muted?"Susturuldu":"Ak",children:t.muted?m.jsx(Wc,{size:12}):m.jsx(Vh,{size:12})})]}),t.isSpeaking&&m.jsx("span",{className:"absolute top-2 right-2 w-2.5 h-2.5 rounded-full bg-green-400 animate-pulse border-2 border-[#0e0e12]"})]})},WL=12,HL=({participants:t,mode:e="grid",maxParticipants:n=WL,speakerIndex:i=0,onParticipantClick:r,className:o=""})=>{const a=t.slice(0,n),c=t.length-a.length,u=a.length,{cols:h,rows:f,containerRef:g}=KL(e==="speaker"?1+(u-1):u);if(u===0)return m.jsx("div",{className:`flex-1 flex items-center justify-center bg-[#0e0e12] text-zinc-500 ${o}`,children:m.jsx("p",{className:"text-sm",children:"Henz kimse yok"})});if(e==="speaker"&&u>1){const k=a[i]??a[0],x=a.filter((C,E)=>E!==i);return m.jsxs("div",{ref:g,className:`relative flex-1 flex min-h-0 w-full gap-3 p-3 ${o}`,children:[m.jsx("div",{className:"flex-[3] min-w-0 min-h-0 flex flex-col",children:m.jsx(Um.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.2},className:"flex-1 min-h-0 rounded-xl overflow-hidden",children:m.jsx(Fm,{participant:k,track:k.screenTrack??k.cameraTrack??null,trackMuted:k.screenTrack?!1:k.cameraMuted,isScreenShare:!!k.screenTrack,isActive:!0,onClick:r?()=>r(k,i):void 0,className:"h-full w-full"})},k.id)}),m.jsx("div",{className:"w-48 md:w-56 flex-shrink-0 flex flex-col gap-2 overflow-y-auto custom-scrollbar",children:m.jsx(ok,{mode:"popLayout",children:x.map((C,E)=>{const I=E>=i?E+1:E;return m.jsx(Um.div,{layout:!0,initial:{opacity:0,x:8},animate:{opacity:1,x:0},exit:{opacity:0,x:-8},transition:{duration:.2},className:"flex-shrink-0 h-24 md:h-28 rounded-lg overflow-hidden",children:m.jsx(Fm,{participant:C,track:C.screenTrack??C.cameraTrack??null,trackMuted:C.screenTrack?!1:C.cameraMuted,isScreenShare:!!C.screenTrack,onClick:r?()=>r(C,I):void 0,className:"h-full w-full"})},C.id)})})}),c>0&&m.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-black/80 text-zinc-400 text-sm",children:["+",c," katlmc daha"]})]})}const w={display:"grid",gridTemplateColumns:`repeat(${h}, 1fr)`,gridTemplateRows:`repeat(${f}, 1fr)`,gap:8,width:"100%",height:"100%",minHeight:0};return m.jsxs("div",{ref:g,className:`flex-1 flex flex-col min-h-0 w-full p-3 ${o}`,children:[m.jsx("div",{className:"flex-1 min-h-0",style:{minHeight:200},children:m.jsx("div",{style:w,children:m.jsx(ok,{mode:"popLayout",children:a.map((k,x)=>m.jsx(Um.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"min-w-0 min-h-0 aspect-video max-h-full",children:m.jsx(Fm,{participant:k,track:k.screenTrack??k.cameraTrack??null,trackMuted:k.screenTrack?!1:k.cameraMuted,isScreenShare:!!k.screenTrack,onClick:r?()=>r(k,x):void 0,className:"h-full w-full"})},k.id))})})}),c>0&&m.jsx("div",{className:"flex-shrink-0 py-2 text-center",children:m.jsxs("span",{className:"text-sm text-zinc-500",children:["+",c," katlmc daha"]})})]})},Ls=8;function GL({x:t,y:e,streamVolume:n,normalVolume:i,onStreamVolumeChange:r,onNormalVolumeChange:o,onClose:a}){const c=S.useRef(null),u=S.useMemo(()=>({x:t,y:e}),[t,e]);S.useLayoutEffect(()=>{const g=c.current;if(!g)return;const v=g.getBoundingClientRect(),w=window.innerWidth,k=window.innerHeight;let x=u.x,C=u.y;x+v.width+Ls>w&&(x=w-v.width-Ls),x<Ls&&(x=Ls),C+v.height+Ls>k&&(C=k-v.height-Ls),C<Ls&&(C=Ls),g.style.left=`${x}px`,g.style.top=`${C}px`},[u.x,u.y]),S.useEffect(()=>{const g=k=>{c.current&&!c.current.contains(k.target)&&a()},v=k=>{k.key==="Escape"&&a()},w=k=>{c.current&&!c.current.contains(k.target)&&a()};return document.addEventListener("mousedown",g,!0),document.addEventListener("keydown",v),document.addEventListener("contextmenu",w,!0),()=>{document.removeEventListener("mousedown",g,!0),document.removeEventListener("keydown",v),document.removeEventListener("contextmenu",w,!0)}},[a]);const h=n===0,f=i===0;return Hs.createPortal(m.jsx("div",{ref:c,className:"fixed z-[10000] min-w-[220px] py-1.5 rounded-md bg-[#313338] border border-[#1e1f22] shadow-[0_8px_24px_rgba(0,0,0,0.4)] text-[#dbdee1] text-[13px]",style:{left:t,top:e},children:m.jsxs("div",{className:"px-2 py-1",children:[m.jsxs("button",{type:"button",className:"w-full px-2.5 py-2 flex items-center gap-3 rounded text-left transition-colors hover:bg-[#404249]",onClick:()=>{r(h?100:0),a()},children:[h?m.jsx(eg,{size:18,className:"text-[#80848e] flex-shrink-0"}):m.jsx(av,{size:18,className:"text-[#23a559] flex-shrink-0"}),m.jsx("span",{className:"font-medium",children:h?"Yayn sesini a":"Yayn sesini ks"})]}),m.jsxs("button",{type:"button",className:"w-full px-2.5 py-2 flex items-center gap-3 rounded text-left transition-colors hover:bg-[#404249]",onClick:()=>{o(f?100:0),a()},children:[f?m.jsx(eg,{size:18,className:"text-[#80848e] flex-shrink-0"}):m.jsx(Vh,{size:18,className:"text-[#5865f2] flex-shrink-0"}),m.jsx("span",{className:"font-medium",children:f?"Normal sesi a":"Normal sesi ks"})]})]})}),document.body)}function JL({ms:t}){let e="text-green-500",n=eP;return t>150?(e="text-red-500",n=tP):t>80&&(e="text-yellow-500",n=nP),m.jsx("div",{className:"group/ping relative flex items-center justify-center cursor-help",title:`${t} ms`,children:m.jsx(n,{size:16,className:e})})}function Bm({user:t,isFocused:e=!1,isSmall:n=!1,focusedId:i,onFocusToggle:r,cameraTrack:o,screenTrack:a,cameraMuted:c,screenMuted:u}){const h=t.screen&&a,f=t.camera&&o;return m.jsxs("div",{className:`
        relative w-full h-full bg-[#2b2d31] rounded-xl flex items-center justify-center shadow-lg group border border-[#1e1f22] overflow-hidden transition-all duration-300
        ${n?"aspect-video md:aspect-auto md:h-32":"aspect-video"}
        ${e?"ring-1 ring-white/10":""}
      `,children:[h?m.jsxs("div",{className:"absolute inset-0 bg-[#000]",children:[m.jsx(ru,{track:a,muted:!1,className:"w-full h-full object-contain"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none"}),m.jsxs("div",{className:"absolute top-3 right-3 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-md animate-pulse z-20",children:[m.jsx(Zm,{size:10})," YAYINDA"]})]}):f?m.jsxs("div",{className:"absolute inset-0 bg-[#111]",children:[m.jsx(ru,{track:o,muted:c,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent pointer-events-none"})]}):t.screen?m.jsxs("div",{className:"absolute inset-0 bg-[#000] flex items-center justify-center",children:[m.jsx("p",{className:"text-gray-500 text-sm z-10",children:"Ekran ykleniyor..."}),m.jsxs("div",{className:"absolute top-3 right-3 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1 shadow-md animate-pulse z-20",children:[m.jsx(Zm,{size:10})," YAYINDA"]})]}):t.camera?m.jsxs("div",{className:"absolute inset-0 bg-[#111] flex items-center justify-center",children:[m.jsx("img",{src:t.avatar||`https://api.dicebear.com/9.x/avataaars/svg?seed=${t.seed}`,alt:"Kamera",className:"w-full h-full object-cover opacity-80"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"})]}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/20 to-transparent pointer-events-none"}),m.jsx("div",{className:"relative z-10 flex flex-col items-center justify-center",children:m.jsxs("div",{className:`
                relative rounded-full overflow-hidden border-[4px] md:border-[6px] shadow-2xl transition-all duration-300 bg-[#1e1f22]
                ${n?"w-16 h-16 border-[3px]":"w-24 h-24 md:w-32 md:h-32 group-hover:scale-105"}
                ${t.talking&&!t.muted?"border-[#23a559]":"border-transparent"}
                ${t.muted?"border-red-500":""}
              `,children:[m.jsx("img",{src:t.avatar||`https://api.dicebear.com/9.x/avataaars/svg?seed=${t.seed}`,alt:t.name,className:"w-full h-full object-cover"}),t.muted&&m.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center backdrop-blur-[1px]",children:m.jsx(Wc,{size:n?16:32,className:"text-red-500 drop-shadow-md"})})]})})]}),m.jsxs("div",{className:`absolute left-3 z-20 flex items-center gap-2 ${n?"bottom-2":"bottom-3 md:bottom-4 md:left-4"}`,children:[m.jsxs("div",{className:"bg-black/60 backdrop-blur-md px-2 py-1 md:px-3 md:py-1.5 rounded-[4px] flex items-center gap-2 border border-white/5 shadow-sm",children:[m.jsx("span",{className:`font-semibold text-white tracking-wide drop-shadow-sm ${n?"text-xs":"text-sm md:text-base"}`,children:t.name}),!n&&m.jsxs(m.Fragment,{children:[t.muted&&m.jsx(Wc,{size:14,className:"text-red-400"}),t.screen&&m.jsx(av,{size:14,className:"text-gray-300"})]})]}),!n&&t.ping!=null&&t.ping>0&&m.jsx("div",{className:"bg-black/60 backdrop-blur-md p-1.5 rounded-[4px] border border-white/5 shadow-sm",children:m.jsx(JL,{ms:t.ping})})]}),m.jsx("div",{className:"absolute top-2 right-2 z-30 opacity-0 group-hover:opacity-100 transition-opacity flex gap-2",children:m.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),r(i===t.id?null:t.id)},className:"p-1.5 bg-black/50 hover:bg-black/80 text-white rounded-md backdrop-blur-sm transition-colors",children:i===t.id?m.jsx(WE,{size:16}):m.jsx(eS,{size:16})})}),t.talking&&!t.muted&&!t.camera&&!t.screen&&m.jsx("div",{className:"absolute inset-0 rounded-xl border-2 border-[#23a559] opacity-100 transition-opacity pointer-events-none shadow-[inset_0_0_20px_rgba(35,165,89,0.2)] animate-pulse"}),t.talking&&!t.muted&&(t.camera||t.screen)&&m.jsx("div",{className:"absolute inset-0 rounded-xl border-4 border-[#23a559] z-30 pointer-events-none"})]})}function Us({icon:t,active:e,danger:n=!1,success:i=!1,onClick:r,onContextMenu:o,tooltip:a,className:c=""}){return m.jsxs("button",{type:"button",onClick:r,onContextMenu:o,className:`
        group relative p-3 rounded-[8px] transition-all duration-200 flex items-center justify-center active:scale-95
        ${n?"bg-transparent text-[#f2f3f5] hover:bg-[#da373c] hover:text-white":i?"bg-[#23a559] text-white hover:bg-[#1f9651]":e?"bg-transparent text-[#f2f3f5] hover:bg-[#35373c]":"bg-[#f2f3f5] text-[#313338] hover:bg-white"}
        ${c}
      `,children:[m.jsx("div",{className:"relative z-10",children:t}),n&&m.jsx("div",{className:"absolute w-[120%] h-0.5 bg-current rotate-45 rounded-full opacity-60"}),m.jsx("span",{className:"absolute bottom-full mb-3 left-1/2 -translate-x-1/2 bg-black/90 text-[#f2f3f5] text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-medium z-50 shadow-md border border-white/10",children:a}),!n&&!i&&e&&m.jsx("div",{className:"absolute bottom-1 right-1 w-0 h-0 border-l-[3px] border-l-transparent border-r-[3px] border-r-transparent border-t-[3px] border-t-current opacity-60"})]})}function Vd(t,e){if(!t)return{cameraTrack:null,screenTrack:null,cameraMuted:!1,screenMuted:!1};const n=t.get(`${e}:${W.Source.Camera}`),i=t.get(`${e}:${W.Source.ScreenShare}`);return{cameraTrack:n?.track??null,screenTrack:i?.track??null,cameraMuted:n?.muted??!1,screenMuted:i?.muted??!1}}function YL({channelName:t,channelBadge:e="Vip#2",participants:n,videoTracks:i,isMuted:r,isDeafened:o,isVideoOn:a,isScreenShareOn:c,onMicToggle:u,onDeafenToggle:h,onVideoToggle:f,onScreenShareToggle:g,onDisconnect:v,onOpenTextChat:w,streamVolume:k=100,normalVolume:x=100,onStreamVolumeChange:C,onNormalVolumeChange:E}){const[I,N]=S.useState("stage"),[P,R]=S.useState(null),[j,U]=S.useState(0),[F,H]=S.useState(!1),[q,Q]=S.useState(!1),[ne,Se]=S.useState([]),[De,Ke]=S.useState(""),[de,V]=S.useState(!1),[Z,he]=S.useState({x:0,y:0}),oe=pt.useRef(null),L=pt.useRef(null);S.useEffect(()=>{const se=()=>{H(!!document.fullscreenElement&&document.fullscreenElement===oe.current)};return document.addEventListener("fullscreenchange",se),()=>document.removeEventListener("fullscreenchange",se)},[]),S.useEffect(()=>{if(!C||!E)return;const se=_e=>{const Pe=L.current;Pe&&Pe.contains(_e.target)&&(_e.preventDefault(),_e.stopPropagation(),he({x:_e.clientX,y:_e.clientY}),V(!0))};return document.addEventListener("contextmenu",se,!0),()=>document.removeEventListener("contextmenu",se,!0)},[C,E]);const G=()=>{oe.current&&(document.fullscreenElement?document.exitFullscreen():oe.current.requestFullscreen().catch(se=>console.error("Tam ekran hatas:",se)))},ke=()=>{const se=!c;g(),se?(R(n[0]?.id??null),Q(!1)):P===n[0]?.id&&R(null)},Te=se=>{se.preventDefault(),De.trim()&&(Se(_e=>[..._e,{id:Date.now(),user:"Sen",text:De.trim(),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),avatar:"me"}]),Ke(""))},Ne=n.find(se=>se.id===P),Ce=n.filter(se=>se.id!==P),qe=n.map(se=>{const _e=Vd(i,se.id);return{id:se.id,name:se.name,avatar:se.avatar,muted:se.muted,isSpeaking:se.talking,cameraTrack:_e.cameraTrack,screenTrack:_e.screenTrack,cameraMuted:_e.cameraMuted,screenMuted:_e.screenMuted}});return m.jsxs("div",{className:"flex h-full w-full min-h-0 bg-[#1e1f22] text-gray-100 font-sans overflow-hidden",children:[m.jsxs("div",{className:"flex-1 flex flex-col relative bg-black transition-all duration-300 min-w-0",children:[m.jsxs("div",{className:"absolute top-4 left-4 right-4 z-50 flex items-center justify-between gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-md bg-[#1e1f22]/90 hover:bg-[#1e1f22] transition-colors select-none backdrop-blur-sm border border-white/5 shadow-lg",children:[m.jsx(ph,{size:16,className:"text-gray-400"}),m.jsx("span",{className:"font-bold text-sm text-gray-200",children:t}),m.jsx("div",{className:"w-px h-3 bg-gray-600 mx-1"}),m.jsx("span",{className:"text-xs text-green-500 font-mono",children:e})]}),m.jsx("div",{className:"flex rounded-md overflow-hidden border border-white/10 bg-[#1e1f22]/90 backdrop-blur-sm",children:m.jsxs("button",{type:"button",onClick:()=>N(se=>se==="stage"?"grid":se==="grid"?"speaker":"stage"),className:"px-3 py-1.5 text-xs font-medium transition-colors text-gray-400 hover:text-white hover:bg-white/10",title:I==="stage"?"Izgara":I==="grid"?"Konumac (ekran paylam)":"Sahne",children:[m.jsx(Xm,{size:16,className:"inline-block mr-1 align-middle"}),I==="stage"?"Izgara":I==="grid"?"Konumac":"Sahne"]})})]}),m.jsx("div",{ref:oe,className:"video-stage relative flex-1 w-full min-h-0 overflow-hidden p-4 md:p-6 flex flex-col bg-black",children:I==="grid"||I==="speaker"?m.jsx(HL,{participants:qe,mode:I,maxParticipants:12,speakerIndex:j,onParticipantClick:(se,_e)=>U(_e),className:"flex-1 min-h-0"}):m.jsxs(m.Fragment,{children:[F&&m.jsxs("button",{type:"button",onClick:G,className:"fixed top-4 right-4 z-[9999] px-4 py-2 rounded-lg bg-black/80 hover:bg-black text-white text-sm font-medium flex items-center gap-2 border border-white/20 shadow-lg",children:[m.jsx(Db,{size:18})," Tam ekrandan k"]}),P&&Ne?(()=>{const se=Vd(i,Ne.id),_e=se.screenTrack&&se.cameraTrack;return m.jsxs("div",{className:"flex-1 w-full h-full flex flex-col md:flex-row gap-3 md:gap-4 max-w-[1600px] mx-auto min-h-0",children:[m.jsx("div",{className:"flex-1 min-h-0 w-full relative flex flex-col md:flex-row gap-3 min-w-0",children:_e?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex-1 min-w-0 min-h-0 relative rounded-xl overflow-hidden bg-[#000] border border-white/10",children:[m.jsx(ru,{track:se.screenTrack,muted:!1,className:"w-full h-full object-contain"}),m.jsxs("div",{className:"absolute top-2 right-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1 shadow-md animate-pulse z-10",children:[m.jsx(Zm,{size:10})," YAYINDA"]})]}),m.jsx("div",{className:"flex-1 min-w-0 min-h-0 rounded-xl overflow-hidden bg-[#2b2d31] border border-white/10 flex flex-col",children:m.jsxs("div",{className:"flex-1 min-h-0 relative",children:[m.jsx(ru,{track:se.cameraTrack,muted:se.cameraMuted,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent pointer-events-none"}),m.jsx("div",{className:"absolute bottom-2 left-2 right-2 flex items-center gap-2 z-10",children:m.jsx("span",{className:"text-sm font-medium text-white truncate drop-shadow-lg",children:Ne.name})})]})})]}):m.jsx("div",{className:"flex-1 min-h-0 w-full relative",children:m.jsx(Bm,{user:Ne,isFocused:!0,focusedId:P,onFocusToggle:R,...se})})}),m.jsx("div",{className:"h-32 md:h-full w-full md:w-64 flex md:flex-col gap-3 overflow-x-auto md:overflow-y-auto pr-2 pb-2 flex-shrink-0",children:Ce.map(Pe=>m.jsx("div",{className:"min-w-[200px] md:min-w-0 md:min-h-[140px] flex-shrink-0",children:m.jsx(Bm,{user:Pe,isSmall:!0,focusedId:P,onFocusToggle:R,...Vd(i,Pe.id)})},Pe.id))})]})})():n.length===0?m.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-500",children:[m.jsx(ph,{size:48,className:"mb-4 opacity-50"}),m.jsx("p",{className:"text-sm",children:"Henz kimse yok."})]}):m.jsx("div",{className:"flex-1 w-full h-full flex items-center justify-center overflow-y-auto min-h-0",children:m.jsx("div",{className:`
                  w-full max-w-[1400px] grid gap-4 md:gap-6 auto-rows-fr h-fit max-h-full transition-all duration-300
                  ${q?"grid-cols-1 lg:grid-cols-2":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}
                `,children:n.map(se=>m.jsx("div",{className:"w-full h-full min-h-[180px]",children:m.jsx(Bm,{user:se,focusedId:P,onFocusToggle:R,...Vd(i,se.id)})},se.id))})})]})}),m.jsx("div",{className:"flex-shrink-0 w-full pb-6 pt-2 px-4 flex justify-center z-50 pointer-events-none",children:m.jsxs("div",{ref:L,className:"pointer-events-auto bg-[#111214] px-4 py-2.5 rounded-[12px] flex items-center gap-2 shadow-[0_8px_24px_rgba(0,0,0,0.5)] border border-[#1e1f22]",children:[m.jsx(Us,{icon:r?m.jsx(Wc,{size:20}):m.jsx(Vh,{size:20}),active:!r,danger:r,onClick:u,tooltip:r?"Sesi A":"Sustur"}),m.jsx(Us,{icon:m.jsx(LE,{size:20}),active:!o,onClick:h,tooltip:o?"Sesi A":"Sarlatr (sa tk: ses ayarlar)"}),m.jsx(Us,{icon:a?m.jsx(aP,{size:20}):m.jsx(lP,{size:20}),active:a,onClick:f,tooltip:a?"Kameray Kapat":"Kameray A"}),m.jsx(Us,{icon:c?m.jsx(HE,{size:20}):m.jsx(av,{size:20}),active:c,success:c,onClick:ke,tooltip:c?"Paylam Durdur":"Ekran Payla"}),m.jsx("div",{className:"w-px h-8 bg-[#3f4147] mx-2"}),m.jsxs("button",{type:"button",onClick:v,className:"group relative p-3 rounded-[8px] bg-[#da373c] hover:bg-[#a1282c] text-white transition-all duration-200 flex items-center justify-center shadow-lg active:scale-95",title:"Balanty Kes",children:[m.jsx(QE,{size:22}),m.jsx("span",{className:"absolute bottom-full mb-3 left-1/2 -translate-x-1/2 bg-black/90 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"Balanty Kes"})]}),m.jsx("div",{className:"w-px h-8 bg-[#3f4147] mx-2"}),m.jsx(Us,{icon:q?m.jsx(jb,{size:20,fill:"currentColor"}):m.jsx(jb,{size:20}),active:q,onClick:()=>Q(!q),tooltip:"Sohbeti Gster",className:q?"text-white":""}),m.jsx(Us,{icon:m.jsx(iS,{size:20}),active:!1,onClick:()=>{},tooltip:"Ayarlar"}),m.jsx(Us,{icon:P?m.jsx(Xm,{size:20}):m.jsx(eS,{size:20}),active:!1,onClick:()=>R(P?null:n[0]?.id??null),tooltip:P?"Izgara Grnm":"Odaklan"}),m.jsx(Us,{icon:F?m.jsx(Db,{size:20}):m.jsx($E,{size:20}),active:F,onClick:G,tooltip:F?"Tam Ekrandan k":"Yayn Tam Ekran Yap"})]})})]}),m.jsxs("div",{className:`
          flex flex-col bg-[#2b2d31] border-l border-[#1e1f22] transition-all duration-300 ease-in-out flex-shrink-0
          ${q?"w-80 opacity-100 translate-x-0":"w-0 opacity-0 translate-x-full overflow-hidden"}
        `,children:[m.jsxs("div",{className:"h-12 border-b border-[#1e1f22] flex items-center justify-between px-4 bg-[#2b2d31] shadow-sm flex-shrink-0",children:[m.jsx("span",{className:"font-semibold text-gray-200 text-sm",children:"Sohbet"}),m.jsx("button",{type:"button",onClick:()=>Q(!1),className:"text-gray-400 hover:text-white p-1",children:m.jsx(Go,{size:18})})]}),m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 custom-scrollbar",children:ne.length===0?m.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Henz mesaj yok."}):ne.map(se=>m.jsxs("div",{className:"flex gap-3 group",children:[m.jsx("img",{src:`https://api.dicebear.com/9.x/avataaars/svg?seed=${se.avatar}`,alt:"",className:"w-10 h-10 rounded-full bg-[#1e1f22] mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[m.jsx("span",{className:"font-medium text-gray-100 text-sm",children:se.user}),m.jsx("span",{className:"text-[10px] text-gray-400",children:se.time})]}),m.jsx("p",{className:"text-gray-300 text-sm leading-relaxed whitespace-pre-wrap break-words",children:se.text})]})]},se.id))}),m.jsx("div",{className:"p-4 bg-[#2b2d31] flex-shrink-0 border-t border-[#1e1f22]",children:m.jsxs("form",{onSubmit:Te,className:"relative",children:[m.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white cursor-pointer w-5 h-5 rounded-full bg-gray-600 flex items-center justify-center text-[10px] font-bold",children:"+"}),m.jsx("input",{type:"text",value:De,onChange:se=>Ke(se.target.value),placeholder:"#genel-sohbet kanalna mesaj gnder",className:"w-full bg-[#383a40] text-gray-100 text-sm rounded-lg py-2.5 pl-10 pr-10 outline-none focus:ring-0 placeholder-gray-500 border border-transparent focus:border-white/20"}),m.jsx("button",{type:"submit",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white cursor-pointer",children:m.jsx(nS,{size:18})})]})})]}),de&&C&&E&&m.jsx(GL,{x:Z.x,y:Z.y,streamVolume:k,normalVolume:x,onStreamVolumeChange:C,onNormalVolumeChange:E,onClose:()=>V(!1)})]})}const W1=pt.memo(({user:t,voiceState:e,setVoiceState:n,voiceChannelUsers:i,livekitSpeakingIds:r,livekitVideoTracks:o,setLivekitFocusedKey:a,livekitPinnedKey:c,setLivekitPinnedKey:u,livekitFullscreen:h,setLivekitFullscreen:f,focusedKey:g,focusedEntry:v,focusedId:w,isFullscreen:k,setActiveChannelId:x,setChannelType:C,setConnectedVoiceChannelId:E,setVoiceChannelUsers:I,addToast:N,channelName:P="Ses Kanal",onOpenTextChat:R})=>{const j=async()=>{try{await Ct.leaveRoom(),E?.(null),x(null),C("text"),I([]),a(null),u(null),f(!1),N("Ses kanalndan ayrldn.","info")}catch{N("Ses kanalndan ayrlrken hata olutu","error")}},U=async()=>{try{const de=!e.video;await Ct.setCameraEnabled(de),n(V=>({...V,video:de}))}catch(de){N(de instanceof Error?de.message:"Kamera alamad","error"),n(V=>({...V,video:!1}))}},F=async()=>{try{const de=!e.mic;await Ct.setMicrophoneEnabled(de),n(V=>({...V,mic:de}))}catch(de){N(de instanceof Error?de.message:"Mikrofon alamad","error"),n(V=>({...V,mic:!1}))}},H=async()=>{try{const de=!e.deafen;if(await Ct.setDeafened(de),!de){const V=(e.normalVolume??100)/100,Z=(e.streamVolume??100)/100;Ct.setRemoteVolumes(V,Z)}n(V=>({...V,deafen:de,mic:de?!1:V.mic}))}catch(de){N(de instanceof Error?de.message:"Ses ayar yaplamad","error"),n(V=>({...V,deafen:!1}))}},q=de=>{n(Z=>({...Z,streamVolume:de}));const V=(e.normalVolume??100)/100;Ct.setRemoteVolumes(V,de/100)},Q=de=>{n(Z=>({...Z,normalVolume:de}));const V=(e.streamVolume??100)/100;Ct.setRemoteVolumes(de/100,V)},ne=async()=>{try{const de=!e.screenShare;await Ct.setScreenShareEnabled(de),n(V=>({...V,screenShare:de}))}catch(de){N(de instanceof Error?de.message:"Ekran paylam balatlamad","error"),n(V=>({...V,screenShare:!1}))}},Se=S.useMemo(()=>({id:t.id,username:t.username,avatar_url:t.avatar,avatar:t.avatar,muted:!e.mic,deafened:e.deafen,video_enabled:e.video,screen_share_enabled:e.screenShare}),[t,e]),De=S.useMemo(()=>{const de=i.filter(V=>V.id!==t.id);return[Se,...de]},[Se,i,t.id]),Ke=S.useMemo(()=>De.map(de=>({id:de.id,name:de.id===t.id?"Sen":de.username||`User-${de.id.slice(-4)}`,seed:de.username||de.id.slice(-8)||de.id,talking:r.has(de.id),muted:de.muted??!1,camera:de.video_enabled??!1,screen:de.screen_share_enabled??!1,avatar:de.avatar_url||de.avatar})),[De,t.id,r]);return m.jsx(YL,{channelName:P,channelBadge:"Ses",participants:Ke,videoTracks:o,isMuted:!e.mic,isDeafened:e.deafen,isVideoOn:e.video,isScreenShareOn:e.screenShare,onMicToggle:F,onDeafenToggle:H,onVideoToggle:U,onScreenShareToggle:ne,onDisconnect:j,onOpenTextChat:R,streamVolume:e.streamVolume??100,normalVolume:e.normalVolume??100,onStreamVolumeChange:q,onNormalVolumeChange:Q})});W1.displayName="VoiceChannelControls";const sl=t=>{if(t==="online"||t==="idle"||t==="dnd"||t==="invisible")return t};function QL(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function XL(t){const e=[],n=[];let i=t;return i=i.replace(/\[IMG:(https?:\/\/[^\]]+)\]/g,(r,o)=>(e.push(o),"")),i=i.replace(/\[FILE:(https?:\/\/[^\]]+)\]/g,(r,o)=>(n.push(o),"")),i=i.replace(/\n{2,}/g,`
`).trim(),{text:i,imageUrls:e,fileUrls:n}}function ZL(t){try{const n=new URL(t).pathname.split("/").pop()||"Dosya";return decodeURIComponent(n).slice(0,60)||"Dosya"}catch{return"Dosya"}}const $c=2e3,kx=2,xx=100,Sx=1,Tx=100,e3=10,Cx=e3*1024*1024,H1=["image/jpeg","image/png","image/gif","image/webp"],G1=[...H1,"application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],_x="message-attachments",t3=8e3,J1=pt.memo(({messages:t,messagesLoading:e=!1,typingUsers:n=[],user:i,inputVal:r,setInputVal:o,onSendMessage:a,onDeleteMessage:c,onEditMessage:u,bottomRef:h,channelType:f,serverChannels:g,activeChannelId:v,activeServerId:w,activeDmUser:k,showMembers:x,setShowMembers:C,voiceState:E,setVoiceState:I,setActiveChannelId:N,setChannelType:P,setConnectedVoiceChannelId:R,setVoiceChannelUsers:j,addToast:U,voiceChannelUsers:F,livekitSpeakingIds:H,livekitVideoTracks:q,livekitFocusedKey:Q,setLivekitFocusedKey:ne,livekitPinnedKey:Se,setLivekitPinnedKey:De,livekitFullscreen:Ke,setLivekitFullscreen:de,attachmentPreviewUrl:V=null,attachmentName:Z="",onAttachmentSelect:he,onAttachmentClear:oe})=>{const L=pt.useRef(null),G=pt.useRef(null),[ke,Te]=S.useState(null),[Ne,Ce]=S.useState(""),[qe,se]=S.useState(!1);pt.useEffect(()=>{if(!qe)return;const be=jt=>{G.current&&!G.current.contains(jt.target)&&se(!1)};return document.addEventListener("mousedown",be),()=>document.removeEventListener("mousedown",be)},[qe]);const[_e,Pe]=S.useState(!1),[zt,mt]=S.useState(""),Et=zt.trim().toLowerCase(),wt=Et?t.filter(be=>String(be.content||"").toLowerCase().includes(Et)):t,kn=Array.from(q.entries()),hi=kn.find(([,be])=>be.source===W.Source.ScreenShare)?.[0]||null;let $t=null;for(const be of Array.from(H)){const jt=kn.find(([xn,Sn])=>xn.startsWith(`${be}:`)&&Sn.source===W.Source.ScreenShare)?.[0],Gn=kn.find(([xn,Sn])=>xn.startsWith(`${be}:`)&&Sn.source===W.Source.Camera)?.[0];if($t=jt||Gn||null,$t)break}const et=Se||Q||hi||$t,Hn=et?q.get(et):null,Zt=et?et.split(":")[0]:null,en=Ke&&!!Hn;return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"h-14 flex items-center justify-between px-4 mb-2 flex-shrink-0 md:bg-transparent bg-black/20",children:[m.jsx("div",{className:"flex items-center gap-3",children:w==="dm"?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-zinc-400 text-lg",children:"@"}),m.jsx("h3",{className:"text-xl font-bold text-white",children:k?.name})]}):f==="text"?m.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[m.jsx(ov,{size:20,className:"text-orange-400"}),g.find(be=>be.id===v)?.name]}):m.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[m.jsx(tS,{className:"animate-pulse"}),m.jsx("h3",{className:"text-xl font-bold text-white",children:g.find(be=>be.id===v)?.name})]})}),m.jsxs("div",{className:"flex items-center gap-2",children:[f==="text"&&m.jsx(m.Fragment,{children:_e?m.jsxs("div",{className:"flex items-center gap-1 bg-white/5 rounded-xl px-2 py-1.5 border border-white/10",children:[m.jsx(Jd,{size:18,className:"text-zinc-400 flex-shrink-0"}),m.jsx("input",{value:zt,onChange:be=>mt(be.target.value),placeholder:"Mesajlarda ara...",className:"bg-transparent text-white placeholder-zinc-500 focus:outline-none w-40 text-sm",autoFocus:!0}),m.jsx("button",{type:"button",onClick:()=>{Pe(!1),mt("")},className:"p-1 text-zinc-400 hover:text-white",title:"Kapat",children:m.jsx(Go,{size:16})})]}):m.jsx("button",{onClick:()=>Pe(!0),className:"p-2 rounded-xl hover:bg-white/5 text-zinc-400",title:"Mesajlarda ara",children:m.jsx(Jd,{size:20})})}),m.jsx("button",{onClick:()=>C(!x),className:`p-2 rounded-xl transition-colors hidden md:block ${x?"bg-white/10 text-white":"hover:bg-white/5 text-zinc-400"}`,children:m.jsx(Xm,{size:20})})]})]}),m.jsx(Ko,{className:"flex-1 rounded-none md:rounded-3xl overflow-hidden flex flex-col relative border-white/5 border-x-0 md:border-x border-b-0 md:border-b",children:f==="voice"?m.jsx(W1,{user:i,voiceState:E,setVoiceState:I,voiceChannelUsers:F,livekitSpeakingIds:H,livekitVideoTracks:q,livekitFocusedKey:Q,setLivekitFocusedKey:ne,livekitPinnedKey:Se,setLivekitPinnedKey:De,livekitFullscreen:Ke,setLivekitFullscreen:de,focusedKey:et,focusedEntry:Hn??null,focusedId:Zt,isFullscreen:en,setActiveChannelId:N,setChannelType:P,setConnectedVoiceChannelId:R,setVoiceChannelUsers:j,addToast:U,channelName:g.find(be=>be.id===v)?.name??"Ses Kanal",onOpenTextChat:()=>{const be=g.find(jt=>jt.type==="text");be&&(P("text"),N(be.id))}}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-6 custom-scrollbar",children:[e?m.jsxs("div",{className:"py-20 flex flex-col items-center justify-center gap-4",children:[m.jsx(qs,{className:"animate-spin text-orange-500",size:40}),m.jsx("p",{className:"text-sm text-zinc-500",children:"Mesajlar ykleniyor..."})]}):wt.length===0?m.jsx("div",{className:"py-20 text-center opacity-50 select-none",children:Et?m.jsxs(m.Fragment,{children:[m.jsx(Jd,{size:40,className:"mx-auto mb-4 text-zinc-500"}),m.jsx("h3",{className:"text-xl font-bold",children:"Sonu bulunamad"}),m.jsxs("p",{className:"text-sm",children:['"',zt,'" ile eleen mesaj yok.']})]}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"w-20 h-20 bg-white/5 rounded-full mx-auto flex items-center justify-center mb-4",children:m.jsx(KE,{size:40})}),m.jsx("h3",{className:"text-xl font-bold",children:"Sohbetin Balangc"}),m.jsx("p",{className:"text-sm",children:'Buras balang noktas. lk "merhaba"y sen de!'})]})}):m.jsxs(m.Fragment,{children:[Et&&m.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-white/5 rounded-xl mb-2 text-sm text-zinc-400",children:[m.jsxs("span",{children:['Arama: "',zt,'"  ',wt.length," mesaj"]}),m.jsx("button",{type:"button",onClick:()=>{mt(""),Pe(!1)},className:"text-orange-400 hover:underline",children:"Temizle"})]}),wt.map(be=>m.jsxs("div",{className:`flex gap-4 ${be.isMe?"flex-row-reverse":""} group animate-in slide-in-from-bottom-2 duration-300`,children:[m.jsx("div",{className:"flex-shrink-0 mt-auto",children:!be.isMe&&m.jsx(Xr,{src:be.avatar,size:"md",status:void 0,onClick:void 0})}),m.jsxs("div",{className:`flex flex-col max-w-[80%] md:max-w-[70%] ${be.isMe?"items-end":"items-start"}`,children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1 px-1",children:[m.jsx("span",{className:"text-xs font-bold text-zinc-400 cursor-pointer hover:underline",children:be.user}),m.jsx("span",{className:"text-[10px] text-zinc-600",children:be.time})]}),ke===be.id&&u?m.jsxs("div",{className:"flex gap-2 items-center w-full",children:[m.jsx("input",{value:Ne,onChange:jt=>Ce(jt.target.value),maxLength:$c,className:"flex-1 bg-black/40 border border-white/10 rounded-xl px-3 py-2 text-sm text-white focus:outline-none focus:border-orange-500",autoFocus:!0}),m.jsx("button",{type:"button",onClick:()=>{u(be.id,Ne),Te(null),Ce("")},className:"p-2 text-green-400 hover:bg-white/10 rounded-lg",title:"Kaydet",children:m.jsx(IE,{size:16})}),m.jsx("button",{type:"button",onClick:()=>{Te(null),Ce("")},className:"p-2 text-zinc-400 hover:bg-white/10 rounded-lg",title:"ptal",children:m.jsx(Go,{size:16})})]}):m.jsxs("div",{className:`px-5 py-3 rounded-2xl text-sm leading-relaxed shadow-sm relative break-words group/bubble
                                                ${be.isMe?"bg-gradient-to-br from-orange-600 to-red-600 text-white rounded-br-none":"bg-white/10 text-zinc-100 rounded-bl-none border border-white/5"}`,children:[(()=>{const{text:jt,imageUrls:Gn,fileUrls:xn}=XL(String(be.content||""));return m.jsxs(m.Fragment,{children:[Gn.length>0&&m.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Gn.map((Sn,dn)=>m.jsx("a",{href:Sn,target:"_blank",rel:"noopener noreferrer",className:"block rounded-lg overflow-hidden max-w-[280px] max-h-[280px] border border-white/10",children:m.jsx("img",{src:Sn,alt:"",className:"max-w-full max-h-[280px] object-contain",loading:"lazy"})},dn))}),xn.length>0&&m.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:xn.map((Sn,dn)=>m.jsxs("a",{href:Sn,target:"_blank",rel:"noopener noreferrer",className:"text-sm underline text-orange-300 hover:text-orange-200 flex items-center gap-1",children:[" ",ZL(Sn)]},dn))}),jt?m.jsx("span",{dangerouslySetInnerHTML:{__html:QL(jt).replace(/\n/g,"<br/>")}}):null]})})(),be.isMe&&u&&m.jsxs(m.Fragment,{children:[m.jsx("button",{type:"button",onClick:()=>{Te(be.id),Ce(String(be.content||""))},className:"absolute -top-3 -right-12 bg-black/80 p-1.5 rounded-full text-zinc-400 opacity-0 group-hover/bubble:opacity-100 hover:text-white transition-all border border-white/10",title:"Dzenle",children:m.jsx(YE,{size:12})}),m.jsx("button",{type:"button",onClick:()=>c(be.id),className:"absolute -top-3 -right-3 bg-black/80 p-1.5 rounded-full text-red-400 opacity-0 group-hover/bubble:opacity-100 hover:text-red-300 transition-all border border-white/10",title:"Mesaj Sil",children:m.jsx(rS,{size:12})})]})]})]})]},be.id))]}),m.jsx("div",{ref:h})]}),n.length>0&&f==="text"&&m.jsxs("div",{className:"px-4 py-1 text-xs text-zinc-500 italic flex items-center gap-1",children:[m.jsx("span",{className:"animate-pulse",children:""}),n.map(be=>be.username).join(", ")," yazyor..."]}),m.jsxs("div",{className:"p-4 pt-2",children:[V&&m.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-white/5 rounded-xl border border-white/10",children:[V.startsWith("blob:")&&/\.(jpe?g|png|gif|webp)$/i.test(Z||"")?m.jsx("img",{src:V,alt:"",className:"w-12 h-12 object-cover rounded-lg"}):null,m.jsx("span",{className:"text-sm text-zinc-300 truncate flex-1",children:Z||"Dosya"}),oe&&m.jsx("button",{type:"button",onClick:oe,className:"p-1 text-zinc-400 hover:text-white",title:"Kaldr",children:m.jsx(Go,{size:16})})]}),m.jsxs("div",{className:"bg-black/40 backdrop-blur-md border border-white/10 rounded-2xl p-2 flex items-center gap-2 focus-within:border-orange-500/50 focus-within:ring-1 focus-within:ring-orange-500/20 transition-all shadow-lg",children:[f==="text"&&he?m.jsxs(m.Fragment,{children:[m.jsx("input",{ref:L,type:"file",className:"hidden",accept:G1.join(","),onChange:be=>{const jt=be.target.files?.[0];jt&&he(jt),be.target.value=""}}),m.jsx("button",{type:"button",onClick:()=>L.current?.click(),className:"p-2 text-zinc-400 hover:text-white bg-white/5 rounded-xl hover:bg-white/10 transition-colors",title:"Dosya ekle",children:m.jsx(JE,{size:20})})]}):m.jsx("button",{type:"button",className:"p-2 text-zinc-400 hover:text-white bg-white/5 rounded-xl hover:bg-white/10 transition-colors",children:m.jsx(Hc,{size:20})}),m.jsx("form",{onSubmit:a,className:"flex-1",children:m.jsx("input",{value:r,onChange:be=>o(be.target.value),placeholder:"Bir mesaj yaz...",maxLength:$c,className:"w-full bg-transparent text-white placeholder-zinc-500 focus:outline-none h-10 px-2"})}),m.jsxs("div",{className:"flex items-center gap-1 pr-2 relative",children:[m.jsxs("div",{className:"relative",ref:G,children:[m.jsx("button",{type:"button",onClick:()=>se(be=>!be),className:"p-2 text-zinc-400 hover:text-orange-400",title:"Emoji",children:m.jsx(iP,{size:20})}),qe&&m.jsx("div",{className:"absolute bottom-full right-0 mb-1 p-2 bg-[#18181b] border border-white/10 rounded-xl shadow-xl flex flex-wrap gap-1 max-w-[200px] z-10",children:["","","","","","","","","","","",""].map(be=>m.jsx("button",{type:"button",onClick:()=>{o(r+be),se(!1)},className:"p-1.5 hover:bg-white/10 rounded-lg text-lg",children:be},be))})]}),(r.length>0||V)&&m.jsx("button",{type:"button",onClick:be=>{be.preventDefault(),a(be)},className:"p-2 bg-orange-600 text-white rounded-xl shadow-lg hover:bg-orange-700 transition-all transform hover:scale-105",children:m.jsx(nS,{size:18})})]})]})]})]})})]})});J1.displayName="ChatArea";const vn=({children:t,primary:e,danger:n,success:i,onClick:r,className:o="",disabled:a,icon:c})=>m.jsxs("button",{onClick:r,disabled:a,className:`px-6 py-2.5 rounded-xl font-medium transition-colors duration-150 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 select-none
      ${e?"bg-gradient-to-r from-orange-600 to-red-600 text-white shadow-lg shadow-orange-500/20 hover:shadow-orange-500/40":n?"bg-rose-500/10 text-rose-400 hover:bg-rose-500/20 border border-rose-500/20":i?"bg-green-600 text-white hover:bg-green-700 shadow-lg shadow-green-500/20":"bg-white/5 text-zinc-200 hover:bg-white/10 border border-white/5 hover:border-white/10"} 
      ${o}`,children:[c&&m.jsx(c,{size:18}),t]}),Y1=pt.memo(({channel:t,isActive:e,onClick:n,onDelete:i,currentUser:r,currentServer:o,children:a})=>{const{attributes:c,listeners:u,setNodeRef:h,transform:f,transition:g}=dj({id:t.id}),[v,w]=S.useState(!1),k=S.useRef(null),x={transform:nu.Transform.toString(f),transition:g},C=P=>{P.preventDefault(),P.stopPropagation(),n&&n(P)},E=P=>{P.preventDefault(),P.stopPropagation(),w(!0)},I=P=>{P.preventDefault(),P.stopPropagation(),i&&window.confirm(`"${t.name}" kanaln silmek istediinize emin misiniz?`)&&i(t.id),w(!1)};S.useEffect(()=>{const P=R=>{k.current&&!k.current.contains(R.target)&&w(!1)};if(v)return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[v]);const N=o?.ownerId===r?.id;return m.jsxs("div",{ref:h,style:x,...c,...u,className:"touch-none transform-gpu relative",children:[m.jsxs("div",{onClick:C,onContextMenu:E,className:`flex items-center gap-3 px-3 py-2 rounded-xl cursor-pointer transition-colors duration-100 group relative select-none
                ${e?"bg-gradient-to-r from-orange-500/20 to-red-500/10 text-white border border-orange-500/30":"text-zinc-400 hover:bg-white/5 hover:text-zinc-200 border border-transparent"}`,children:[t.type==="text"?m.jsx(ov,{size:18,className:e?"text-orange-400":"opacity-50"}):m.jsx(tS,{size:18,className:e?"text-red-400":"opacity-50"}),m.jsx("span",{className:"font-medium text-sm truncate select-none flex-1",children:t.name}),N&&m.jsx("button",{onClick:P=>{P.preventDefault(),P.stopPropagation(),w(!v)},className:`flex-shrink-0 p-1 hover:bg-white/10 rounded transition-opacity ${e?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:m.jsx(fh,{size:14})})]}),v&&N&&m.jsx("div",{ref:k,className:"absolute left-full ml-2 top-0 bg-[#18181b] border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50 min-w-[180px] animate-in slide-in-from-left-2 fade-in",children:m.jsxs("button",{onClick:I,className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-colors",children:[m.jsx(rS,{size:16}),"Kanal Sil"]})}),a]})});Y1.displayName="SortableChannelItem";const Q1=pt.memo(({activeServerId:t,handleDmSelect:e,handleDragEnd:n,filteredFriends:i,activeDmUser:r,setShowAddFriend:o,currentServer:a,categories:c,serverChannels:u,activeChannelId:h,setActiveChannelId:f,setChannelType:g,connectedVoiceChannelId:v,setConnectedVoiceChannelId:w,setLastTextChannelIdForServer:k,setMobileMenuOpen:x,setModals:C,setNewChannelCategory:E,sensors:I,user:N,authUser:P,addToast:R,fetchVoiceChannelUsers:j,setVoiceChannelUsers:U,onDeleteChannel:F,onlineUserIds:H=new Set})=>m.jsxs(Ko,{className:"h-full flex flex-col rounded-none md:rounded-3xl overflow-hidden border-y-0 md:border-y border-l-0 md:border-l",children:[t==="dm"?m.jsxs("div",{className:"p-4 flex flex-col h-full",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6 px-2",children:[m.jsx("h2",{className:"text-xl font-bold",children:"Mesajlar"}),m.jsx(vn,{onClick:()=>o(!0),className:"h-8 px-3 py-0 bg-green-600/20 text-green-400 hover:bg-green-600/30 border-green-600/30 text-xs",children:"Arkada Ekle"})]}),m.jsx("div",{className:"space-y-1 overflow-y-auto pr-1 flex-1 custom-scrollbar",children:i.length===0?m.jsx("p",{className:"text-zinc-500 text-center text-sm mt-4",children:"Kimse bulunamad."}):i.map(q=>m.jsxs("div",{onClick:()=>e(q),className:`flex items-center gap-3 p-3 rounded-2xl cursor-pointer transition-colors group
             ${r?.id===q.id?"bg-white/10":"hover:bg-white/5"}`,children:[m.jsx(Xr,{src:q.avatar,size:"sm",status:H.has(q.id)?"online":sl(q.status),onClick:void 0}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("div",{className:"flex justify-between items-center",children:m.jsx("div",{className:`text-sm font-medium transition-colors truncate ${r?.id===q.id?"text-white":"text-zinc-300"}`,children:q.name})}),m.jsx("div",{className:"text-xs text-zinc-500 truncate group-hover:text-zinc-400",children:q.lastMsg})]})]},q.id))})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"h-16 flex items-center justify-between px-6 border-b border-white/5 flex-shrink-0",children:[m.jsx("div",{className:"font-bold text-lg tracking-wide truncate cursor-pointer hover:text-zinc-300 transition-colors",onClick:()=>C(q=>({...q,serverSettings:!0})),children:a.name}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("button",{onClick:()=>C(q=>({...q,createCategory:!0})),className:"p-2 text-zinc-500 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"Kategori Ekle",children:m.jsx(DE,{size:18})}),m.jsx("button",{onClick:()=>{E("GENEL"),C(q=>({...q,addChannel:!0}))},className:"p-2 text-zinc-500 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:"Kanal Ekle",children:m.jsx(Hc,{size:20})}),m.jsx("button",{onClick:()=>C(q=>({...q,serverSettings:!0})),className:"p-2 text-zinc-500 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:a.ownerId===N.id?m.jsx(iS,{size:18}):m.jsx(fh,{size:18})})]})]}),m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar",children:Object.keys(c).length===0?m.jsx("p",{className:"text-zinc-500 text-center text-sm mt-10",children:"Kanal bulunamad."}):m.jsx(KA,{sensors:I,collisionDetection:KO,onDragEnd:n,children:m.jsx(rj,{items:u.map(q=>q.id),strategy:nj,children:Object.entries(c).map(([q,Q])=>m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between px-3 mb-2 group cursor-pointer mt-4 first:mt-0",children:[m.jsx("span",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-widest",children:q}),m.jsx(Hc,{size:14,onClick:ne=>{ne.stopPropagation(),E(q),C(Se=>({...Se,addChannel:!0}))},className:"text-zinc-500 opacity-0 group-hover:opacity-100 hover:text-orange-400 transition-all"})]}),m.jsx("div",{className:"space-y-1",children:Q.map(ne=>m.jsx(Y1,{channel:ne,isActive:ne.type==="voice"?h===ne.id||v===ne.id:h===ne.id,onDelete:F,currentUser:N,currentServer:a,onClick:Se=>{if(Se.preventDefault(),Se.stopPropagation(),x(!1),ne.type==="text"){f(ne.id),g("text"),t&&k&&k(t,ne.id);return}if(ne.type!=="voice"||!P?.id)return;const De=N.username||P.email||"User";if(v===ne.id){h===ne.id?Ct.leaveRoom().then(()=>{w(null),f(null),g("text"),U([]),R("Ses kanalndan ayrldn.","info")}).catch(Ke=>{R("Ses kanalndan ayrlrken hata olutu","error")}):(f(ne.id),g("voice"));return}v?Ct.leaveRoom().then(()=>{Ct.joinRoom(ne.id,P.id,De).then(()=>{w(ne.id),f(ne.id),g("voice"),j(ne.id),R(`${ne.name} ses kanalna katldn.`,"success")}).catch(Ke=>{R("Ses kanalna katlamad: "+(Ke?.message||"Bilinmeyen hata"),"error")})}):Ct.joinRoom(ne.id,P.id,De).then(()=>{w(ne.id),f(ne.id),g("voice"),j(ne.id),R(`${ne.name} ses kanalna katldn.`,"success")}).catch(Ke=>{R("Ses kanalna katlamad: "+(Ke?.message||"Bilinmeyen hata"),"error")})},children:ne.type==="voice"&&(ne.id===h||ne.id===v)&&m.jsx("div",{className:"pl-8 pb-2",children:m.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-white/5 rounded-lg border border-white/5 mx-1",children:[m.jsx(Xr,{src:N.avatar,size:"sm",className:"w-5 h-5",status:void 0,onClick:void 0}),m.jsx("span",{className:"text-xs font-bold text-white truncate",children:N.username})]})})},ne.id))})]},q))})})})]}),m.jsx(X1,{user:N,setModals:C})]}));Q1.displayName="Sidebar";const X1=pt.memo(({user:t,setModals:e})=>{const[n,i]=S.useState({mic:!0,deafen:!1});return m.jsxs("div",{className:"p-4 border-t border-white/5 bg-black/20 flex-shrink-0 flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:opacity-80",onClick:()=>e(r=>({...r,profile:!0})),children:[m.jsx(Xr,{src:t.avatar,size:"sm",status:sl(t.status),onClick:void 0}),m.jsxs("div",{className:"text-xs",children:[m.jsx("div",{className:"font-bold text-white",children:t.username}),m.jsx("div",{className:"text-zinc-500",children:t.discriminator})]})]}),m.jsxs("div",{className:"flex gap-1",children:[m.jsx("button",{onClick:()=>i(r=>({...r,mic:!r.mic})),className:`p-1.5 rounded-lg ${n.mic?"hover:bg-white/10 text-zinc-400":"bg-red-500/20 text-red-500"}`,children:n.mic?m.jsx(Vh,{size:16}):m.jsx(Wc,{size:16})}),m.jsx("button",{onClick:()=>i(r=>({...r,deafen:!r.deafen})),className:`p-1.5 rounded-lg ${n.deafen?"bg-red-500/20 text-red-500":"hover:bg-white/10 text-zinc-400"}`,children:n.deafen?m.jsx(eg,{size:16}):m.jsx(ph,{size:16})})]})]})});X1.displayName="UserMiniBar";function lf(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function n3(t,e,n,i){function r(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(f){try{h(i.next(f))}catch(g){a(g)}}function u(f){try{h(i.throw(f))}catch(g){a(g)}}function h(f){f.done?o(f.value):r(f.value).then(c,u)}h((i=i.apply(t,e||[])).next())})}const i3=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class T0 extends Error{constructor(e,n="FunctionsError",i){super(e),this.name=n,this.context=i}}class r3 extends T0{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ex extends T0{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Px extends T0{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Gg;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Gg||(Gg={}));class s3{constructor(e,{headers:n={},customFetch:i,region:r=Gg.Any}={}){this.url=e,this.headers=n,this.region=r,this.fetch=i3(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return n3(this,arguments,void 0,function*(n,i={}){var r;let o,a;try{const{headers:c,method:u,body:h,signal:f,timeout:g}=i;let v={},{region:w}=i;w||(w=this.region);const k=new URL(`${this.url}/${n}`);w&&w!=="any"&&(v["x-region"]=w,k.searchParams.set("forceFunctionRegion",w));let x;h&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(v["Content-Type"]="application/octet-stream",x=h):typeof h=="string"?(v["Content-Type"]="text/plain",x=h):typeof FormData<"u"&&h instanceof FormData?x=h:(v["Content-Type"]="application/json",x=JSON.stringify(h)):x=h;let C=f;g&&(a=new AbortController,o=setTimeout(()=>a.abort(),g),f?(C=a.signal,f.addEventListener("abort",()=>a.abort())):C=a.signal);const E=yield this.fetch(k.toString(),{method:u||"POST",headers:Object.assign(Object.assign(Object.assign({},v),this.headers),c),body:x,signal:C}).catch(R=>{throw new r3(R)}),I=E.headers.get("x-relay-error");if(I&&I==="true")throw new Ex(E);if(!E.ok)throw new Px(E);let N=((r=E.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),P;return N==="application/json"?P=yield E.json():N==="application/octet-stream"||N==="application/pdf"?P=yield E.blob():N==="text/event-stream"?P=E:N==="multipart/form-data"?P=yield E.formData():P=yield E.text(),{data:P,error:null,response:E}}catch(c){return{data:null,error:c,response:c instanceof Px||c instanceof Ex?c.context:void 0}}finally{o&&clearTimeout(o)}})}}var o3=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},a3=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let r=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{let a=null,c=null,u=null,h=o.status,f=o.statusText;if(o.ok){var g,v;if(n.method!=="HEAD"){var w;const E=await o.text();E===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((w=n.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?c=E:c=JSON.parse(E))}const x=(g=n.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),C=(v=o.headers.get("content-range"))===null||v===void 0?void 0:v.split("/");x&&C&&C.length>1&&(u=parseInt(C[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(c)&&(c.length>1?(a={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,u=null,h=406,f="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{var k;const x=await o.text();try{a=JSON.parse(x),Array.isArray(a)&&o.status===404&&(c=[],a=null,h=200,f="OK")}catch{o.status===404&&x===""?(h=204,f="No Content"):a={message:x}}if(a&&n.isMaybeSingle&&(!(a==null||(k=a.details)===null||k===void 0)&&k.includes("0 rows"))&&(a=null,h=200,f="OK"),a&&n.shouldThrowOnError)throw new o3(a)}return{error:a,data:c,count:u,status:h,statusText:f}});return this.shouldThrowOnError||(r=r.catch(o=>{var a;let c="";const u=o?.cause;if(u){var h,f,g,v;const k=(h=u?.message)!==null&&h!==void 0?h:"",x=(f=u?.code)!==null&&f!==void 0?f:"";c=`${(g=o?.name)!==null&&g!==void 0?g:"FetchError"}: ${o?.message}`,c+=`

Caused by: ${(v=u?.name)!==null&&v!==void 0?v:"Error"}: ${k}`,x&&(c+=` (${x})`),u?.stack&&(c+=`
${u.stack}`)}else{var w;c=(w=o?.stack)!==null&&w!==void 0?w:""}return{error:{message:`${(a=o?.name)!==null&&a!==void 0?a:"FetchError"}: ${o?.message}`,details:c,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(t,e)}returns(){return this}overrideTypes(){return this}},l3=class extends a3{select(t){let e=!1;const n=(t??"*").split("").map(i=>/\s/.test(i)&&!e?"":(i==='"'&&(e=!e),i)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:i,referencedTable:r=i}={}){const o=r?`${r}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:i=n}={}){const r=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${t}`),this.url.searchParams.set(o,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:i=!1,wal:r=!1,format:o="text"}={}){var a;const c=[t?"analyze":null,e?"verbose":null,n?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Rx=new RegExp("[,()]");var Ga=class extends l3{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(i=>typeof i=="string"&&Rx.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(i=>typeof i=="string"&&Rx.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:i}={}){let r="";i==="plain"?r="pl":i==="phrase"?r="ph":i==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${r}fts${o}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const i=n?`${n}.or`:"or";return this.url.searchParams.append(i,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},c3=class{constructor(t,{headers:e={},schema:n,fetch:i}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=i}select(t,e){const{head:n=!1,count:i}=e??{},r=n?"HEAD":"GET";let o=!1;const a=(t??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",a),i&&this.headers.append("Prefer",`count=${i}`),new Ga({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var i;const r="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ga({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:i,defaultToNull:r=!0}={}){var o;const a="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),i&&this.headers.append("Prefer",`count=${i}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new Ga({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(t,{count:e}={}){var n;const i="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Ga({method:i,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Ga({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},u3=class Z1{constructor(e,{headers:n={},schema:i,fetch:r}={}){this.url=e,this.headers=new Headers(n),this.schemaName=i,this.fetch=r}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new c3(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Z1(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:i=!1,get:r=!1,count:o}={}){var a;let c;const u=new URL(`${this.url}/rpc/${e}`);let h;i||r?(c=i?"HEAD":"GET",Object.entries(n).filter(([g,v])=>v!==void 0).map(([g,v])=>[g,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([g,v])=>{u.searchParams.append(g,v)})):(c="POST",h=n);const f=new Headers(this.headers);return o&&f.set("Prefer",`count=${o}`),new Ga({method:c,url:u,headers:f,schema:this.schemaName,body:h,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};class d3{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const i=n.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const i=this.getWebSocketConstructor();return new i(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const h3="2.89.0",f3=`realtime-js/${h3}`,e_="1.0.0",p3="2.0.0",Nx=e_,Jg=1e4,m3=1e3,g3=100;var $s;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})($s||($s={}));var an;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(an||(an={}));var Xi;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Xi||(Xi={}));var Yg;(function(t){t.websocket="websocket"})(Yg||(Yg={}));var $o;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})($o||($o={}));class v3{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(i))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,i;const r=(i=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&i!==void 0?i:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var n,i;const r=(i=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&i!==void 0?i:{},a=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,n,i){var r,o;const a=e.topic,c=(r=e.ref)!==null&&r!==void 0?r:"",u=(o=e.join_ref)!==null&&o!==void 0?o:"",h=e.payload.event,f=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(f).length===0?"":JSON.stringify(f);if(u.length>255)throw new Error(`joinRef length ${u.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`ref length ${c.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const v=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+c.length+a.length+h.length+g.length,w=new ArrayBuffer(this.HEADER_LENGTH+v);let k=new DataView(w),x=0;k.setUint8(x++,this.KINDS.userBroadcastPush),k.setUint8(x++,u.length),k.setUint8(x++,c.length),k.setUint8(x++,a.length),k.setUint8(x++,h.length),k.setUint8(x++,g.length),k.setUint8(x++,n),Array.from(u,E=>k.setUint8(x++,E.charCodeAt(0))),Array.from(c,E=>k.setUint8(x++,E.charCodeAt(0))),Array.from(a,E=>k.setUint8(x++,E.charCodeAt(0))),Array.from(h,E=>k.setUint8(x++,E.charCodeAt(0))),Array.from(g,E=>k.setUint8(x++,E.charCodeAt(0)));var C=new Uint8Array(w.byteLength+i.byteLength);return C.set(new Uint8Array(w),0),C.set(new Uint8Array(i),w.byteLength),C.buffer}decode(e,n){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return n(i)}if(typeof e=="string"){const i=JSON.parse(e),[r,o,a,c,u]=i;return n({join_ref:r,ref:o,topic:a,event:c,payload:u})}return n({})}_binaryDecode(e){const n=new DataView(e),i=n.getUint8(0),r=new TextDecoder;if(i===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,n,r)}_decodeUserBroadcast(e,n,i){const r=n.getUint8(1),o=n.getUint8(2),a=n.getUint8(3),c=n.getUint8(4);let u=this.HEADER_LENGTH+4;const h=i.decode(e.slice(u,u+r));u=u+r;const f=i.decode(e.slice(u,u+o));u=u+o;const g=i.decode(e.slice(u,u+a));u=u+a;const v=e.slice(u,e.byteLength),w=c===this.JSON_ENCODING?JSON.parse(i.decode(v)):v,k={type:this.BROADCAST_EVENT,event:f,payload:w};return a>0&&(k.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:k}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e?.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([i])=>n.includes(i)))}}class t_{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ft;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ft||(ft={}));const Ix=(t,e,n={})=>{var i;const r=(i=n.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((o,a)=>(o[a]=y3(a,t,e,r),o),{}):{}},y3=(t,e,n,i)=>{const r=e.find(c=>c.name===t),o=r?.type,a=n[t];return o&&!i.includes(o)?n_(o,a):Qg(a)},n_=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return x3(e,n)}switch(t){case ft.bool:return b3(e);case ft.float4:case ft.float8:case ft.int2:case ft.int4:case ft.int8:case ft.numeric:case ft.oid:return w3(e);case ft.json:case ft.jsonb:return k3(e);case ft.timestamp:return S3(e);case ft.abstime:case ft.date:case ft.daterange:case ft.int4range:case ft.int8range:case ft.money:case ft.reltime:case ft.text:case ft.time:case ft.timestamptz:case ft.timetz:case ft.tsrange:case ft.tstzrange:return Qg(e);default:return Qg(e)}},Qg=t=>t,b3=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},w3=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},k3=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},x3=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,i=t[n];if(t[0]==="{"&&i==="}"){let o;const a=t.slice(1,n);try{o=JSON.parse("["+a+"]")}catch{o=a?a.split(","):[]}return o.map(c=>n_(e,c))}return t},S3=t=>typeof t=="string"?t.replace(" ","T"):t,i_=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Vm{constructor(e,n,i={},r=Jg){this.channel=e,this.event=n,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var i;return this._hasReceived(e)&&n((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ox;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Ox||(Ox={}));class qc{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},r=>{const{onJoin:o,onLeave:a,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qc.syncState(this.state,r,o,a),this.pendingDiffs.forEach(u=>{this.state=qc.syncDiff(this.state,u,o,a)}),this.pendingDiffs=[],c()}),this.channel._on(i.diff,{},r=>{const{onJoin:o,onLeave:a,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=qc.syncDiff(this.state,r,o,a),c())}),this.onJoin((r,o,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:o,newPresences:a})}),this.onLeave((r,o,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:o,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,i,r){const o=this.cloneDeep(e),a=this.transformState(n),c={},u={};return this.map(o,(h,f)=>{a[h]||(u[h]=f)}),this.map(a,(h,f)=>{const g=o[h];if(g){const v=f.map(C=>C.presence_ref),w=g.map(C=>C.presence_ref),k=f.filter(C=>w.indexOf(C.presence_ref)<0),x=g.filter(C=>v.indexOf(C.presence_ref)<0);k.length>0&&(c[h]=k),x.length>0&&(u[h]=x)}else c[h]=f}),this.syncDiff(o,{joins:c,leaves:u},i,r)}static syncDiff(e,n,i,r){const{joins:o,leaves:a}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(o,(c,u)=>{var h;const f=(h=e[c])!==null&&h!==void 0?h:[];if(e[c]=this.cloneDeep(u),f.length>0){const g=e[c].map(w=>w.presence_ref),v=f.filter(w=>g.indexOf(w.presence_ref)<0);e[c].unshift(...v)}i(c,f,u)}),this.map(a,(c,u)=>{let h=e[c];if(!h)return;const f=u.map(g=>g.presence_ref);h=h.filter(g=>f.indexOf(g.presence_ref)<0),e[c]=h,r(c,h,u),h.length===0&&delete e[c]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(i=>n(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,i)=>{const r=e[i];return"metas"in r?n[i]=r.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[i]=r,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ax;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Ax||(Ax={}));var Kc;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Kc||(Kc={}));var Wr;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Wr||(Wr={}));class ol{constructor(e,n={config:{}},i){var r,o;if(this.topic=e,this.params=n,this.socket=i,this.bindings={},this.state=an.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Vm(this,Xi.join,this.params,this.timeout),this.rejoinTimer=new t_(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=an.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=an.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Xi.reply,{},(a,c)=>{this._trigger(this._replyEventName(c),a)}),this.presence=new qc(this),this.broadcastEndpointURL=i_(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(r=this.params.config)===null||r===void 0?void 0:r.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var i,r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==an.closed){const{config:{broadcast:a,presence:c,private:u}}=this.params,h=(r=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(w=>w.filter))!==null&&r!==void 0?r:[],f=!!this.bindings[Kc.PRESENCE]&&this.bindings[Kc.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,g={},v={broadcast:a,presence:Object.assign(Object.assign({},c),{enabled:f}),postgres_changes:h,private:u};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(w=>e?.(Wr.CHANNEL_ERROR,w)),this._onClose(()=>e?.(Wr.CLOSED)),this.updateJoinPayload(Object.assign({config:v},g)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:w})=>{var k;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){e?.(Wr.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,C=(k=x?.length)!==null&&k!==void 0?k:0,E=[];for(let I=0;I<C;I++){const N=x[I],{filter:{event:P,schema:R,table:j,filter:U}}=N,F=w&&w[I];if(F&&F.event===P&&ol.isFilterValueEqual(F.schema,R)&&ol.isFilterValueEqual(F.table,j)&&ol.isFilterValueEqual(F.filter,U))E.push(Object.assign(Object.assign({},N),{id:F.id}));else{this.unsubscribe(),this.state=an.errored,e?.(Wr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,e&&e(Wr.SUBSCRIBED);return}}).receive("error",w=>{this.state=an.errored,e?.(Wr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{e?.(Wr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,i){return this.state===an.joined&&e===Kc.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,i)}async httpSend(e,n,i={}){var r;if(n==null)return Promise.reject("Payload is required for httpSend()");const o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},c=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(r=i.timeout)!==null&&r!==void 0?r:this.timeout);if(c.status===202)return{success:!0};let u=c.statusText;try{const h=await c.json();u=h.error||h.message||u}catch{}return Promise.reject(new Error(u))}async send(e,n={}){var i,r;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:a}=e,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const u={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(i=n.timeout)!==null&&i!==void 0?i:this.timeout);return await((r=h.body)===null||r===void 0?void 0:r.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,c,u;const h=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((u=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||u===void 0)&&u.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=an.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Xi.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new Vm(this,Xi.leave,{},e),i.receive("ok",()=>{n(),r("ok")}).receive("timeout",()=>{n(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=an.closed,this.bindings={}}async _fetchWithTimeout(e,n,i){const r=new AbortController,o=setTimeout(()=>r.abort(),i),a=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:r.signal}));return clearTimeout(o),a}_push(e,n,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Vm(this,e,n,i);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>g3){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,i){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,i){var r,o;const a=e.toLocaleLowerCase(),{close:c,error:u,leave:h,join:f}=Xi;if(i&&[c,u,h,f].indexOf(a)>=0&&i!==this._joinRef())return;let v=this._onMessage(a,n,i);if(n&&!v)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(w=>{var k,x,C;return((k=w.filter)===null||k===void 0?void 0:k.event)==="*"||((C=(x=w.filter)===null||x===void 0?void 0:x.event)===null||C===void 0?void 0:C.toLocaleLowerCase())===a}).map(w=>w.callback(v,i)):(o=this.bindings[a])===null||o===void 0||o.filter(w=>{var k,x,C,E,I,N;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in w){const P=w.id,R=(k=w.filter)===null||k===void 0?void 0:k.event;return P&&((x=n.ids)===null||x===void 0?void 0:x.includes(P))&&(R==="*"||R?.toLocaleLowerCase()===((C=n.data)===null||C===void 0?void 0:C.type.toLocaleLowerCase()))}else{const P=(I=(E=w?.filter)===null||E===void 0?void 0:E.event)===null||I===void 0?void 0:I.toLocaleLowerCase();return P==="*"||P===((N=n?.event)===null||N===void 0?void 0:N.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===a}).map(w=>{if(typeof v=="object"&&"ids"in v){const k=v.data,{schema:x,table:C,commit_timestamp:E,type:I,errors:N}=k;v=Object.assign(Object.assign({},{schema:x,table:C,commit_timestamp:E,eventType:I,new:{},old:{},errors:N}),this._getPayloadRecords(k))}w.callback(v,i)})}_isClosed(){return this.state===an.closed}_isJoined(){return this.state===an.joined}_isJoining(){return this.state===an.joining}_isLeaving(){return this.state===an.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,i){const r=e.toLocaleLowerCase(),o={type:r,filter:n,callback:i};return this.bindings[r]?this.bindings[r].push(o):this.bindings[r]=[o],this}_off(e,n){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(r=>{var o;return!(((o=r.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===i&&ol.isEqual(r.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(e[i]!==n[i])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Xi.close,{},e)}_onError(e){this._on(Xi.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=an.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Ix(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Ix(e.columns,e.old_record)),n}}const zm=()=>{},zd={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},T3=[1e3,2e3,5e3,1e4],C3=1e4,_3=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class E3{constructor(e,n){var i;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Jg,this.transport=null,this.heartbeatIntervalMs=zd.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=zm,this.ref=0,this.reconnectTimer=null,this.vsn=Nx,this.logger=zm,this.conn=null,this.sendBuffer=[],this.serializer=new v3,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>r?(...o)=>r(...o):(...o)=>fetch(...o),!(!((i=n?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Yg.websocket}`,this.httpEndpoint=i_(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=d3.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,i){this.logger(e,n,i)}connectionState(){switch(this.conn&&this.conn.readyState){case $s.connecting:return $o.Connecting;case $s.open:return $o.Open;case $s.closing:return $o.Closing;default:return $o.Closed}}isConnected(){return this.connectionState()===$o.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const i=`realtime:${e}`,r=this.getChannels().find(o=>o.topic===i);if(r)return r;{const o=new ol(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:i,payload:r,ref:o}=e,a=()=>{this.encode(e,c=>{var u;(u=this.conn)===null||u===void 0||u.send(c)})};this.log("push",`${n} ${i} (${o})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(m3,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},zd.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(h){this.log("error","error in heartbeat callback",h)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:r,payload:o,ref:a}=n,c=a?`(${a})`:"",u=o.status||"";this.log("receive",`${u} ${i} ${r} ${c}`.trim(),o),this.channels.filter(h=>h._isMember(i)).forEach(h=>h._trigger(r,o,a)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===$s.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===$s.open||this.conn.readyState===$s.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Xi.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const i=e.match(/\?/)?"&":"?",r=new URLSearchParams(n);return`${e}${i}${r}`}_workerObjectUrl(e){let n;if(e)n=e;else{const i=new Blob([_3],{type:"application/javascript"});n=URL.createObjectURL(i)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,i=!1;if(e)n=e,i=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(r){this.log("error","Error fetching access token from callback",r),n=this.accessTokenValue}else n=this.accessTokenValue;i?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const o={access_token:n,version:f3};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(Xi.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(n)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new t_(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zd.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,i,r,o,a,c,u,h,f,g,v,w;switch(this.transport=(n=e?.transport)!==null&&n!==void 0?n:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:Jg,this.heartbeatIntervalMs=(r=e?.heartbeatIntervalMs)!==null&&r!==void 0?r:zd.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(c=e?.heartbeatCallback)!==null&&c!==void 0?c:zm,this.vsn=(u=e?.vsn)!==null&&u!==void 0?u:Nx,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e?.reconnectAfterMs)!==null&&h!==void 0?h:(k=>T3[k-1]||C3),this.vsn){case e_:this.encode=(f=e?.encode)!==null&&f!==void 0?f:((k,x)=>x(JSON.stringify(k))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:((k,x)=>x(JSON.parse(k)));break;case p3:this.encode=(v=e?.encode)!==null&&v!==void 0?v:this.serializer.encode.bind(this.serializer),this.decode=(w=e?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var uu=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function P3(t,e,n){const i=new URL(e,t);if(n)for(const[r,o]of Object.entries(n))o!==void 0&&i.searchParams.set(r,o);return i.toString()}async function R3(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function N3(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:i,query:r,body:o,headers:a}){const c=P3(t.baseUrl,i,r),u=await R3(t.auth),h=await e(c,{method:n,headers:{...o?{"Content-Type":"application/json"}:{},...u,...a},body:o?JSON.stringify(o):void 0}),f=await h.text(),g=(h.headers.get("content-type")||"").includes("application/json"),v=g&&f?JSON.parse(f):f;if(!h.ok){const w=g?v:void 0,k=w?.error;throw new uu(k?.message??`Request failed with status ${h.status}`,{status:h.status,icebergType:k?.type,icebergCode:k?.code,details:w})}return{status:h.status,headers:h.headers,data:v}}}}function $d(t){return t.join("")}var I3=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:$d(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(i=>({namespace:i}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${$d(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${$d(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${$d(t.namespace)}`}),!0}catch(e){if(e instanceof uu&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof uu&&n.status===409)return;throw n}}};function za(t){return t.join("")}var O3=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${za(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof uu&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof uu&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},A3=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=N3({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new I3(this.client,e),this.tableOps=new O3(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},cf=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Ot(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var j3=class extends cf{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Xg=class extends cf{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const C0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),D3=()=>Response,Zg=t=>{if(Array.isArray(t))return t.map(n=>Zg(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,i])=>{const r=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[r]=Zg(i)}),e},M3=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},L3=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function du(t){"@babel/helpers - typeof";return du=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},du(t)}function U3(t,e){if(du(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(du(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function F3(t){var e=U3(t,"string");return du(e)=="symbol"?e:e+""}function B3(t,e,n){return(e=F3(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ue(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jx(Object(n),!0).forEach(function(i){B3(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const $m=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},V3=async(t,e,n)=>{t instanceof await D3()&&!n?.noResolveJson?t.json().then(i=>{const r=t.status||500,o=i?.statusCode||r+"";e(new j3($m(i),r,o))}).catch(i=>{e(new Xg($m(i),i))}):e(new Xg($m(t),t))},z3=(t,e,n,i)=>{const r={method:t,headers:e?.headers||{}};return t==="GET"||!i?r:(M3(i)?(r.headers=Ue({"Content-Type":"application/json"},e?.headers),r.body=JSON.stringify(i)):r.body=i,e?.duplex&&(r.duplex=e.duplex),Ue(Ue({},r),n))};async function Su(t,e,n,i,r,o){return new Promise((a,c)=>{t(n,z3(e,i,r,o)).then(u=>{if(!u.ok)throw u;return i?.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>V3(u,c,i))})}async function hu(t,e,n,i){return Su(t,"GET",e,n,i)}async function Ji(t,e,n,i,r){return Su(t,"POST",e,i,r,n)}async function ev(t,e,n,i,r){return Su(t,"PUT",e,i,r,n)}async function $3(t,e,n,i){return Su(t,"HEAD",e,Ue(Ue({},n),{},{noResolveJson:!0}),i)}async function _0(t,e,n,i,r){return Su(t,"DELETE",e,i,r,n)}var q3=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ot(e))return{data:null,error:e};throw e}}};let r_;r_=Symbol.toStringTag;var K3=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[r_]="BlobDownloadBuilder",this.promise=null}asStream(){return new q3(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Ot(e))return{data:null,error:e};throw e}}};const W3={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Dx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var H3=class{constructor(t,e={},n,i){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=C0(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,i){var r=this;try{let o;const a=Ue(Ue({},Dx),i);let c=Ue(Ue({},r.headers),t==="POST"&&{"x-upsert":String(a.upsert)});const u=a.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",a.cacheControl),u&&o.append("metadata",r.encodeMetadata(u)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.has("cacheControl")||o.append("cacheControl",a.cacheControl),u&&!o.has("metadata")&&o.append("metadata",r.encodeMetadata(u))):(o=n,c["cache-control"]=`max-age=${a.cacheControl}`,c["content-type"]=a.contentType,u&&(c["x-metadata"]=r.toBase64(r.encodeMetadata(u))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!a.duplex&&(a.duplex="half")),i?.headers&&(c=Ue(Ue({},c),i.headers));const h=r._removeEmptyFolders(e),f=r._getFinalPath(h),g=await(t=="PUT"?ev:Ji)(r.fetch,`${r.url}/object/${f}`,o,Ue({headers:c},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:h,id:g.Id,fullPath:g.Key},error:null}}catch(o){if(r.shouldThrowOnError)throw o;if(Ot(o))return{data:null,error:o};throw o}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,i){var r=this;const o=r._removeEmptyFolders(t),a=r._getFinalPath(o),c=new URL(r.url+`/object/upload/sign/${a}`);c.searchParams.set("token",e);try{let u;const h=Ue({upsert:Dx.upsert},i),f=Ue(Ue({},r.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&n instanceof Blob?(u=new FormData,u.append("cacheControl",h.cacheControl),u.append("",n)):typeof FormData<"u"&&n instanceof FormData?(u=n,u.append("cacheControl",h.cacheControl)):(u=n,f["cache-control"]=`max-age=${h.cacheControl}`,f["content-type"]=h.contentType),{data:{path:o,fullPath:(await ev(r.fetch,c.toString(),u,{headers:f})).Key},error:null}}catch(u){if(r.shouldThrowOnError)throw u;if(Ot(u))return{data:null,error:u};throw u}}async createSignedUploadUrl(t,e){var n=this;try{let i=n._getFinalPath(t);const r=Ue({},n.headers);e?.upsert&&(r["x-upsert"]="true");const o=await Ji(n.fetch,`${n.url}/object/upload/sign/${i}`,{},{headers:r}),a=new URL(n.url+o.url),c=a.searchParams.get("token");if(!c)throw new cf("No token returned by API");return{data:{signedUrl:a.toString(),path:t,token:c},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Ot(i))return{data:null,error:i};throw i}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var i=this;try{return{data:await Ji(i.fetch,`${i.url}/object/move`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:i.headers}),error:null}}catch(r){if(i.shouldThrowOnError)throw r;if(Ot(r))return{data:null,error:r};throw r}}async copy(t,e,n){var i=this;try{return{data:{path:(await Ji(i.fetch,`${i.url}/object/copy`,{bucketId:i.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:i.headers})).Key},error:null}}catch(r){if(i.shouldThrowOnError)throw r;if(Ot(r))return{data:null,error:r};throw r}}async createSignedUrl(t,e,n){var i=this;try{let r=i._getFinalPath(t),o=await Ji(i.fetch,`${i.url}/object/sign/${r}`,Ue({expiresIn:e},n?.transform?{transform:n.transform}:{}),{headers:i.headers});const a=n?.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${i.url}${o.signedURL}${a}`)},{data:o,error:null}}catch(r){if(i.shouldThrowOnError)throw r;if(Ot(r))return{data:null,error:r};throw r}}async createSignedUrls(t,e,n){var i=this;try{const r=await Ji(i.fetch,`${i.url}/object/sign/${i.bucketId}`,{expiresIn:e,paths:t},{headers:i.headers}),o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:r.map(a=>Ue(Ue({},a),{},{signedUrl:a.signedURL?encodeURI(`${i.url}${a.signedURL}${o}`):null})),error:null}}catch(r){if(i.shouldThrowOnError)throw r;if(Ot(r))return{data:null,error:r};throw r}}download(t,e){const n=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),r=i?`?${i}`:"",o=this._getFinalPath(t),a=()=>hu(this.fetch,`${this.url}/${n}/${o}${r}`,{headers:this.headers,noResolveJson:!0});return new K3(a,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:Zg(await hu(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(Ot(i))return{data:null,error:i};throw i}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await $3(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(i){if(e.shouldThrowOnError)throw i;if(Ot(i)&&i instanceof Xg){const r=i.originalError;if([400,404].includes(r?.status))return{data:!1,error:i}}throw i}}getPublicUrl(t,e){const n=this._getFinalPath(t),i=[],r=e?.download?`download=${e.download===!0?"":e.download}`:"";r!==""&&i.push(r);const o=typeof e?.transform<"u"?"render/image":"object",a=this.transformOptsToQueryString(e?.transform||{});a!==""&&i.push(a);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${c}`)}}}async remove(t){var e=this;try{return{data:await _0(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async list(t,e,n){var i=this;try{const r=Ue(Ue(Ue({},W3),e),{},{prefix:t||""});return{data:await Ji(i.fetch,`${i.url}/object/list/${i.bucketId}`,r,{headers:i.headers},n),error:null}}catch(r){if(i.shouldThrowOnError)throw r;if(Ot(r))return{data:null,error:r};throw r}}async listV2(t,e){var n=this;try{const i=Ue({},t);return{data:await Ji(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,i,{headers:n.headers},e),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Ot(i))return{data:null,error:i};throw i}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const s_="2.89.0",o_={"X-Client-Info":`storage-js/${s_}`};var G3=class{constructor(t,e={},n,i){this.shouldThrowOnError=!1;const r=new URL(t);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href.replace(/\/$/,""),this.headers=Ue(Ue({},o_),e),this.fetch=C0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await hu(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await hu(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await Ji(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Ot(i))return{data:null,error:i};throw i}}async updateBucket(t,e){var n=this;try{return{data:await ev(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(Ot(i))return{data:null,error:i};throw i}}async emptyBucket(t){var e=this;try{return{data:await Ji(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await _0(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},J3=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ue(Ue({},o_),e),this.fetch=C0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await Ji(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;t?.limit!==void 0&&n.set("limit",t.limit.toString()),t?.offset!==void 0&&n.set("offset",t.offset.toString()),t?.sortColumn&&n.set("sortColumn",t.sortColumn),t?.sortOrder&&n.set("sortOrder",t.sortOrder),t?.search&&n.set("search",t.search);const i=n.toString(),r=i?`${e.url}/bucket?${i}`:`${e.url}/bucket`;return{data:await hu(e.fetch,r,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await _0(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ot(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!L3(t))throw new cf("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new A3({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(n,{get(r,o){const a=r[o];return typeof a!="function"?a:async(...c)=>{try{return{data:await a.apply(r,c),error:null}}catch(u){if(i)throw u;return{data:null,error:u}}}}})}};const E0={"X-Client-Info":`storage-js/${s_}`,"Content-Type":"application/json"};var a_=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function wi(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var qm=class extends a_{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Y3=class extends a_{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const P0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Q3=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Mx=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),X3=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!n?.noResolveJson){const i=t.status||500,r=t;if(typeof r.json=="function")r.json().then(o=>{const a=o?.statusCode||o?.code||i+"";e(new qm(Mx(o),i,a))}).catch(()=>{const o=i+"";e(new qm(r.statusText||`HTTP ${i} error`,i,o))});else{const o=i+"";e(new qm(r.statusText||`HTTP ${i} error`,i,o))}}else e(new Y3(Mx(t),t))},Z3=(t,e,n,i)=>{const r={method:t,headers:e?.headers||{}};return i?(Q3(i)?(r.headers=Ue({"Content-Type":"application/json"},e?.headers),r.body=JSON.stringify(i)):r.body=i,Ue(Ue({},r),n)):r};async function eU(t,e,n,i,r,o){return new Promise((a,c)=>{t(n,Z3(e,i,r,o)).then(u=>{if(!u.ok)throw u;if(i?.noResolveJson)return u;const h=u.headers.get("content-type");return!h||!h.includes("application/json")?{}:u.json()}).then(u=>a(u)).catch(u=>X3(u,c,i))})}async function ki(t,e,n,i,r){return eU(t,"POST",e,i,r,n)}var tU=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ue(Ue({},E0),e),this.fetch=P0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await ki(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(wi(i))return{data:null,error:i};throw i}}async listIndexes(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await ki(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(wi(i))return{data:null,error:i};throw i}}},nU=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ue(Ue({},E0),e),this.fetch=P0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await ki(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await ki(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await ki(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}},iU=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ue(Ue({},E0),e),this.fetch=P0(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await ki(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await ki(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(wi(n))return{data:null,error:n};throw n}}},rU=class extends iU{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new sU(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},sU=class extends tU{constructor(t,e,n,i){super(t,e,i),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new oU(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},oU=class extends nU{constructor(t,e,n,i,r){super(t,e,r),this.vectorBucketName=n,this.indexName=i}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,Ue(Ue({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},aU=class extends G3{constructor(t,e={},n,i){super(t,e,n,i)}from(t){return new H3(this.url,this.headers,t,this.fetch)}get vectors(){return new rU(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new J3(this.url+"/iceberg",this.headers,this.fetch)}};const l_="2.89.0",Ja=30*1e3,tv=3,Km=tv*Ja,lU="http://localhost:9999",cU="supabase.auth.token",uU={"X-Client-Info":`gotrue-js/${l_}`},nv="X-Supabase-Api-Version",c_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},dU=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hU=600*1e3;class fu extends Error{constructor(e,n,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=i}}function Re(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class fU extends fu{constructor(e,n,i){super(e,n,i),this.name="AuthApiError",this.status=n,this.code=i}}function pU(t){return Re(t)&&t.name==="AuthApiError"}class qo extends fu{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class is extends fu{constructor(e,n,i,r){super(e,i,r),this.name=n,this.status=i}}class bi extends is{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function mU(t){return Re(t)&&t.name==="AuthSessionMissingError"}class $a extends is{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qd extends is{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Kd extends is{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function gU(t){return Re(t)&&t.name==="AuthImplicitGrantRedirectError"}class Lx extends is{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class vU extends is{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class iv extends is{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Wm(t){return Re(t)&&t.name==="AuthRetryableFetchError"}class Ux extends is{constructor(e,n,i){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=i}}class rv extends is{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Lh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fx=` 	
\r=`.split(""),yU=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Fx.length;e+=1)t[Fx[e].charCodeAt(0)]=-2;for(let e=0;e<Lh.length;e+=1)t[Lh[e].charCodeAt(0)]=e;return t})();function Bx(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(Lh[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(Lh[i]),e.queuedBits-=6}}function u_(t,e,n){const i=yU[t];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Vx(t){const e=[],n=a=>{e.push(String.fromCodePoint(a))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},o=a=>{kU(a,i,n)};for(let a=0;a<t.length;a+=1)u_(t.charCodeAt(a),r,o);return e.join("")}function bU(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function wU(t,e){for(let n=0;n<t.length;n+=1){let i=t.charCodeAt(n);if(i>55295&&i<=56319){const r=(i-55296)*1024&65535;i=(t.charCodeAt(n+1)-56320&65535|r)+65536,n+=1}bU(i,e)}}function kU(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let i=1;i<6;i+=1)if((t>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function ml(t){const e=[],n={queue:0,queuedBits:0},i=r=>{e.push(r)};for(let r=0;r<t.length;r+=1)u_(t.charCodeAt(r),n,i);return new Uint8Array(e)}function xU(t){const e=[];return wU(t,n=>e.push(n)),new Uint8Array(e)}function Ho(t){const e=[],n={queue:0,queuedBits:0},i=r=>{e.push(r)};return t.forEach(r=>Bx(r,n,i)),Bx(null,n,i),e.join("")}function SU(t){return Math.round(Date.now()/1e3)+t}function TU(){return Symbol("auth-callback")}const En=()=>typeof window<"u"&&typeof document<"u",Do={tested:!1,writable:!1},d_=()=>{if(!En())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Do.tested)return Do.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Do.tested=!0,Do.writable=!0}catch{Do.tested=!0,Do.writable=!1}return Do.writable};function CU(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((r,o)=>{e[o]=r})}catch{}return n.searchParams.forEach((i,r)=>{e[r]=i}),e}const h_=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),_U=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Ya=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Mo=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},_n=async(t,e)=>{await t.removeItem(e)};class uf{constructor(){this.promise=new uf.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}uf.promiseConstructor=Promise;function Hm(t){const e=t.split(".");if(e.length!==3)throw new rv("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!dU.test(e[i]))throw new rv("JWT not in base64url format");return{header:JSON.parse(Vx(e[0])),payload:JSON.parse(Vx(e[1])),signature:ml(e[2]),raw:{header:e[0],payload:e[1]}}}async function EU(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function PU(t,e){return new Promise((i,r)=>{(async()=>{for(let o=0;o<1/0;o++)try{const a=await t(o);if(!e(o,null,a)){i(a);return}}catch(a){if(!e(o,a)){r(a);return}}})()})}function RU(t){return("0"+t.toString(16)).substr(-2)}function NU(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=n.length;let r="";for(let o=0;o<56;o++)r+=n.charAt(Math.floor(Math.random()*i));return r}return crypto.getRandomValues(e),Array.from(e,RU).join("")}async function IU(t){const n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n),r=new Uint8Array(i);return Array.from(r).map(o=>String.fromCharCode(o)).join("")}async function OU(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await IU(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function qa(t,e,n=!1){const i=NU();let r=i;n&&(r+="/PASSWORD_RECOVERY"),await Ya(t,`${e}-code-verifier`,r);const o=await OU(i);return[o,i===o?"plain":"s256"]}const AU=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function jU(t){const e=t.headers.get(nv);if(!e||!e.match(AU))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function DU(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function MU(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const LU=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ka(t){if(!LU.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Gm(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function UU(t,e){return new Proxy(t,{get:(n,i,r)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const o=i.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,i,r)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,i,r)}})}function zx(t){return JSON.parse(JSON.stringify(t))}const zo=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),FU=[502,503,504];async function $x(t){var e;if(!_U(t))throw new iv(zo(t),0);if(FU.includes(t.status))throw new iv(zo(t),t.status);let n;try{n=await t.json()}catch(o){throw new qo(zo(o),o)}let i;const r=jU(t);if(r&&r.getTime()>=c_["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?i=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(i=n.error_code),i){if(i==="weak_password")throw new Ux(zo(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new bi}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,a)=>o&&typeof a=="string",!0))throw new Ux(zo(n),t.status,n.weak_password.reasons);throw new fU(zo(n),t.status||500,i)}const BU=(t,e,n,i)=>{const r={method:t,headers:e?.headers||{}};return t==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),n))};async function Me(t,e,n,i){var r;const o=Object.assign({},i?.headers);o[nv]||(o[nv]=c_["2024-01-01"].name),i?.jwt&&(o.Authorization=`Bearer ${i.jwt}`);const a=(r=i?.query)!==null&&r!==void 0?r:{};i?.redirectTo&&(a.redirect_to=i.redirectTo);const c=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=await VU(t,e,n+c,{headers:o,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(u):{data:Object.assign({},u),error:null}}async function VU(t,e,n,i,r,o){const a=BU(e,i,r,o);let c;try{c=await t(n,Object.assign({},a))}catch(u){throw console.error(u),new iv(zo(u),0)}if(c.ok||await $x(c),i?.noResolveJson)return c;try{return await c.json()}catch(u){await $x(u)}}function Hi(t){var e;let n=null;qU(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=SU(t.expires_in)));const i=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:i},error:null}}function qx(t){const e=Hi(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,i)=>n&&typeof i=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Ws(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function zU(t){return{data:t,error:null}}function $U(t){const{action_link:e,email_otp:n,hashed_token:i,redirect_to:r,verification_type:o}=t,a=lf(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:n,hashed_token:i,redirect_to:r,verification_type:o},u=Object.assign({},a);return{data:{properties:c,user:u},error:null}}function Kx(t){return t}function qU(t){return t.access_token&&t.refresh_token&&t.expires_in}const Jm=["global","local","others"];class KU{constructor({url:e="",headers:n={},fetch:i}){this.url=e,this.headers=n,this.fetch=h_(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Jm[0]){if(Jm.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jm.join(", ")}`);try{return await Me(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(Re(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,n={}){try{return await Me(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ws})}catch(i){if(Re(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:n}=e,i=lf(e,["options"]),r=Object.assign(Object.assign({},i),n);return"newEmail"in i&&(r.new_email=i?.newEmail,delete r.newEmail),await Me(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:$U,redirectTo:n?.redirectTo})}catch(n){if(Re(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Me(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ws})}catch(n){if(Re(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,i,r,o,a,c,u;try{const h={nextPage:null,lastPage:0,total:0},f=await Me(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Kx});if(f.error)throw f.error;const g=await f.json(),v=(a=f.headers.get("x-total-count"))!==null&&a!==void 0?a:0,w=(u=(c=f.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&u!==void 0?u:[];return w.length>0&&(w.forEach(k=>{const x=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),C=JSON.parse(k.split(";")[1].split("=")[1]);h[`${C}Page`]=x}),h.total=parseInt(v)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(Re(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){Ka(e);try{return await Me(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ws})}catch(n){if(Re(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Ka(e);try{return await Me(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Ws})}catch(i){if(Re(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,n=!1){Ka(e);try{return await Me(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Ws})}catch(i){if(Re(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Ka(e.userId);try{const{data:n,error:i}=await Me(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:n,error:i}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Ka(e.userId),Ka(e.id);try{return{data:await Me(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,i,r,o,a,c,u;try{const h={nextPage:null,lastPage:0,total:0},f=await Me(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:"",per_page:(o=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:""},xform:Kx});if(f.error)throw f.error;const g=await f.json(),v=(a=f.headers.get("x-total-count"))!==null&&a!==void 0?a:0,w=(u=(c=f.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&u!==void 0?u:[];return w.length>0&&(w.forEach(k=>{const x=parseInt(k.split(";")[0].split("=")[1].substring(0,1)),C=JSON.parse(k.split(";")[1].split("=")[1]);h[`${C}Page`]=x}),h.total=parseInt(v)),{data:Object.assign(Object.assign({},g),h),error:null}}catch(h){if(Re(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Me(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Me(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Me(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Re(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await Me(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Re(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Me(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return{data:null,error:n};throw n}}}function Wx(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Wa={debug:!!(globalThis&&d_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class f_ extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class WU extends f_{}async function HU(t,e,n){Wa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),Wa.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async r=>{if(r){Wa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,r.name);try{return await n()}finally{Wa.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,r.name)}}else{if(e===0)throw Wa.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new WU(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Wa.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function GU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function p_(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function JU(t){return parseInt(t,16)}function YU(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function QU(t){var e;const{chainId:n,domain:i,expirationTime:r,issuedAt:o=new Date,nonce:a,notBefore:c,requestId:u,resources:h,scheme:f,uri:g,version:v}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(v!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${v}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const w=p_(t.address),k=f?`${f}://${i}`:i,x=t.statement?`${t.statement}
`:"",C=`${k} wants you to sign in with your Ethereum account:
${w}

${x}`;let E=`URI: ${g}
Version: ${v}
Chain ID: ${n}${a?`
Nonce: ${a}`:""}
Issued At: ${o.toISOString()}`;if(r&&(E+=`
Expiration Time: ${r.toISOString()}`),c&&(E+=`
Not Before: ${c.toISOString()}`),u&&(E+=`
Request ID: ${u}`),h){let I=`
Resources:`;for(const N of h){if(!N||typeof N!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${N}`);I+=`
- ${N}`}E+=I}return`${C}
${E}`}class Qt extends Error{constructor({message:e,code:n,cause:i,name:r}){var o;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(o=r??(i instanceof Error?i.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class Uh extends Qt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function XU({error:t,options:e}){var n,i,r;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Qt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new Qt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Qt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Qt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Qt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Qt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new Qt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Qt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(m_(a)){if(o.rp.id!==a)return new Qt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Qt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function ZU({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Qt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Qt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const i=window.location.hostname;if(m_(i)){if(n.rpId!==i)return new Qt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class e4{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const t4=new e4;function n4(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:i}=t,r=lf(t,["challenge","user","excludeCredentials"]),o=ml(e).buffer,a=Object.assign(Object.assign({},n),{id:ml(n.id).buffer}),c=Object.assign(Object.assign({},r),{challenge:o,user:a});if(i&&i.length>0){c.excludeCredentials=new Array(i.length);for(let u=0;u<i.length;u++){const h=i[u];c.excludeCredentials[u]=Object.assign(Object.assign({},h),{id:ml(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return c}function i4(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,i=lf(t,["challenge","allowCredentials"]),r=ml(e).buffer,o=Object.assign(Object.assign({},i),{challenge:r});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let a=0;a<n.length;a++){const c=n[a];o.allowCredentials[a]=Object.assign(Object.assign({},c),{id:ml(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function r4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ho(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ho(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function s4(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,i=t.getClientExtensionResults(),r=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ho(new Uint8Array(r.authenticatorData)),clientDataJSON:Ho(new Uint8Array(r.clientDataJSON)),signature:Ho(new Uint8Array(r.signature)),userHandle:r.userHandle?Ho(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function m_(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Hx(){var t,e;return!!(En()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function o4(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Uh("Browser returned unexpected credential type",e)}:{data:null,error:new Uh("Empty credential response",e)}}catch(e){return{data:null,error:XU({error:e,options:t})}}}async function a4(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Uh("Browser returned unexpected credential type",e)}:{data:null,error:new Uh("Empty credential response",e)}}catch(e){return{data:null,error:ZU({error:e,options:t})}}}const l4={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},c4={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Fh(...t){const e=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),n=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),i={};for(const r of t)if(r)for(const o in r){const a=r[o];if(a!==void 0)if(Array.isArray(a))i[o]=a;else if(n(a))i[o]=a;else if(e(a)){const c=i[o];e(c)?i[o]=Fh(c,a):i[o]=Fh(a)}else i[o]=a}return i}function u4(t,e){return Fh(l4,t,e||{})}function d4(t,e){return Fh(c4,t,e||{})}class h4{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:i,signal:r},o){try{const{data:a,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!a)return{data:null,error:c};const u=r??t4.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:h}=a.webauthn.credential_options.publicKey;h.name||(h.name=`${h.id}:${i}`),h.displayName||(h.displayName=h.name)}switch(a.webauthn.type){case"create":{const h=u4(a.webauthn.credential_options.publicKey,o?.create),{data:f,error:g}=await o4({publicKey:h,signal:u});return f?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}case"request":{const h=d4(a.webauthn.credential_options.publicKey,o?.request),{data:f,error:g}=await a4(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:h,signal:u}));return f?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}}}catch(a){return Re(a)?{data:null,error:a}:{data:null,error:new qo("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:n,webauthn:i}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},o){if(!n)return{data:null,error:new fu("rpId is required for WebAuthn authentication")};try{if(!Hx())return{data:null,error:new qo("Browser does not support WebAuthn",null)};const{data:a,error:c}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:i},signal:r},{request:o});if(!a)return{data:null,error:c};const{webauthn:u}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:u.type,rpId:n,rpOrigins:i,credential_response:u.credential_response}})}catch(a){return Re(a)?{data:null,error:a}:{data:null,error:new qo("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:r}={}},o){if(!n)return{data:null,error:new fu("rpId is required for WebAuthn registration")};try{if(!Hx())return{data:null,error:new qo("Browser does not support WebAuthn",null)};const{data:a,error:c}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(f=>{var g;return(g=f.data)===null||g===void 0?void 0:g.all.find(v=>v.factor_type==="webauthn"&&v.friendly_name===e&&v.status!=="unverified")}).then(f=>f?this.client.mfa.unenroll({factorId:f?.id}):void 0),{data:null,error:c};const{data:u,error:h}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:n,rpOrigins:i},signal:r},{create:o});return u?this._verify({factorId:a.id,challengeId:u.challengeId,webauthn:{rpId:n,rpOrigins:i,type:u.webauthn.type,credential_response:u.webauthn.credential_response}}):{data:null,error:h}}catch(a){return Re(a)?{data:null,error:a}:{data:null,error:new qo("Unexpected error in register",a)}}}}GU();const f4={url:lU,storageKey:cU,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:uU,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Gx(t,e,n){return await n()}const Ha={};class pu{get jwks(){var e,n;return(n=(e=Ha[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Ha[this.storageKey]=Object.assign(Object.assign({},Ha[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Ha[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ha[this.storageKey]=Object.assign(Object.assign({},Ha[this.storageKey]),{cachedAt:e})}constructor(e){var n,i,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},f4),e);if(this.storageKey=o.storageKey,this.instanceID=(n=pu.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,pu.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&En()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new KU({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=h_(o.fetch),this.lock=o.lock||Gx,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:this.persistSession&&En()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=HU:this.lock=Gx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new h4(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:d_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Wx(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Wx(this.memoryStorage)),En()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${l_}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},i="none";if(En()&&(n=CU(window.location.href),this._isImplicitGrantCallback(n)?i="implicit":await this._isPKCECallback(n)&&(i="pkce")),En()&&this.detectSessionInUrl&&i!=="none"){const{data:r,error:o}=await this._getSessionFromURL(n,i);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),gU(o)){const u=(e=o.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:a,redirectType:c}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",c),await this._saveSession(a),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Re(n)?this._returnResult({error:n}):this._returnResult({error:new qo("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,i,r;try{const o=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(r=e?.options)===null||r===void 0?void 0:r.captchaToken}},xform:Hi}),{data:a,error:c}=o;if(c||!a)return this._returnResult({data:{user:null,session:null},error:c});const u=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:h,session:u},error:null})}catch(o){if(Re(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,i,r;try{let o;if("email"in e){const{email:f,password:g,options:v}=e;let w=null,k=null;this.flowType==="pkce"&&([w,k]=await qa(this.storage,this.storageKey)),o=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:v?.emailRedirectTo,body:{email:f,password:g,data:(n=v?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:v?.captchaToken},code_challenge:w,code_challenge_method:k},xform:Hi})}else if("phone"in e){const{phone:f,password:g,options:v}=e;o=await Me(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:f,password:g,data:(i=v?.data)!==null&&i!==void 0?i:{},channel:(r=v?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:v?.captchaToken}},xform:Hi})}else throw new qd("You must provide either an email or phone number and a password");const{data:a,error:c}=o;if(c||!a)return await _n(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});const u=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:h,session:u},error:null})}catch(o){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:a,options:c}=e;n=await Me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:qx})}else if("phone"in e){const{phone:o,password:a,options:c}=e;n=await Me(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:qx})}else throw new qd("You must provide either an email or phone number and a password");const{data:i,error:r}=n;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!i||!i.session||!i.user){const o=new $a;return this._returnResult({data:{user:null,session:null},error:o})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:r})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,i,r,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,i,r,o,a,c,u,h,f,g,v;let w,k;if("message"in e)w=e.message,k=e.signature;else{const{chain:x,wallet:C,statement:E,options:I}=e;let N;if(En())if(typeof C=="object")N=C;else{const H=window;if("ethereum"in H&&typeof H.ethereum=="object"&&"request"in H.ethereum&&typeof H.ethereum.request=="function")N=H.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof C!="object"||!I?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");N=C}const P=new URL((n=I?.url)!==null&&n!==void 0?n:window.location.href),R=await N.request({method:"eth_requestAccounts"}).then(H=>H).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!R||R.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const j=p_(R[0]);let U=(i=I?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!U){const H=await N.request({method:"eth_chainId"});U=JU(H)}const F={domain:P.host,address:j,statement:E,uri:P.href,version:"1",chainId:U,nonce:(r=I?.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(a=(o=I?.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(c=I?.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(u=I?.signInWithEthereum)===null||u===void 0?void 0:u.notBefore,requestId:(h=I?.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(f=I?.signInWithEthereum)===null||f===void 0?void 0:f.resources};w=QU(F),k=await N.request({method:"personal_sign",params:[YU(w),j]})}try{const{data:x,error:C}=await Me(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:k},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Hi});if(C)throw C;if(!x||!x.session||!x.user){const E=new $a;return this._returnResult({data:{user:null,session:null},error:E})}return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),this._returnResult({data:Object.assign({},x),error:C})}catch(x){if(Re(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async signInWithSolana(e){var n,i,r,o,a,c,u,h,f,g,v,w;let k,x;if("message"in e)k=e.message,x=e.signature;else{const{chain:C,wallet:E,statement:I,options:N}=e;let P;if(En())if(typeof E=="object")P=E;else{const j=window;if("solana"in j&&typeof j.solana=="object"&&("signIn"in j.solana&&typeof j.solana.signIn=="function"||"signMessage"in j.solana&&typeof j.solana.signMessage=="function"))P=j.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=E}const R=new URL((n=N?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in P&&P.signIn){const j=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},N?.signInWithSolana),{version:"1",domain:R.host,uri:R.href}),I?{statement:I}:null));let U;if(Array.isArray(j)&&j[0]&&typeof j[0]=="object")U=j[0];else if(j&&typeof j=="object"&&"signedMessage"in j&&"signature"in j)U=j;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in U&&"signature"in U&&(typeof U.signedMessage=="string"||U.signedMessage instanceof Uint8Array)&&U.signature instanceof Uint8Array)k=typeof U.signedMessage=="string"?U.signedMessage:new TextDecoder().decode(U.signedMessage),x=U.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");k=[`${R.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...I?["",I,""]:[""],"Version: 1",`URI: ${R.href}`,`Issued At: ${(r=(i=N?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((o=N?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${N.signInWithSolana.notBefore}`]:[],...!((a=N?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${N.signInWithSolana.expirationTime}`]:[],...!((c=N?.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${N.signInWithSolana.chainId}`]:[],...!((u=N?.signInWithSolana)===null||u===void 0)&&u.nonce?[`Nonce: ${N.signInWithSolana.nonce}`]:[],...!((h=N?.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${N.signInWithSolana.requestId}`]:[],...!((g=(f=N?.signInWithSolana)===null||f===void 0?void 0:f.resources)===null||g===void 0)&&g.length?["Resources",...N.signInWithSolana.resources.map(U=>`- ${U}`)]:[]].join(`
`);const j=await P.signMessage(new TextEncoder().encode(k),"utf8");if(!j||!(j instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=j}}try{const{data:C,error:E}=await Me(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:k,signature:Ho(x)},!((v=e.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(w=e.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Hi});if(E)throw E;if(!C||!C.session||!C.user){const I=new $a;return this._returnResult({data:{user:null,session:null},error:I})}return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),this._returnResult({data:Object.assign({},C),error:E})}catch(C){if(Re(C))return this._returnResult({data:{user:null,session:null},error:C});throw C}}async _exchangeCodeForSession(e){const n=await Mo(this.storage,`${this.storageKey}-code-verifier`),[i,r]=(n??"").split("/");try{if(!i&&this.flowType==="pkce")throw new vU;const{data:o,error:a}=await Me(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:Hi});if(await _n(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!o||!o.session||!o.user){const c=new $a;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:r??null}),error:a})}catch(o){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:i,token:r,access_token:o,nonce:a}=e,c=await Me(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:r,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:Hi}),{data:u,error:h}=c;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u||!u.session||!u.user){const f=new $a;return this._returnResult({data:{user:null,session:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:u,error:h})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,i,r,o,a;try{if("email"in e){const{email:c,options:u}=e;let h=null,f=null;this.flowType==="pkce"&&([h,f]=await qa(this.storage,this.storageKey));const{error:g}=await Me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(n=u?.data)!==null&&n!==void 0?n:{},create_user:(i=u?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:u?.captchaToken},code_challenge:h,code_challenge_method:f},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:c,options:u}=e,{data:h,error:f}=await Me(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(r=u?.data)!==null&&r!==void 0?r:{},create_user:(o=u?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:u?.captchaToken},channel:(a=u?.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h?.message_id},error:f})}throw new qd("You must provide either an email or phone number.")}catch(c){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async verifyOtp(e){var n,i;try{let r,o;"options"in e&&(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:a,error:c}=await Me(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:r,xform:Hi});if(c)throw c;if(!a)throw new Error("An error occurred on token verification.");const u=a.session,h=a.user;return u?.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),this._returnResult({data:{user:h,session:u},error:null})}catch(r){if(Re(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var n,i,r,o,a;try{let c=null,u=null;this.flowType==="pkce"&&([c,u]=await qa(this.storage,this.storageKey));const h=await Me(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&i!==void 0?i:void 0}),!((r=e?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:u}),headers:this.headers,xform:zU});return!((o=h.data)===null||o===void 0)&&o.url&&En()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(c){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(c))return this._returnResult({data:null,error:c});throw c}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:i}=e;if(i)throw i;if(!n)throw new bi;const{error:r}=await Me(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(Re(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:i,type:r,options:o}=e,{error:a}=await Me(this.fetch,"POST",n,{headers:this.headers,body:{email:i,type:r,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:i,type:r,options:o}=e,{data:a,error:c}=await Me(this.fetch,"POST",n,{headers:this.headers,body:{phone:i,type:r,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a?.message_id},error:c})}throw new qd("You must provide either an email or phone number and a type")}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await i,await n()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=n();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Mo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<Km:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const a=await Mo(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=Gm()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=UU(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await Me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ws}):await this._useSession(async n=>{var i,r,o;const{data:a,error:c}=n;if(c)throw c;return!(!((i=a.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new bi}:await Me(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0,xform:Ws})})}catch(n){if(Re(n))return mU(n)&&(await this._removeSession(),await _n(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async i=>{const{data:r,error:o}=i;if(o)throw o;if(!r.session)throw new bi;const a=r.session;let c=null,u=null;this.flowType==="pkce"&&e.email!=null&&([c,u]=await qa(this.storage,this.storageKey));const{data:h,error:f}=await Me(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:u}),jwt:a.access_token,xform:Ws});if(f)throw f;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(i){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new bi;const n=Date.now()/1e3;let i=n,r=!0,o=null;const{payload:a}=Hm(e.access_token);if(a.exp&&(i=a.exp,r=i<=n),r){const{data:c,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c)return{data:{user:null,session:null},error:null};o=c}else{const{data:c,error:u}=await this._getUser(e.access_token);if(u)throw u;o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:i-n,expires_at:i},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(Re(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var i;if(!e){const{data:a,error:c}=n;if(c)throw c;e=(i=a.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new bi;const{data:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!En())throw new Kd("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Kd(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Lx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Kd("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Lx("No code detected.");const{data:I,error:N}=await this._exchangeCodeForSession(e.code);if(N)throw N;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:I.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:r,access_token:o,refresh_token:a,expires_in:c,expires_at:u,token_type:h}=e;if(!o||!c||!a||!h)throw new Kd("No session defined in URL");const f=Math.round(Date.now()/1e3),g=parseInt(c);let v=f+g;u&&(v=parseInt(u));const w=v-f;w*1e3<=Ja&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${g}s`);const k=v-g;f-k>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",k,v,f):f-k<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",k,v,f);const{data:x,error:C}=await this._getUser(o);if(C)throw C;const E={provider_token:i,provider_refresh_token:r,access_token:o,expires_in:g,expires_at:v,refresh_token:a,token_type:h,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:E,redirectType:e.type},error:null})}catch(i){if(Re(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Mo(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var i;const{data:r,error:o}=n;if(o)return this._returnResult({error:o});const a=(i=r.session)===null||i===void 0?void 0:i.access_token;if(a){const{error:c}=await this.admin.signOut(a,e);if(c&&!(pU(c)&&(c.status===404||c.status===401||c.status===403)))return this._returnResult({error:c})}return e!=="others"&&(await this._removeSession(),await _n(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=TU(),i={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async n=>{var i,r;try{const{data:{session:o},error:a}=n;if(a)throw a;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let i=null,r=null;this.flowType==="pkce"&&([i,r]=await qa(this.storage,this.storageKey,!0));try{return await Me(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:r,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:i,error:r}=await this._useSession(async o=>{var a,c,u,h,f;const{data:g,error:v}=o;if(v)throw v;const w=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await Me(this.fetch,"GET",w,{headers:this.headers,jwt:(f=(h=g.session)===null||h===void 0?void 0:h.access_token)!==null&&f!==void 0?f:void 0})});if(r)throw r;return En()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(Re(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var i;try{const{error:r,data:{session:o}}=n;if(r)throw r;const{options:a,provider:c,token:u,access_token:h,nonce:f}=e,g=await Me(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=o?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:c,id_token:u,access_token:h,nonce:f,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Hi}),{data:v,error:w}=g;return w?this._returnResult({data:{user:null,session:null},error:w}):!v||!v.session||!v.user?this._returnResult({data:{user:null,session:null},error:new $a}):(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("USER_UPDATED",v.session)),this._returnResult({data:v,error:w}))}catch(r){if(await _n(this.storage,`${this.storageKey}-code-verifier`),Re(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var i,r;const{data:o,error:a}=n;if(a)throw a;return await Me(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const i=Date.now();return await PU(async r=>(r>0&&await EU(200*Math.pow(2,r-1)),this._debug(n,"refreshing attempt",r),await Me(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Hi})),(r,o)=>{const a=200*Math.pow(2,r);return o&&Wm(o)&&Date.now()+a-i<Ja})}catch(i){if(this._debug(n,"error",i),Re(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",i),En()&&!n.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,n;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const r=await Mo(this.storage,this.storageKey);if(r&&this.userStorage){let a=await Mo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:r.user},await Ya(this.userStorage,this.storageKey+"-user",a)),r.user=(e=a?.user)!==null&&e!==void 0?e:Gm()}else if(r&&!r.user&&!r.user){const a=await Mo(this.storage,this.storageKey+"-user");a&&a?.user?(r.user=a.user,await _n(this.storage,this.storageKey+"-user"),await Ya(this.storage,this.storageKey,r)):r.user=Gm()}if(this._debug(i,"session from storage",r),!this._isValidSession(r)){this._debug(i,"session is not valid"),r!==null&&await this._removeSession();return}const o=((n=r.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Km;if(this._debug(i,`session has${o?"":" not"} expired with margin of ${Km}s`),o){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),Wm(a)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:c}=await this._getUser(r.access_token);!c&&a?.user?(r.user=a.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(i,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(i,"error",r),console.error(r);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var n,i;if(!e)throw new bi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new uf;const{data:o,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!o.session)throw new bi;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const c={data:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(r,"error",o),Re(o)){const a={data:null,error:o};return Wm(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(o),o}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,n,i=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",n,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],a=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,n)}catch(u){o.push(u)}});if(await Promise.all(a),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await _n(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),i=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&n.user&&await Ya(this.userStorage,this.storageKey+"-user",{user:n.user});const r=Object.assign({},n);delete r.user;const o=zx(r);await Ya(this.storage,this.storageKey,o)}else{const r=zx(n);await Ya(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await _n(this.storage,this.storageKey),await _n(this.storage,this.storageKey+"-code-verifier"),await _n(this.storage,this.storageKey+"-user"),this.userStorage&&await _n(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&En()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ja);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:i}}=n;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((i.expires_at*1e3-e)/Ja);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Ja}ms, refresh threshold is ${tv} ticks`),r<=tv&&await this._callRefreshToken(i.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof f_)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!En()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,i){const r=[`provider=${encodeURIComponent(n)}`];if(i?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&r.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[o,a]=await qa(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(c.toString())}if(i?.queryParams){const o=new URLSearchParams(i.queryParams);r.push(o.toString())}return i?.skipBrowserRedirect&&r.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var i;const{data:r,error:o}=n;return o?this._returnResult({data:null,error:o}):await Me(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var i,r;const{data:o,error:a}=n;if(a)return this._returnResult({data:null,error:a});const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:u,error:h}=await Me(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(i=o?.session)===null||i===void 0?void 0:i.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&u.type==="totp"&&(!((r=u?.totp)===null||r===void 0)&&r.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),this._returnResult({data:u,error:null}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var i;const{data:r,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?r4(e.webauthn.credential_response):s4(e.webauthn.credential_response)})}:{code:e.code}),{data:c,error:u}=await Me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:u}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var i;const{data:r,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=await Me(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=r?.session)===null||i===void 0?void 0:i.access_token});if(a.error)return a;const{data:c}=a;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:n4(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:i4(c.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:i}=await this.getUser();if(i)return{data:null,error:i};const r={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n?.factors)!==null&&e!==void 0?e:[])r.all.push(o),o.status==="verified"&&r[o.factor_type].push(o);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:i},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Hm(i.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((n=(e=i.user.factors)===null||e===void 0?void 0:e.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:i},error:r}=n;return r?this._returnResult({data:null,error:r}):i?await Me(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new bi})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async i=>{const{data:{session:r},error:o}=i;if(o)return this._returnResult({data:null,error:o});if(!r)return this._returnResult({data:null,error:new bi});const a=await Me(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return a.data&&a.data.redirect_url&&En()&&!n?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(i){if(Re(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,n){try{return await this._useSession(async i=>{const{data:{session:r},error:o}=i;if(o)return this._returnResult({data:null,error:o});if(!r)return this._returnResult({data:null,error:new bi});const a=await Me(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return a.data&&a.data.redirect_url&&En()&&!n?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(i){if(Re(i))return this._returnResult({data:null,error:i});throw i}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:i}=e;return i?this._returnResult({data:null,error:i}):n?await Me(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new bi})})}catch(e){if(Re(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:i},error:r}=n;return r?this._returnResult({data:null,error:r}):i?(await Me(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new bi})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let i=n.keys.find(c=>c.kid===e);if(i)return i;const r=Date.now();if(i=this.jwks.keys.find(c=>c.kid===e),i&&this.jwks_cached_at+hU>r)return i;const{data:o,error:a}=await Me(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=r,i=o.keys.find(c=>c.kid===e),!i)?null:i}async getClaims(e,n={}){try{let i=e;if(!i){const{data:w,error:k}=await this.getSession();if(k||!w.session)return this._returnResult({data:null,error:k});i=w.session.access_token}const{header:r,payload:o,signature:a,raw:{header:c,payload:u}}=Hm(i);n?.allowExpired||DU(o.exp);const h=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!h){const{error:w}=await this.getUser(i);if(w)throw w;return{data:{claims:o,header:r,signature:a},error:null}}const f=MU(r.alg),g=await crypto.subtle.importKey("jwk",h,f,!0,["verify"]);if(!await crypto.subtle.verify(f,g,a,xU(`${c}.${u}`)))throw new rv("Invalid JWT signature");return{data:{claims:o,header:r,signature:a},error:null}}catch(i){if(Re(i))return this._returnResult({data:null,error:i});throw i}}}pu.nextInstanceID={};const p4=pu,m4="2.89.0";let Ic="";typeof Deno<"u"?Ic="deno":typeof document<"u"?Ic="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ic="react-native":Ic="node";const g4={"X-Client-Info":`supabase-js-${Ic}/${m4}`},v4={headers:g4},y4={schema:"public"},b4={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},w4={};function mu(t){"@babel/helpers - typeof";return mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mu(t)}function k4(t,e){if(mu(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(mu(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function x4(t){var e=k4(t,"string");return mu(e)=="symbol"?e:e+""}function S4(t,e,n){return(e=x4(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Jx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Lt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Jx(Object(n),!0).forEach(function(i){S4(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const T4=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),C4=()=>Headers,_4=(t,e,n)=>{const i=T4(n),r=C4();return async(o,a)=>{var c;const u=(c=await e())!==null&&c!==void 0?c:t;let h=new r(a?.headers);return h.has("apikey")||h.set("apikey",t),h.has("Authorization")||h.set("Authorization",`Bearer ${u}`),i(o,Lt(Lt({},a),{},{headers:h}))}};function E4(t){return t.endsWith("/")?t:t+"/"}function P4(t,e){var n,i;const{db:r,auth:o,realtime:a,global:c}=t,{db:u,auth:h,realtime:f,global:g}=e,v={db:Lt(Lt({},u),r),auth:Lt(Lt({},h),o),realtime:Lt(Lt({},f),a),storage:{},global:Lt(Lt(Lt({},g),c),{},{headers:Lt(Lt({},(n=g?.headers)!==null&&n!==void 0?n:{}),(i=c?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return t.accessToken?v.accessToken=t.accessToken:delete v.accessToken,v}function R4(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(E4(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var N4=class extends p4{constructor(t){super(t)}},I4=class{constructor(t,e,n){var i,r;this.supabaseUrl=t,this.supabaseKey=e;const o=R4(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const a=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:y4,realtime:w4,auth:Lt(Lt({},b4),{},{storageKey:a}),global:v4},u=P4(n??{},c);if(this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(r=u.global.headers)!==null&&r!==void 0?r:{},u.accessToken)this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=u.auth)!==null&&h!==void 0?h:{},this.headers,u.global.fetch)}this.fetch=_4(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Lt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.accessToken&&this.accessToken().then(f=>this.realtime.setAuth(f)).catch(f=>console.warn("Failed to set initial Realtime auth token:",f)),this.rest=new u3(new URL("rest/v1",o).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new aU(this.storageUrl.href,this.headers,this.fetch,n?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new s3(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:i}=await t.auth.getSession();return(e=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:r,storageKey:o,flowType:a,lock:c,debug:u,throwOnError:h},f,g){const v={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new N4({url:this.authUrl.href,headers:Lt(Lt({},v),f),storageKey:o,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:i,userStorage:r,flowType:a,lock:c,debug:u,throwOnError:h,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new E3(this.realtimeUrl.href,Lt(Lt({},t),{},{params:Lt(Lt({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const O4=(t,e,n)=>new I4(t,e,n);function A4(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}A4()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const j4="https://mzlpnbjubwdhfytwbvit.supabase.co",D4="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16bHBuYmp1YndkaGZ5dHdidml0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MTY4ODUsImV4cCI6MjA4Mzk5Mjg4NX0.sB9IYsdmTpwNigX7TLyQeFllRNncmQWfQ8HNlHZrzbc",Yi=O4(j4,D4);async function M4(t,e,n){t.name.split(".").pop();const i=t.name.replace(/[^a-zA-Z0-9.-]/g,"_").slice(0,80),r=`${e}/${n}/${Date.now()}-${i}`,{error:o}=await Yi.storage.from(_x).upload(r,t,{cacheControl:"3600",upsert:!1});if(o)throw o;const{data:a}=Yi.storage.from(_x).getPublicUrl(r);return a.publicUrl}function sr(){return S.useMemo(()=>Yi,[])}function Tu(){const[t,e]=S.useState(null),[n,i]=S.useState(null),[r,o]=S.useState(!0),a=sr();S.useEffect(()=>{let f=!1;a.auth.getSession().then(({data:{session:v}})=>{f||(e(v),i(v?.user??null))}).catch(v=>{f||(e(null),i(null))}).finally(()=>{f||o(!1)});const{data:{subscription:g}}=a.auth.onAuthStateChange((v,w)=>{f||(e(w),i(w?.user??null),o(!1))});return()=>{f=!0,g.unsubscribe()}},[a]);const c=S.useCallback(async()=>{await a.auth.signOut()},[a]),u=S.useCallback(async(f,g)=>{const{data:v,error:w}=await a.auth.signInWithPassword({email:f,password:g});if(w)throw w;return v},[a]),h=S.useCallback(async(f,g,v)=>{const{data:w,error:k}=await a.auth.signUp({email:f,password:g,options:{data:v}});if(k)throw k;return w},[a]);return{session:t,user:n,loading:r,signOut:c,signIn:u,signUp:h,isAuthenticated:!!t&&!!n}}function R0(t){const[e,n]=S.useState(null),[i,r]=S.useState(!0),[o,a]=S.useState(null),c=sr(),{user:u}=Tu(),h=u?.id,f=S.useCallback(async()=>{if(!h){r(!1);return}try{r(!0),a(null);const{data:v,error:w}=await c.from("profiles").select("*").eq("id",h).single();if(w)if(w.code==="PGRST116"){const{data:k,error:x}=await c.from("profiles").insert({id:h,username:null,discriminator:null,avatar_url:`https://api.dicebear.com/7.x/notionists/svg?seed=${h}`,status:"online"}).select().single();if(x)throw x;n(k)}else throw w;else n(v)}catch(v){a(v instanceof Error?v:new Error("Profile yklenemedi"))}finally{r(!1)}},[h,c]),g=S.useCallback(async v=>{if(!h)throw new Error("User ID gerekli");try{const{data:w,error:k}=await c.from("profiles").update({...v,updated_at:new Date().toISOString()}).eq("id",h).select().single();if(k)throw k;return n(w),w}catch(w){const k=w instanceof Error?w:new Error("Profile gncellenemedi");throw a(k),k}},[h,c]);return S.useEffect(()=>{f()},[f]),{profile:e,loading:i,error:o,refetch:f,updateProfile:g}}function L4(){const[t,e]=S.useState([]),[n,i]=S.useState(!0),[r,o]=S.useState(null),a=sr(),{user:c,loading:u}=Tu(),h=S.useCallback(async()=>{try{if(o(null),!c?.id){e([]),i(!1);return}i(!0);const{data:f,error:g}=await a.from("server_members").select("server_id").eq("user_id",c.id);if(g)throw g;const v=(f||[]).map(x=>x.server_id);if(v.length===0){e([]),i(!1);return}const{data:w,error:k}=await a.from("servers").select("id, created_at, name, icon_url, owner_id").in("id",v).order("created_at",{ascending:!1});if(k)throw k;e(w||[])}catch(f){o(f instanceof Error?f:new Error("Servers yklenemedi")),e([])}finally{i(!1)}},[a,c?.id]);return S.useEffect(()=>{u||h()},[u,h]),{servers:t,loading:n,error:r,refetch:h}}function U4(t){const[e,n]=S.useState([]),[i,r]=S.useState(!1),[o,a]=S.useState(null),c=sr(),u=S.useCallback(async()=>{if(!t||t==="dm"){n([]);return}try{r(!0),a(null);const{data:h,error:f}=await c.from("channels").select("*").eq("server_id",t).order("position",{ascending:!0}).order("created_at",{ascending:!0});if(f)throw f;n(h||[])}catch(h){a(h instanceof Error?h:new Error("Channels yklenemedi"))}finally{r(!1)}},[t,c]);return S.useEffect(()=>{u()},[u]),{channels:e,loading:i,error:o,refetch:u}}function F4(t){const[e,n]=S.useState([]),[i,r]=S.useState(!1),[o,a]=S.useState(null),c=sr(),u=S.useCallback(async()=>{if(!t||t.length<36){n([]);return}try{r(!0),a(null);const{data:g,error:v}=await c.from("messages").select("*, profiles:user_id(username, avatar_url)").eq("channel_id",t).order("created_at",{ascending:!0});if(v)throw v;const w=(g||[]).map(k=>({id:k.id,user:k.profiles?.username||"Unknown",content:k.content,time:new Date(k.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isMe:!1,avatar:k.profiles?.avatar_url||""}));n(w)}catch(g){a(g instanceof Error?g:new Error("Messages yklenemedi"))}finally{r(!1)}},[t,c]),h=S.useCallback(async(g,v)=>{if(!(!t||!g.trim()))try{const{data:w,error:k}=await c.from("messages").insert({channel_id:t,user_id:v,content:g.trim()}).select("*, profiles:user_id(username, avatar_url)").single();if(k)throw k;const x={id:w.id,user:w.profiles?.username||"Unknown",content:w.content,time:new Date(w.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isMe:!0,avatar:w.profiles?.avatar_url||""};return n(C=>[...C,x]),x}catch(w){const k=w instanceof Error?w:new Error("Mesaj gnderilemedi");throw a(k),k}},[t,c]),f=S.useCallback(async(g,v,w)=>{if(!(!t||!w.trim()))try{const{error:k}=await c.from("messages").update({content:w.trim()}).eq("id",g).eq("user_id",v);if(k)throw k;n(x=>x.map(C=>C.id===g?{...C,content:w.trim()}:C))}catch(k){const x=k instanceof Error?k:new Error("Mesaj gncellenemedi");throw a(x),x}},[t,c]);return S.useEffect(()=>{if(!t||t.length<36){n([]);return}let g=!0,v=null;return(async()=>(await u(),v=c.channel(`messages:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`channel_id=eq.${t}`},async k=>{if(g)try{const{data:x,error:C}=await c.from("messages").select("*, profiles:user_id(username, avatar_url)").eq("id",k.new.id).single();if(!C&&x&&g){const E={id:x.id,user:x.profiles?.username||"Unknown",content:x.content,time:new Date(x.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isMe:!1,avatar:x.profiles?.avatar_url||""};n(I=>I.some(N=>N.id===E.id)?I:[...I,E])}else g&&u()}catch{g&&u()}}).on("postgres_changes",{event:"DELETE",schema:"public",table:"messages",filter:`channel_id=eq.${t}`},k=>{g&&n(x=>x.filter(C=>C.id!==k.old.id))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages",filter:`channel_id=eq.${t}`},k=>{g&&n(x=>x.map(C=>C.id===k.new.id?{...C,content:k.new.content}:C))}).subscribe()))(),()=>{g=!1,v&&c.removeChannel(v)}},[t,c,u]),{messages:e,loading:i,error:o,refetch:u,sendMessage:h,updateMessage:f}}function B4({onLogin:t}){const[e,n]=S.useState(!0),[i,r]=S.useState(!1),[o,a]=S.useState(null),{signIn:c,signUp:u}=Tu(),[h,f]=S.useState(""),[g,v]=S.useState(""),w=async k=>{k.preventDefault(),r(!0),a(null);try{e?await c(h,g):await u(h,g),t()}catch(x){a(x.message||"Bir hata olutu.")}finally{r(!1)}};return m.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[m.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-orange-600/20 rounded-full blur-[120px]"}),m.jsx("div",{className:"absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-red-600/20 rounded-full blur-[120px]"}),m.jsxs("div",{className:"w-full max-w-md relative z-10",children:[m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("div",{className:"inline-flex items-center justify-center p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-3xl border border-white/5 mb-6 shadow-2xl shadow-orange-500/5",children:m.jsx(lv,{size:40,className:"text-orange-500",fill:"currentColor",fillOpacity:.2})}),m.jsxs("h1",{className:"text-4xl font-black text-white mb-2 tracking-tight",children:["Oxide",m.jsx("span",{className:"text-orange-500",children:"Space"})]}),m.jsx("p",{className:"text-zinc-500",children:"Dijital evrenine giri yap."})]}),m.jsxs("div",{className:"backdrop-blur-xl bg-[#121217]/80 border border-white/10 rounded-3xl p-8 shadow-2xl relative overflow-hidden group",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"}),m.jsxs("form",{onSubmit:w,className:"space-y-4 relative z-10",children:[o&&m.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-xl flex items-center gap-3 text-red-400 text-sm",children:[m.jsx(Bh,{size:16}),o]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase ml-1",children:"Email"}),m.jsxs("div",{className:"relative",children:[m.jsx(zE,{className:"absolute left-3 top-3.5 text-zinc-500",size:18}),m.jsx("input",{type:"email",required:!0,value:h,onChange:k=>f(k.target.value),placeholder:"ornek@oxide.space",className:"w-full bg-black/40 border border-white/5 rounded-xl py-3 pl-10 pr-4 text-white focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/50 transition-all placeholder:text-zinc-700"})]})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase ml-1",children:"ifre"}),m.jsxs("div",{className:"relative",children:[m.jsx(FE,{className:"absolute left-3 top-3.5 text-zinc-500",size:18}),m.jsx("input",{type:"password",required:!0,value:g,onChange:k=>v(k.target.value),placeholder:"",className:"w-full bg-black/40 border border-white/5 rounded-xl py-3 pl-10 pr-4 text-white focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/50 transition-all placeholder:text-zinc-700"})]})]}),m.jsx("button",{type:"submit",disabled:i,className:"w-full bg-gradient-to-r from-orange-600 to-red-600 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-orange-500/20 hover:shadow-orange-500/40 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 mt-4",children:i?m.jsx(qs,{className:"animate-spin"}):e?"Giri Yap":"Kayt Ol"})]}),m.jsxs("div",{className:"mt-6 flex flex-col items-center gap-4",children:[m.jsx("div",{className:"w-full h-px bg-white/5"}),m.jsxs("p",{className:"text-zinc-500 text-sm",children:[e?"Hesabn yok mu?":"Zaten hesabn var m?"," ",m.jsx("button",{onClick:()=>{n(!e),a(null)},className:"text-orange-500 hover:text-orange-400 font-bold transition-colors",children:e?"Kayt Ol":"Giri Yap"})]})]})]}),m.jsxs("p",{className:"text-center text-zinc-700 text-xs mt-8",children:["Devam ederek ",m.jsx("a",{href:"#",className:"underline hover:text-zinc-500",children:"Hizmet artlar"}),"'n kabul etmi olursun."]})]})]})}const Wd=2,Hd=32,V4=/^[a-zA-Z0-9_]+$/;function z4(){return String(1e3+Math.floor(Math.random()*9e3))}function $4({onDone:t}){const{updateProfile:e}=R0(),[n,i]=S.useState(""),[r,o]=S.useState(!1),[a,c]=S.useState(null),u=async h=>{h.preventDefault(),c(null);const f=n.trim();if(f.length<Wd){c(`Kullanc ad en az ${Wd} karakter olmal.`);return}if(f.length>Hd){c(`Kullanc ad en fazla ${Hd} karakter olmal.`);return}if(!V4.test(f)){c("Sadece harf, rakam ve alt izgi (_) kullanabilirsin.");return}o(!0);try{const g=z4();await e({username:f,discriminator:g}),t()}catch(g){const v=g instanceof Error?g.message:"Kullanc ad kaydedilemedi.";c(v)}finally{o(!1)}};return m.jsxs("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[m.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-orange-600/20 rounded-full blur-[120px]"}),m.jsx("div",{className:"absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-red-600/20 rounded-full blur-[120px]"}),m.jsxs("div",{className:"w-full max-w-md relative z-10",children:[m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("div",{className:"inline-flex justify-center p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-3xl border border-white/5 mb-6 shadow-2xl shadow-orange-500/5",children:m.jsx(lv,{size:40,className:"text-orange-500",fill:"currentColor",fillOpacity:.2})}),m.jsxs("h1",{className:"text-4xl font-black text-white mb-2 tracking-tight",children:["Oxide",m.jsx("span",{className:"text-orange-500",children:"Space"})]}),m.jsx("p",{className:"text-zinc-500",children:"Sadece kullanc adn gir; etiket (#1234) sana otomatik atanr."})]}),m.jsx("div",{className:"backdrop-blur-xl bg-[#121217]/80 border border-white/10 rounded-3xl p-8 shadow-2xl relative overflow-hidden",children:m.jsxs("form",{onSubmit:u,className:"space-y-4 relative z-10",children:[a&&m.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-xl flex items-center gap-3 text-red-400 text-sm",children:[m.jsx(Bh,{size:16}),a]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase ml-1",children:"Kullanc ad (etiket sistem tarafndan atanr)"}),m.jsxs("div",{className:"relative",children:[m.jsx(oP,{className:"absolute left-3 top-3.5 text-zinc-500",size:18}),m.jsx("input",{type:"text",required:!0,minLength:Wd,maxLength:Hd,value:n,onChange:h=>i(h.target.value),placeholder:"kullanici_adi",className:"w-full bg-black/40 border border-white/5 rounded-xl py-3 pl-10 pr-4 text-white focus:outline-none focus:border-orange-500/50 focus:ring-1 focus:ring-orange-500/50 transition-all placeholder:text-zinc-700"})]}),m.jsxs("p",{className:"text-xs text-zinc-500 ml-1",children:[Wd,"-",Hd," karakter, sadece harf, rakam ve _"]})]}),m.jsx("button",{type:"submit",disabled:r,className:"w-full bg-gradient-to-r from-orange-600 to-red-600 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-orange-500/20 hover:shadow-orange-500/40 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 mt-4",children:r?m.jsx(qs,{className:"animate-spin"}):"Devam"})]})}),m.jsx("p",{className:"text-center text-zinc-700 text-xs mt-6",children:"Etiket (rn. #1234) ileride Premium ile deitirilebilir."})]})]})}const g_=S.createContext(void 0);function q4({children:t}){const[e,n]=S.useState({mic:!0,video:!1,deafen:!1,screenShare:!1,streamVolume:100,normalVolume:100}),[i,r]=S.useState([]),[o,a]=S.useState(new Set),[c,u]=S.useState(new Map),[h,f]=S.useState(null),[g,v]=S.useState(null),[w,k]=S.useState(!1);return m.jsx(g_.Provider,{value:{voiceState:e,setVoiceState:n,voiceChannelUsers:i,setVoiceChannelUsers:r,livekitSpeakingIds:o,setLivekitSpeakingIds:a,livekitVideoTracks:c,setLivekitVideoTracks:u,livekitFocusedKey:h,setLivekitFocusedKey:f,livekitPinnedKey:g,setLivekitPinnedKey:v,livekitFullscreen:w,setLivekitFullscreen:k},children:t})}function v_(){const t=S.useContext(g_);if(!t)throw new Error("useVoiceContext must be used within VoiceProvider");return t}const y_=S.createContext(void 0);function K4({children:t}){const[e,n]=S.useState(null),[i,r]=S.useState(null),[o,a]=S.useState("text"),[c,u]=S.useState(null),[h,f]=S.useState([{id:"dm",name:"Mesajlar",icon:null,type:"dm"}]),[g,v]=S.useState({}),[w,k]=S.useState({}),x=pt.useCallback((R,j)=>{k(U=>({...U,[R]:j}))},[]),{servers:C,loading:E,refetch:I}=L4(),{channels:N,refetch:P}=U4(e);return m.jsx(y_.Provider,{value:{activeServerId:e,activeChannelId:i,servers:h,channels:g,channelType:o,connectedVoiceChannelId:c,lastTextChannelIdByServer:w,setActiveServerId:n,setActiveChannelId:r,setChannelType:a,setConnectedVoiceChannelId:u,setServers:f,setChannels:v,setLastTextChannelIdForServer:x,dbServers:C,dbServersLoading:E,dbChannels:N,refetchServers:I,refetchChannels:P},children:t})}function df(){const t=S.useContext(y_);if(!t)throw new Error("useServerContext must be used within ServerProvider");return t}const b_=S.createContext(void 0);function W4({children:t}){const[e,n]=S.useState([]),[i,r]=S.useState(""),[o,a]=S.useState(!0),[c,u]=S.useState(!1),[h,f]=S.useState(!1),[g,v]=S.useState(!1),[w,k]=S.useState(""),[x,C]=S.useState(!1),[E,I]=S.useState(!0),[N,P]=S.useState("setup"),[R,j]=S.useState({create:!1,joinServer:!1,createServer:!1,settings:!1,serverSettings:!1,profile:!1,addChannel:!1,createCategory:!1}),[U,F]=S.useState(""),[H,q]=S.useState("text"),[Q,ne]=S.useState("GENEL"),[Se,De]=S.useState(""),[Ke,de]=S.useState(""),[V,Z]=S.useState(null),[he,oe]=S.useState(null),[L,G]=S.useState(""),[ke,Te]=S.useState(""),[Ne,Ce]=S.useState(!1),[qe,se]=S.useState(""),_e=S.useCallback((zt,mt="success")=>{const Et=Date.now();n(wt=>[...wt,{id:Et,msg:zt,type:mt}]),setTimeout(()=>{n(wt=>wt.filter(kn=>kn.id!==Et))},3e3)},[]),Pe=S.useCallback(zt=>{n(mt=>mt.filter(Et=>Et.id!==zt))},[]);return m.jsx(b_.Provider,{value:{toasts:e,addToast:_e,removeToast:Pe,inputVal:i,setInputVal:r,showMembers:o,setShowMembers:a,isMobileMenuOpen:c,setMobileMenuOpen:u,showNotifications:h,setShowNotifications:f,showAddFriend:g,setShowAddFriend:v,searchQuery:w,setSearchQuery:k,isLoading:x,setIsLoading:C,isAuthChecking:E,setIsAuthChecking:I,view:N,setView:P,modals:R,setModals:j,newChannelName:U,setNewChannelName:F,newChannelType:H,setNewChannelType:q,newChannelCategory:Q,setNewChannelCategory:ne,newCategoryName:Se,setNewCategoryName:De,newServerName:Ke,setNewServerName:de,newServerIconFile:V,setNewServerIconFile:Z,newServerIconPreview:he,setNewServerIconPreview:oe,joinCode:L,setJoinCode:G,inviteCode:ke,setInviteCode:Te,inviteLoading:Ne,setInviteLoading:Ce,newFriendName:qe,setNewFriendName:se},children:t})}function N0(){const t=S.useContext(b_);if(!t)throw new Error("useUIContext must be used within UIProvider");return t}function H4(){const t=sr(),{activeChannelId:e,channelType:n}=df(),{voiceChannelUsers:i,setVoiceChannelUsers:r}=v_(),{addToast:o}=N0(),a=S.useCallback(async c=>{if(c)try{const{data:u,error:h}=await t.from("voice_states").select(`
            *,
            profiles:user_id (
              id,
              username,
              avatar_url,
              status
            )
          `).eq("channel_id",c);h&&(logger.error("Voice state fetch error:",h),o("Ses kanal kullanclar yklenemedi.","error"));const f=Ct.getRoom(),g=new Set;f&&(f.localParticipant.identity&&g.add(f.localParticipant.identity),f.remoteParticipants.forEach(E=>{E.identity&&g.add(E.identity)}));const v=Array.from(g);let w=[];if(v.length>0){const{data:E,error:I}=await t.from("profiles").select("id, username, avatar_url, status").in("id",v);I?logger.error("Profiles fetch error:",I):E&&(w=E)}const k=new Map;u&&u.forEach(E=>{E.profiles&&k.set(E.user_id,{...E.profiles,muted:E.muted,deafened:E.deafened,video_enabled:E.video_enabled,screen_share_enabled:E.screen_share_enabled})});const x=new Map(k),C=Ct.getRoom();w.forEach(E=>{const I=x.get(E.id);if(C){const N=C.remoteParticipants.get(E.id)||(C.localParticipant.identity===E.id?C.localParticipant:null);if(N){const P=N.getTrackPublication(W.Source.Microphone),R=N.getTrackPublication(W.Source.Camera),j=N.getTrackPublication(W.Source.ScreenShare);I?x.set(E.id,{...I,muted:P?P.isMuted:I.muted,video_enabled:R?!!R.track:I.video_enabled,screen_share_enabled:j?!!j.track:I.screen_share_enabled}):x.set(E.id,{...E,muted:P?P.isMuted:!1,deafened:!1,video_enabled:R?!!R.track:!1,screen_share_enabled:j?!!j.track:!1})}}}),r(Array.from(x.values()))}catch(u){logger.error("fetchVoiceChannelUsers error:",u),o("Ses kanal kullanclar yklenirken hata olutu.","error")}},[t,o,r]);return S.useEffect(()=>{if(!e||n!=="voice"){r([]);return}let c=!0,u=null,h=[];return(async()=>{u=t.channel(`voice_states:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"voice_states",filter:`channel_id=eq.${e}`},()=>{c&&a(e)}).subscribe();const g=Ct.getRoom();if(g&&c){const v=()=>{c&&a(e)},w=()=>{c&&a(e)};g.on("participantConnected",v),g.on("participantDisconnected",w),h=[{event:"participantConnected",handler:v},{event:"participantDisconnected",handler:w}],a(e)}})(),()=>{c=!1,u&&t.removeChannel(u);const g=Ct.getRoom();g&&h.length>0&&h.forEach(({event:v,handler:w})=>{g.off(v,w)})}},[e,n,t,a,r]),{fetchVoiceChannelUsers:a,voiceChannelUsers:i}}function G4(){const t=sr(),{setServers:e,refetchServers:n}=df(),{addToast:i}=N0(),r=S.useCallback(async(u,h)=>{try{const{data:{user:f}}=await t.auth.getUser();if(!f)throw new Error("Kullanc giri yapmam");let g=null;if(h){const C=h.name.split(".").pop(),I=`server-icons/${`${f.id}-${Date.now()}.${C}`}`,{error:N}=await t.storage.from("server-icons").upload(I,h,{cacheControl:"3600",upsert:!1});if(N)throw new Error("Icon yklenemedi: "+N.message);const{data:{publicUrl:P}}=t.storage.from("server-icons").getPublicUrl(I);g=P}const{data:v,error:w}=await t.from("servers").insert({name:u.trim(),icon_url:g,owner_id:f.id}).select().single();if(w)throw w;const{error:k}=await t.from("server_members").insert({server_id:v.id,user_id:f.id});k&&$v.error("Member ekleme hatas:",k);const x={id:v.id,name:v.name,icon:g,type:"server",ownerId:v.owner_id};return e(C=>[...C,x]),await n(),i("Sunucu oluturuldu!","success"),v}catch(f){const g=f.message||"Sunucu oluturulamad";throw i(g,"error"),f}},[t,e,n,i]),o=S.useCallback(async u=>{try{const{data:{user:h}}=await t.auth.getUser();if(!h)throw new Error("Kullanc giri yapmam");const{data:f,error:g}=await t.from("server_invites").select("server_id").eq("code",u).single();if(g||!f)throw new Error("Geersiz davet kodu");const{error:v}=await t.from("server_members").insert({server_id:f.server_id,user_id:h.id});if(v){if(v.code==="23505"){i("Zaten bu sunucunun yesisin!","info");return}throw v}await n(),i("Sunucuya katldn!","success")}catch(h){const f=h.message||"Sunucuya katlamad";throw i(f,"error"),h}},[t,n,i]),a=S.useCallback(async(u,h,f,g)=>{try{const{data:v}=await t.from("channels").select("position").eq("server_id",u).order("position",{ascending:!1}).limit(1).maybeSingle(),w=(v?.position??-1)+1,{data:k,error:x}=await t.from("channels").insert({server_id:u,name:h.trim(),type:f,category:g||"GENEL",position:w}).select().single();if(x)throw x;return i("Kanal oluturuldu!","success"),k}catch(v){const w=v.message||"Kanal oluturulamad";throw i(w,"error"),v}},[t,i]),c=S.useCallback(async u=>{try{const{error:h}=await t.from("channels").delete().eq("id",u);if(h)throw h;i("Kanal silindi!","success")}catch(h){const f=h.message||"Kanal silinemedi";throw i(f,"error"),h}},[t,i]);return{createServer:r,joinServer:o,createChannel:a,deleteChannel:c}}const J4=2e3;function Y4(t,e,n){const i=sr(),[r,o]=S.useState([]),a=S.useRef(null),c=S.useRef(!1),u=S.useCallback(async h=>{if(!t||!e||c.current===h)return;c.current=h;const f=a.current;if(f)try{await f.track({user_id:e,username:n||"Kullanc",typing:h})}catch{}},[t,e,n]);return S.useEffect(()=>{if(!t||!e){o([]);return}const h=`typing:${t}`,f=i.channel(h);return f.on("presence",{event:"sync"},()=>{const g=f.presenceState(),v=[];Object.values(g).forEach(w=>{w.forEach(k=>{k.user_id&&k.user_id!==e&&k.typing&&v.push({userId:k.user_id,username:k.username||"Kullanc"})})}),o(v)}).subscribe(async g=>{g==="SUBSCRIBED"&&c.current&&await f.track({user_id:e,username:n||"Kullanc",typing:!0})}),a.current=f,()=>{i.removeChannel(f),a.current=null,o([])}},[t,e,n,i]),{typingUsers:r,setTyping:u}}function Q4(t,e=J4){const[n,i]=S.useState(!1),r=S.useRef(null);return S.useEffect(()=>(t.length>0?(i(!0),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{i(!1),r.current=null},e)):(i(!1),r.current&&(clearTimeout(r.current),r.current=null)),()=>{r.current&&clearTimeout(r.current)}),[t,e]),n}function X4(t){const e=sr(),[n,i]=S.useState(new Set),r=S.useRef(null);return S.useEffect(()=>{if(!t){i(new Set);return}const a=e.channel("presence:online");return a.on("presence",{event:"sync"},()=>{const c=a.presenceState(),u=new Set;Object.values(c).forEach(h=>{h.forEach(f=>{f.user_id&&f.user_id!==t&&u.add(f.user_id)})}),i(u)}).subscribe(async c=>{c==="SUBSCRIBED"&&await a.track({user_id:t})}),r.current=a,()=>{e.removeChannel(a),r.current=null,i(new Set)}},[t,e]),n}function Z4(t){const e=sr(),[n,i]=S.useState([]),[r,o]=S.useState(!1),[a,c]=S.useState(null),u=S.useCallback(async()=>{if(!t){i([]);return}o(!0),c(null);try{const{data:h,error:f}=await e.from("server_members").select("user_id, role").eq("server_id",t);if(f)throw f;if(!h?.length){i([]),o(!1);return}const g=h.map(C=>C.user_id),{data:v,error:w}=await e.from("profiles").select("id, username, avatar_url").in("id",g);if(w)throw w;const k=new Map;(v||[]).forEach(C=>{k.set(C.id,{username:C.username,avatar_url:C.avatar_url})});const x=h.map(C=>{const E=k.get(C.user_id);return{id:C.user_id,username:E?.username??"Kullanc",avatar:E?.avatar_url??`https://api.dicebear.com/7.x/notionists/svg?seed=${C.user_id}`,role:C.role||"member"}});i(x)}catch(h){c(h instanceof Error?h:new Error(String(h))),i([])}finally{o(!1)}},[t,e]);return S.useEffect(()=>{u()},[u]),{members:n,loading:r,error:a,refetch:u}}const e5={id:"",username:"",discriminator:"",bio:"",avatar:"",status:"offline",bannerColor:"",badges:[]},w_=S.createContext(void 0);function t5({children:t}){const[e,n]=S.useState(e5),[i,r]=S.useState(null),[o,a]=S.useState([]),{user:c}=Tu(),{profile:u}=R0();return S.useEffect(()=>{if(u&&c){const h=u.discriminator?"#"+u.discriminator:"#"+u.id.substring(0,4);n({id:u.id,username:u.username||"User",discriminator:h,bio:u.bio||"",avatar:u.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${u.id}`,status:u.status||"online",bannerColor:"bg-gradient-to-r from-orange-500 via-red-500 to-pink-500",badges:[]})}},[u,c]),m.jsx(w_.Provider,{value:{user:e,setUser:n,activeDmUser:i,setActiveDmUser:r,friends:o,setFriends:a},children:t})}function k_(){const t=S.useContext(w_);if(!t)throw new Error("useUserContext must be used within UserProvider");return t}const x_=S.createContext(void 0);function n5({children:t}){const[e,n]=S.useState([]),{activeChannelId:i,channelType:r}=df(),{user:o}=k_(),a=r==="text"?i:null,{messages:c,sendMessage:u,updateMessage:h,loading:f}=F4(a);S.useEffect(()=>{const w=o?.username??"";if(Array.isArray(c)&&c.length>0){const k=c.map(x=>({...x,isMe:x.user===w}));n(k)}else(!a||!Array.isArray(c)||c.length===0)&&n([])},[c,o?.username,a]);const g=async(w,k)=>{await u(w,k)},v=async(w,k)=>{const x=o?.id;x&&await h(w,x,k)};return m.jsx(x_.Provider,{value:{messages:e,setMessages:n,sendMessage:g,editMessage:v,messagesLoading:f},children:t})}function i5(){const t=S.useContext(x_);if(!t)throw new Error("useMessageContext must be used within MessageProvider");return t}class r5{peerConnections=new Map;localStream=null;currentChannelId=null;userId=null;voiceStateSubscription=null;rtcConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]};async initialize(e){this.userId=e}async joinChannel(e,n){if(this.currentChannelId!==e){this.currentChannelId&&await this.leaveChannel(),this.currentChannelId=e;try{this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});const{error:i}=await Yi.from("voice_states").upsert({user_id:this.userId,channel_id:e,server_id:n,muted:!1,deafened:!1,video_enabled:!1,screen_share_enabled:!1},{onConflict:"user_id,channel_id"}).select().single();if(i){$v.error("Voice state error:",i);return}this.subscribeToVoiceStates(e),await this.setupPeerConnections(e)}catch(i){throw i}}}async leaveChannel(){this.currentChannelId&&(await Yi.from("voice_states").delete().eq("user_id",this.userId).eq("channel_id",this.currentChannelId),this.peerConnections.forEach(e=>{e.peerConnection.close(),e.stream&&e.stream.getTracks().forEach(n=>n.stop())}),this.peerConnections.clear(),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.voiceStateSubscription&&(this.voiceStateSubscription.unsubscribe(),this.voiceStateSubscription=null),this.currentChannelId=null)}async toggleMute(e){!this.currentChannelId||!this.localStream||(this.localStream.getAudioTracks().forEach(n=>{n.enabled=!e}),await Yi.from("voice_states").update({muted:e}).eq("user_id",this.userId).eq("channel_id",this.currentChannelId))}async toggleDeafen(e){this.currentChannelId&&(await Yi.from("voice_states").update({deafened:e}).eq("user_id",this.userId).eq("channel_id",this.currentChannelId),e&&await this.toggleMute(!0))}async toggleVideo(e){if(this.currentChannelId){if(e&&!this.localStream?.getVideoTracks().length)try{(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks().forEach(i=>{this.localStream?.addTrack(i)})}catch(n){console.error("Error enabling video:",n);return}else!e&&this.localStream&&this.localStream.getVideoTracks().forEach(n=>{n.stop(),this.localStream?.removeTrack(n)});await Yi.from("voice_states").update({video_enabled:e}).eq("user_id",this.userId).eq("channel_id",this.currentChannelId)}}async toggleScreenShare(e){if(this.currentChannelId){if(e)try{const n=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});n.getTracks().forEach(i=>{this.peerConnections.forEach(r=>{r.peerConnection.getSenders().forEach(o=>{i.kind==="video"&&o.replaceTrack(i)})})}),n.getVideoTracks()[0].onended=()=>{this.toggleScreenShare(!1)}}catch{}await Yi.from("voice_states").update({screen_share_enabled:e}).eq("user_id",this.userId).eq("channel_id",this.currentChannelId)}}subscribeToVoiceStates(e){this.voiceStateSubscription=Yi.channel(`voice:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"voice_states",filter:`channel_id=eq.${e}`},async n=>{n.eventType==="INSERT"&&n.new.user_id!==this.userId?await this.createPeerConnection(n.new.user_id):n.eventType==="DELETE"?this.removePeerConnection(n.old.user_id):n.eventType==="UPDATE"&&this.updatePeerConnection(n.new)}).subscribe()}async setupPeerConnections(e){const{data:n}=await Yi.from("voice_states").select("*").eq("channel_id",e).neq("user_id",this.userId);if(n)for(const i of n)await this.createPeerConnection(i.user_id)}async createPeerConnection(e){if(this.peerConnections.has(e))return;const n=new RTCPeerConnection(this.rtcConfig);this.localStream&&this.localStream.getTracks().forEach(r=>{n.addTrack(r,this.localStream)}),n.ontrack=r=>{const[o]=r.streams;this.onRemoteStream(e,o)},n.onicecandidate=r=>{r.candidate&&this.sendIceCandidate(e,r.candidate)},this.peerConnections.set(e,{peerConnection:n,userId:e});const i=await n.createOffer();await n.setLocalDescription(i),await this.sendOffer(e,i)}removePeerConnection(e){const n=this.peerConnections.get(e);n&&(n.peerConnection.close(),n.stream&&n.stream.getTracks().forEach(i=>i.stop()),this.peerConnections.delete(e))}updatePeerConnection(e){this.peerConnections.get(e.user_id)}onRemoteStream(e,n){const i=this.peerConnections.get(e);i&&(i.stream=n,this.onStreamCallback&&this.onStreamCallback(e,n))}onStreamCallback;setOnStreamCallback(e){this.onStreamCallback=e}async sendOffer(e,n){}async sendIceCandidate(e,n){}getLocalStream(){return this.localStream}getPeerConnections(){return this.peerConnections}async cleanup(){await this.leaveChannel(),this.userId=null}}const Yx=new r5,Gd="oxide_server_folders",s5=[],o5=({message:t,type:e,onClose:n})=>m.jsxs("div",{className:"flex items-center gap-3 bg-[#18181b] border border-white/10 text-white px-4 py-3 rounded-xl shadow-2xl animate-in slide-in-from-bottom-5 fade-in duration-300 max-w-sm z-[200]",children:[e==="success"?m.jsx(Qm,{className:"text-green-400",size:20}):m.jsx(Bh,{className:"text-red-400",size:20}),m.jsx("span",{className:"text-sm font-medium",children:t}),m.jsx("button",{onClick:n,className:"ml-auto text-zinc-500 hover:text-white",children:m.jsx(Go,{size:16})})]}),a5=({type:t})=>{const e={developer:m.jsx(Zx,{size:14,className:"text-blue-400"}),"early-supporter":m.jsx(lv,{size:14,className:"text-yellow-400"}),booster:m.jsx(l5,{size:14,className:"text-pink-400"})};return m.jsx("div",{className:"group relative bg-white/5 p-1.5 rounded-lg border border-white/5 hover:bg-white/10 transition-colors cursor-help",children:e[t]||m.jsx(EE,{size:14,className:"text-zinc-400"})})},l5=({className:t,size:e})=>m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[m.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),m.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),m.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),m.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]}),Lo=({isOpen:t,onClose:e,title:n,children:i})=>t?m.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/85 p-4",children:[m.jsx("div",{className:"absolute inset-0",onClick:e}),m.jsxs(Ko,{className:"w-full max-w-md rounded-3xl p-6 relative overflow-hidden border border-white/10 bg-[#121217] max-h-[90vh] overflow-y-auto",children:[m.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors bg-white/5 p-1 rounded-full z-10",children:m.jsx(Go,{size:20})}),n&&m.jsxs(m.Fragment,{children:[m.jsx("h2",{className:"text-2xl font-bold mb-1 text-white",children:n}),m.jsx("div",{className:"w-full h-px bg-gradient-to-r from-orange-500/50 to-transparent mb-6"})]}),i]})]}):null,Fs=t=>{if(!t)return"Bilinmeyen hata";if(typeof t=="string")return t;if(t instanceof Error&&t.message)return t.message;try{return JSON.stringify(t)}catch{return"Bilinmeyen hata"}};function c5(){const{activeServerId:t,setActiveServerId:e,activeChannelId:n,setActiveChannelId:i,servers:r,setServers:o,channels:a,setChannels:c,channelType:u,setChannelType:h,connectedVoiceChannelId:f,setConnectedVoiceChannelId:g,dbServers:v,dbServersLoading:w,dbChannels:k,refetchChannels:x,refetchServers:C,setLastTextChannelIdForServer:E}=df(),{voiceState:I,setVoiceState:N,voiceChannelUsers:P,setVoiceChannelUsers:R,livekitSpeakingIds:j,setLivekitSpeakingIds:U,livekitVideoTracks:F,setLivekitVideoTracks:H,livekitFocusedKey:q,setLivekitFocusedKey:Q,livekitPinnedKey:ne,setLivekitPinnedKey:Se,livekitFullscreen:De,setLivekitFullscreen:Ke}=v_(),{toasts:de,addToast:V,removeToast:Z,inputVal:he,setInputVal:oe,showMembers:L,setShowMembers:G,isMobileMenuOpen:ke,setMobileMenuOpen:Te,showNotifications:Ne,setShowNotifications:Ce,showAddFriend:qe,setShowAddFriend:se,searchQuery:_e,setSearchQuery:Pe,isLoading:zt,setIsLoading:mt,isAuthChecking:Et,setIsAuthChecking:wt,view:kn,setView:hi,modals:$t,setModals:et,newChannelName:Hn,setNewChannelName:Zt,newChannelType:en,setNewChannelType:be,newChannelCategory:jt,setNewChannelCategory:Gn,newCategoryName:xn,setNewCategoryName:Sn,newServerName:dn,setNewServerName:Jn,newServerIconFile:fi,setNewServerIconFile:Fi,newServerIconPreview:kt,setNewServerIconPreview:so,joinCode:Cr,setJoinCode:rs,inviteCode:or,setInviteCode:_r,inviteLoading:ss,setInviteLoading:Er,newFriendName:Ci,setNewFriendName:Pr}=N0(),{user:Ge,setUser:lt,friends:tn,setFriends:Ht,activeDmUser:xt,setActiveDmUser:nn}=k_(),{messages:rn,setMessages:St,sendMessage:_i,editMessage:dt,messagesLoading:Yn}=i5(),[Gt]=S.useState(s5),[pi,Qn]=S.useState(!1),[hn,In]=S.useState(()=>{try{const _=localStorage.getItem(Gd);if(!_)return[];const J=JSON.parse(_);return Array.isArray(J.folders)?J.folders:[]}catch{return[]}}),[Fn,Rr]=S.useState(()=>{try{const _=localStorage.getItem(Gd);if(!_)return{};const J=JSON.parse(_);return J.serverToFolder&&typeof J.serverToFolder=="object"?J.serverToFolder:{}}catch{return{}}}),[El,Cu]=S.useState(()=>{try{const _=localStorage.getItem(Gd);if(!_)return new Set;const J=JSON.parse(_);return new Set(Array.isArray(J.collapsedIds)?J.collapsedIds:[])}catch{return new Set}}),[Xn,os]=S.useState(null),[Pl,hf]=S.useState({x:0,y:0}),[Rl,Nl]=S.useState(""),[ta,Il]=S.useState(null),[na,ia]=S.useState(null),[Pt,ra]=S.useState(null),[Ol,as]=S.useState(!1),[sa,ls]=S.useState(null);S.useEffect(()=>{try{localStorage.setItem(Gd,JSON.stringify({folders:hn,serverToFolder:Fn,collapsedIds:Array.from(El)}))}catch{}},[hn,Fn,El]);const[Nr,oo]=S.useState(null),[Bn,_u]=S.useState(null),Be=sr(),{session:ff,user:Qe,loading:Eu}=Tu(),{profile:cs,loading:oa,updateProfile:us,refetch:aa}=R0(),pf=_=>!_?.username||/^User-[a-f0-9]{4}$/i.test(_.username||""),{fetchVoiceChannelUsers:mf}=H4();G4();const Al=t==="dm"&&xt?.threadId?`dm:${xt.threadId}`:u==="text"&&n?n:null,jl=Q4(he),{typingUsers:Dl,setTyping:ds}=Y4(Al,Qe?.id,Ge.username);S.useEffect(()=>{ds(jl)},[jl,ds]);const Ml=X4(Qe?.id),Ll=t&&t!=="dm"?t:null,{members:nt}=Z4(Ll);S.useEffect(()=>{if(!Eu){wt(!1);return}const _=window.setTimeout(()=>{wt(!1)},t3);return()=>window.clearTimeout(_)},[Eu]),S.useEffect(()=>{Qe?.id?Yx.initialize(Qe.id):Yx.cleanup()},[Qe?.id]),S.useEffect(()=>{if(w)return;const _={id:"dm",name:"Mesajlar",icon:null,type:"dm"};o(J=>{const Y=(v||[]).map(Oe=>({id:Oe.id,name:Oe.name,icon:Oe.icon_url||`https://api.dicebear.com/7.x/icons/svg?seed=${Oe.name}`,color:"from-gray-700 to-gray-900",type:"server",ownerId:Oe.owner_id??void 0})),ce=new Set(Y.map(Oe=>Oe.id)),me=J.filter(Oe=>Oe.id!=="dm"&&!ce.has(Oe.id));return[_,...me,...Y]})},[v,w]),S.useEffect(()=>{t&&k&&k.length>0&&c(_=>({..._,[t]:k.map(J=>({id:J.id,name:J.name,type:J.type,category:J.category||"GENEL"}))}))},[t,k]),S.useEffect(()=>{if(u!=="voice")return;const _=Ct.getRoom();if(!_)return;const J=()=>{const Y=_.localParticipant.getTrackPublication(W.Source.Microphone),ce=_.localParticipant.getTrackPublication(W.Source.Camera),me=_.localParticipant.getTrackPublication(W.Source.ScreenShare);N(Oe=>({...Oe,mic:!(Y&&Y.isMuted),video:!!ce?.track,screenShare:!!me?.track}))};return J(),_.on("localTrackPublished",J),_.on("localTrackUnpublished",J),()=>{_.off("localTrackPublished",J),_.off("localTrackUnpublished",J)}},[u]),S.useEffect(()=>{if(u!=="voice"){U(new Set),H(new Map),Q(null),Se(null),Ke(!1);return}const _=Ct.getRoom();if(!_)return;let J=!0;const Y=(Fe,We)=>`${Fe}:${We}`,ce=[],me=()=>{if(!J)return;const Fe=_.localParticipant.getTrackPublication(W.Source.Camera),We=_.localParticipant.getTrackPublication(W.Source.ScreenShare),ct=Fe?.track,fn=We?.track;H(Dt=>{const Jt=new Map(Dt);return ct&&ct.kind==="video"?Jt.set(Y(_.localParticipant.identity,W.Source.Camera),{track:ct,source:W.Source.Camera,muted:!!Fe?.isMuted}):Jt.delete(Y(_.localParticipant.identity,W.Source.Camera)),fn&&fn.kind==="video"?Jt.set(Y(_.localParticipant.identity,W.Source.ScreenShare),{track:fn,source:W.Source.ScreenShare,muted:!!We?.isMuted}):Jt.delete(Y(_.localParticipant.identity,W.Source.ScreenShare)),Jt})},Oe=(Fe,We,ct)=>{if(!J||Fe.kind!=="video")return;const fn=We?.source||W.Source.Camera;H(Dt=>{const Jt=new Map(Dt);return Jt.set(Y(ct.identity,fn),{track:Fe,source:fn,muted:!!We?.isMuted}),Jt})},Ve=(Fe,We,ct)=>{if(!J||Fe.kind!=="video")return;const fn=We?.source||W.Source.Camera;H(Dt=>{const Jt=new Map(Dt);return Jt.delete(Y(ct.identity,fn)),Jt})},pe=(Fe,We)=>{if(!J)return;const ct=Fe?.source||W.Source.Camera;H(fn=>{const Dt=new Map(fn),Jt=Y(We.identity,ct),ws=Dt.get(Jt);return ws&&Dt.set(Jt,{...ws,muted:!0}),Dt})},Ie=(Fe,We)=>{if(!J)return;const ct=Fe?.source||W.Source.Camera;H(fn=>{const Dt=new Map(fn),Jt=Y(We.identity,ct),ws=Dt.get(Jt);return ws&&Dt.set(Jt,{...ws,muted:!1}),Dt})};return[{event:"trackSubscribed",handler:Oe},{event:"trackUnsubscribed",handler:Ve},{event:"participantDisconnected",handler:Fe=>{J&&(H(We=>{const ct=new Map(We);return ct.forEach((fn,Dt)=>{Dt.startsWith(`${Fe.identity}:`)&&ct.delete(Dt)}),ct}),U(We=>{const ct=new Set(We);return ct.delete(Fe.identity),ct}))}},{event:"activeSpeakersChanged",handler:Fe=>{J&&U(new Set(Fe.map(We=>We.identity)))}},{event:ie.TrackMuted,handler:pe},{event:ie.TrackUnmuted,handler:Ie},{event:"localTrackPublished",handler:me},{event:"localTrackUnpublished",handler:me}].forEach(({event:Fe,handler:We})=>{_.on(Fe,We),ce.push({event:Fe,handler:We})}),me(),_.remoteParticipants.forEach(Fe=>{Fe.videoTrackPublications.forEach(We=>{if(We.track&&We.track.kind==="video"&&J){const ct=We?.source||W.Source.Camera;H(fn=>{const Dt=new Map(fn);return Dt.set(Y(Fe.identity,ct),{track:We.track,source:ct,muted:!!We?.isMuted}),Dt})}})}),()=>{J=!1,ce.forEach(({event:Fe,handler:We})=>{_.off(Fe,We)})}},[u]),S.useEffect(()=>{q||Ke(!1)},[q]);const[hs,Ul]=S.useState("Hesabm"),[la,ao]=S.useState(0),[Ir,ca]=S.useState(!1),[ar,ua]=S.useState(""),[mi,lr]=S.useState(""),[Zn,lo]=S.useState(""),[fs,cr]=S.useState([]),[gf,Pu]=S.useState([]),[Or,vf]=S.useState(100),[Fl,da]=S.useState(100),[Bl,yf]=S.useState(50),[ps,co]=S.useState(!0),[Ar,ha]=S.useState(!0),[Ru,bf]=S.useState(!0),[Vl,fa]=S.useState("720p"),[uo,zl]=S.useState(!1),[ei,pa]=S.useState(null),[jr,Nu]=S.useState("overview"),[ma,ms]=S.useState(!1),[ga,On]=S.useState(Ge.bio),[gs,ho]=S.useState(!1),[vs,$l]=S.useState(Ge.username),[Bi,ur]=S.useState(!1),[Dr,fo]=S.useState(null),[va,Iu]=S.useState(!1),[ql,Ou]=S.useState(!1),ya=S.useRef(null),Au=S.useRef(null),po=S.useRef(null),wf=$O(Ww(Vv,{activationConstraint:{distance:8}}),Ww(Fv,{coordinateGetter:pj}));S.useEffect(()=>{ya.current?.scrollIntoView({behavior:"smooth"})},[rn,n,xt]),S.useEffect(()=>{let _;return Ir?_=setInterval(()=>ao(Math.random()*100),100):ao(0),()=>clearInterval(_)},[Ir]),S.useLayoutEffect(()=>{if(Bi&&po.current){const _=po.current.getBoundingClientRect();fo({top:_.bottom+8,left:_.left})}else fo(null)},[Bi]),S.useEffect(()=>{if(!Bi)return;const _=J=>{const Y=document.getElementById("profile-status-menu");po.current&&!po.current.contains(J.target)&&Y&&!Y.contains(J.target)&&ur(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[Bi]),S.useEffect(()=>{if(!($t.settings||u==="voice"))return;const J=async()=>{try{const[ce,me,Oe]=await Promise.all([Ct.getAudioInputDevices(),Ct.getAudioOutputDevices(),Ct.getVideoInputDevices()]);cr([...ce.map(Ve=>({...Ve,kind:"audioinput"})),...me.map(Ve=>({...Ve,kind:"audiooutput"}))]),Pu(Oe.map(Ve=>({...Ve,kind:"videoinput"})))}catch(ce){logger.error("Aygt listesi yklenemedi:",ce)}};J();const Y=()=>J();return navigator.mediaDevices.addEventListener("devicechange",Y),()=>navigator.mediaDevices.removeEventListener("devicechange",Y)},[$t.settings,u]),S.useEffect(()=>{ar&&Ct.setAudioInputDevice(ar).catch(_=>logger.error(_))},[ar]),S.useEffect(()=>{Zn&&Ct.setVideoInputDevice(Zn).catch(_=>logger.error(_))},[Zn]),S.useEffect(()=>{mi&&Ct.setAudioOutputDevice(mi).catch(_=>logger.error(_))},[mi]),S.useEffect(()=>()=>{kt&&URL.revokeObjectURL(kt)},[kt]),S.useEffect(()=>{_r("")},[t]);const mo=S.useCallback(async()=>{if(!Qe?.id){Ht([]);return}try{const{data:_,error:J}=await Be.from("dm_participants").select("thread_id").eq("user_id",Qe.id);if(J)throw J;const Y=(_||[]).map(Ie=>Ie.thread_id);if(Y.length===0){Ht([]);return}const{data:ce,error:me}=await Be.from("dm_participants").select("thread_id, profiles:user_id(id, username, avatar_url, status)").in("thread_id",Y).neq("user_id",Qe.id);if(me)throw me;const{data:Oe}=await Be.from("dm_messages").select("thread_id, content, created_at").in("thread_id",Y).order("created_at",{ascending:!1}),Ve=new Map;(Oe||[]).forEach(Ie=>{Ve.has(Ie.thread_id)||Ve.set(Ie.thread_id,Ie.content)});const pe=(ce||[]).map(Ie=>{const Rt=Ie.profiles,ti=Rt?.id||"unknown";return{id:ti,name:Rt?.username||"Kullanc",status:Rt?.status||"offline",avatar:Rt?.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${ti}`,lastMsg:Ve.get(Ie.thread_id),threadId:Ie.thread_id}});Ht(pe)}catch(_){logger.error("DM listesi yklenemedi:",_),V("DM listesi yklenemedi.","error")}},[Qe?.id,Be,V]),go=S.useCallback(async _=>{if(_){Qn(!0);try{const{data:J,error:Y}=await Be.from("dm_messages").select("*, profiles:user_id(username, avatar_url)").eq("thread_id",_).order("created_at",{ascending:!0});if(Y){V("DM mesajlar yklenemedi.","error");return}const ce=(J||[]).map(me=>({id:me.id,user:me.profiles?.username||"Kullanc",content:me.content,time:new Date(me.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),isMe:me.user_id===Qe?.id,avatar:me.profiles?.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${me.user_id}`}));St(ce)}finally{Qn(!1)}}},[Qe?.id,Be,V]);S.useEffect(()=>{mo()},[mo]),S.useEffect(()=>{const _=xt?.threadId;if(!_)return;go(_);const J=Be.channel(`dm_messages:${_}`).on("postgres_changes",{event:"*",schema:"public",table:"dm_messages",filter:`thread_id=eq.${_}`},()=>{go(_),mo()}).subscribe();return()=>{Be.removeChannel(J)}},[xt?.threadId,Be,go,mo]);const Kl=S.useCallback(_=>{nn(_),se(!1),_.threadId?go(_.threadId):St([]),Te(!1)},[go]),vo=S.useMemo(()=>r.find(_=>_.id===t)||r[0],[r,t]),ba=S.useMemo(()=>t&&a[t]||[],[a,t]),ju=S.useMemo(()=>ba.filter(_=>_.name.toLowerCase().includes(_e.toLowerCase())),[ba,_e]),kf=S.useMemo(()=>tn.filter(_=>_.name.toLowerCase().includes(_e.toLowerCase())),[tn,_e]),wa=S.useMemo(()=>ju.reduce((_,J)=>(_[J.category]||(_[J.category]=[]),_[J.category].push(J),_),{}),[ju]),xf=S.useCallback(_=>{if(_.size>Cx){V(`Dosya en fazla ${Cx/1024/1024} MB olabilir.`,"error");return}const J=_.type.toLowerCase();if(!G1.includes(J)){V("Bu dosya tr desteklenmiyor. Resim, PDF veya metin kullann.","error");return}oo(_),_u(URL.createObjectURL(_))},[V]),Wl=S.useCallback(()=>{Bn&&URL.revokeObjectURL(Bn),oo(null),_u(null)},[Bn]),yo=_=>{_!==t&&(mt(!0),Te(!1),Pe(""),se(!1),(async()=>(e(_),_==="dm"?(i(null),nn(null),St([]),mt(!1)):(nn(null),St([]),await x(),k&&k.length>0?(i(k[0].id),h(k[0].type)):i(null),mt(!1))))())},Du=S.useCallback(async _=>{_?.preventDefault();const J=he.trim();if(!J&&!Nr||!Qe?.id)return;if(J.length>$c){V(`Mesaj en fazla ${$c} karakter olabilir.`,"error");return}let Y=J;if(Nr){try{const ce=t==="dm"&&xt?.threadId?xt.threadId:u==="text"&&n?n:n||"",me=await M4(Nr,Qe.id,ce),Oe=H1.includes(Nr.type);Y=Y?`${Y}
${Oe?`[IMG:${me}]`:`[FILE:${me}]`}`:Oe?`[IMG:${me}]`:`[FILE:${me}]`}catch(ce){V(ce instanceof Error?ce.message:"Dosya yklenemedi","error");return}Wl()}if(t==="dm"){const ce=xt?.threadId;if(!ce){V("Bir DM semelisiniz.","info"),oe("");return}try{const{error:me}=await Be.from("dm_messages").insert({thread_id:ce,user_id:Qe.id,content:Y});if(me)throw me;V("Mesaj gnderildi","success")}catch(me){V(me instanceof Error?me.message:"DM mesaj gnderilemedi","error")}}else if(t&&t!=="dm"&&u==="text"&&n)try{Qe?.id&&await _i(Y,Qe.id)}catch(ce){V(Fs(ce)||"Mesaj gnderilemedi","error")}oe("")},[he,Nr,Qe?.id,t,xt?.threadId,u,n,V,oe,_i,Be,Wl]),Sf=S.useCallback(async(_,J)=>{const Y=J.trim();if(!(!Y||Y.length>$c)){if(t==="dm")try{const{error:ce}=await Be.from("dm_messages").update({content:Y}).eq("id",_).eq("user_id",Qe?.id);if(ce)throw ce;St(me=>me.map(Oe=>Oe.id===_?{...Oe,content:Y}:Oe)),V("Mesaj gncellendi","success")}catch(ce){V("Mesaj gncellenemedi: "+Fs(ce),"error")}else if(u==="text"&&n)try{await dt(String(_),Y),V("Mesaj gncellendi","success")}catch(ce){V("Mesaj gncellenemedi: "+Fs(ce),"error")}}},[t,u,n,Qe?.id,Be,V,St,dt]),Tf=S.useCallback(async _=>{const J=String(_);if(t==="dm")try{const{error:Y}=await Be.from("dm_messages").delete().eq("id",J);if(Y)throw Y;St(ce=>ce.filter(me=>me.id!==_)),V("Mesaj silindi","success")}catch(Y){V("Mesaj silinemedi: "+Fs(Y),"error")}else if(u==="text"&&n)try{const{error:Y}=await Be.from("messages").delete().eq("id",J);if(Y)throw Y;St(ce=>ce.filter(me=>me.id!==_)),V("Mesaj silindi","success")}catch(Y){V("Mesaj silinemedi: "+Fs(Y),"error")}},[t,u,n,Be,V,St]),Cf=async()=>{if(ql)return;const _=Hn.trim();if(_){if(_.length<Sx||_.length>Tx){V(`Kanal ad ${Sx}-${Tx} karakter olmal.`,"error");return}if(!t||t==="dm"){V("Kanal oluturmak iin bir sunucu semelisiniz.","error");return}if(t.length<36){V("Geersiz sunucu seimi.","error");return}Ou(!0);try{const{data:J}=await Be.from("channels").select("position").eq("server_id",t).order("position",{ascending:!1}).limit(1).maybeSingle(),Y=(J?.position??-1)+1,{data:ce,error:me}=await Be.from("channels").insert({server_id:t,name:_.toLowerCase().replace(/\s+/g,"-"),type:en,category:jt.toUpperCase()||"GENEL",position:Y}).select().single();if(me){V("Kanal oluturulamad: "+me.message,"error");return}ce&&(await x(),et(Oe=>({...Oe,addChannel:!1})),Zt(""),V(`${ce.name} kanal oluturuldu.`),i(ce.id),h(ce.type))}finally{Ou(!1)}}},_f=S.useCallback(async _=>{if(!(!_||!t))try{const{error:J}=await Be.from("channels").delete().eq("id",_);if(J)throw J;if(_===n){const{data:Y}=await Be.from("channels").select("id, type").eq("server_id",t).order("position",{ascending:!0}).order("created_at",{ascending:!0}),ce=(Y||[]).find(me=>me.type==="text");i(ce?.id??null),h("text")}await x(),V("Kanal silindi.","success")}catch(J){V("Kanal silinemedi: "+Fs(J),"error")}},[n,t,Be,V,x,i,h]),Ef=()=>{xn.trim()&&(Gn(xn.toUpperCase()),et(_=>({..._,createCategory:!1,addChannel:!0})),Sn(""),V(`Kategori seildi: ${xn}. imdi bir kanal ekle.`))},Pf=_=>{const J=_.target.files?.[0];if(J){if(!J.type.startsWith("image/")){V("Sadece resim dosyas ykleyebilirsiniz.","error");return}if(J.size>2*1024*1024){V("Resim boyutu en fazla 2MB olmal.","error");return}kt&&URL.revokeObjectURL(kt),Fi(J),so(URL.createObjectURL(J))}},Rf=async()=>{if(!fi||!Qe?.id)return null;const _=fi.name.split(".").pop()||"png",J=`${Qe.id}/${Date.now()}.${_}`,{error:Y}=await Be.storage.from("server-icons").upload(J,fi,{cacheControl:"3600",upsert:!0});if(Y)return logger.error("Server icon upload error:",Y),V("Sunucu resmi yklenemedi: "+(Y.message||"Bilinmeyen hata"),"error"),null;const{data:ce}=Be.storage.from("server-icons").getPublicUrl(J);return ce?.publicUrl||null},Hl=()=>Math.random().toString(36).slice(2,8),bo=async()=>{if(!t||t==="dm"){V("Davet oluturmak iin bir sunucu semelisiniz.","error");return}if(!Qe?.id){V("Giri yapmanz gerekiyor.","error");return}Er(!0);try{let _=null;for(let J=0;J<3&&!_;J+=1){const Y=Hl(),{data:ce,error:me}=await Be.from("server_invites").insert({server_id:t,code:Y,created_by:Qe.id}).select().single();if(!me)_=ce;else if(!me.message?.includes("duplicate"))throw me}if(!_)throw new Error("Davet kodu oluturulamad.");_r(_.code),V("Davet kodu oluturuldu.","success")}catch(_){V("Davet oluturulamad: "+(_.message||"Bilinmeyen hata"),"error")}finally{Er(!1)}},Nf=async()=>{if(or)try{await navigator.clipboard.writeText(or),V("Davet kodu kopyaland.","success")}catch(_){logger.error("Invite copy error:",_),V("Kopyalama baarsz.","error")}},Gl=()=>{const _=Rl.trim()||"Yeni Klasr",J=crypto.randomUUID();In(Y=>[...Y,{id:J,name:_}]),Nl(""),Xn&&Rr(Y=>({...Y,[Xn]:J})),os(null)},Jl=(_,J)=>{Rr(Y=>({...Y,[_]:J})),os(null)},Yl=_=>{Rr(J=>{const Y={...J};return delete Y[_],Y}),os(null)},Mu=_=>{Cu(J=>{const Y=new Set(J);return Y.has(_)?Y.delete(_):Y.add(_),Y})},Ql=(_,J)=>{In(Y=>{const ce=Y.findIndex(pe=>pe.id===_),me=Y.findIndex(pe=>pe.id===J);if(ce===-1||me===-1||ce===me)return Y;const Oe=Y.filter((pe,Ie)=>Ie!==ce),Ve=me>ce?me-1:me;return Oe.splice(Ve,0,Y[ce]),Oe})},ys=async()=>{if(va)return;const _=dn.trim();if(_){if(_.length<kx||_.length>xx){V(`Sunucu ad ${kx}-${xx} karakter olmal.`,"error");return}if(!Qe?.id){V("Giri yapmanz gerekiyor.","error");return}if(!cs){V("Profil ykleniyor, ltfen bekleyin...","info");return}Iu(!0);try{let J=`https://api.dicebear.com/7.x/icons/svg?seed=${_}`;if(fi){const Ve=await Rf();Ve&&(J=Ve)}const{data:Y,error:ce}=await Be.from("servers").insert({name:_,icon_url:J,owner_id:Qe.id}).select().single();if(ce){V("Sunucu oluturulamad: "+ce.message,"error");return}if(!Y)return;const{error:me}=await Be.from("server_members").insert({server_id:Y.id,user_id:Qe.id,role:"owner"});me&&(me.code==="23505"||V("yelik kayd oluturulamad: "+(me.message||"Bilinmeyen hata"),"error"));const Oe=[{server_id:Y.id,name:"genel",type:"text",category:"GENEL",position:0},{server_id:Y.id,name:"sohbet",type:"voice",category:"SES",position:1}];await Be.from("channels").insert(Oe).select(),o(Ve=>Ve.some(pe=>pe.id===Y.id)?Ve:[...Ve,{id:Y.id,name:Y.name,icon:Y.icon_url||J,color:"from-gray-700 to-gray-900",type:"server",ownerId:Y.owner_id||Qe.id}]),await C(),et(Ve=>({...Ve,createServer:!1})),Jn(""),Fi(null),kt&&(URL.revokeObjectURL(kt),so(null)),V(`${_} sunucusu hazr!`),yo(Y.id)}finally{Iu(!1)}}},If=async()=>{if(Cr.trim()){if(!Qe?.id){V("Giri yapmanz gerekiyor.","error");return}try{const{data:_,error:J}=await Be.from("server_invites").select("server_id").eq("code",Cr.trim()).single();if(J||!_){V("Geersiz veya sresi dolmu davet kodu.","error");return}const{error:Y}=await Be.from("server_members").insert({server_id:_.server_id,user_id:Qe.id});if(Y){if(Y.code==="23505"){V("Zaten bu sunucunun yesisin!","info"),et(ce=>({...ce,joinServer:!1})),rs(""),await C(),yo(_.server_id);return}throw Y}await C(),et(ce=>({...ce,joinServer:!1})),rs(""),V("Sunucuya katldn!","success"),yo(_.server_id)}catch(_){V("Katlma baarsz: "+(_ instanceof Error?_.message:"Bilinmeyen hata"),"error")}}},Lu=async()=>{if(Ci.trim()){if(!Qe?.id){V("Giri yapmanz gerekiyor.","error");return}try{const{data:_,error:J}=await Be.from("profiles").select("id, username, avatar_url, status").ilike("username",Ci.trim()).limit(1).single();if(J||!_){V("Kullanc bulunamad.","error");return}if(_.id===Qe.id){V("Kendinle DM balatamazsn.","info");return}const{data:Y,error:ce}=await Be.from("dm_participants").select("thread_id").eq("user_id",Qe.id);if(ce)throw ce;const me=(Y||[]).map(Ve=>Ve.thread_id);let Oe=null;if(me.length>0){const{data:Ve}=await Be.from("dm_participants").select("thread_id").eq("user_id",_.id).in("thread_id",me).limit(1).single();Ve?.thread_id&&(Oe=Ve.thread_id)}if(!Oe){const{data:Ve,error:pe}=await Be.from("dm_threads").insert({}).select().single();if(pe||!Ve)throw pe;const{error:Ie}=await Be.from("dm_participants").insert([{thread_id:Ve.id,user_id:Qe.id},{thread_id:Ve.id,user_id:_.id}]);if(Ie)throw Ie;Oe=Ve.id}await mo(),Pr(""),se(!1),V(`${_.username||Ci} eklendi!`,"success"),Oe&&Kl({id:_.id,name:_.username||Ci,status:_.status||"offline",avatar:_.avatar_url||`https://api.dicebear.com/7.x/notionists/svg?seed=${_.id}`,threadId:Oe})}catch(_){V("DM oluturulamad: "+(_.message||"Bilinmeyen hata"),"error")}}},Of=async()=>{try{await us({bio:ga}),lt(_=>({..._,bio:ga})),ms(!1),V("Biyografi gncellendi.","success")}catch(_){V(Fs(_),"error")}},Uu=async()=>{const _=vs.trim();if(_.length<2||_.length>32||!/^[a-zA-Z0-9_]+$/.test(_)){V("Kullanc ad 2-32 karakter, sadece harf, rakam ve _ olmal.","error");return}try{await us({username:_}),lt(J=>({...J,username:_})),ho(!1),V("Kullanc ad gncellendi.")}catch(J){V(Fs(J),"error")}},Fu=_=>{lt(J=>({...J,status:_})),ur(!1),V(`Durum ayarland: ${_}`)},wo=S.useCallback(async _=>{const{active:J,over:Y}=_;if(!t||t==="dm"||!Y||J.id===Y.id)return;const ce=a[t]||[],me=ce.findIndex(Ie=>Ie.id===J.id),Oe=ce.findIndex(Ie=>Ie.id===Y.id);if(me===-1||Oe===-1)return;const Ve=zv(ce,me,Oe),pe=ce.find(Ie=>Ie.id===Y.id);pe&&ce[me]?.category!==pe.category&&(Ve[Oe]={...Ve[Oe],category:pe.category}),c(Ie=>({...Ie,[t]:Ve}));try{for(let Ie=0;Ie<Ve.length;Ie++){const{error:Rt}=await Be.from("channels").update({position:Ie}).eq("id",Ve[Ie].id);if(Rt)throw Rt}await x()}catch{V("Kanal sras kaydedilemedi.","error"),await x()}},[t,a,c,Be,x,V]),ko=Gt.filter(_=>!_.read).length;let Mr;return Et?Mr=m.jsx("div",{className:"h-screen w-full bg-[#09090b] flex items-center justify-center text-white",children:m.jsx(qs,{className:"animate-spin text-orange-500",size:40})}):ff?oa||!cs?Mr=m.jsx("div",{className:"h-screen w-full bg-[#09090b] flex items-center justify-center text-white",children:m.jsx(qs,{className:"animate-spin text-orange-500",size:40})}):pf(cs)?Mr=m.jsx($4,{onDone:aa}):kn==="setup"?Mr=m.jsxs("div",{className:"h-screen w-full bg-[#0a0a0f] text-white flex items-center justify-center overflow-hidden relative",children:[m.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop')] bg-cover opacity-20 animate-pulse"}),m.jsxs(Ko,{className:"z-10 p-10 rounded-[3rem] max-w-lg w-full text-center border-white/10 animate-in zoom-in duration-500",children:[m.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-orange-500 to-red-600 rounded-3xl mx-auto flex items-center justify-center mb-8 shadow-2xl rotate-3 border border-orange-400/30",children:m.jsx(tm,{size:48,className:"text-white"})}),m.jsxs("h1",{className:"text-5xl font-black mb-4 tracking-tighter",children:["Oxide",m.jsx("span",{className:"text-orange-500",children:"Space"})]}),m.jsx("p",{className:"text-zinc-400 mb-8 text-lg",children:"Dijital iletiimde yeni bir element."}),m.jsx(vn,{primary:!0,className:"w-full py-4 text-lg",onClick:()=>hi("app"),children:"Yrngeye Gir"})]})]}):Mr=m.jsxs("div",{className:"h-screen w-full bg-[#09090b] text-white flex flex-col font-sans overflow-hidden relative selection:bg-orange-500/30",onClick:()=>{Ce(!1)},children:[m.jsx("div",{className:"absolute bottom-6 right-6 z-[150] flex flex-col gap-2 pointer-events-none",children:de.map(_=>m.jsx("div",{className:"pointer-events-auto",children:m.jsx(o5,{message:_.msg,type:_.type,onClose:()=>Z(_.id)})},_.id))}),m.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[m.jsx("div",{className:"absolute top-0 left-1/4 w-[40vw] h-[40vw] bg-orange-900/10 rounded-full blur-[120px]"}),m.jsx("div",{className:"absolute bottom-0 right-0 w-[30vw] h-[30vw] bg-red-900/10 rounded-full blur-[120px]"})]}),m.jsxs("div",{className:"h-20 flex-shrink-0 z-50 px-4 md:px-6 flex items-center justify-between bg-gradient-to-r from-[#0c0c0f] via-[#121218] to-[#0c0c0f] border-b border-white/10 shadow-[0_4px_24px_-4px_rgba(249,115,22,0.12)]",children:[m.jsxs("div",{className:"flex items-center gap-4 md:gap-5 flex-1 min-w-0",children:[m.jsx("button",{className:"md:hidden p-2.5 rounded-xl text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>Te(!ke),children:m.jsx(qE,{size:22})}),m.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group flex-shrink-0 rounded-2xl px-3 py-2 transition-all duration-300 hover:bg-white/5",onClick:()=>yo("dm"),children:[m.jsx("div",{className:`w-11 h-11 rounded-xl flex items-center justify-center transition-all duration-300 ${t==="dm"?"bg-gradient-to-br from-orange-500 to-red-600 text-white shadow-lg shadow-orange-500/40 ring-2 ring-orange-400/50":"bg-white/5 text-zinc-400 group-hover:bg-white/10 group-hover:text-white"}`,children:m.jsx(tm,{size:22})}),m.jsxs("span",{className:"font-bold text-lg tracking-tight hidden md:block bg-gradient-to-r from-zinc-100 to-zinc-300 bg-clip-text text-transparent",children:["Oxide",m.jsx("span",{className:"text-orange-400",children:"Space"})]})]}),m.jsx("div",{className:"h-9 w-px bg-gradient-to-b from-transparent via-white/15 to-transparent hidden md:block flex-shrink-0"}),m.jsx("div",{className:"hidden md:flex items-center gap-2 overflow-x-auto no-scrollbar py-2 flex-1 min-w-0 max-w-[55vw]",children:(()=>{const _=r.filter(pe=>pe.type!=="dm"),J=_.filter(pe=>!Fn[pe.id]),Y=(pe,Ie)=>{Il(Ie),pe.dataTransfer.setData("text/plain",Ie),pe.dataTransfer.effectAllowed="move",pe.dataTransfer.setDragImage(pe.target,0,0)},ce=()=>{Il(null),ia(null),ra(null),as(!1),ls(null)},me=pe=>{pe.preventDefault();const Ie=pe.dataTransfer.getData("application/x-folder-id");if(Ie&&hn.length>0)Ql(Ie,hn[0].id),ia(null);else{const Rt=pe.dataTransfer.getData("text/plain");Rt&&Yl(Rt)}as(!1),ls(null)},Oe=(pe,Ie)=>{pe.preventDefault();const Rt=pe.dataTransfer.getData("application/x-folder-id");if(Rt&&Rt!==Ie)Ql(Rt,Ie),ia(null),ls(null);else{const ti=pe.dataTransfer.getData("text/plain");ti&&(Jl(ti,Ie),Cu(bs=>{const Fe=new Set(bs);return Fe.delete(Ie),Fe})),ra(null)}},Ve=pe=>m.jsxs("button",{draggable:!0,onDragStart:Ie=>Y(Ie,pe.id),onDragEnd:ce,onClick:()=>yo(pe.id),onContextMenu:Ie=>{Ie.preventDefault(),os(pe.id),hf({x:Ie.clientX,y:Ie.clientY})},className:`group flex items-center gap-2.5 pl-1.5 pr-4 py-2 rounded-xl transition-all duration-300 flex-shrink-0 cursor-grab active:cursor-grabbing
                                        ${t===pe.id?"bg-white/15 text-white shadow-lg shadow-black/30 ring-1 ring-white/20":"hover:bg-white/10 text-zinc-400 hover:text-zinc-200"}
                                        ${ta===pe.id?"opacity-50 scale-95":""}`,children:[m.jsx("div",{className:`w-9 h-9 rounded-lg bg-gradient-to-br ${pe.color??"from-gray-700 to-gray-900"} p-[2px] flex-shrink-0`,children:m.jsx("img",{src:pe.icon||"",alt:"",className:"w-full h-full rounded-lg bg-black/60 object-cover",draggable:!1})}),m.jsx("span",{className:"text-sm font-semibold whitespace-nowrap",children:pe.name})]},pe.id);return m.jsxs(m.Fragment,{children:[m.jsx("button",{onClick:()=>et(pe=>({...pe,create:!0})),className:"w-11 h-11 rounded-xl border-2 border-dashed border-white/20 flex items-center justify-center text-zinc-500 hover:text-orange-400 hover:border-orange-500/50 hover:bg-orange-500/10 transition-all flex-shrink-0 order-first",title:"Sunucu olutur",children:m.jsx(Hc,{size:20})}),m.jsx("div",{onDragOver:pe=>{pe.preventDefault(),pe.dataTransfer.dropEffect="move",ta&&as(!0),na&&hn.length>0&&as(!0)},onDragLeave:()=>{as(!1),ls(null)},onDrop:me,className:`flex items-center gap-2 flex-shrink-0 min-w-[80px] rounded-xl transition-colors ${Ol?"bg-orange-500/20 ring-2 ring-orange-500/50 ring-inset":""}`,children:J.map(Ve)}),hn.map(pe=>{const Ie=_.filter(Fe=>Fn[Fe.id]===pe.id),Rt=El.has(pe.id),ti=Pt===pe.id,bs=sa===pe.id;return m.jsxs("div",{draggable:!0,onDragStart:Fe=>{ia(pe.id),Fe.dataTransfer.setData("application/x-folder-id",pe.id),Fe.dataTransfer.effectAllowed="move",Fe.dataTransfer.setDragImage(Fe.currentTarget,0,0)},onDragEnd:ce,className:`flex items-center gap-1 flex-shrink-0 rounded-xl transition-colors cursor-grab active:cursor-grabbing
                                                    ${ti?"bg-orange-500/20 ring-2 ring-orange-500/50 ring-inset":""}
                                                    ${bs?"ring-2 ring-amber-500/60 ring-inset":""}
                                                    ${na===pe.id?"opacity-50":""}`,onDragOver:Fe=>{Fe.preventDefault(),Fe.dataTransfer.dropEffect="move",na&&na!==pe.id&&ls(pe.id),ta&&ra(pe.id)},onDragLeave:()=>{ra(Fe=>Fe===pe.id?null:Fe),ls(Fe=>Fe===pe.id?null:Fe)},onDrop:Fe=>Oe(Fe,pe.id),children:[m.jsxs("button",{type:"button",onClick:()=>Mu(pe.id),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg text-zinc-500 hover:text-zinc-300 hover:bg-white/5 transition-colors flex-shrink-0",title:Rt?"A":"Kapat",children:[m.jsx(OE,{size:16,className:`transition-transform ${Rt?"":"rotate-90"}`}),m.jsx(Ab,{size:14}),m.jsx("span",{className:"text-xs font-medium",children:pe.name})]}),m.jsx("div",{className:"flex items-center gap-2",children:!Rt&&Ie.map(Ve)})]},pe.id)})]})})()})]}),Xn&&Hs.createPortal(m.jsx("div",{className:"fixed inset-0 z-[200]",onClick:()=>os(null),children:m.jsxs("div",{className:"absolute bg-[#18181b] border border-white/10 rounded-xl shadow-2xl py-1 min-w-[200px] overflow-hidden",style:{left:Pl.x,top:Pl.y},onClick:_=>_.stopPropagation(),children:[m.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-zinc-500 uppercase tracking-wider border-b border-white/5",children:"Klasre ta"}),Fn[Xn]&&m.jsx("button",{type:"button",onClick:()=>Yl(Xn),className:"w-full text-left px-4 py-2 text-sm text-zinc-300 hover:bg-white/10 hover:text-white",children:"Klasrden kar"}),hn.map(_=>m.jsxs("button",{type:"button",onClick:()=>Jl(Xn,_.id),className:"w-full text-left px-4 py-2 text-sm text-zinc-300 hover:bg-white/10 hover:text-white flex items-center gap-2",children:[m.jsx(Ab,{size:14,className:"text-orange-500/80"}),_.name]},_.id)),m.jsxs("div",{className:"border-t border-white/5 mt-1 pt-1",children:[m.jsx("div",{className:"px-3 py-1.5 text-xs text-zinc-500",children:"Yeni klasr"}),m.jsxs("div",{className:"flex gap-1 px-3 pb-2",children:[m.jsx("input",{type:"text",value:Rl,onChange:_=>Nl(_.target.value),onKeyDown:_=>_.key==="Enter"&&Gl(),placeholder:"Klasr ad",className:"flex-1 bg-black/40 border border-white/10 rounded-lg px-3 py-1.5 text-sm text-white placeholder-zinc-500 focus:outline-none focus:ring-1 focus:ring-orange-500/50"}),m.jsx("button",{type:"button",onClick:Gl,className:"px-3 py-1.5 rounded-lg bg-orange-600 hover:bg-orange-500 text-white text-sm font-medium",children:"Ekle"})]})]})]})}),document.body),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("div",{className:"relative hidden lg:block group",children:[m.jsx(Jd,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500 group-hover:text-zinc-300",size:16}),m.jsx("input",{type:"text",value:_e,onChange:_=>Pe(_.target.value),placeholder:t==="dm"?"Arkada ara...":"Kanal ara...",className:"bg-black/20 border border-white/5 rounded-full py-2 pl-10 pr-4 text-sm w-48 focus:w-64 transition-all focus:outline-none focus:border-orange-500/50 placeholder-zinc-600"})]}),m.jsxs("div",{className:"relative",children:[m.jsxs("button",{onClick:_=>{_.stopPropagation(),Ce(!Ne)},className:"relative p-2 rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:[m.jsx(PE,{size:20}),ko>0&&m.jsx("span",{className:"absolute top-2 right-2 w-2.5 h-2.5 bg-orange-500 rounded-full animate-pulse border-2 border-[#09090b]"})]}),Ne&&m.jsxs("div",{onClick:_=>_.stopPropagation(),className:"absolute top-full right-0 mt-2 w-80 bg-[#121217] border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50",children:[m.jsxs("div",{className:"p-3 border-b border-white/5 flex justify-between items-center bg-white/5",children:[m.jsx("span",{className:"font-bold text-sm",children:"Bildirimler"}),m.jsx("button",{className:"text-xs text-orange-400 hover:text-orange-300",children:"Tmn Okundu aretle"})]}),m.jsx("div",{className:"max-h-64 overflow-y-auto",children:Gt.length===0?m.jsx("p",{className:"p-4 text-center text-zinc-500 text-sm",children:"Bildirim yok."}):Gt.map(_=>m.jsxs("div",{className:`p-3 border-b border-white/5 hover:bg-white/5 transition-colors cursor-pointer ${_.read?"":"bg-orange-500/5"}`,children:[m.jsx("p",{className:"text-sm text-zinc-200 mb-1",children:_.text}),m.jsxs("span",{className:"text-[10px] text-zinc-500",children:[_.time," nce"]})]},_.id))})]})]}),m.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-white/10 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>et(_=>({..._,profile:!0})),children:[m.jsxs("div",{className:"text-right hidden md:block",children:[m.jsx("div",{className:"text-sm font-bold text-white",children:Ge.username}),m.jsxs("div",{className:"text-xs text-green-400 flex items-center justify-end gap-1",children:[m.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${Ge.status==="online"?"bg-green-400":"bg-zinc-500"}`})," ",Ge.status==="online"?"evrimii":Ge.status]})]}),m.jsx(Xr,{src:Ge.avatar,size:"md",status:sl(Ge.status)})]})]})]}),m.jsxs("div",{className:"flex-1 flex overflow-hidden p-0 md:p-4 gap-4 relative",children:[zt&&m.jsxs("div",{className:"absolute inset-0 z-40 bg-[#09090b]/90 flex flex-col items-center justify-center",children:[m.jsx(qs,{size:48,className:"text-orange-500 animate-spin mb-4"}),m.jsx("p",{className:"text-zinc-400 font-medium tracking-wide",children:"Balant oksitleniyor..."})]}),m.jsx("div",{className:`
          absolute inset-y-0 left-0 z-30 w-72 bg-[#121217] md:bg-transparent md:static md:flex flex-col
          transform transition-transform duration-300 ease-in-out md:translate-x-0
          ${ke?"translate-x-0":"-translate-x-full"}
        `,children:m.jsx(Q1,{activeServerId:t,handleDmSelect:Kl,handleDragEnd:wo,filteredFriends:kf,activeDmUser:xt,setShowAddFriend:se,currentServer:vo,categories:wa,serverChannels:ba,activeChannelId:n,setActiveChannelId:i,setChannelType:h,connectedVoiceChannelId:f,setConnectedVoiceChannelId:g,setLastTextChannelIdForServer:E,setMobileMenuOpen:Te,setModals:et,setNewChannelCategory:Gn,sensors:wf,user:Ge,authUser:Qe,addToast:V,fetchVoiceChannelUsers:mf,setVoiceChannelUsers:R,onDeleteChannel:_f,onlineUserIds:Ml})}),ke&&m.jsx("div",{className:"fixed inset-0 bg-black/50 z-20 md:hidden",onClick:()=>Te(!1)}),m.jsx("div",{className:"flex-1 flex flex-col min-w-0 relative transition-all h-full",children:!n&&t!=="dm"&&!qe||t==="dm"&&!xt&&!qe?m.jsxs(Ko,{className:"flex-1 rounded-none md:rounded-3xl flex flex-col items-center justify-center text-center p-8 border-none md:border",children:[m.jsx("div",{className:"w-28 h-28 rounded-2xl bg-gradient-to-br from-orange-500/20 to-red-600/20 border border-orange-500/20 flex items-center justify-center mb-6",children:m.jsx(tm,{size:56,className:"text-orange-400/80"})}),m.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Sinyal Bekleniyor..."}),m.jsx("p",{className:"text-zinc-400 max-w-sm",children:"Sol taraftan bir kanal veya sohbet seerek iletiime bala."})]}):qe?m.jsx(Ko,{className:"flex-1 rounded-none md:rounded-3xl flex flex-col items-center justify-center p-8 border-none md:border",children:m.jsxs("div",{className:"max-w-md w-full",children:[m.jsx("h2",{className:"text-2xl font-bold text-white mb-6 text-center",children:"Arkada Ekle"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{value:Ci,onChange:_=>Pr(_.target.value),placeholder:"Kullanc ad gir (rn: NeoUser)",className:"flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-green-500"}),m.jsx(vn,{success:!0,onClick:Lu,disabled:!Ci,children:"Gnder"})]}),m.jsxs("div",{className:"mt-8",children:[m.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase mb-4",children:"nerilenler"}),m.jsx("div",{className:"space-y-2",children:["CyberPunk","Glitch","Matrix"].map(_=>m.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Xr,{src:`https://api.dicebear.com/7.x/notionists/svg?seed=${_}`,size:"sm",status:void 0,onClick:void 0}),m.jsx("span",{className:"font-bold",children:_})]}),m.jsx(vn,{onClick:()=>{Pr(_),Lu()},className:"h-8 px-3 py-0 text-xs bg-white/10",children:"Ekle"})]},_))})]})]})}):m.jsx(J1,{messages:rn,messagesLoading:t==="dm"?pi:Yn,typingUsers:Dl,user:Ge,inputVal:he,setInputVal:oe,onSendMessage:Du,onDeleteMessage:Tf,onEditMessage:Sf,bottomRef:ya,channelType:u,serverChannels:ba,activeChannelId:n,activeServerId:t,activeDmUser:xt,showMembers:L,setShowMembers:G,voiceState:I,setVoiceState:N,setActiveChannelId:i,setChannelType:h,setConnectedVoiceChannelId:g,setVoiceChannelUsers:R,addToast:V,voiceChannelUsers:P,livekitSpeakingIds:j,livekitVideoTracks:F,livekitFocusedKey:q,setLivekitFocusedKey:Q,livekitPinnedKey:ne,setLivekitPinnedKey:Se,livekitFullscreen:De,setLivekitFullscreen:Ke,attachmentPreviewUrl:Bn,attachmentName:Nr?.name??"",onAttachmentSelect:xf,onAttachmentClear:Wl})}),L&&n&&u==="text"&&t!=="dm"&&!qe&&m.jsxs(Ko,{className:"w-64 rounded-3xl overflow-hidden hidden lg:flex flex-col flex-shrink-0 border-white/5 border-l-0 md:border-l",children:[m.jsx("div",{className:"p-4 border-b border-white/5 bg-black/20",children:m.jsxs("h3",{className:"font-bold text-sm uppercase tracking-wider text-zinc-500",children:["evrimii  ",nt.filter(_=>Ml.has(_.id)).length," / ",nt.length]})}),m.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:nt.length===0?m.jsx("p",{className:"text-zinc-500 text-sm",children:"ye listesi ykleniyor..."}):nt.map(_=>m.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-xl hover:bg-white/5 cursor-pointer transition-colors group",children:[m.jsx(Xr,{src:_.avatar,size:"sm",status:Ml.has(_.id)?"online":"idle",onClick:void 0}),m.jsxs("div",{className:"min-w-0",children:[m.jsx("div",{className:"font-medium text-sm text-zinc-200 truncate",children:_.username}),m.jsx("div",{className:"text-[10px] text-zinc-500 truncate",children:_.role==="owner"?"Ynetici ":"Topluluk yesi"})]})]},_.id))})]})]}),m.jsx(Lo,{isOpen:$t.create,onClose:()=>et(_=>({..._,create:!1})),title:"Yeni Bir Balang",children:m.jsxs("div",{className:"space-y-4",children:[m.jsxs("button",{onClick:()=>et(_=>({..._,create:!1,createServer:!0})),className:"w-full p-4 bg-white/5 border border-white/10 rounded-xl flex items-center justify-between hover:border-orange-500 hover:bg-orange-500/10 transition-all group",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"p-3 bg-orange-500/20 rounded-full text-orange-500 group-hover:scale-110 transition-transform",children:m.jsx(Hc,{size:24})}),m.jsxs("div",{className:"text-left",children:[m.jsx("div",{className:"font-bold text-white text-lg",children:"Kendi Evrenini Yarat"}),m.jsx("div",{className:"text-zinc-400 text-sm",children:"Arkadalarn iin yeni bir sunucu."})]})]}),m.jsx(fh,{className:"-rotate-90 text-zinc-500 group-hover:text-white"})]}),m.jsxs("button",{onClick:()=>et(_=>({..._,create:!1,joinServer:!0})),className:"w-full p-4 bg-white/5 border border-white/10 rounded-xl flex items-center justify-between hover:border-green-500 hover:bg-green-500/10 transition-all group",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"p-3 bg-green-500/20 rounded-full text-green-500 group-hover:scale-110 transition-transform",children:m.jsx(BE,{size:24})}),m.jsxs("div",{className:"text-left",children:[m.jsx("div",{className:"font-bold text-white text-lg",children:"Bir Evrene Katl"}),m.jsx("div",{className:"text-zinc-400 text-sm",children:"Davet kodun var m?"})]})]}),m.jsx(fh,{className:"-rotate-90 text-zinc-500 group-hover:text-white"})]})]})}),m.jsx(Lo,{isOpen:$t.createServer,onClose:()=>et(_=>({..._,createServer:!1})),title:"Evrenini Tasarla",children:m.jsxs("div",{className:"text-center space-y-6 py-4",children:[m.jsx("div",{className:"w-24 h-24 bg-white/5 border-2 border-dashed border-zinc-500 rounded-full mx-auto flex items-center justify-center hover:border-orange-500 hover:text-orange-500 cursor-pointer transition-colors text-zinc-500 group overflow-hidden",onClick:()=>Au.current?.click(),children:kt?m.jsx("img",{src:kt,className:"w-full h-full object-cover"}):m.jsx(UE,{size:32,className:"group-hover:scale-110 transition-transform"})}),m.jsx("input",{ref:Au,type:"file",accept:"image/*",className:"hidden",onChange:Pf}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-left text-xs font-bold text-zinc-400 uppercase mb-2",children:"Evren Ad"}),m.jsx("input",{value:dn,onChange:_=>Jn(_.target.value),type:"text",placeholder:"Oxide Topluluu",className:"w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-orange-500 transition-colors font-medium"})]}),m.jsx(vn,{primary:!0,className:"w-full py-3",onClick:ys,disabled:!dn||va,children:va?m.jsxs(m.Fragment,{children:[m.jsx(qs,{className:"animate-spin inline mr-2",size:18})," Oluturuluyor..."]}):"Balat"})]})}),m.jsx(Lo,{isOpen:$t.joinServer,onClose:()=>et(_=>({..._,joinServer:!1})),title:"Davet Kodu Gir",children:m.jsxs("div",{className:"space-y-6 py-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-left text-xs font-bold text-zinc-400 uppercase mb-2",children:"Davet Kodu"}),m.jsx("input",{value:Cr,onChange:_=>rs(_.target.value),type:"text",placeholder:"rn: oxide-space",className:"w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-green-500 transition-colors font-medium"}),m.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"Davet kodlar byk/kk harf duyarldr."})]}),m.jsx(vn,{success:!0,className:"w-full py-3",onClick:If,disabled:!Cr,children:"Katl"})]})}),m.jsx(Lo,{isOpen:$t.serverSettings,onClose:()=>et(_=>({..._,serverSettings:!1})),title:"Sunucu Ayarlar",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-4 p-4 bg-white/5 rounded-xl border border-white/5",children:[m.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-orange-500 to-red-600 p-0.5",children:m.jsx("img",{src:vo.icon||"",className:"w-full h-full rounded-full object-cover bg-black"})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-bold text-white",children:vo.name}),m.jsxs("span",{className:"text-xs text-zinc-500",children:["ID: ",vo.id]})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-2",children:"Sunucu Ad"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{type:"text",defaultValue:vo.name,className:"flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-white focus:outline-none focus:border-orange-500"}),m.jsx(vn,{children:"Kaydet"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-500 uppercase mb-2",children:"Davet Kodu"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("input",{type:"text",value:or,readOnly:!0,placeholder:"Henz davet kodu yok",className:"flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-2 text-white focus:outline-none focus:border-green-500"}),m.jsx(vn,{success:!0,onClick:bo,disabled:ss||t==="dm",children:ss?"Oluturuluyor...":"Olutur"}),m.jsx(vn,{onClick:Nf,disabled:!or,children:"Kopyala"})]}),m.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"Davet kodu byk/kk harf duyarldr."})]}),m.jsx("div",{className:"h-px bg-white/5 my-4"}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-bold text-white mb-2",children:"Tehlikeli Blge"}),m.jsxs("div",{className:"border border-red-900/30 bg-red-900/10 rounded-xl p-4 flex justify-between items-center",children:[m.jsxs("div",{children:[m.jsx("div",{className:"font-bold text-red-200",children:"Sunucuyu Sil"}),m.jsx("div",{className:"text-xs text-red-400",children:"Bu ilem geri alnamaz."})]}),m.jsx(vn,{danger:!0,className:"h-8 text-xs",children:"Sil"})]})]})]})}),m.jsx(Lo,{isOpen:$t.addChannel,onClose:()=>et(_=>({..._,addChannel:!1})),title:"Yeni Frekans Olutur",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-400 uppercase mb-2",children:"Kanal Tr"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{onClick:()=>be("text"),className:`flex items-center justify-between p-4 rounded-xl cursor-pointer border transition-all ${en==="text"?"bg-orange-500/20 border-orange-500":"bg-black/20 border-white/5 hover:bg-white/5"}`,children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(ov,{size:24,className:"text-zinc-300"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-bold text-white",children:"Metin Kanal"}),m.jsx("div",{className:"text-xs text-zinc-400",children:"Grsel, yaz ve kod paralar."})]})]}),en==="text"&&m.jsx(Qm,{size:20,className:"text-orange-500"})]}),m.jsxs("div",{onClick:()=>be("voice"),className:`flex items-center justify-between p-4 rounded-xl cursor-pointer border transition-all ${en==="voice"?"bg-orange-500/20 border-orange-500":"bg-black/20 border-white/5 hover:bg-white/5"}`,children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(ph,{size:24,className:"text-zinc-300"}),m.jsxs("div",{children:[m.jsx("div",{className:"font-bold text-white",children:"Ses Kanal"}),m.jsx("div",{className:"text-xs text-zinc-400",children:"Sesli sohbet, ekran paylam."})]})]}),en==="voice"&&m.jsx(Qm,{size:20,className:"text-orange-500"})]})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-400 uppercase mb-2",children:"Kanal Ad"}),m.jsx("input",{value:Hn,onChange:_=>Zt(_.target.value),type:"text",placeholder:"genel-sohbet",className:"w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-orange-500 transition-colors"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-400 uppercase mb-2",children:"Kategori"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{value:jt,onChange:_=>Gn(_.target.value.toUpperCase()),list:"categories-list",type:"text",placeholder:"GENEL",className:"w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-orange-500 transition-colors"}),m.jsx("datalist",{id:"categories-list",children:Object.keys(wa).map(_=>m.jsx("option",{value:_},_))})]})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx(vn,{onClick:()=>et(_=>({..._,addChannel:!1})),children:"ptal"}),m.jsx(vn,{primary:!0,onClick:Cf,disabled:!Hn||ql,children:ql?m.jsxs(m.Fragment,{children:[m.jsx(qs,{className:"animate-spin inline mr-2",size:16})," Oluturuluyor..."]}):"Olutur"})]})]})}),m.jsx(Lo,{isOpen:$t.createCategory,onClose:()=>et(_=>({..._,createCategory:!1})),title:"Kategori Olutur",children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs font-bold text-zinc-400 uppercase mb-2",children:"Kategori Ad"}),m.jsx("input",{value:xn,onChange:_=>Sn(_.target.value),type:"text",placeholder:"OYUN ODALARI",className:"w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-orange-500 transition-colors uppercase"}),m.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"Bu kategorinin iine hemen bir kanal eklemen gerekecek."})]}),m.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[m.jsx(vn,{onClick:()=>et(_=>({..._,createCategory:!1})),children:"ptal"}),m.jsx(vn,{primary:!0,onClick:Ef,disabled:!xn,children:"Devam Et"})]})]})}),m.jsx(Lo,{isOpen:$t.profile,onClose:()=>{et(_=>({..._,profile:!1})),ur(!1)},title:"Profil",children:m.jsxs("div",{className:"-mx-6",children:[m.jsx("div",{className:`h-32 ${Ge.bannerColor} w-full relative`}),m.jsxs("div",{className:"px-6 -mt-14 relative",children:[m.jsx("div",{ref:po,className:"inline-block p-1 bg-[#121217] rounded-2xl shadow-lg border border-white/5 overflow-visible",children:m.jsx("button",{type:"button",onClick:()=>ur(!Bi),className:"block rounded-[1.25rem] ring-2 ring-transparent focus:ring-2 focus:ring-orange-500/50 focus:outline-none overflow-visible",children:m.jsx(Xr,{src:Ge.avatar,size:"xl",status:sl(Ge.status),className:"rounded-[1.25rem]"})})}),Bi&&Dr&&Hs.createPortal(m.jsxs("div",{id:"profile-status-menu",role:"menu",className:"fixed z-[200] min-w-[11rem] py-1.5 px-1 bg-[#18181b] border border-white/10 rounded-xl shadow-2xl",style:{top:Dr.top,left:Dr.left},children:[m.jsx("div",{className:"px-3 py-2 text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Durum"}),[{key:"online",label:"evrimii",dot:"bg-green-500"},{key:"idle",label:"Bota",dot:"bg-yellow-500"},{key:"dnd",label:"Rahatsz etmeyin",dot:"bg-red-500"},{key:"invisible",label:"Grnmez",dot:"bg-zinc-500"}].map(({key:_,label:J,dot:Y})=>m.jsxs("button",{type:"button",role:"menuitem",onClick:()=>{Fu(_),ur(!1)},className:"w-full flex items-center gap-3 py-2.5 px-3 rounded-lg text-left text-sm text-white hover:bg-white/5 whitespace-nowrap",children:[m.jsx("div",{className:`w-3 h-3 rounded-full shrink-0 ${Y}`}),m.jsx("span",{children:J})]},_))]}),document.body),m.jsxs("div",{className:"mt-4 flex flex-wrap items-start justify-between gap-3",children:[m.jsxs("div",{className:"min-w-0 flex-1",children:[m.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2 flex-wrap",children:[m.jsx("span",{className:"truncate",children:Ge.username}),m.jsx("span",{className:"text-zinc-500 font-normal text-base",children:Ge.discriminator}),Ge.badges.map(_=>m.jsx(a5,{type:_},_))]}),m.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[(()=>{const _=sl(Ge.status)??"online",J={online:{label:"evrimii",dot:"bg-green-500"},idle:{label:"Bota",dot:"bg-yellow-500"},dnd:{label:"Rahatsz etmeyin",dot:"bg-red-500"},invisible:{label:"Grnmez",dot:"bg-zinc-500"}},{label:Y,dot:ce}=J[_]??J.online;return m.jsxs("button",{type:"button",onClick:()=>ur(!Bi),className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-white/5 border border-white/10 hover:bg-white/10 transition-colors text-left",children:[m.jsx("span",{className:`w-2 h-2 rounded-full shrink-0 ${ce}`}),m.jsx("span",{className:"text-zinc-300",children:Y})]})})(),m.jsxs("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(`${Ge.username}${Ge.discriminator}`),V("Etiket kopyaland","success")},className:"text-xs text-zinc-500 hover:text-zinc-300 flex items-center gap-1.5 transition-colors",children:[m.jsx(jE,{size:12})," Etiketi kopyala"]})]})]}),m.jsx(vn,{onClick:()=>{et(_=>({..._,profile:!1,settings:!0})),Ul("Hesabm")},className:"bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/20 text-xs py-2 px-4 shrink-0",children:"Profili Dzenle"})]})]}),m.jsx("div",{className:"px-6 mt-6 flex gap-1 border-b border-white/5",children:["Genel Bak","Aktivite","Balantlar"].map(_=>{const J=_==="Genel Bak"?"overview":_==="Aktivite"?"activity":"connections";return m.jsx("button",{type:"button",onClick:()=>Nu(J),className:`pb-3 px-1 text-sm font-semibold border-b-2 -mb-px transition-colors ${jr===J?"text-white border-orange-500":"text-zinc-500 border-transparent hover:text-zinc-300"}`,children:_},_)})}),m.jsxs("div",{className:"p-6 min-h-[220px] bg-[#0c0c0f]/80",children:[jr==="overview"&&m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Kullanc ad"}),gs?m.jsxs("div",{className:"space-y-2",children:[m.jsx("input",{value:vs,onChange:_=>$l(_.target.value),className:"w-full bg-black/40 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500/30 outline-none transition-colors",placeholder:"kullanici_adi",autoFocus:!0}),m.jsxs("div",{className:"flex gap-2 justify-end",children:[m.jsx("button",{type:"button",onClick:()=>{ho(!1),$l(Ge.username)},className:"text-sm text-zinc-400 hover:text-white px-3 py-1.5 rounded-lg hover:bg-white/5",children:"ptal"}),m.jsxs("button",{type:"button",onClick:Uu,className:"text-sm bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg flex items-center gap-1.5",children:[m.jsx(Ub,{size:14})," Kaydet"]})]})]}):m.jsxs("button",{type:"button",onClick:()=>{$l(Ge.username),ho(!0)},className:"w-full text-left text-sm p-3 rounded-xl border border-transparent hover:border-white/10 hover:bg-white/5 transition-colors flex items-center justify-between group",children:[m.jsx("span",{className:"text-white font-medium",children:Ge.username}),m.jsx(Lb,{size:14,className:"text-zinc-500 opacity-0 group-hover:opacity-100"})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Etiket"}),m.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5",children:[m.jsx("span",{className:"text-white font-medium",children:Ge.discriminator}),m.jsx("span",{className:"text-xs text-zinc-500",children:"Premium ile deitirilebilir"})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"Hakkmda"}),ma?m.jsxs("div",{className:"space-y-2",children:[m.jsx("textarea",{value:ga,onChange:_=>On(_.target.value),className:"w-full bg-black/40 border border-white/10 rounded-xl p-3 text-sm text-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500/30 outline-none resize-none h-24 transition-colors",placeholder:"Kendini ksaca tant...",autoFocus:!0}),m.jsxs("div",{className:"flex gap-2 justify-end",children:[m.jsx("button",{type:"button",onClick:()=>ms(!1),className:"text-sm text-zinc-400 hover:text-white px-3 py-1.5 rounded-lg hover:bg-white/5",children:"ptal"}),m.jsxs("button",{type:"button",onClick:Of,className:"text-sm bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg flex items-center gap-1.5",children:[m.jsx(Ub,{size:14})," Kaydet"]})]})]}):m.jsxs("button",{type:"button",onClick:()=>{On(Ge.bio),ms(!0)},className:"w-full text-left text-sm p-3 rounded-xl border border-transparent hover:border-white/10 hover:bg-white/5 transition-colors min-h-[4rem] group",children:[m.jsx("span",{className:Ge.bio?"text-zinc-300":"text-zinc-500 italic",children:Ge.bio||"Biyografi ekle veya buraya tkla..."}),m.jsx(Lb,{size:14,className:"float-right mt-1 text-zinc-500 opacity-0 group-hover:opacity-100"})]})]}),m.jsxs("div",{className:"space-y-1 pt-2 border-t border-white/5",children:[m.jsx("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"yelik"}),m.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center shrink-0",children:m.jsx(RE,{size:20,className:"text-zinc-400"})}),m.jsxs("div",{className:"min-w-0",children:[m.jsx("div",{className:"text-sm font-medium text-white",children:"OxideSpace yesi"}),m.jsx("div",{className:"text-xs text-zinc-500",children:"Katlm tarihi yaknda"})]})]})]})]}),jr==="activity"&&m.jsxs("div",{children:[m.jsxs("div",{className:"bg-gradient-to-r from-green-900/20 to-black border border-green-500/20 rounded-2xl p-4 flex items-center gap-4",children:[m.jsxs("div",{className:"w-16 h-16 bg-zinc-800 rounded-xl flex items-center justify-center relative overflow-hidden group",children:[m.jsx(Mb,{size:32,className:"text-green-500 relative z-10"}),m.jsx("div",{className:"absolute inset-0 bg-green-500/20 animate-pulse"})]}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-xs font-bold text-green-500 uppercase mb-0.5",children:"Spotify dinliyor"}),m.jsx("div",{className:"font-bold text-white",children:"Cyberpunk 2077 OST"}),m.jsx("div",{className:"text-xs text-zinc-400",children:"P.T. Adamczyk"}),m.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full mt-3 overflow-hidden",children:m.jsx("div",{className:"w-1/3 h-full bg-white rounded-full"})})]})]}),m.jsxs("div",{className:"mt-4 bg-white/5 border border-white/5 rounded-2xl p-4 flex items-center gap-4 opacity-50",children:[m.jsx("div",{className:"w-12 h-12 bg-indigo-500/20 rounded-xl flex items-center justify-center",children:m.jsx(Zx,{size:24,className:"text-indigo-400"})}),m.jsxs("div",{children:[m.jsx("div",{className:"font-bold text-white",children:"Visual Studio Code"}),m.jsx("div",{className:"text-xs text-zinc-400",children:"Editing OneFile.jsx"})]}),m.jsx("div",{className:"ml-auto text-xs text-zinc-500",children:"4s"})]})]}),jr==="connections"&&m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/40 border border-white/5 rounded-xl",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(ME,{size:20,className:"text-white"}),m.jsx("span",{className:"font-bold text-sm",children:"NeoDeveloper"})]}),m.jsx(Ym,{className:"text-zinc-500 w-4 h-4"})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#1DB954]/10 border border-[#1DB954]/20 rounded-xl",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Mb,{size:20,className:"text-[#1DB954]"}),m.jsx("span",{className:"font-bold text-sm",children:"NeoMusic"})]}),m.jsx(Ym,{className:"text-zinc-500 w-4 h-4"})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#5865F2]/10 border border-[#5865F2]/20 rounded-xl",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(AE,{size:20,className:"text-[#5865F2]"}),m.jsx("span",{className:"font-bold text-sm",children:"Buy Me a Coffee"})]}),m.jsx(Ym,{className:"text-zinc-500 w-4 h-4"})]})]})]})]})}),$t.settings&&m.jsxs("div",{className:"fixed inset-0 z-[200] bg-[#09090b] flex",children:[m.jsxs("div",{className:"w-80 bg-[#121217] p-6 flex flex-col border-r border-white/5 overflow-y-auto",children:[m.jsx("h2",{className:"font-bold text-xs text-zinc-500 uppercase mb-4 px-2 tracking-wider",children:"Ayarlar"}),m.jsxs("div",{className:"space-y-1 mb-6",children:[["Hesabm","Grnm","Ses ve Grnt","Gizlilik"].map(_=>m.jsx("div",{onClick:()=>Ul(_),className:`px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-colors ${hs===_?"bg-orange-600/20 text-white":"text-zinc-400 hover:bg-white/5 hover:text-zinc-200"}`,children:_},_)),m.jsx("div",{className:"my-4 h-px bg-white/5"}),m.jsxs("div",{onClick:()=>et(_=>({..._,settings:!1})),className:"px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium text-rose-400 hover:bg-rose-500/10 flex items-center justify-between group",children:["k Yap ",m.jsx(VE,{size:16,className:"group-hover:translate-x-1 transition-transform"})]})]})]}),m.jsxs("div",{className:"flex-1 bg-[#09090b] p-8 md:p-12 overflow-y-auto relative custom-scrollbar",children:[m.jsxs("button",{onClick:()=>et(_=>({..._,settings:!1})),className:"fixed top-8 right-8 w-10 h-10 border border-zinc-600 rounded-full flex flex-col items-center justify-center text-zinc-400 hover:text-white hover:border-white transition-all bg-black/50 backdrop-blur-sm z-50",children:[m.jsx(Go,{size:20}),m.jsx("span",{className:"text-[9px] font-bold mt-0.5",children:"ESC"})]}),m.jsxs("div",{className:"max-w-3xl mx-auto",children:[hs==="Hesabm"&&m.jsxs(m.Fragment,{children:[m.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Hesabm"}),m.jsx("p",{className:"text-zinc-500 text-sm mb-8",children:"Profil bilgilerini ve hesap ayarlarn ynet."}),m.jsxs("div",{className:"rounded-2xl border border-white/10 bg-[#121217]/80 overflow-hidden mb-8",children:[m.jsxs("div",{className:"p-6 flex flex-wrap items-center gap-4 sm:gap-6",children:[m.jsx(Xr,{src:Ge.avatar,size:"xl",status:sl(Ge.status),className:"border-4 border-[#09090b] shrink-0"}),m.jsxs("div",{className:"min-w-0 flex-1",children:[m.jsxs("div",{className:"text-xl font-bold text-white",children:[Ge.username,m.jsx("span",{className:"text-zinc-500 font-normal ml-1",children:Ge.discriminator})]}),m.jsx("p",{className:"text-zinc-500 text-sm mt-0.5",children:"Profil fotoraf ve kullanc ad"})]}),m.jsx(vn,{primary:!0,onClick:()=>{et(_=>({..._,settings:!1,profile:!0}))},className:"shrink-0",children:"Profili Dzenle"})]}),m.jsx("div",{className:"border-t border-white/5 divide-y divide-white/5",children:m.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[m.jsxs("div",{children:[m.jsx("div",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider",children:"E-posta"}),m.jsx("div",{className:"text-white font-medium mt-0.5",children:Qe?.email??""})]}),m.jsx("span",{className:"text-xs text-zinc-500",children:"Dorulanm hesap"})]})})]})]}),hs==="Grnm"&&m.jsxs(m.Fragment,{children:[m.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Grnm"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/5 flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(GE,{size:24})," ",m.jsx("span",{children:"Karanlk Mod"})]}),m.jsx("div",{className:"w-6 h-6 bg-orange-500 rounded-full border-4 border-[#121217] ring-2 ring-orange-500"})]}),m.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/5 flex items-center justify-between opacity-50 cursor-not-allowed",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(sP,{size:24})," ",m.jsx("span",{children:"Aydnlk Mod"})]}),m.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-zinc-600"})]})]})]}),hs==="Ses ve Grnt"&&m.jsxs(m.Fragment,{children:[m.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Ses ve Grnt"}),m.jsxs("div",{className:"space-y-8",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Ses Aygtlar"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase mb-2 block",children:"Giri Aygt"}),m.jsxs("select",{value:ar,onChange:_=>ua(_.target.value),className:"w-full p-3 bg-black/40 border border-white/10 rounded-xl text-white focus:outline-none focus:border-orange-500",children:[m.jsx("option",{value:"",children:"Varsaylan Mikrofon"}),fs.filter(_=>_.kind==="audioinput").map(_=>m.jsx("option",{value:_.deviceId,children:_.label||`Mikrofon ${_.deviceId.substring(0,8)}`},_.deviceId))]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase mb-2 block",children:"k Aygt"}),m.jsxs("select",{value:mi,onChange:_=>lr(_.target.value),className:"w-full p-3 bg-black/40 border border-white/10 rounded-xl text-white focus:outline-none focus:border-orange-500",children:[m.jsx("option",{value:"",children:"Varsaylan Hoparlr"}),fs.filter(_=>_.kind==="audiooutput").map(_=>m.jsx("option",{value:_.deviceId,children:_.label||`Hoparlr ${_.deviceId.substring(0,8)}`},_.deviceId))]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Ses Seviyeleri"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-2",children:[m.jsx("span",{children:"Giri Seviyesi"}),m.jsxs("span",{children:[Or,"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"100",value:Or,onChange:_=>vf(Number(_.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-orange-500"})]}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-2",children:[m.jsx("span",{children:"k Seviyesi"}),m.jsxs("span",{children:[Fl,"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"100",value:Fl,onChange:_=>da(Number(_.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-orange-500"})]}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-2",children:[m.jsx("span",{children:"Giri Hassasiyeti"}),m.jsxs("span",{children:[Bl,"%"]})]}),m.jsx("input",{type:"range",min:"0",max:"100",value:Bl,onChange:_=>yf(Number(_.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-orange-500"})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Ses Gelitirmeleri"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/40 border border-white/10 rounded-xl",children:[m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-white",children:"Yank ptali"}),m.jsx("div",{className:"text-xs text-zinc-500",children:"Mikrofonunuzdan gelen yanky azaltr"})]}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:ps,onChange:_=>co(_.target.checked),className:"sr-only peer"}),m.jsx("div",{className:"w-11 h-6 bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/40 border border-white/10 rounded-xl",children:[m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-white",children:"Grlt Bastrma"}),m.jsx("div",{className:"text-xs text-zinc-500",children:"Arka plan grltsn azaltr"})]}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:Ar,onChange:_=>ha(_.target.checked),className:"sr-only peer"}),m.jsx("div",{className:"w-11 h-6 bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),m.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/40 border border-white/10 rounded-xl",children:[m.jsxs("div",{children:[m.jsx("div",{className:"font-medium text-white",children:"Otomatik Kazan Kontrol"}),m.jsx("div",{className:"text-xs text-zinc-500",children:"Ses seviyesini otomatik ayarlar"})]}),m.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[m.jsx("input",{type:"checkbox",checked:Ru,onChange:_=>bf(_.target.checked),className:"sr-only peer"}),m.jsx("div",{className:"w-11 h-6 bg-zinc-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-orange-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Video Aygtlar"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase mb-2 block",children:"Kamera"}),m.jsxs("select",{value:Zn,onChange:_=>lo(_.target.value),className:"w-full p-3 bg-black/40 border border-white/10 rounded-xl text-white focus:outline-none focus:border-orange-500",children:[m.jsx("option",{value:"",children:"Varsaylan Kamera"}),gf.map(_=>m.jsx("option",{value:_.deviceId,children:_.label||`Kamera ${_.deviceId.substring(0,8)}`},_.deviceId))]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs font-bold text-zinc-500 uppercase mb-2 block",children:"Video Kalitesi"}),m.jsxs("select",{value:Vl,onChange:_=>fa(_.target.value),className:"w-full p-3 bg-black/40 border border-white/10 rounded-xl text-white focus:outline-none focus:border-orange-500",children:[m.jsx("option",{value:"480p",children:"480p (SD)"}),m.jsx("option",{value:"720p",children:"720p (HD)"}),m.jsx("option",{value:"1080p",children:"1080p (Full HD)"})]})]})]})]}),m.jsx("div",{className:"h-px bg-white/5"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Test ve nizleme"}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(vn,{className:"flex-1",icon:rP,onClick:async()=>{if(Ir)ca(!1),ao(0);else{ca(!0);try{const _={audio:{deviceId:ar?{exact:ar}:void 0,echoCancellation:ps,noiseSuppression:Ar,autoGainControl:Ru}},J=await navigator.mediaDevices.getUserMedia(_),Y=new AudioContext,ce=Y.createAnalyser();Y.createMediaStreamSource(J).connect(ce),ce.fftSize=256,ce.smoothingTimeConstant=.8;const Oe=new Uint8Array(ce.frequencyBinCount);let Ve;const pe=()=>{if(!Ir){Ve&&cancelAnimationFrame(Ve),J.getTracks().forEach(ti=>ti.stop()),Y.close();return}ce.getByteFrequencyData(Oe);const Ie=Oe.reduce((ti,bs)=>ti+bs)/Oe.length,Rt=Math.min(Ie/255*100*(Or/100),100);ao(Rt),Ve=requestAnimationFrame(pe)};pe()}catch(_){logger.error("Mic test error:",_),ca(!1),V("Mikrofon eriimi reddedildi","error")}}},children:Ir?"Testi Durdur":"Mikrofon Testi"}),m.jsx(vn,{className:"flex-1",icon:NE,onClick:async()=>{if(uo)ei&&(ei.getTracks().forEach(_=>_.stop()),pa(null)),zl(!1);else try{const _=await navigator.mediaDevices.getUserMedia({video:{deviceId:Zn||void 0}});pa(_),zl(!0)}catch(_){logger.error("Camera error:",_),V("Kamera eriimi reddedildi","error")}},children:uo?"nizlemeyi Kapat":"Kamera nizleme"})]}),Ir&&m.jsxs("div",{className:"bg-black/40 p-4 rounded-xl border border-white/10",children:[m.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-1",children:[m.jsx("span",{children:"Giri Seviyesi"}),m.jsxs("span",{children:[Math.round(la),"%"]})]}),m.jsx("div",{className:"w-full h-2 bg-white/10 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 via-yellow-500 to-orange-500 transition-all duration-100 ease-out",style:{width:`${Math.min(la,100)}%`}})})]}),uo&&ei&&m.jsx("div",{className:"bg-black/40 p-4 rounded-xl border border-white/10",children:m.jsx("video",{ref:_=>{_&&ei&&(_.srcObject=ei,_.play())},autoPlay:!0,muted:!0,className:"w-full rounded-lg",style:{maxHeight:"300px",objectFit:"contain"}})})]})]})]})]}),hs==="Gizlilik"&&m.jsxs(m.Fragment,{children:[m.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Gizlilik"}),m.jsxs("div",{className:"p-6 bg-orange-500/10 border border-orange-500/20 rounded-2xl mb-6",children:[m.jsxs("h3",{className:"font-bold text-orange-400 mb-2 flex items-center gap-2",children:[m.jsx(ZE,{size:20})," Gvenli Mod"]}),m.jsx("p",{className:"text-sm text-zinc-300",children:"OxideSpace tm mesajlarn utan uca ifreler. Verilerin gvende."})]})]})]})]})]})]}):Mr=m.jsx(B4,{onLogin:()=>{}}),Mr}const Ym=({className:t})=>m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[m.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),m.jsx("polyline",{points:"15 3 21 3 21 9"}),m.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]});class u5 extends S.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,n){this.setState({error:e,errorInfo:n})}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:m.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4",children:m.jsxs("div",{className:"max-w-md w-full bg-[#121217] border border-red-500/20 rounded-2xl p-6 space-y-4",children:[m.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[m.jsx(Bh,{size:24}),m.jsx("h2",{className:"text-xl font-bold",children:"Bir hata olutu"})]}),m.jsx("p",{className:"text-zinc-400 text-sm",children:"Uygulamada beklenmeyen bir hata meydana geldi. Ltfen sayfay yenileyin veya tekrar deneyin."}),this.state.error&&m.jsxs("details",{className:"mt-4 p-3 bg-black/40 rounded-lg border border-white/5",children:[m.jsx("summary",{className:"text-xs text-zinc-500 cursor-pointer mb-2",children:"Hata detaylar"}),m.jsxs("pre",{className:"text-xs text-red-400 overflow-auto max-h-40",children:[this.state.error.toString(),this.state.errorInfo?.componentStack]})]}),m.jsxs("button",{onClick:this.handleReset,className:"w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-xl font-medium flex items-center justify-center gap-2 transition-colors",children:[m.jsx(XE,{size:18}),"Tekrar Dene"]}),m.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-white/5 hover:bg-white/10 text-white px-4 py-2 rounded-xl font-medium transition-colors",children:"Sayfay Yenile"})]})}):this.props.children}}TE.createRoot(document.getElementById("root")).render(m.jsx(pt.StrictMode,{children:m.jsx(u5,{children:m.jsx(W4,{children:m.jsx(t5,{children:m.jsx(K4,{children:m.jsx(n5,{children:m.jsx(q4,{children:m.jsx(c5,{})})})})})})})}));
